{"version":3,"sources":["voice_code/events/websocket.cljs"],"mappings":"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","names":["re_frame.core.reg_event_fx","p__13389","map__13390","cljs.core/--destructure-map","cljs.core.get","db","_","map__13391","server-url","server-port","cljs.core/assoc-in","p__13392","map__13394","p__13395","p__13396","map__13397","vec__13398","cljs.core.nth","map__13401","code","reason","attempts","cljs.core.get_in","max-attempts","should-reconnect?","delay-ms","cljs.core.min","Math/pow","G__13405","cljs.core.update_in","cljs.core.fnil","cljs.core/inc","cljs.core.assoc","re_frame.core.reg_event_db","p__13407","vec__13408","error","p__13412","vec__13413","map__13416","type","msg","G__13417","js/console.warn","p__13420","p__13421","map__13422","vec__13423","map__13426","auth-version","p__13427","map__13428","map__13429","map__13430","api-key","ios-session-id","recent-sessions-limit","p__13431","p__13432","map__13433","vec__13434","map__13437","session-id","p__13438","vec__13439","map__13442","message","or__5142__auto__","p__13447","p__13448","map__13449","vec__13450","map__13453","success","text","message-id","usage","cost","cljs.core/conj","cljs.core/random-uuid","js/Date","cljs.core.update","cljs.core/disj","p__13455","vec__13456","p__13460","vec__13461","p__13464","vec__13465","map__13468","G__13469","p__13472","p__13473","map__13474","vec__13475","map__13478","map__13479","role","timestamp","cljs.core.keyword","p__13480","vec__13481","map__13484","sessions","cljs.core.reduce","session","p__13487","vec__13488","map__13491","p__13496","vec__13497","map__13500","name","working-directory","p__13501","vec__13502","map__13505","messages","cljs.core.mapv","p__13507","vec__13508","map__13511","updates","cljs.core/merge","cljs.core.dissoc","p__13513","vec__13514","map__13517","p__13518","vec__13519","map__13522","p__13523","vec__13524","map__13527","p__13528","vec__13529","map__13532","p__13533","map__13534","temp__5823__auto__","p__13535","p__13536","map__13537","vec__13538","last-message-id","cljs.core/last","G__13541","p__13542","vec__13543","map__13546","project-commands","general-commands","p__13549","vec__13550","map__13553","command-session-id","command-id","shell-command","p__13554","vec__13555","map__13558","stream","cljs.core/str","p__13559","vec__13560","map__13563","exit-code","duration-ms","cmd","cljs.core/dissoc","p__13564","vec__13565","map__13568","p__13569","vec__13570","map__13573","output","p__13574","vec__13575","map__13578","resources","p__13579","vec__13580","resource","cljs.core/dec","p__13584","vec__13585","map__13588","filename","p1__13583#","cljs.core.remove","cljs.core._EQ_","p__13589","vec__13590","map__13593","recipes","p__13594","vec__13595","map__13598","recipe-name","p__13599","vec__13600","map__13603","p__13604","p__13605","map__13606","vec__13607","map__13610","system-prompt","p__13611","p__13612","map__13613","vec__13614","and__5140__auto__","cljs.core/seq","p__13618","p__13619","map__13620","vec__13621"],"sourcesContent":["(ns voice-code.events.websocket\n  \"re-frame event handlers for WebSocket messages.\n   Implements all message types from STANDARDS.md protocol.\"\n  (:require [re-frame.core :as rf]\n            [voice-code.websocket :as ws]))\n\n;; ============================================================================\n;; Connection Events\n;; ============================================================================\n\n(rf/reg-event-fx\n :ws/connect\n (fn [{:keys [db]} _]\n   (let [{:keys [server-url server-port]} (:settings db)]\n     {:db (assoc-in db [:connection :status] :connecting)\n      :ws/connect {:server-url server-url\n                   :server-port server-port}})))\n\n(rf/reg-event-fx\n :ws/connected\n (fn [{:keys [db]} _]\n   {:db (assoc-in db [:connection :status] :connected)}))\n\n(rf/reg-event-fx\n :ws/disconnected\n (fn [{:keys [db]} [_ {:keys [code reason]}]]\n   (let [attempts (get-in db [:connection :reconnect-attempts] 0)\n         max-attempts 20\n         should-reconnect? (< attempts max-attempts)\n         delay-ms (when should-reconnect?\n                    (min (* 1000 (Math/pow 2 attempts)) 30000))]\n     (cond-> {:db (-> db\n                      (assoc-in [:connection :status] :disconnected)\n                      (assoc-in [:connection :authenticated?] false)\n                      (update-in [:connection :reconnect-attempts] (fnil inc 0)))\n              :ws/stop-ping-timer nil}\n       should-reconnect?\n       (assoc :ws/schedule-reconnect\n              {:delay-ms delay-ms\n               :config {:server-url (get-in db [:settings :server-url])\n                        :server-port (get-in db [:settings :server-port])}})))))\n\n(rf/reg-event-db\n :ws/error\n (fn [db [_ error]]\n   (assoc-in db [:connection :error] (str error))))\n\n;; ============================================================================\n;; Message Dispatcher\n;; ============================================================================\n\n(rf/reg-event-fx\n :ws/message-received\n (fn [_ [_ {:keys [type] :as msg}]]\n   (case type\n     ;; Connection lifecycle\n     \"hello\" {:dispatch [:ws/handle-hello msg]}\n     \"connected\" {:dispatch [:ws/handle-connected msg]}\n     \"auth_error\" {:dispatch [:ws/handle-auth-error msg]}\n\n     ;; Conversation\n     \"response\" {:dispatch [:ws/handle-response msg]}\n     \"ack\" {:dispatch [:ws/handle-ack msg]}\n     \"error\" {:dispatch [:ws/handle-error msg]}\n     \"replay\" {:dispatch [:ws/handle-replay msg]}\n\n     ;; Session management\n     \"session_list\" {:dispatch [:sessions/handle-list msg]}\n     \"recent_sessions\" {:dispatch [:sessions/handle-recent msg]}\n     \"session_created\" {:dispatch [:sessions/handle-created msg]}\n     \"session_history\" {:dispatch [:sessions/handle-history msg]}\n     \"session_updated\" {:dispatch [:sessions/handle-updated msg]}\n     \"turn_complete\" {:dispatch [:sessions/handle-turn-complete msg]}\n     \"session_locked\" {:dispatch [:sessions/handle-locked msg]}\n\n     ;; Commands\n     \"available_commands\" {:dispatch [:commands/handle-available msg]}\n     \"command_started\" {:dispatch [:commands/handle-started msg]}\n     \"command_output\" {:dispatch [:commands/handle-output msg]}\n     \"command_complete\" {:dispatch [:commands/handle-complete msg]}\n     \"command_history\" {:dispatch [:commands/handle-history msg]}\n     \"command_output_full\" {:dispatch [:commands/handle-output-full msg]}\n\n     ;; Compaction\n     \"compaction_complete\" {:dispatch [:sessions/handle-compaction-complete msg]}\n     \"compaction_error\" {:dispatch [:sessions/handle-compaction-error msg]}\n\n     ;; Resources\n     \"resources_list\" {:dispatch [:resources/handle-list msg]}\n     \"file_uploaded\" {:dispatch [:resources/handle-uploaded msg]}\n     \"resource_deleted\" {:dispatch [:resources/handle-deleted msg]}\n\n     ;; Recipes\n     \"available_recipes\" {:dispatch [:recipes/handle-available msg]}\n     \"recipe_started\" {:dispatch [:recipes/handle-started msg]}\n     \"recipe_exited\" {:dispatch [:recipes/handle-exited msg]}\n\n     ;; Keepalive\n     \"pong\" nil\n\n     ;; Unknown - log warning\n     (js/console.warn \"Unknown message type:\" type))))\n\n;; ============================================================================\n;; Hello/Connect Flow\n;; ============================================================================\n\n(rf/reg-event-fx\n :ws/handle-hello\n (fn [{:keys [db]} [_ {:keys [auth-version]}]]\n   {:db (assoc-in db [:connection :status] :authenticating)\n    :dispatch [:ws/send-connect]}))\n\n(rf/reg-event-fx\n :ws/send-connect\n (fn [{:keys [db]} _]\n   (let [{:keys [api-key ios-session-id]} db\n         {:keys [recent-sessions-limit]} (:settings db)]\n     {:ws/send {:type \"connect\"\n                :api-key api-key\n                :session-id ios-session-id\n                :recent-sessions-limit recent-sessions-limit}})))\n\n(rf/reg-event-fx\n :ws/handle-connected\n (fn [{:keys [db]} [_ {:keys [session-id]}]]\n   {:db (-> db\n            (assoc-in [:connection :status] :connected)\n            (assoc-in [:connection :authenticated?] true)\n            (assoc-in [:connection :reconnect-attempts] 0))\n    :ws/start-ping-timer nil\n    :dispatch [:sessions/resubscribe-all]}))\n\n(rf/reg-event-db\n :ws/handle-auth-error\n (fn [db [_ {:keys [message]}]]\n   (-> db\n       (assoc-in [:connection :status] :disconnected)\n       (assoc-in [:connection :authenticated?] false)\n       (assoc-in [:connection :error] (or message \"Authentication failed\")))))\n\n;; ============================================================================\n;; Response Handling\n;; ============================================================================\n\n(rf/reg-event-fx\n :ws/handle-response\n (fn [{:keys [db]} [_ {:keys [success text session-id message-id usage cost error]}]]\n   (if success\n     {:db (-> db\n              (update-in [:messages session-id] (fnil conj [])\n                         {:id (random-uuid)\n                          :session-id session-id\n                          :role :assistant\n                          :text text\n                          :timestamp (js/Date.)\n                          :status :confirmed})\n              (update :locked-sessions disj session-id))\n      :dispatch-n [[:ws/send-message-ack message-id]\n                   [:persistence/save-message session-id]]}\n     {:db (-> db\n              (assoc-in [:ui :current-error] error)\n              (update :locked-sessions disj session-id))})))\n\n(rf/reg-event-fx\n :ws/send-message-ack\n (fn [_ [_ message-id]]\n   (when message-id\n     {:ws/send {:type \"message_ack\"\n                :message-id message-id}})))\n\n(rf/reg-event-db\n :ws/handle-ack\n (fn [db [_ _]]\n   ;; Acknowledgment received - prompt is being processed\n   db))\n\n(rf/reg-event-db\n :ws/handle-error\n (fn [db [_ {:keys [message session-id]}]]\n   (cond-> (assoc-in db [:ui :current-error] message)\n     session-id (update :locked-sessions disj session-id))))\n\n(rf/reg-event-fx\n :ws/handle-replay\n (fn [{:keys [db]} [_ {:keys [message-id message]}]]\n   (let [{:keys [session-id text role timestamp]} message]\n     {:db (update-in db [:messages session-id] (fnil conj [])\n                     {:id (or message-id (random-uuid))\n                      :session-id session-id\n                      :role (keyword role)\n                      :text text\n                      :timestamp (js/Date. timestamp)\n                      :status :confirmed})\n      :dispatch [:ws/send-message-ack message-id]})))\n\n;; ============================================================================\n;; Session Handlers\n;; ============================================================================\n\n(rf/reg-event-db\n :sessions/handle-list\n (fn [db [_ {:keys [sessions]}]]\n   (reduce (fn [db session]\n             (assoc-in db [:sessions (:session-id session)]\n                       {:id (:session-id session)\n                        :backend-name (:name session)\n                        :working-directory (:working-directory session)\n                        :last-modified (js/Date. (:last-modified session))\n                        :message-count (:message-count session)\n                        :preview (:preview session)}))\n           db\n           sessions)))\n\n(rf/reg-event-db\n :sessions/handle-recent\n (fn [db [_ {:keys [sessions]}]]\n   (reduce (fn [db session]\n             (assoc-in db [:sessions (:session-id session)]\n                       {:id (:session-id session)\n                        :backend-name (:name session)\n                        :working-directory (:working-directory session)\n                        :last-modified (js/Date. (:last-modified session))}))\n           db\n           sessions)))\n\n(rf/reg-event-db\n :sessions/handle-created\n (fn [db [_ {:keys [session-id name working-directory]}]]\n   (assoc-in db [:sessions session-id]\n             {:id session-id\n              :backend-name name\n              :working-directory working-directory\n              :last-modified (js/Date.)\n              :message-count 0})))\n\n(rf/reg-event-db\n :sessions/handle-history\n (fn [db [_ {:keys [session-id messages]}]]\n   (assoc-in db [:messages session-id]\n             (mapv (fn [msg]\n                     {:id (:id msg)\n                      :session-id session-id\n                      :role (keyword (:role msg))\n                      :text (:text msg)\n                      :timestamp (js/Date. (:timestamp msg))\n                      :status :confirmed})\n                   messages))))\n\n(rf/reg-event-db\n :sessions/handle-updated\n (fn [db [_ {:keys [session-id] :as updates}]]\n   (update-in db [:sessions session-id] merge\n              (dissoc updates :type :session-id))))\n\n(rf/reg-event-db\n :sessions/handle-turn-complete\n (fn [db [_ {:keys [session-id]}]]\n   (update db :locked-sessions disj session-id)))\n\n(rf/reg-event-db\n :sessions/handle-locked\n (fn [db [_ {:keys [session-id]}]]\n   (update db :locked-sessions conj session-id)))\n\n(rf/reg-event-db\n :sessions/handle-compaction-complete\n (fn [db [_ {:keys [session-id]}]]\n   ;; Compaction succeeded - refresh session\n   db))\n\n(rf/reg-event-db\n :sessions/handle-compaction-error\n (fn [db [_ {:keys [session-id error]}]]\n   (assoc-in db [:ui :current-error] (str \"Compaction failed: \" error))))\n\n(rf/reg-event-fx\n :sessions/resubscribe-all\n (fn [{:keys [db]} _]\n   ;; Resubscribe to active session after reconnection\n   (when-let [session-id (:active-session-id db)]\n     {:dispatch [:session/subscribe session-id]})))\n\n(rf/reg-event-fx\n :session/subscribe\n (fn [{:keys [db]} [_ session-id]]\n   (let [last-message-id (-> db :messages (get session-id) last :id)]\n     {:ws/send (cond-> {:type \"subscribe\"\n                        :session-id session-id}\n                 last-message-id\n                 (assoc :last-message-id last-message-id))})))\n\n;; ============================================================================\n;; Command Handlers\n;; ============================================================================\n\n(rf/reg-event-db\n :commands/handle-available\n (fn [db [_ {:keys [working-directory project-commands general-commands]}]]\n   (assoc-in db [:commands :available working-directory]\n             {:project project-commands\n              :general general-commands})))\n\n(rf/reg-event-db\n :commands/handle-started\n (fn [db [_ {:keys [command-session-id command-id shell-command]}]]\n   (assoc-in db [:commands :running command-session-id]\n             {:command-id command-id\n              :shell-command shell-command\n              :output \"\"\n              :started-at (js/Date.)})))\n\n(rf/reg-event-db\n :commands/handle-output\n (fn [db [_ {:keys [command-session-id stream text]}]]\n   (update-in db [:commands :running command-session-id :output]\n              str text \"\\n\")))\n\n(rf/reg-event-db\n :commands/handle-complete\n (fn [db [_ {:keys [command-session-id exit-code duration-ms]}]]\n   (let [cmd (get-in db [:commands :running command-session-id])]\n     (-> db\n         (update :commands dissoc command-session-id)\n         (update-in [:commands :history] conj\n                    (assoc cmd\n                           :exit-code exit-code\n                           :duration-ms duration-ms\n                           :completed-at (js/Date.)))))))\n\n(rf/reg-event-db\n :commands/handle-history\n (fn [db [_ {:keys [sessions]}]]\n   (assoc-in db [:commands :history] sessions)))\n\n(rf/reg-event-db\n :commands/handle-output-full\n (fn [db [_ {:keys [command-session-id output]}]]\n   (assoc-in db [:commands :running command-session-id :output] output)))\n\n;; ============================================================================\n;; Resource Handlers\n;; ============================================================================\n\n(rf/reg-event-db\n :resources/handle-list\n (fn [db [_ {:keys [resources]}]]\n   (assoc-in db [:resources :list] resources)))\n\n(rf/reg-event-db\n :resources/handle-uploaded\n (fn [db [_ resource]]\n   (-> db\n       (update-in [:resources :list] conj resource)\n       (update-in [:resources :pending-uploads] dec))))\n\n(rf/reg-event-db\n :resources/handle-deleted\n (fn [db [_ {:keys [filename]}]]\n   (update-in db [:resources :list]\n              (fn [resources]\n                (remove #(= (:filename %) filename) resources)))))\n\n;; ============================================================================\n;; Recipe Handlers\n;; ============================================================================\n\n(rf/reg-event-db\n :recipes/handle-available\n (fn [db [_ {:keys [recipes]}]]\n   (assoc-in db [:recipes :available] recipes)))\n\n(rf/reg-event-db\n :recipes/handle-started\n (fn [db [_ {:keys [session-id recipe-name]}]]\n   (assoc-in db [:recipes :active session-id]\n             {:name recipe-name\n              :started-at (js/Date.)})))\n\n(rf/reg-event-db\n :recipes/handle-exited\n (fn [db [_ {:keys [session-id]}]]\n   (update-in db [:recipes :active] dissoc session-id)))\n\n;; ============================================================================\n;; Outbound Messages\n;; ============================================================================\n\n(rf/reg-event-fx\n :prompt/send\n (fn [{:keys [db]} [_ {:keys [text session-id working-directory system-prompt]}]]\n   (let [ios-session-id (:ios-session-id db)\n         message-id (str (random-uuid))]\n     {:db (-> db\n              (update :locked-sessions conj session-id)\n              (update-in [:messages session-id] (fnil conj [])\n                         {:id message-id\n                          :session-id session-id\n                          :role :user\n                          :text text\n                          :timestamp (js/Date.)\n                          :status :sending}))\n      :ws/send {:type \"prompt\"\n                :text text\n                :ios-session-id ios-session-id\n                :session-id session-id\n                :working-directory working-directory\n                :system-prompt system-prompt}})))\n\n(rf/reg-event-fx\n :prompt/send-from-draft\n (fn [{:keys [db]} [_ session-id]]\n   (let [text (get-in db [:ui :drafts session-id])\n         session (get-in db [:sessions session-id])]\n     (when (and text (seq text))\n       {:dispatch-n [[:prompt/send {:text text\n                                    :session-id session-id\n                                    :working-directory (:working-directory session)}]\n                     [:ui/clear-draft session-id]]}))))\n\n(rf/reg-event-fx\n :session/compact\n (fn [{:keys [db]} [_ session-id]]\n   {:ws/send {:type \"compact_session\"\n              :session-id session-id}}))\n"]}