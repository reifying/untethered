# Claude Code Session Naming Research
Date: 2025-11-16

## Key Findings from Web Search

### How Claude Code Generates Session Titles

1. **Automatic Title Generation**
   - Claude Code automatically generates descriptive titles for conversations
   - Titles describe "what the chat is about" (e.g., "Refactor plan for foo.py")
   - Generation happens via API call (background session summarization)
   - Incurs small token cost for summarization

2. **Storage Format**
   - Titles stored in `.jsonl` files as entries with `"type":"summary"`
   - Format: `{"type":"summary","summary":"Conversation Title","leafUuid":"..."}`
   - `leafUuid` field references the last message ID in conversation thread

3. **When Titles Are Created**
   - Background summarization for powering `--resume` lists and previews
   - Appears to happen after initial conversation activity
   - NOT created from the first prompt alone

### Summary Type in JSONL Files

**CONFIRMED**: `type="summary"` entries are:
- Generated titles/summaries for the conversation
- Used for display in `--resume` list
- Created via API summarization (LLM-generated)
- Can have errors if title generation fails

**Multiple Summaries Explained**:
- Each `/compact` operation creates a new summary
- Summaries mark compaction boundaries in the file
- Files compacted multiple times have multiple summaries
- Known bug: Can get cross-session summary contamination

### Session Identification in UI

When users run `claude --resume`:
- Shows conversation picker with metadata:
  - Session title (from type="summary")
  - Time elapsed
  - Message count
  - Git branch

### Current Limitations

1. **No Custom Naming**
   - Feature requested multiple times (Issues #2112, #2838, #3605, #6006)
   - All closed as duplicates or not implemented
   - Users cannot manually rename sessions

2. **Sessions Identified By**:
   - Session ID (UUID)
   - Timestamp
   - Auto-generated title/summary

3. **Known Bugs**:
   - Failed title generation causes sessions to not appear in --resume list
   - Cross-session summary contamination when starting new conversations in same directory

## Implications for Our Implementation

### What We Now Know

1. **First line `type="summary"` IS the session title**
   - This is the LLM-generated conversation title
   - It's what Claude Code displays in the resume list
   - Our initial assumption was CORRECT for old format

2. **Multiple summaries are compaction markers**
   - Each summary represents a title at a point in time
   - Latest summary may be more accurate than first
   - First summary is the original session title before compaction

3. **New format (queue-operation/user) doesn't have titles yet**
   - These are newer sessions
   - Title generation may happen asynchronously
   - We should use first user prompt as fallback

### Recommended Strategy

**Priority order for session naming:**

1. **First `type="summary"` summary field** (highest priority)
   - This is the official Claude Code session title
   - Generated by LLM specifically for identification
   - Most accurate description of session intent

2. **Last `type="summary"` summary field** (alternative)
   - For heavily compacted sessions
   - May reflect current state better than original
   - Consider making this configurable

3. **First `queue-operation` content** (new format fallback)
   - For sessions without summaries yet
   - Truncate to 60-80 characters
   - Filter out "Warmup" and short commands

4. **First substantive `user` message** (final fallback)
   - Skip "Warmup" and generic messages
   - Skip very short content (< 10 chars)

5. **Directory + timestamp** (absolute fallback)
   - When no other content available

### Filter Recommendations

Skip these as session names:
- "Warmup"
- "!ls" or other shell commands
- Content < 10 characters
- API error messages
- Messages containing "API Error:" or "error"

### Open Questions for User

1. Should we use FIRST summary or LAST summary from compacted sessions?
   - First = original session intent
   - Last = current state after multiple compactions

2. Should we differentiate between:
   - Sessions with official titles (type="summary")
   - Sessions using prompt fallback (no summary yet)

3. How should we handle sessions that had title generation errors?
