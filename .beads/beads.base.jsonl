{"id":"voice-code-desktop-3b-375","content_hash":"f94a223be70356946eb76821e6da77b256d7501b05cef8b9c9980dd70bc75be1","title":"macOS Desktop UX Improvements","description":"## Design Document\n@docs/design/desktop-ux-improvements.md\n\n## Overview\nImplement 8 UX improvements for the macOS desktop app to provide native-feeling interactions including keyboard shortcuts, trackpad gestures, hover tooltips, and platform-appropriate settings.\n\n## Features\n1. Text input Return key (send) and Shift+Return (newline)\n2. Trackpad two-finger swipe left for back navigation\n3. Button hover tooltips with keyboard shortcuts\n4. Fix command history sheet sizing\n5. Enable system prompt editing in settings\n6. Hide iOS-only audio settings on macOS\n7. Add stop speech control (toolbar + Message Detail)\n8. Connection status tap to retry reconnection\n\n## Acceptance Criteria\n1. Return key sends prompt in text input (macOS)\n2. Shift+Return inserts newline (macOS)\n3. Two-finger swipe left navigates back in Session view (macOS)\n4. Two-finger swipe left navigates back in Project view (macOS)\n5. All toolbar buttons show hover tooltips (macOS)\n6. Cmd+R refreshes session (macOS)\n7. Cmd+. stops speech (macOS)\n8. Command history sheet shows full content (macOS)\n9. System prompt is editable in settings (both)\n10. Silence speech on vibrate hidden on macOS\n11. Continue playback when locked hidden on macOS\n12. Stop speech button appears in toolbar when speaking (macOS)\n13. Read Aloud toggles to Stop when speaking (both)\n14. Clicking connection status retries connection (both)\n15. All existing iOS functionality unchanged","status":"open","priority":2,"issue_type":"epic","created_at":"2026-01-05T19:31:10.487169-06:00","updated_at":"2026-01-05T19:31:10.487169-06:00","source_repo":"."}
{"id":"voice-code-desktop-3b-375.10","content_hash":"81e3708db9cd137b367093d2cd3db1f2d5bd83a0696c4d3ca997377e0278a375","title":"Add connection retry on status icon tap","description":"## Design Reference\n@docs/design/desktop-ux-improvements.md#8-connection-retry-on-status-icon-tap\n\n## Context\nThe connection status icon is informational only. When connection fails and stops retrying, users have no way to manually trigger a reconnection attempt.\n\n## Requirements\n- [ ] Make connection status indicator tappable (both platforms)\n- [ ] Tapping triggers reconnection attempt\n- [ ] Add forceReconnect() method to VoiceCodeClient\n- [ ] Add hover tooltip on macOS\n\n## Technical Approach\nPart 1 - VoiceCodeClient.forceReconnect():\n- Add new public method to VoiceCodeClient.swift\n- Reset reconnectionAttempts to 0\n- Call disconnect()\n- Call connect(sessionId:) if sessionId available\n- Log reconnection attempt\n\nPart 2 - UI changes:\n- Modify ConversationView.swift (lines 239-246)\n- Wrap existing HStack in Button\n- Use .buttonStyle(.plain) to preserve appearance\n- Add .help(\"Click to reconnect\") on macOS\n\nFiles to modify:\n- ios/VoiceCode/Managers/VoiceCodeClient.swift\n- ios/VoiceCode/Views/ConversationView.swift\n\n## Verification\n- [ ] Manual verification: Disconnect backend, wait for connection to fail\n- [ ] Click on status indicator, verify reconnection attempt starts\n- [ ] Verify status updates when connection succeeds\n- [ ] Manual verification (macOS): Hover over status shows tooltip\n\n## Acceptance Criteria\n- AC14: Clicking connection status retries connection (both)\n- AC15: All existing iOS functionality unchanged\n\n## Parallelization\nCan be worked alongside: All other tasks","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-05T19:35:13.423865-06:00","updated_at":"2026-01-05T19:35:13.423865-06:00","source_repo":"."}
{"id":"voice-code-desktop-3b-375.11","content_hash":"aca4bd99e8dd8cb8679b094c348ad99795ad4c2c09cc4ad7e62744608a21b7ed","title":"Apply swipe navigation to all applicable views","description":"## Design Reference\n@docs/design/desktop-ux-improvements.md#2-trackpad-swipe-navigation-macos\n\n## Context\nWith the SwipeNavigationModifier created, apply swipe-to-back gesture to all views that have back navigation on macOS.\n\n## Requirements\n- [ ] Add .swipeToBack() to ConversationView (pop to session list)\n- [ ] Add .swipeToBack() to SessionsForDirectoryView (pop to directory list)\n- [ ] Add .swipeToBack() to CommandOutputDetailView (pop to command history)\n- [ ] Add .swipeToBack() to CommandExecutionView (pop to command menu)\n- [ ] Add .swipeToBack() to SessionInfoView (dismiss sheet)\n- [ ] Add .swipeToBack() to RecipeMenuView (dismiss sheet)\n- [ ] Add .swipeToBack() to APIKeyManagementView (dismiss sheet)\n- [ ] Add .swipeToBack() to DebugLogsView (pop to directory list)\n\n## Technical Approach\nFor navigation stack views (pop action):\n- Pass custom action to .swipeToBack { navigationPath.removeLast() }\n- Or use environment dismiss if simpler\n\nFor sheet views (dismiss):\n- Use .swipeToBack() with no arguments (uses default dismiss)\n\nNote: Test NavigationStack on macOS first - it may already support swipe gestures natively.\n\nFiles to modify:\n- ios/VoiceCode/Views/ConversationView.swift\n- ios/VoiceCode/Views/SessionsForDirectoryView.swift\n- ios/VoiceCode/Views/CommandOutputDetailView.swift\n- ios/VoiceCode/Views/CommandExecutionView.swift\n- ios/VoiceCode/Views/SessionInfoView.swift\n- ios/VoiceCode/Views/RecipeMenuView.swift\n- ios/VoiceCode/Views/APIKeyManagementView.swift\n- ios/VoiceCode/Views/DebugLogsView.swift\n\nDependencies:\n- Requires: Create SwipeNavigationModifier task (voice-code-desktop-3b-375.2)\n\n## Verification\n- [ ] Manual verification: Two-finger swipe left in ConversationView navigates back\n- [ ] Manual verification: Two-finger swipe left in SessionsForDirectoryView navigates back\n- [ ] Manual verification: Two-finger swipe left in sheet views dismisses\n- [ ] Verify iOS builds successfully (no-op behavior)\n- [ ] Verify no conflicts with NavigationStack built-in gestures\n\n## Acceptance Criteria\n- AC3: Two-finger swipe left navigates back in Session view (macOS)\n- AC4: Two-finger swipe left navigates back in Project view (macOS)\n- AC15: All existing iOS functionality unchanged\n\n## Parallelization\nMust wait for: Create SwipeNavigationModifier task\nCan be worked alongside: All other tasks (after dependency complete)","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-05T19:35:38.546829-06:00","updated_at":"2026-01-05T19:35:38.546829-06:00","source_repo":".","dependencies":[{"issue_id":"voice-code-desktop-3b-375.11","depends_on_id":"voice-code-desktop-3b-375.2","type":"blocks","created_at":"2026-01-05T19:35:38.547358-06:00","created_by":"travisbrown"}]}
{"id":"voice-code-desktop-3b-375.2","content_hash":"58d43887950374190b5fa4e7a246a55def5dabacff8a54ef61ff9f0f04e7acfe","title":"Create SwipeNavigationModifier for macOS back navigation","description":"## Design Reference\n@docs/design/desktop-ux-improvements.md#2-trackpad-swipe-navigation-macos\n\n## Context\nThis is a foundation task that creates a reusable SwiftUI view modifier for swipe-to-back navigation on macOS. Other views will depend on this modifier being available.\n\n## Requirements\n- [ ] Create SwipeToBackModifier ViewModifier (macOS only)\n- [ ] Create swipeToBack() View extension (available on both platforms, no-op on iOS)\n- [ ] Support custom action closure for navigation stack views\n- [ ] Support default dismiss behavior for sheet views\n- [ ] Use DragGesture with 50pt minimum distance\n- [ ] Detect leftward horizontal swipe (translation.width \u003c -50)\n\n## Technical Approach\n- Create new file: ios/VoiceCode/Utils/SwipeNavigationModifier.swift\n- Use #if os(macOS) for the modifier struct\n- Extension available on both platforms with internal conditional\n- No dependencies on other tasks\n\n## Verification\n- [ ] Manual verification: Apply modifier to a test view and verify swipe triggers action\n- [ ] Verify iOS build succeeds (no-op behavior)\n- [ ] Verify macOS build succeeds with functional swipe\n\n## Acceptance Criteria\nThis task enables:\n- AC3: Two-finger swipe left navigates back in Session view\n- AC4: Two-finger swipe left navigates back in Project view\n\n## Parallelization\nCan be worked alongside: All other tasks except Apply swipe navigation to views","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-05T19:32:07.403331-06:00","updated_at":"2026-01-05T19:32:07.403331-06:00","source_repo":"."}
{"id":"voice-code-desktop-3b-375.3","content_hash":"e57ab185fa21276e8e6e4e7621d7fed205130eb9c2b50874925d65b878e00be5","title":"Implement Return key sends prompt, Shift+Return inserts newline","description":"## Design Reference\n@docs/design/desktop-ux-improvements.md#1-text-input-return-key-behavior\n\n## Context\nOn macOS, pressing Return in the text input currently highlights text instead of sending the prompt. This is a core usability issue that must be fixed for natural desktop interaction.\n\n## Requirements\n- [ ] Return (Enter) key sends the prompt on macOS\n- [ ] Shift+Return inserts a newline on macOS\n- [ ] iOS behavior unchanged (uses dedicated send button)\n- [ ] Text field clears after sending\n\n## Technical Approach\n- Modify ConversationTextInputView struct in ConversationView.swift (around line 1422)\n- Use .onKeyPress(.return) modifier (requires macOS 14.0+, codebase targets 15.0+)\n- Check press.modifiers.contains(.shift) for newline vs send\n- Wrap in #if os(macOS) conditional\n- Alternative: NSViewRepresentable with NSTextViewDelegate if onKeyPress insufficient\n\nFiles to modify:\n- ios/VoiceCode/Views/ConversationView.swift (ConversationTextInputView struct)\n\n## Verification\n- [ ] Manual verification (macOS): Type text, press Return - prompt sends\n- [ ] Manual verification (macOS): Type text, press Shift+Return - newline inserted\n- [ ] Manual verification (iOS): Existing send button behavior unchanged\n- [ ] Verify prompt text clears after sending\n\n## Acceptance Criteria\n- AC1: Return key sends prompt in text input (macOS)\n- AC2: Shift+Return inserts newline (macOS)\n- AC15: All existing iOS functionality unchanged\n\n## Parallelization\nCan be worked alongside: All other tasks","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-05T19:32:31.510125-06:00","updated_at":"2026-01-05T19:32:31.510125-06:00","source_repo":"."}
{"id":"voice-code-desktop-3b-375.4","content_hash":"caaafb642470cf2663f9d75a0bc45a5a8ef50a6ea0581509ce68440389764086","title":"Add hover tooltips to all toolbar buttons on macOS","description":"## Design Reference\n@docs/design/desktop-ux-improvements.md#3-button-hover-tooltips-macos\n\n## Context\nToolbar buttons have no discoverability on macOS. Users cannot discover what buttons do or their keyboard shortcuts without trial and error. Adding hover tooltips improves UX and documents shortcuts inline.\n\n## Requirements\n- [ ] Add .help() modifier to all toolbar buttons in macOS toolbar section\n- [ ] Include keyboard shortcuts in tooltip text where applicable\n- [ ] Tooltips should be concise and descriptive\n\n## Buttons to Add Tooltips:\n| Button | Tooltip |\n|--------|---------|\n| Refresh | Refresh session (Cmd+R) |\n| Kill Session | Stop current prompt (Cmd+K) |\n| Session Info | Session info (Cmd+I) |\n| Auto-scroll | Toggle auto-scroll |\n| Compact | Compact session history |\n| Recipe | Run recipe (Cmd+Shift+R) |\n| Queue Remove | Remove from queue |\n| Stop Speech | Stop speaking (Cmd+.) |\n| Voice Input | Start voice input (Space) |\n\n## Technical Approach\n- Modify ConversationView.swift toolbar section (lines 396-484)\n- Add .help() modifier to each Button in the macOS ToolbarItem\n- No #if os(macOS) needed since already in macOS toolbar section\n\nFiles to modify:\n- ios/VoiceCode/Views/ConversationView.swift\n\n## Verification\n- [ ] Manual verification: Hover over each button on macOS, verify tooltip appears\n- [ ] Verify tooltip text matches specification\n- [ ] Verify tooltips include keyboard shortcuts where applicable\n\n## Acceptance Criteria\n- AC5: All toolbar buttons show hover tooltips (macOS)\n\n## Parallelization\nCan be worked alongside: All other tasks","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-05T19:32:54.157966-06:00","updated_at":"2026-01-05T19:32:54.157966-06:00","source_repo":"."}
{"id":"voice-code-desktop-3b-375.5","content_hash":"97b51ab4db81e671aed00be936ae1748ea6f3a6635e6e7ba472ea382ac0b2caa","title":"Add keyboard shortcuts to toolbar actions on macOS","description":"## Design Reference\n@docs/design/desktop-ux-improvements.md#3-button-hover-tooltips-macos\n\n## Context\nmacOS users expect keyboard shortcuts for common actions. Adding shortcuts improves productivity and provides a native desktop experience.\n\n## Requirements\n- [ ] Add .keyboardShortcut() modifier to toolbar buttons on macOS\n- [ ] Shortcuts only active on macOS (wrapped in #if os(macOS) or in macOS toolbar section)\n\n## Shortcuts to Implement:\n| Action | Shortcut |\n|--------|----------|\n| Refresh | Cmd+R |\n| Session Info | Cmd+I |\n| Stop Speech | Cmd+. |\n| Recipe Menu | Cmd+Shift+R |\n| Kill Session | Cmd+K |\n\nNote: Send Prompt (Return) is handled by separate Return key behavior task.\n\n## Technical Approach\n- Modify ConversationView.swift toolbar section (lines 396-484)\n- Add .keyboardShortcut() modifier to each Button\n- Example: .keyboardShortcut(\"r\", modifiers: [.command])\n- Kill Session uses Cmd+K to avoid conflict with Stop Speech (Cmd+.)\n\nFiles to modify:\n- ios/VoiceCode/Views/ConversationView.swift\n\n## Verification\n- [ ] Manual verification: Press Cmd+R in conversation view - session refreshes\n- [ ] Manual verification: Press Cmd+I - session info opens\n- [ ] Manual verification: Press Cmd+. while speaking - speech stops\n- [ ] Manual verification: Press Cmd+Shift+R - recipe menu opens\n- [ ] Verify no shortcut conflicts with system shortcuts\n\n## Acceptance Criteria\n- AC6: Cmd+R refreshes session (macOS)\n- AC7: Cmd+. stops speech (macOS)\n\n## Parallelization\nCan be worked alongside: All other tasks\nShould be done after: Add hover tooltips task (both modify same area)","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-05T19:33:15.3864-06:00","updated_at":"2026-01-05T19:33:15.3864-06:00","source_repo":"."}
{"id":"voice-code-desktop-3b-375.6","content_hash":"c39d5eb199ff369a8e3901259cb9bd429f077e76a752e5a1fd2253278d03a8ec","title":"Hide iOS-only audio settings on macOS","description":"## Design Reference\n@docs/design/desktop-ux-improvements.md#6-settings-hide-ios-only-options\n\n## Context\niOS-specific audio settings appear on macOS where they do not apply. These settings control mobile-specific behaviors (silent mode, screen lock) that have no macOS equivalent.\n\n## Requirements\n- [ ] Hide \"Silence speech when phone is on vibrate\" on macOS\n- [ ] Hide \"Continue playback even when locked\" on macOS\n- [ ] Settings remain visible and functional on iOS\n\n## Technical Approach\n- Modify SettingsView.swift\n- Wrap the Audio Behavior section in #if os(iOS) conditional\n- Simple platform conditional, no complex logic\n\nFiles to modify:\n- ios/VoiceCode/Views/SettingsView.swift\n\n## Verification\n- [ ] Manual verification (macOS): Open Settings, verify Audio Behavior section not visible\n- [ ] Manual verification (iOS): Open Settings, verify Audio Behavior section visible\n- [ ] Verify toggles still function correctly on iOS\n\n## Acceptance Criteria\n- AC10: \"Silence speech on vibrate\" hidden on macOS\n- AC11: \"Continue playback when locked\" hidden on macOS\n- AC15: All existing iOS functionality unchanged\n\n## Parallelization\nCan be worked alongside: All other tasks","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-05T19:33:37.941075-06:00","updated_at":"2026-01-05T19:33:37.941075-06:00","source_repo":"."}
{"id":"voice-code-desktop-3b-375.7","content_hash":"f1fa91da8f49eae87fcb82db7bc40da99a811242ff435e5a819bab4b914fa2a6","title":"Fix command history sheet sizing on macOS","description":"## Design Reference\n@docs/design/desktop-ux-improvements.md#4-command-history-sizing\n\n## Context\nThe command history sheet on macOS only shows the Done button with content not visible. This is a layout issue where the sheet needs minimum frame constraints.\n\n## Requirements\n- [ ] Command history sheet content is visible on macOS\n- [ ] Sheet has appropriate minimum dimensions\n- [ ] iOS behavior unchanged\n\n## Technical Approach\nNote: The \"command history\" button actually presents ActiveCommandsListView (defined in CommandExecutionView.swift), not CommandHistoryView.\n\nOption 1 (preferred): Add frame to sheet presentation\n- Modify SessionsForDirectoryView.swift (around line 293)\n- Add .frame(minWidth: 600, minHeight: 400) to the sheet on macOS\n\nOption 2: Add frame inside ActiveCommandsListView\n- Modify CommandExecutionView.swift\n- Add .frame(minWidth: 500, minHeight: 300) to the List\n\nFiles to modify:\n- ios/VoiceCode/Views/SessionsForDirectoryView.swift (preferred)\n- OR ios/VoiceCode/Views/CommandExecutionView.swift (alternative)\n\n## Verification\n- [ ] Manual verification (macOS): Open command history sheet, verify content visible\n- [ ] Verify sheet is scrollable when content exceeds view\n- [ ] Verify Done button still accessible and functional\n- [ ] Manual verification (iOS): Sheet behavior unchanged\n\n## Acceptance Criteria\n- AC8: Command history sheet shows full content (macOS)\n- AC15: All existing iOS functionality unchanged\n\n## Parallelization\nCan be worked alongside: All other tasks","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-05T19:33:59.023106-06:00","updated_at":"2026-01-05T19:33:59.023106-06:00","source_repo":"."}
{"id":"voice-code-desktop-3b-375.8","content_hash":"9dec1c0c77cb1a4425581f42e6951c8745e0ae997f586e824dcc7d31c1cda2db","title":"Fix system prompt editing in settings on macOS","description":"## Design Reference\n@docs/design/desktop-ux-improvements.md#5-settings-system-prompt-editing\n\n## Context\nThe system prompt field in settings cannot be modified on macOS. The root cause needs investigation - may be TextField behavior with .lineLimit() or a binding issue.\n\n## Requirements\n- [ ] Investigate root cause of editing issue on macOS\n- [ ] System prompt TextField is editable on macOS\n- [ ] Changes persist correctly\n- [ ] iOS behavior unchanged\n\n## Investigation Steps\n1. Is the TextField receiving focus?\n2. Is text input being captured?\n3. Is the binding updating?\n\nCurrent implementation uses:\n- Local @State variable localSystemPrompt\n- Initialized from settings.systemPrompt in .onAppear\n- onChange syncs back to settings.systemPrompt\n\n## Technical Approach\nOption A - Use TextEditor on macOS:\n- Use TextEditor(text: $localSystemPrompt) on macOS\n- Keep TextField on iOS\n- Add .frame(minHeight: 100) for TextEditor\n\nOption B - Fix TextField styling:\n- Add .textFieldStyle(.plain) on macOS\n- May resolve focus/input issues\n\nFiles to modify:\n- ios/VoiceCode/Views/SettingsView.swift (lines 176-189)\n\n## Verification\n- [ ] Manual verification (macOS): Click on system prompt field, type text\n- [ ] Verify text appears as typed\n- [ ] Close and reopen settings, verify text persisted\n- [ ] Manual verification (iOS): System prompt field still works\n\n## Acceptance Criteria\n- AC9: System prompt is editable in settings (both)\n- AC15: All existing iOS functionality unchanged\n\n## Parallelization\nCan be worked alongside: All other tasks","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-05T19:34:23.922304-06:00","updated_at":"2026-01-05T19:34:23.922304-06:00","source_repo":"."}
{"id":"voice-code-desktop-3b-375.9","content_hash":"f0a620ccce4199bd35c1557ac6a1df4211e2f819804bc2908f83e0ef3ad4664a","title":"Add stop speech control to toolbar and Message Detail","description":"## Design Reference\n@docs/design/desktop-ux-improvements.md#7-stop-speech-control\n\n## Context\nThere is no way to stop TTS when agent response is being read aloud. Users need a way to interrupt speech during live sessions or when reviewing new messages.\n\n## Requirements\n- [ ] Add stop speech button to macOS toolbar (visible when speaking)\n- [ ] Add Cmd+. keyboard shortcut for stop speech (macOS)\n- [ ] Toggle Read Aloud button to Stop when speaking (both platforms)\n- [ ] Button icon changes: speaker.wave.2.fill -\u003e stop.circle.fill\n- [ ] Button text changes: Read Aloud -\u003e Stop\n- [ ] Button color changes to red when stopping\n\n## Technical Approach\nPart 1 - Toolbar button (macOS only):\n- Modify ConversationView.swift toolbar (lines 396-484)\n- Add conditional button: if voiceOutput.isSpeaking { ... }\n- Use stop.circle.fill icon with red color\n- Add .help() and .keyboardShortcut(\".\", modifiers: [.command])\n- voiceOutput is @StateObject in ConversationView (line 46)\n\nPart 2 - Message Detail toggle (shared):\n- Modify messageDetailContent in ConversationView.swift\n- Change Read Aloud button to toggle based on voiceOutput.isSpeaking\n- If speaking: show Stop with red icon, call voiceOutput.stop()\n- If not speaking: show Read Aloud with speaker icon, call voiceOutput.speak()\n\nFiles to modify:\n- ios/VoiceCode/Views/ConversationView.swift\n\n## Verification\n- [ ] Manual verification (macOS): Start TTS, verify Stop button appears in toolbar\n- [ ] Manual verification (macOS): Click Stop button, verify speech stops\n- [ ] Manual verification (macOS): Press Cmd+., verify speech stops\n- [ ] Manual verification (both): Open message detail during TTS, verify button shows Stop\n- [ ] Manual verification (both): Click Stop in message detail, verify speech stops\n- [ ] Verify button reverts to Read Aloud after speech stops\n\n## Acceptance Criteria\n- AC7: Cmd+. stops speech (macOS)\n- AC12: Stop speech button appears in toolbar when speaking (macOS)\n- AC13: Read Aloud toggles to Stop when speaking (both)\n\n## Parallelization\nCan be worked alongside: All other tasks","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-05T19:34:50.245991-06:00","updated_at":"2026-01-05T19:34:50.245991-06:00","source_repo":"."}
{"id":"voice-code-desktop3-yfz","title":"macOS Desktop App MVP","description":"## Design Document\n@docs/design/macos-desktop-app.md\n\n## Overview\nCreate a macOS native app with full feature parity to the iOS voice-code app, maximizing code sharing (95%+) through a single Xcode project with iOS and macOS targets.\n\nKey deliverables:\n- VoiceCodeMac target in project.yml with macOS-specific configuration\n- iOS-only file exclusions: DeviceAudioSessionManager.swift, QRScannerView.swift\n- Platform conditionals in 5 files: VoiceCodeClient, VoiceInputManager, VoiceOutputManager, VoiceCodeApp, APIKeySection\n- New ClipboardUtility.swift for cross-platform clipboard/haptic operations\n- Updates to 7 view files to use ClipboardUtility\n- macOS app icons\n- VoiceCodeMacTests target (excludes 5 iOS-only test files)\n\n## Acceptance Criteria\n1. macOS app builds successfully with xcodegen generate and xcodebuild -scheme VoiceCodeMac\n2. App launches and connects to backend server\n3. Session list displays correctly\n4. Conversations display and allow text input\n5. Voice input captures and transcribes speech\n6. Voice output speaks assistant responses\n7. Command menu shows Makefile targets and executes commands\n8. Recipes display and execute\n9. Resources view shows uploaded files\n10. Settings persist across launches (including API key via Keychain)\n11. All existing iOS unit tests pass\n12. All unit tests pass on macOS target\n13. API key authentication works (manual entry only on macOS, QR+manual on iOS)","status":"open","priority":2,"issue_type":"epic","created_at":"2026-01-02T18:37:26.398618-06:00","updated_at":"2026-01-04T11:49:00.055875-06:00"}
{"id":"voice-code-desktop3-yfz.10","title":"Build macOS target and fix compilation errors","description":"## Design Reference\n@docs/design/macos-desktop-app.md (Section: Verification)\n\n## Context\nAfter all platform conditionals are in place, the macOS target should compile. This task is for building and fixing any remaining compilation errors.\n\n## Requirements\n1. Build VoiceCodeMac target\n2. Fix any compilation errors\n3. Address critical warnings\n4. Ensure app launches\n\n## Technical Approach\n\n### Process\n1. Run `make build-mac` (or equivalent Makefile target)\n2. Collect all error messages\n3. Fix errors one by one, updating relevant tasks if needed\n4. Iterate until build succeeds\n\n### Common Issues to Expect\n- Missing platform conditionals\n- Unavailable APIs on macOS\n- Import statement issues\n- Type mismatches between platforms\n\n### Dependencies\n- Depends on ALL previous tasks (yfz.2 through yfz.9)\n- This is the integration verification step\n\n## Verification\n1. `make build-mac` succeeds\n2. No compilation errors\n3. App binary is produced\n4. App launches and shows main window\n\n## Acceptance Criteria\n- [ ] macOS target builds successfully\n- [ ] No compilation errors\n- [ ] App launches on macOS\n- [ ] Main window displays","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-02T18:40:32.099652-06:00","updated_at":"2026-01-02T18:42:22.856221-06:00","dependencies":[{"issue_id":"voice-code-desktop3-yfz.10","depends_on_id":"voice-code-desktop3-yfz.3","type":"blocks","created_at":"2026-01-02T18:43:13.779668-06:00","created_by":"travisbrown"},{"issue_id":"voice-code-desktop3-yfz.10","depends_on_id":"voice-code-desktop3-yfz.4","type":"blocks","created_at":"2026-01-02T18:43:15.041447-06:00","created_by":"travisbrown"},{"issue_id":"voice-code-desktop3-yfz.10","depends_on_id":"voice-code-desktop3-yfz.5","type":"blocks","created_at":"2026-01-02T18:43:16.225754-06:00","created_by":"travisbrown"},{"issue_id":"voice-code-desktop3-yfz.10","depends_on_id":"voice-code-desktop3-yfz.6","type":"blocks","created_at":"2026-01-02T18:43:17.812588-06:00","created_by":"travisbrown"},{"issue_id":"voice-code-desktop3-yfz.10","depends_on_id":"voice-code-desktop3-yfz.7","type":"blocks","created_at":"2026-01-02T18:43:19.195828-06:00","created_by":"travisbrown"},{"issue_id":"voice-code-desktop3-yfz.10","depends_on_id":"voice-code-desktop3-yfz.8","type":"blocks","created_at":"2026-01-02T18:43:20.774003-06:00","created_by":"travisbrown"},{"issue_id":"voice-code-desktop3-yfz.10","depends_on_id":"voice-code-desktop3-yfz.9","type":"blocks","created_at":"2026-01-02T18:43:22.568653-06:00","created_by":"travisbrown"},{"issue_id":"voice-code-desktop3-yfz.10","depends_on_id":"voice-code-desktop3-yfz.13","type":"blocks","created_at":"2026-01-04T11:29:45.951328-06:00","created_by":"travisbrown"}]}
{"id":"voice-code-desktop3-yfz.11","title":"Run VoiceCodeMacTests","description":"## Design Reference\n@docs/design/macos-desktop-app.md (Section: Verification)\n\n## Context\nRun automated tests against the macOS target to verify functionality. Tests should pass with the platform conditionals in place.\n\n## Requirements\n1. Run VoiceCodeMacTests target\n2. Fix any failing tests\n3. Ensure test coverage matches iOS\n\n## Technical Approach\n\n### Process\n1. Run `make test-mac` (or equivalent Makefile target)\n2. Review test results\n3. Fix failing tests - may need platform conditionals in test code\n4. Ensure excluded iOS-only tests are not run\n\n### Excluded Tests (iOS-only, per design document)\n- `DeviceAudioSessionManagerTests.swift` — tests AVAudioSession (iOS-only API)\n- `VoiceOutputManagerTests.swift` — tests audio session configuration\n- `CopyFeaturesTests.swift` — tests UIPasteboard clipboard operations\n- `SessionInfoViewTests.swift` — tests UIPasteboard clipboard operations\n- `QRScannerViewTests.swift` — tests QRScannerView (iOS-only, excluded from macOS target)\n\n### Dependencies\n- Depends on: voice-code-desktop3-yfz.10 (Build must succeed first)\n\n## Verification\n1. Test suite runs to completion\n2. All tests pass\n3. No unexpected test failures\n\n## Acceptance Criteria\n- [ ] VoiceCodeMacTests target runs\n- [ ] All tests pass\n- [ ] iOS-only tests properly excluded (5 files listed above)","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-02T18:40:33.272009-06:00","updated_at":"2026-01-04T11:39:49.456709-06:00","dependencies":[{"issue_id":"voice-code-desktop3-yfz.11","depends_on_id":"voice-code-desktop3-yfz.10","type":"blocks","created_at":"2026-01-02T18:43:30.231216-06:00","created_by":"travisbrown"}]}
{"id":"voice-code-desktop3-yfz.12","title":"Manual feature testing","description":"## Design Reference\n@docs/design/macos-desktop-app.md (Section: Acceptance Criteria)\n\n## Context\nFinal verification that all iOS features work correctly on macOS. Manual testing ensures parity beyond what automated tests cover.\n\n## Requirements\nTest all features from the acceptance criteria:\n1. WebSocket connection to backend\n2. Create/switch/delete sessions\n3. Voice input recording\n4. Send prompts, receive responses\n5. Copy message to clipboard\n6. Execute Makefile commands\n7. View command history\n8. View command output\n9. API key authentication (manual entry)\n\n## Technical Approach\n\n### Test Script\n1. Launch macOS app (without API key configured)\n2. Verify authentication required screen appears\n3. Enter API key manually in Settings\n4. Verify backend connection (status indicator)\n5. Create new session\n6. Record voice input\n7. Send text prompt\n8. Receive response\n9. Copy response to clipboard\n10. Open Commands tab\n11. Execute a command\n12. View command history\n13. Check command output\n14. Switch sessions\n15. Delete a session\n16. Delete API key and verify disconnect\n\n### Known Limitations (Expected)\n- Resources feature may not work (no Share Extension on macOS in MVP)\n- Haptic feedback not present (correct behavior)\n- QR code scanning not available (iOS-only, manual entry works)\n\n### Dependencies\n- Depends on: voice-code-desktop3-yfz.11 (Tests must pass first)\n\n## Verification\nAll acceptance criteria from the epic are manually verified.\n\n## Acceptance Criteria\n- [ ] Authentication required view shows when no API key\n- [ ] API key can be entered manually in Settings\n- [ ] App connects to WebSocket backend after authentication\n- [ ] Sessions can be created, switched, deleted\n- [ ] Voice input works\n- [ ] Prompts sent successfully\n- [ ] Responses received and displayed\n- [ ] Clipboard copy works\n- [ ] Commands execute\n- [ ] Command history displays\n- [ ] Command output viewable\n- [ ] Resources displays (content may be empty without Share Extension)\n- [ ] API key can be deleted from Settings","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-02T18:40:34.424918-06:00","updated_at":"2026-01-04T11:49:47.058102-06:00","dependencies":[{"issue_id":"voice-code-desktop3-yfz.12","depends_on_id":"voice-code-desktop3-yfz.11","type":"blocks","created_at":"2026-01-02T18:43:31.847005-06:00","created_by":"travisbrown"}]}
{"id":"voice-code-desktop3-yfz.13","title":"APIKeySection.swift platform conditionals for QR scanner","description":"## Design Reference\n@docs/design/macos-desktop-app.md\n\n## Context\nThe security feature added `APIKeySection.swift` which uses `QRScannerView` for camera-based QR code scanning. Since `QRScannerView.swift` is excluded from the macOS target (uses UIViewController and AVCaptureSession), `APIKeySection.swift` needs platform conditionals to hide QR scanning UI on macOS.\n\n## Requirements\n1. Add #if os(iOS) conditionals around QRScannerView usage\n2. Hide \"Scan QR Code\" button on macOS\n3. Hide \"Update Key\" button (which opens scanner) on macOS\n4. Manual key entry remains the only option on macOS\n\n## Technical Approach\n\n### Files to Modify\n- `ios/VoiceCode/Views/APIKeySection.swift`\n\n### Changes\n```swift\n// Hide scanner sheet on macOS\n#if os(iOS)\n.sheet(isPresented: $showingScanner) {\n    QRScannerView(...)\n}\n#endif\n\n// In notConfiguredKeyView, hide scan button on macOS\n#if os(iOS)\nButton(action: { showingScanner = true }) {\n    HStack {\n        Text(\"Scan QR Code\")\n        ...\n    }\n}\n#endif\n\n// In configuredKeyView, hide update button on macOS\n#if os(iOS)\nButton(action: { showingScanner = true }) {\n    HStack {\n        Text(\"Update Key\")\n        ...\n    }\n}\n#endif\n```\n\n### Dependencies\n- Depends on: voice-code-desktop3-yfz.2 (QRScannerView must be excluded first)\n- Can run in parallel with: yfz.3-9\n\n## Verification\n1. macOS target compiles without QRScannerView references\n2. iOS target still shows QR scanning options\n3. macOS shows only manual key entry\n4. Key management (save/delete) works on both platforms\n\n## Acceptance Criteria\n- [ ] No QRScannerView usage without #if os(iOS) guard\n- [ ] macOS shows manual entry only (no scan buttons)\n- [ ] iOS retains full QR scanning functionality\n- [ ] Both platforms compile","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-04T11:29:20.060435-06:00","updated_at":"2026-01-04T11:29:37.369789-06:00","dependencies":[{"issue_id":"voice-code-desktop3-yfz.13","depends_on_id":"voice-code-desktop3-yfz.2","type":"blocks","created_at":"2026-01-04T11:29:44.472894-06:00","created_by":"travisbrown"}]}
{"id":"voice-code-desktop3-yfz.2","title":"Project Infrastructure: VoiceCodeMac target setup","description":"## Design Reference\n@docs/design/macos-desktop-app.md\n\n## Context\nThis is the foundation task that establishes the macOS target in the Xcode project. All other tasks depend on this being completed first. Without this infrastructure, there is no macOS build to modify or test.\n\n## Requirements\n1. Create VoiceCodeMac directory structure\n2. Create macOS-specific Info.plist with required keys\n3. Create macOS entitlements file with App Sandbox and network permissions\n4. Update project.yml with VoiceCodeMac target configuration\n5. Generate Xcode project and verify it opens without errors\n\n## Technical Approach\n\n### New Files\n- `ios/VoiceCodeMac/Info.plist` - macOS app metadata (bundle ID, version, SwiftUI lifecycle)\n- `ios/VoiceCodeMac/VoiceCodeMac.entitlements` - App Sandbox, network client, audio input\n\n### Files to Modify\n- `ios/project.yml` - Add VoiceCodeMac target with:\n  - Platform: macOS\n  - Deployment target: 15.0 (per design document line 388)\n  - Sources pointing to shared VoiceCode/ and VoiceCodeMac/\n  - Excludes for iOS-only files:\n    - `Managers/DeviceAudioSessionManager.swift` (AVAudioSession)\n    - `Views/QRScannerView.swift` (UIViewController, AVCaptureSession camera)\n  - Test target VoiceCodeMacTests excluding iOS-only tests:\n    - `DeviceAudioSessionManagerTests.swift`\n    - `VoiceOutputManagerTests.swift`\n    - `CopyFeaturesTests.swift`\n    - `SessionInfoViewTests.swift`\n    - `QRScannerViewTests.swift`\n\n### Dependencies\nNone - this is the foundation task.\n\n## Verification\n1. Run `make generate` successfully\n2. Open VoiceCode.xcodeproj in Xcode\n3. Select VoiceCodeMac scheme\n4. Build succeeds (may have warnings, but no errors blocking compilation)\n5. App launches and shows main window\n\n## Acceptance Criteria\n- [ ] VoiceCodeMac/ directory exists with Info.plist and entitlements\n- [ ] project.yml includes VoiceCodeMac and VoiceCodeMacTests targets\n- [ ] project.yml excludes DeviceAudioSessionManager.swift and QRScannerView.swift from macOS\n- [ ] VoiceCodeMacTests excludes 5 iOS-only test files\n- [ ] macOS deployment target is 15.0\n- [ ] `make generate` completes without errors\n- [ ] Xcode opens project and shows both iOS and macOS schemes\n- [ ] macOS target builds (compilation succeeds)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T18:38:57.171976-06:00","updated_at":"2026-01-04T12:17:43.313871-06:00","closed_at":"2026-01-04T12:17:43.313871-06:00"}
{"id":"voice-code-desktop3-yfz.3","title":"Create ClipboardUtility.swift","description":"## Design Reference\n@docs/design/macos-desktop-app.md (Section: ClipboardUtility.swift, lines 317-352)\n\n## Context\nCentralizes clipboard and haptic feedback operations to avoid duplicating platform conditionals across 7 view files. This utility provides a single location for platform-specific code.\n\n## Requirements\n1. Create ClipboardUtility.swift with cross-platform clipboard copy function\n2. Include haptic feedback wrapper (iOS-only, no-op on macOS)\n3. Use proper platform conditionals (#if os(iOS) / #elseif os(macOS))\n\n## Technical Approach\n\n### New Files\n- `ios/VoiceCode/Utils/ClipboardUtility.swift`\n\n### Implementation (per design document)\n```swift\nimport Foundation\n#if os(iOS)\nimport UIKit\n#elseif os(macOS)\nimport AppKit\n#endif\n\nenum ClipboardUtility {\n    /// Copy text to system clipboard with optional haptic feedback (iOS only)\n    static func copy(_ text: String) {\n        #if os(iOS)\n        UIPasteboard.general.string = text\n        #elseif os(macOS)\n        NSPasteboard.general.clearContents()\n        NSPasteboard.general.setString(text, forType: .string)\n        #endif\n    }\n\n    /// Trigger success haptic feedback (iOS only, no-op on macOS)\n    static func triggerSuccessHaptic() {\n        #if os(iOS)\n        let generator = UINotificationFeedbackGenerator()\n        generator.notificationOccurred(.success)\n        #endif\n        // macOS: No haptic feedback available\n    }\n}\n```\n\n### Dependencies\n- Depends on: voice-code-desktop3-yfz.2 (Project Infrastructure)\n- Can run in parallel with: yfz.4, yfz.5, yfz.6, yfz.7 (manager conditionals)\n\n## Verification\n1. File compiles for both iOS and macOS targets\n2. No compiler errors or warnings about platform availability\n\n## Acceptance Criteria\n- [ ] ClipboardUtility.swift exists in ios/VoiceCode/Utils/\n- [ ] Has copy() and triggerSuccessHaptic() methods\n- [ ] Compiles for iOS target\n- [ ] Compiles for macOS target\n- [ ] Platform conditionals are correct","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T18:40:12.197311-06:00","updated_at":"2026-01-04T13:07:00.486634-06:00","closed_at":"2026-01-04T13:07:00.486634-06:00","dependencies":[{"issue_id":"voice-code-desktop3-yfz.3","depends_on_id":"voice-code-desktop3-yfz.2","type":"blocks","created_at":"2026-01-02T18:42:50.388708-06:00","created_by":"travisbrown"}]}
{"id":"voice-code-desktop3-yfz.4","title":"VoiceCodeClient.swift platform conditionals","description":"## Design Reference\n@docs/design/macos-desktop-app.md (Section: VoiceCodeClient.swift)\n\n## Context\nVoiceCodeClient uses UIApplication lifecycle notifications for WebSocket reconnection. macOS uses NSApplication equivalents.\n\n## Requirements\n1. Add platform conditionals for lifecycle notification observers\n2. Use willEnterForegroundNotification (iOS) vs willBecomeActiveNotification (macOS)\n3. Use didEnterBackgroundNotification (iOS) vs willResignActiveNotification (macOS)\n\n## Technical Approach\n\n### Files to Modify\n- `ios/VoiceCode/Managers/VoiceCodeClient.swift`\n\n### Changes\nReplace UIApplication notification observers with platform-conditional versions:\n\n```swift\n#if os(iOS)\nNotificationCenter.default.addObserver(\n    self,\n    selector: #selector(appWillEnterForeground),\n    name: UIApplication.willEnterForegroundNotification,\n    object: nil\n)\n#elseif os(macOS)\nNotificationCenter.default.addObserver(\n    self,\n    selector: #selector(appWillEnterForeground),\n    name: NSApplication.willBecomeActiveNotification,\n    object: nil\n)\n#endif\n```\n\n### Dependencies\n- Depends on: voice-code-desktop3-yfz.2 (Project Infrastructure)\n- Can run in parallel with: yfz.3, yfz.5, yfz.6, yfz.7\n\n## Verification\n1. macOS target compiles without UIApplication errors\n2. iOS target still compiles correctly\n3. WebSocket reconnects properly on both platforms\n\n## Acceptance Criteria\n- [ ] No UIApplication references without #if os(iOS) guard\n- [ ] macOS uses NSApplication equivalents\n- [ ] Compiles for both platforms","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-02T18:40:13.439069-06:00","updated_at":"2026-01-02T18:41:27.153743-06:00","dependencies":[{"issue_id":"voice-code-desktop3-yfz.4","depends_on_id":"voice-code-desktop3-yfz.2","type":"blocks","created_at":"2026-01-02T18:42:52.152727-06:00","created_by":"travisbrown"}]}
{"id":"voice-code-desktop3-yfz.5","title":"VoiceInputManager.swift platform conditionals","description":"## Design Reference\n@docs/design/macos-desktop-app.md (Section: VoiceInputManager.swift)\n\n## Context\nVoiceInputManager uses AVAudioSession for iOS audio configuration. macOS does not have AVAudioSession - it uses AVAudioEngine directly without session management.\n\n## Requirements\n1. Guard all AVAudioSession calls with #if os(iOS)\n2. macOS audio input works without session configuration\n3. Preserve iOS behavior exactly\n\n## Technical Approach\n\n### Files to Modify\n- `ios/VoiceCode/Managers/VoiceInputManager.swift`\n\n### Changes\nWrap AVAudioSession configuration in platform conditionals:\n\n```swift\nprivate func configureAudioSession() throws {\n    #if os(iOS)\n    let session = AVAudioSession.sharedInstance()\n    try session.setCategory(.playAndRecord, mode: .default, options: [.defaultToSpeaker, .allowBluetooth])\n    try session.setActive(true)\n    #endif\n    // macOS: No session configuration needed\n}\n```\n\n### Dependencies\n- Depends on: voice-code-desktop3-yfz.2 (Project Infrastructure)\n- Can run in parallel with: yfz.3, yfz.4, yfz.6, yfz.7\n\n## Verification\n1. macOS target compiles without AVAudioSession errors\n2. Voice input works on macOS using AVAudioEngine\n3. iOS behavior unchanged\n\n## Acceptance Criteria\n- [ ] No AVAudioSession references without #if os(iOS) guard\n- [ ] macOS compiles successfully\n- [ ] Voice recording starts without errors on macOS","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-02T18:40:15.067729-06:00","updated_at":"2026-01-02T18:41:28.54364-06:00","dependencies":[{"issue_id":"voice-code-desktop3-yfz.5","depends_on_id":"voice-code-desktop3-yfz.2","type":"blocks","created_at":"2026-01-02T18:42:53.469317-06:00","created_by":"travisbrown"}]}
{"id":"voice-code-desktop3-yfz.6","title":"VoiceOutputManager.swift platform conditionals","description":"## Design Reference\n@docs/design/macos-desktop-app.md (Section: VoiceOutputManager.swift)\n\n## Context\nVoiceOutputManager has AVAudioSession guards for audio playback. The interruptionHandler property and session configuration need platform conditionals.\n\n## Requirements\n1. Guard AVAudioSession usage with #if os(iOS)\n2. Remove or conditionally compile interruptionHandler property\n3. Ensure audio playback works on macOS\n\n## Technical Approach\n\n### Files to Modify\n- `ios/VoiceCode/Managers/VoiceOutputManager.swift`\n\n### Changes\n```swift\n#if os(iOS)\nprivate var interruptionHandler: Any?\n#endif\n\nprivate func setupAudioSession() {\n    #if os(iOS)\n    let session = AVAudioSession.sharedInstance()\n    try? session.setCategory(.playback, mode: .default)\n    try? session.setActive(true)\n    #endif\n}\n```\n\n### Dependencies\n- Depends on: voice-code-desktop3-yfz.2 (Project Infrastructure)\n- Can run in parallel with: yfz.3, yfz.4, yfz.5, yfz.7\n\n## Verification\n1. macOS target compiles without AVAudioSession errors\n2. Audio playback works on macOS\n3. iOS behavior unchanged\n\n## Acceptance Criteria\n- [ ] No AVAudioSession references without #if os(iOS) guard\n- [ ] interruptionHandler conditionally compiled\n- [ ] Text-to-speech works on macOS","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-02T18:40:16.420632-06:00","updated_at":"2026-01-02T18:41:30.060768-06:00","dependencies":[{"issue_id":"voice-code-desktop3-yfz.6","depends_on_id":"voice-code-desktop3-yfz.2","type":"blocks","created_at":"2026-01-02T18:42:54.821709-06:00","created_by":"travisbrown"}]}
{"id":"voice-code-desktop3-yfz.7","title":"VoiceCodeApp.swift platform conditionals","description":"## Design Reference\n@docs/design/macos-desktop-app.md (Section: VoiceCodeApp.swift)\n\n## Context\nVoiceCodeApp uses UIApplication lifecycle hooks for app state management. macOS uses NSApplication equivalents with different lifecycle methods.\n\n## Requirements\n1. Add platform conditionals for scenePhase handling\n2. Replace UIApplication-specific code with NSApplication equivalents\n3. Maintain same behavior on both platforms\n\n## Technical Approach\n\n### Files to Modify\n- `ios/VoiceCode/VoiceCodeApp.swift`\n\n### Changes\n```swift\n.onChange(of: scenePhase) { newPhase in\n    switch newPhase {\n    case .active:\n        voiceCodeClient.connect()\n    case .background:\n        #if os(iOS)\n        voiceCodeClient.disconnect()\n        #endif\n        // macOS: Keep connection alive\n    case .inactive:\n        break\n    @unknown default:\n        break\n    }\n}\n```\n\n### Dependencies\n- Depends on: voice-code-desktop3-yfz.2 (Project Infrastructure)\n- Can run in parallel with: yfz.3, yfz.4, yfz.5, yfz.6\n\n## Verification\n1. App launches correctly on macOS\n2. WebSocket connects on app activation\n3. iOS behavior unchanged\n\n## Acceptance Criteria\n- [ ] No UIApplication references without guards\n- [ ] App launches on macOS\n- [ ] Lifecycle behavior appropriate for each platform","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-02T18:40:17.818622-06:00","updated_at":"2026-01-02T18:41:31.34906-06:00","dependencies":[{"issue_id":"voice-code-desktop3-yfz.7","depends_on_id":"voice-code-desktop3-yfz.2","type":"blocks","created_at":"2026-01-02T18:42:56.211539-06:00","created_by":"travisbrown"}]}
{"id":"voice-code-desktop3-yfz.8","title":"Update view files to use ClipboardUtility","description":"## Design Reference\n@docs/design/macos-desktop-app.md (Section: View Files with Clipboard, lines 64-74)\n\n## Context\n7 view files contain UIPasteboard.general.string and UINotificationFeedbackGenerator calls. These need to use ClipboardUtility instead.\n\n## Requirements\n1. Replace all UIPasteboard.general.string calls with ClipboardUtility.copy()\n2. Replace UINotificationFeedbackGenerator calls with ClipboardUtility.triggerSuccessHaptic()\n3. Remove direct UIKit imports where no longer needed\n\n## Technical Approach\n\n### Files to Modify (7 files per design document)\n1. `ios/VoiceCode/Views/DirectoryListView.swift`\n2. `ios/VoiceCode/Views/SessionsForDirectoryView.swift`\n3. `ios/VoiceCode/Views/SessionLookupView.swift`\n4. `ios/VoiceCode/Views/SessionInfoView.swift`\n5. `ios/VoiceCode/Views/ConversationView.swift`\n6. `ios/VoiceCode/Views/DebugLogsView.swift`\n7. `ios/VoiceCode/Views/CommandOutputDetailView.swift`\n\n### Changes Pattern\nBefore:\n```swift\nUIPasteboard.general.string = text\nlet generator = UINotificationFeedbackGenerator()\ngenerator.notificationOccurred(.success)\n```\n\nAfter:\n```swift\nClipboardUtility.copy(text)\nClipboardUtility.triggerSuccessHaptic()\n```\n\n### Dependencies\n- Depends on: voice-code-desktop3-yfz.3 (ClipboardUtility.swift must exist first)\n\n## Verification\n1. All 7 files compile for both platforms\n2. No UIPasteboard or UINotificationFeedbackGenerator references remain\n3. Copy functionality works in iOS Simulator\n4. Copy functionality works in macOS app\n\n## Acceptance Criteria\n- [ ] All 7 files updated to use ClipboardUtility\n- [ ] No direct UIPasteboard usage in these files\n- [ ] No direct UINotificationFeedbackGenerator usage in these files\n- [ ] Both platforms compile","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-02T18:40:28.962719-06:00","updated_at":"2026-01-02T18:47:02.342643-06:00","dependencies":[{"issue_id":"voice-code-desktop3-yfz.8","depends_on_id":"voice-code-desktop3-yfz.3","type":"blocks","created_at":"2026-01-02T18:43:12.411579-06:00","created_by":"travisbrown"}]}
{"id":"voice-code-desktop3-yfz.9","title":"Create macOS app icons","description":"## Design Reference\n@docs/design/macos-desktop-app.md (Section: Assets)\n\n## Context\nmacOS apps require an AppIcon in the asset catalog. Can reuse iOS icon assets scaled appropriately, or create placeholder icons.\n\n## Requirements\n1. Add macOS AppIcon to Assets.xcassets\n2. Support required sizes: 16, 32, 128, 256, 512 (1x and 2x)\n3. Icon should be recognizable as Voice Code app\n\n## Technical Approach\n\n### Files to Modify\n- `ios/VoiceCode/Assets.xcassets/AppIcon.appiconset/Contents.json`\n- Add macOS icon images to the appiconset\n\n### Options\n1. **Scale existing iOS icons** - Use image tools to generate macOS sizes\n2. **Use placeholder** - Simple colored square with \"VC\" text\n3. **Request from user** - Ask for proper macOS icon assets\n\n### Dependencies\n- Depends on: voice-code-desktop3-yfz.2 (Project Infrastructure)\n- Can run in parallel with any code changes\n\n## Verification\n1. Xcode shows AppIcon for macOS target\n2. App builds without missing icon warnings\n3. App icon displays in Dock\n\n## Acceptance Criteria\n- [ ] AppIcon includes macOS icon entries\n- [ ] No missing icon warnings during build\n- [ ] Icon visible in macOS Dock when app runs","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-02T18:40:30.796061-06:00","updated_at":"2026-01-02T18:42:21.57113-06:00","dependencies":[{"issue_id":"voice-code-desktop3-yfz.9","depends_on_id":"voice-code-desktop3-yfz.2","type":"blocks","created_at":"2026-01-02T18:42:57.37626-06:00","created_by":"travisbrown"}]}
{"id":"voice-code-message-too-long-hfn","content_hash":"8d917e4bff5fcc1959d302ec7ac539e1ee01e7496bcdda2aa9e10517a8fd4bbb","title":"Delta Sync Session History","description":"## Design Document\n@docs/design/delta-sync-session-history.md\n\n## Overview\nImplement delta sync for session history to eliminate redundant message transfer and improve truncation behavior. When iOS subscribes to a session, it sends the UUID of its newest cached message. The backend only sends messages newer than that ID, using smart per-message truncation (20KB max) instead of dividing budget equally among all messages.\n\n## Acceptance Criteria\n1. Subscribe with `last_message_id` returns only newer messages\n2. Subscribe without `last_message_id` returns recent messages (backward compatible)\n3. Messages under 20KB are never truncated\n4. Messages over 20KB are truncated with marker showing size\n5. Response never exceeds client's max message size setting\n6. Newest messages are prioritized when budget is exhausted\n7. `is_complete: false` indicates budget exhaustion\n8. iOS displays truncated content with appropriate indicator\n9. All existing tests continue to pass","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-31T17:07:49.744716-06:00","updated_at":"2025-12-31T17:45:32.350309-06:00","closed_at":"2025-12-31T17:45:32.350309-06:00","source_repo":"."}
{"id":"voice-code-message-too-long-hfn.2","content_hash":"a21eebf96f8de0c796c2a21375dd30ba7d66a43bbe708d88c759dc984c6277a6","title":"Implement build-session-history-response function","description":"## Design Reference\n@docs/design/delta-sync-session-history.md#backend-new-truncation-algorithm\n\n## Context\nThis is the core algorithm for delta sync. It replaces the current equal-budget truncation with smart per-message truncation that prioritizes recent messages and preserves small messages intact.\n\n## Requirements\n- [ ] Create `per-message-max-bytes` constant (20KB)\n- [ ] Implement `build-session-history-response` function with delta sync logic\n- [ ] Find messages newer than `last-message-id` (or all if not provided)\n- [ ] Work backwards from newest message, adding until budget exhausted\n- [ ] Truncate only messages exceeding per-message-max (20KB)\n- [ ] Return `is-complete`, `oldest-message-id`, `newest-message-id`\n\n## Technical Approach\n- File to modify: `backend/src/voice_code/server.clj`\n- Algorithm:\n  1. Find index of last-message-id in message list\n  2. Get messages newer than that index (or all if not found)\n  3. Reverse to process newest first\n  4. Loop: truncate large messages, add to result until budget exhausted\n  5. Reverse back to chronological order\n  6. Return with metadata fields\n\n## Verification\n- [ ] Unit test: Empty message list returns empty result with nil IDs\n- [ ] Unit test: All messages fit in budget → is-complete true\n- [ ] Unit test: Budget exhausted mid-way → is-complete false, newest prioritized\n- [ ] Unit test: last-message-id found → only newer messages returned\n- [ ] Unit test: last-message-id not found → all recent messages returned\n- [ ] Unit test: Large messages (\u003e20KB) truncated with marker\n- [ ] Unit test: Small messages (\u003c20KB) preserved intact\n\n## Acceptance Criteria\n- Messages under 20KB are never truncated\n- Messages over 20KB are truncated with marker showing size\n- Newest messages are prioritized when budget is exhausted","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-31T17:08:42.505319-06:00","updated_at":"2025-12-31T20:09:36.291425-06:00","closed_at":"2025-12-31T20:09:36.291425-06:00","source_repo":"."}
{"id":"voice-code-message-too-long-hfn.3","content_hash":"db62b66a87f3f69e8bcdc609e2ddc0765366977d4e8f55730480b02c1c082b2c","title":"Update subscribe handler to use delta sync algorithm","description":"## Design Reference\n@docs/design/delta-sync-session-history.md#backend-updated-subscribe-handler\n\n## Context\nThe subscribe handler must be updated to parse the new `last_message_id` field, call the new `build-session-history-response` function, and return the new response fields.\n\n## Requirements\n- [ ] Parse optional `last-message-id` from subscribe message\n- [ ] Pass `last-message-id` to `build-session-history-response`\n- [ ] Include `oldest-message-id`, `newest-message-id`, `is-complete` in response\n- [ ] Log delta sync usage for debugging\n- [ ] Handle backward compatibility (missing `last-message-id` = full history)\n\n## Technical Approach\n- File to modify: `backend/src/voice_code/server.clj`\n- In the \"subscribe\" case of message handler:\n  1. Extract `last-message-id` from data map\n  2. Call `build-session-history-response` with filtered messages, last-message-id, and max-bytes\n  3. Destructure result to get messages, is-complete, oldest-message-id, newest-message-id\n  4. Include all fields in `session-history` response\n\n## Dependencies\n- Requires: \"Implement build-session-history-response function\"\n\n## Verification\n- [ ] Integration test: Subscribe without last_message_id returns recent messages\n- [ ] Integration test: Subscribe with valid last_message_id returns only newer\n- [ ] Integration test: Subscribe with stale/unknown last_message_id returns recent messages\n- [ ] Integration test: Response includes is_complete, oldest_message_id, newest_message_id\n- [ ] All existing subscribe tests continue to pass\n\n## Acceptance Criteria\n- Subscribe with `last_message_id` returns only newer messages\n- Subscribe without `last_message_id` returns recent messages (backward compatible)\n- All existing tests continue to pass","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-31T17:09:05.07216-06:00","updated_at":"2025-12-31T23:07:34.648982-06:00","closed_at":"2025-12-31T23:07:34.648982-06:00","source_repo":".","dependencies":[{"issue_id":"voice-code-message-too-long-hfn.3","depends_on_id":"voice-code-message-too-long-hfn.2","type":"blocks","created_at":"2025-12-31T17:09:10.946434-06:00","created_by":"travisbrown"}]}
{"id":"voice-code-message-too-long-hfn.4","content_hash":"a922c37a930becb406a929802d1d8abe3947ef8c1028be51a4db0407396d52bd","title":"Implement iOS getNewestCachedMessageId function","description":"## Design Reference\n@docs/design/delta-sync-session-history.md#ios-updated-subscribe-call\n\n## Context\niOS needs a function to query CoreData for the newest message UUID for a given session. This UUID will be sent to the backend as `last_message_id` to enable delta sync.\n\n## Requirements\n- [ ] Create `getNewestCachedMessageId(sessionId:)` function in VoiceCodeClient\n- [ ] Query CDMessage sorted by timestamp descending, limit 1\n- [ ] Return the message's UUID as lowercase string (per STANDARDS.md)\n- [ ] Return nil on error or if no messages exist\n- [ ] Log errors for debugging\n\n## Technical Approach\n- File to modify: `ios/VoiceCode/Managers/VoiceCodeClient.swift`\n- Implementation:\n  1. Parse sessionId string to UUID\n  2. Create NSFetchRequest for CDMessage\n  3. Set predicate: sessionId == uuid\n  4. Set sort: timestamp descending\n  5. Set fetchLimit: 1\n  6. Execute fetch on PersistenceController.shared.container.viewContext\n  7. Return first result's id.uuidString.lowercased()\n\n## Parallelization\nCan be worked alongside: \"Update subscribe handler to use delta sync algorithm\"\n\n## Verification\n- [ ] Manual test: Function returns correct UUID for session with messages\n- [ ] Manual test: Function returns nil for session with no messages\n- [ ] Manual test: Function returns nil for invalid session ID\n- [ ] Verify UUID is lowercase\n\n## Acceptance Criteria\n- iOS can retrieve the newest cached message ID for any session","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-31T17:09:31.941192-06:00","updated_at":"2025-12-31T23:36:49.264849-06:00","closed_at":"2025-12-31T23:36:49.264849-06:00","source_repo":"."}
{"id":"voice-code-message-too-long-hfn.5","content_hash":"95bb7f5d225b3673b0459c7d5d3c0d11c230c351598bfcd8c97d989c51bda62a","title":"Update iOS subscribe to send last_message_id","description":"## Design Reference\n@docs/design/delta-sync-session-history.md#ios-updated-subscribe-call\n\n## Context\nThe iOS subscribe call must be updated to include `last_message_id` when subscribing to a session. This enables delta sync, reducing redundant data transfer.\n\n## Requirements\n- [ ] Update `subscribe(sessionId:)` to call `getNewestCachedMessageId`\n- [ ] Include `last_message_id` in subscribe message if available\n- [ ] Log whether delta sync is being used\n- [ ] Maintain backward compatibility (message still valid without last_message_id)\n\n## Technical Approach\n- File to modify: `ios/VoiceCode/Managers/VoiceCodeClient.swift`\n- In `subscribe(sessionId:)`:\n  1. Call getNewestCachedMessageId(sessionId:)\n  2. Build message dictionary with type and session_id\n  3. If lastMessageId exists, add \"last_message_id\" key\n  4. Log delta sync status\n  5. Send message\n\n## Dependencies\n- Requires: \"Implement iOS getNewestCachedMessageId function\"\n- Requires: \"Update subscribe handler to use delta sync algorithm\" (backend must accept the field)\n\n## Verification\n- [ ] Manual test: Subscribe message includes last_message_id when messages exist\n- [ ] Manual test: Subscribe message omits last_message_id when no cached messages\n- [ ] Console logs show delta sync status\n- [ ] Backend receives and logs last_message_id\n\n## Acceptance Criteria\n- Subscribe with `last_message_id` returns only newer messages\n- Subscribe without `last_message_id` returns recent messages (backward compatible)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-31T17:09:46.221114-06:00","updated_at":"2026-01-01T09:40:00.041412-06:00","closed_at":"2026-01-01T09:40:00.041412-06:00","source_repo":".","dependencies":[{"issue_id":"voice-code-message-too-long-hfn.5","depends_on_id":"voice-code-message-too-long-hfn.4","type":"blocks","created_at":"2025-12-31T17:09:52.114723-06:00","created_by":"travisbrown"},{"issue_id":"voice-code-message-too-long-hfn.5","depends_on_id":"voice-code-message-too-long-hfn.3","type":"blocks","created_at":"2025-12-31T17:09:52.521672-06:00","created_by":"travisbrown"}]}
{"id":"voice-code-message-too-long-hfn.6","content_hash":"bc93a21520062d8a41f47b1a7133da007a6df6521b0b1c33c7bbf7457445ec6a","title":"Handle is_complete response in iOS session history","description":"## Design Reference\n@docs/design/delta-sync-session-history.md#ios-handle-incomplete-response\n\n## Context\niOS needs to handle the new `is_complete` field in session_history responses. When false, it indicates the budget was exhausted before all messages could be sent, meaning there's a gap in history.\n\n## Requirements\n- [ ] Parse `is_complete` field from session_history response\n- [ ] Parse `oldest_message_id` and `newest_message_id` fields\n- [ ] Log warning when is_complete is false\n- [ ] Optionally display indicator to user when history is incomplete\n\n## Technical Approach\n- File to modify: `ios/VoiceCode/Managers/VoiceCodeClient.swift`\n- In session_history case handler:\n  1. Extract is_complete boolean (default true for backward compatibility)\n  2. Extract oldest_message_id and newest_message_id strings\n  3. Log if is_complete is false\n  4. Consider: notify delegate or post notification for UI indicator\n\n## Parallelization\nCan be worked alongside: \"Update iOS subscribe to send last_message_id\"\n\n## Dependencies\n- Requires: \"Update subscribe handler to use delta sync algorithm\" (backend must send the fields)\n\n## Verification\n- [ ] Manual test: is_complete=true logged correctly\n- [ ] Manual test: is_complete=false triggers warning log\n- [ ] Manual test: Missing is_complete field defaults to true (backward compat)\n- [ ] Console shows oldest/newest message IDs\n\n## Acceptance Criteria\n- `is_complete: false` indicates budget exhaustion\n- iOS displays truncated content with appropriate indicator","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-31T17:10:14.827133-06:00","updated_at":"2026-01-01T10:18:52.105878-06:00","closed_at":"2026-01-01T10:18:52.105878-06:00","source_repo":".","dependencies":[{"issue_id":"voice-code-message-too-long-hfn.6","depends_on_id":"voice-code-message-too-long-hfn.3","type":"blocks","created_at":"2025-12-31T17:10:19.9067-06:00","created_by":"travisbrown"}]}
{"id":"voice-code-message-too-long-hfn.7","content_hash":"a391dc5590611dd33e7bbd39768dc8619ef70871a56186f6d6a0fef0a9100f34","title":"Update STANDARDS.md with delta sync protocol","description":"## Design Reference\n@docs/design/delta-sync-session-history.md#required-documentation-updates\n\n## Context\nSTANDARDS.md documents the WebSocket protocol. It must be updated to reflect the new delta sync fields and behavior.\n\n## Requirements\n- [ ] Document `last_message_id` optional field in Subscribe message\n- [ ] Document `oldest_message_id`, `newest_message_id`, `is_complete` in Session History response\n- [ ] Document delta sync behavior and algorithm summary\n- [ ] Document error cases (stale last_message_id treated as not provided)\n\n## Technical Approach\n- File to modify: `STANDARDS.md`\n- Sections to update:\n  1. Subscribe Message section - add last_message_id field\n  2. Session History Response section - add new fields\n  3. Add new \"Delta Sync\" subsection explaining behavior\n\n## Dependencies\n- Should be done after: All implementation tasks (to document final behavior)\n\n## Verification\n- [ ] All new fields documented with correct types and descriptions\n- [ ] Examples show both with and without last_message_id\n- [ ] Error cases documented\n- [ ] Documentation matches implemented behavior\n\n## Acceptance Criteria\n- Protocol documentation accurately reflects implementation\n- New developers can understand delta sync from STANDARDS.md alone","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-31T17:10:38.95168-06:00","updated_at":"2026-01-01T10:42:50.257793-06:00","closed_at":"2026-01-01T10:42:50.257793-06:00","source_repo":".","dependencies":[{"issue_id":"voice-code-message-too-long-hfn.7","depends_on_id":"voice-code-message-too-long-hfn.5","type":"blocks","created_at":"2025-12-31T17:10:44.994082-06:00","created_by":"travisbrown"},{"issue_id":"voice-code-message-too-long-hfn.7","depends_on_id":"voice-code-message-too-long-hfn.6","type":"blocks","created_at":"2025-12-31T17:10:45.39163-06:00","created_by":"travisbrown"}]}
{"id":"voice-code-security-17p","content_hash":"0365e7fa63ccef06614f43508966d36d13c292f7f5ea12853936f6fc27ece52c","title":"Accept case-insensitive Bearer token scheme","description":"## Problem\nRFC 6750 specifies the auth-scheme is case-insensitive, but current implementation requires exact \"Bearer \" prefix. Some proxies may normalize to lowercase.\n\n## Solution\nUpdate `extract-bearer-token` in server.clj:\n```clojure\n(defn extract-bearer-token [req]\n  (when-let [auth-header (get-in req [:headers \"authorization\"])]\n    (when (str/starts-with? (str/lower-case auth-header) \"bearer \")\n      (subs auth-header 7))))\n```\n\n## Files\n- backend/src/voice_code/server.clj\n- backend/test/voice_code/server_auth_test.clj\n\n## Acceptance Criteria\n- [ ] Accept \"Bearer\", \"bearer\", \"BEARER\" prefixes\n- [ ] Add test cases for case variations","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-04T11:09:12.934906-06:00","updated_at":"2026-01-04T11:09:12.934906-06:00","source_repo":".","dependencies":[{"issue_id":"voice-code-security-17p","depends_on_id":"voice-code-security-bvy","type":"parent-child","created_at":"2026-01-04T11:11:35.11936-06:00","created_by":"travisbrown"}]}
{"id":"voice-code-security-a68","content_hash":"4286098a72e4f8dd2b9686dbe0b12f4bc519fbb90ade7db25c7f827acb40c865","title":"Enforce auth_version compatibility check","description":"## Problem\niOS client logs a warning when server auth_version \u003e 1 but proceeds anyway. This could cause undefined behavior with future protocol changes.\n\n## Solution\nFail connection if server requires incompatible auth version:\n```swift\nif authVersion \u003e 1 {\n    self.authenticationError = \"Server requires newer app version\"\n    self.requiresReauthentication = true\n    return // Don't proceed with connect\n}\n```\n\n## Files\n- ios/VoiceCode/Managers/VoiceCodeClient.swift\n\n## Acceptance Criteria\n- [ ] Connection fails gracefully if auth_version \u003e supported\n- [ ] User sees meaningful error message\n- [ ] Add unit test for version mismatch","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-04T11:09:25.315462-06:00","updated_at":"2026-01-04T11:09:25.315462-06:00","source_repo":".","dependencies":[{"issue_id":"voice-code-security-a68","depends_on_id":"voice-code-security-bvy","type":"parent-child","created_at":"2026-01-04T11:11:35.576695-06:00","created_by":"travisbrown"}]}
{"id":"voice-code-security-au2","content_hash":"cba02aa6b675f167b93ab260196abf1674fd8f7710255eca74c37147ce0e5ce6","title":"API Key Authentication","description":"## Design Document\n@docs/api-key-authentication.md\n\n## Overview\nImplement Pre-Shared Key (PSK) authentication between iOS app and Clojure backend. Users generate a 43-character API key on the backend, scan it via QR code on iOS, and all subsequent WebSocket and HTTP connections are authenticated.\n\n## Acceptance Criteria\n1. Backend generates cryptographically secure 43-char API keys (voice-code- prefix + 32 hex chars)\n2. Backend displays API key as QR code in terminal with Unicode block characters\n3. iOS app scans QR code and stores key securely in Keychain with Share Extension access\n4. WebSocket connections include api_key in connect message; backend validates and marks channel authenticated\n5. Invalid/missing API keys are rejected with generic auth_error message (timing-attack resistant)\n6. Authentication persists for WebSocket session lifetime (no per-message auth)\n7. HTTP endpoints validate Bearer token in Authorization header\n8. Share Extension includes API key in HTTP requests\n9. iOS provides UI for key management (scan, view, delete)\n10. Clear error UX when authentication fails or key is missing","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-02T14:39:10.514025-06:00","updated_at":"2026-01-02T17:34:17.197409-06:00","closed_at":"2026-01-02T17:34:17.197409-06:00","source_repo":"."}
{"id":"voice-code-security-au2.10","content_hash":"ba16eeb9620e59e86a5f1b0cd29e94fe2fa4105c30b0d8a167986ccd4ea1c70e","title":"Create KeychainManager for secure API key storage","description":"## Design Reference\n@docs/api-key-authentication.md#35-ios-keychain-storage\n\n## Context\nFoundation iOS task for secure credential storage. KeychainManager provides Keychain access with Share Extension sharing via access group. Must be completed before VoiceCodeClient updates.\n\n## Requirements\n- [ ] Create KeychainManager.swift class\n- [ ] Implement saveAPIKey(_ key: String) throws\n- [ ] Implement retrieveAPIKey() -\u003e String?\n- [ ] Implement deleteAPIKey() throws\n- [ ] Implement hasAPIKey() -\u003e Bool\n- [ ] Implement isValidAPIKeyFormat(_ key: String) -\u003e Bool\n- [ ] Configure kSecAttrAccessGroup for Share Extension sharing\n- [ ] Use kSecAttrAccessibleAfterFirstUnlock for availability\n\n## Technical Approach\n- Files to create: VoiceCode/KeychainManager.swift\n- Service name: \"com.example.voicecode.api-key\"\n- Access group: Configure in entitlements for app + extension\n- Key validation: 43 chars, prefix check, hex validation\n- Error handling: Custom KeychainError enum\n\n## Verification\n- [ ] Unit test: saveAPIKey stores key\n- [ ] Unit test: retrieveAPIKey returns stored key\n- [ ] Unit test: deleteAPIKey removes key\n- [ ] Unit test: hasAPIKey returns correct state\n- [ ] Unit test: isValidAPIKeyFormat validates correctly\n- [ ] Integration test: Share Extension can access stored key\n\n## Parallelization\nCan be worked alongside: Backend auth namespace, ZXing dependency\n\n## Acceptance Criteria\n- AC3: iOS stores key securely in Keychain\n- AC8: Share Extension can access key (via access group)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-02T14:43:43.925327-06:00","updated_at":"2026-01-03T08:52:55.990561-06:00","closed_at":"2026-01-03T08:52:55.990561-06:00","source_repo":"."}
{"id":"voice-code-security-au2.11","content_hash":"823ffdbe8fd173f5059c6d060026553f249b783262abf54e44480c3cd386a195","title":"Update VoiceCodeClient to include API key in connect","description":"## Design Reference\n@docs/api-key-authentication.md#35-ios-keychain-storage\n\n## Context\nVoiceCodeClient must send API key in connect message and handle auth responses. This integrates KeychainManager with WebSocket communication.\n\n## Requirements\n- [ ] Add apiKey property to VoiceCodeClient\n- [ ] Load API key from KeychainManager on init\n- [ ] Include api_key field in connect message JSON\n- [ ] Handle auth_error message type\n- [ ] Handle auth_version in hello message\n- [ ] Implement exponential backoff for reconnection\n- [ ] Notify delegate/observers on auth failure\n\n## Technical Approach\n- Files to modify: VoiceCode/VoiceCodeClient.swift\n- Connect message: Add \"api_key\": apiKey to JSON\n- Auth error handling: Parse type: \"auth_error\", notify UI\n- Backoff: 1s initial, 30s max, 2x multiplier, +/-25% jitter\n- Store auth_version from hello for future compatibility\n\n## Verification\n- [ ] Unit test: connect message includes api_key\n- [ ] Unit test: auth_error triggers failure callback\n- [ ] Unit test: hello auth_version is parsed\n- [ ] Unit test: exponential backoff timing correct\n- [ ] Integration test: successful auth flow\n- [ ] Integration test: failed auth flow\n\n## Parallelization\nMust wait for: KeychainManager\n\n## Acceptance Criteria\n- AC4: WebSocket connect includes api_key\n- AC5: Auth errors handled gracefully","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-02T14:44:20.808204-06:00","updated_at":"2026-01-03T09:12:44.901757-06:00","closed_at":"2026-01-03T09:12:44.901757-06:00","source_repo":".","dependencies":[{"issue_id":"voice-code-security-au2.11","depends_on_id":"voice-code-security-au2.10","type":"blocks","created_at":"2026-01-02T14:44:20.808727-06:00","created_by":"travisbrown"}]}
{"id":"voice-code-security-au2.12","content_hash":"13dfc14b327f8f1ae20ca3d7c2e380528e9ce4a304ae3bf2a545cd2ba9d6d0e5","title":"Implement QRScannerView for API key scanning","description":"## Design Reference\n@docs/api-key-authentication.md#35-ios-keychain-storage\n\n## Context\nQR scanner enables easy API key transfer from terminal to iOS device. Uses AVFoundation for camera access and validates scanned keys before storage.\n\n## Requirements\n- [ ] Create QRScannerView.swift using AVCaptureSession\n- [ ] Request camera permission with appropriate messaging\n- [ ] Detect QR codes containing API key format\n- [ ] Validate scanned key with isValidAPIKeyFormat\n- [ ] Save valid key via KeychainManager\n- [ ] Provide success/failure feedback to user\n- [ ] Handle camera permission denied state\n\n## Technical Approach\n- Files to create: VoiceCode/Views/QRScannerView.swift\n- Use AVCaptureMetadataOutput for QR detection\n- Filter for .qr metadata object type\n- Validate key format before accepting\n- Dismiss on successful scan or user cancel\n- Show alert for invalid QR codes\n\n## Verification\n- [ ] Unit test: valid QR code accepted\n- [ ] Unit test: invalid QR code rejected with message\n- [ ] Manual test: scan QR from terminal\n- [ ] Manual test: camera permission flow\n- [ ] Manual test: permission denied state\n\n## Parallelization\nCan be worked alongside: AuthenticationRequiredView, APIKeySection\n\n## Acceptance Criteria\n- AC3: iOS scans QR code and stores key\n- AC10: Clear feedback on scan success/failure","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-02T14:44:43.745162-06:00","updated_at":"2026-01-03T09:55:31.55938-06:00","closed_at":"2026-01-03T09:55:31.55938-06:00","source_repo":".","dependencies":[{"issue_id":"voice-code-security-au2.12","depends_on_id":"voice-code-security-au2.10","type":"blocks","created_at":"2026-01-02T14:44:43.745664-06:00","created_by":"travisbrown"}]}
{"id":"voice-code-security-au2.13","content_hash":"a814d5533b2118772006ffc5b1dfcfab081d2a0ad3909e16426a5e8b5d8bd8cc","title":"Create AuthenticationRequiredView for unauthenticated state","description":"## Design Reference\n@docs/api-key-authentication.md#35-ios-keychain-storage\n\n## Context\nShown when app launches without API key or when authentication fails. Provides clear instructions and entry point to QR scanning.\n\n## Requirements\n- [ ] Create AuthenticationRequiredView.swift\n- [ ] Display clear message explaining auth requirement\n- [ ] Show \"Scan QR Code\" button to launch scanner\n- [ ] Show \"Enter Manually\" button for manual entry\n- [ ] Display after auth_error from backend\n- [ ] Integrate with app navigation flow\n\n## Technical Approach\n- Files to create: VoiceCode/Views/AuthenticationRequiredView.swift\n- SwiftUI view with centered content\n- Lock icon or similar visual indicator\n- Instructions text explaining the setup process\n- Two CTAs: Scan QR (primary), Enter Manually (secondary)\n- Navigation to QRScannerView or manual entry\n\n## Verification\n- [ ] Unit test: view renders correctly\n- [ ] Manual test: appears when no API key\n- [ ] Manual test: appears after auth_error\n- [ ] Manual test: navigation to scanner works\n- [ ] Manual test: navigation to manual entry works\n\n## Parallelization\nCan be worked alongside: QRScannerView, APIKeySection\n\n## Acceptance Criteria\n- AC10: Clear error UX when key is missing","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-02T14:44:56.651629-06:00","updated_at":"2026-01-03T10:17:56.349047-06:00","closed_at":"2026-01-03T10:17:56.349047-06:00","source_repo":".","dependencies":[{"issue_id":"voice-code-security-au2.13","depends_on_id":"voice-code-security-au2.10","type":"blocks","created_at":"2026-01-02T14:44:56.652186-06:00","created_by":"travisbrown"}]}
{"id":"voice-code-security-au2.14","content_hash":"f373d0445e3e76258f84e5561b2f22fcd69eceab5e6d5ed163d8513efe1d918c","title":"Create APIKeySection for Settings view","description":"## Design Reference\n@docs/api-key-authentication.md#35-ios-keychain-storage\n\n## Context\nSettings section showing API key status and providing key management actions. Part of the app's settings/preferences screen.\n\n## Requirements\n- [ ] Create APIKeySection.swift view component\n- [ ] Show connection status (authenticated/not)\n- [ ] Show masked key preview (first/last 4 chars)\n- [ ] Provide \"Update Key\" action\n- [ ] Provide \"Delete Key\" action with confirmation\n- [ ] Integrate into existing Settings view\n\n## Technical Approach\n- Files to create: VoiceCode/Views/APIKeySection.swift\n- Files to modify: Settings view to include section\n- Key masking: \"voic...89ab\" format\n- Delete confirmation: Alert with destructive action\n- Update: Navigate to QRScannerView or manual entry\n\n## Verification\n- [ ] Unit test: masked key format correct\n- [ ] Unit test: status displays correctly\n- [ ] Manual test: delete with confirmation\n- [ ] Manual test: update flow works\n\n## Parallelization\nCan be worked alongside: QRScannerView, AuthenticationRequiredView\n\n## Acceptance Criteria\n- AC9: iOS provides key management UI","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T14:45:21.051522-06:00","updated_at":"2026-01-03T20:18:55.151728-06:00","closed_at":"2026-01-03T20:18:55.151728-06:00","source_repo":".","dependencies":[{"issue_id":"voice-code-security-au2.14","depends_on_id":"voice-code-security-au2.10","type":"blocks","created_at":"2026-01-02T14:45:21.052145-06:00","created_by":"travisbrown"}]}
{"id":"voice-code-security-au2.15","content_hash":"ad6f2963ab9b9aea42258bada8f4f4c0727f85ce25f319c140ea2ff730a76bec","title":"Create APIKeyManagementView for manual key entry","description":"## Design Reference\n@docs/api-key-authentication.md#35-ios-keychain-storage\n\n## Context\nFull-screen view for manual API key entry and management. Provides alternative to QR scanning and detailed key information.\n\n## Requirements\n- [ ] Create APIKeyManagementView.swift\n- [ ] Text field for manual key entry\n- [ ] Real-time key format validation\n- [ ] Save button (enabled only for valid keys)\n- [ ] Current key display (masked)\n- [ ] Delete key option\n- [ ] Link to QR scanner as alternative\n\n## Technical Approach\n- Files to create: VoiceCode/Views/APIKeyManagementView.swift\n- TextField with secure entry option\n- Validate on each character change\n- Show validation status (checkmark/x)\n- Format hint showing expected key format\n- Integrate with KeychainManager\n\n## Verification\n- [ ] Unit test: validation feedback works\n- [ ] Unit test: save only enabled for valid keys\n- [ ] Manual test: manual entry flow\n- [ ] Manual test: navigation to QR scanner\n\n## Parallelization\nMust wait for: KeychainManager, QRScannerView\n\n## Acceptance Criteria\n- AC9: iOS provides key management UI","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T14:45:36.252061-06:00","updated_at":"2026-01-03T22:38:03.410097-06:00","closed_at":"2026-01-03T22:38:03.410097-06:00","source_repo":".","dependencies":[{"issue_id":"voice-code-security-au2.15","depends_on_id":"voice-code-security-au2.10","type":"blocks","created_at":"2026-01-02T14:45:36.252628-06:00","created_by":"travisbrown"},{"issue_id":"voice-code-security-au2.15","depends_on_id":"voice-code-security-au2.12","type":"blocks","created_at":"2026-01-02T14:45:36.252938-06:00","created_by":"travisbrown"}]}
{"id":"voice-code-security-au2.16","content_hash":"90ed78cd8c272866cefd4bc9889b12d049e9b819d95a7c7cba2a4c2f70e9b740","title":"Update Share Extension to include Bearer token","description":"## Design Reference\n@docs/api-key-authentication.md#34-http-bearer-authentication\n\n## Context\nShare Extension makes HTTP requests to upload files. Must include Bearer token and handle 401 responses appropriately.\n\n## Requirements\n- [ ] Access API key from Keychain via shared access group\n- [ ] Add Authorization: Bearer header to HTTP requests\n- [ ] Handle 401 Unauthorized response\n- [ ] Show appropriate error message for auth failure\n- [ ] Handle missing API key state gracefully\n\n## Technical Approach\n- Files to modify: ShareExtension/ShareViewController.swift\n- Use KeychainManager with shared access group\n- Header: request.setValue(\"Bearer \\(apiKey)\", forHTTPHeaderField: \"Authorization\")\n- On 401: Show \"Authentication required\" error\n- On missing key: Show \"Please set up API key in main app\"\n\n## Verification\n- [ ] Unit test: Authorization header included\n- [ ] Unit test: 401 response handled\n- [ ] Integration test: successful upload with auth\n- [ ] Manual test: share from other app with valid key\n- [ ] Manual test: share error when no key configured\n\n## Parallelization\nMust wait for: KeychainManager, HTTP Bearer auth\n\n## Acceptance Criteria\n- AC8: Share Extension includes API key in HTTP requests","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-02T14:45:55.639813-06:00","updated_at":"2026-01-03T10:35:50.295196-06:00","closed_at":"2026-01-03T10:35:50.295196-06:00","source_repo":".","dependencies":[{"issue_id":"voice-code-security-au2.16","depends_on_id":"voice-code-security-au2.10","type":"blocks","created_at":"2026-01-02T14:45:55.640333-06:00","created_by":"travisbrown"},{"issue_id":"voice-code-security-au2.16","depends_on_id":"voice-code-security-au2.9","type":"blocks","created_at":"2026-01-02T14:45:55.640651-06:00","created_by":"travisbrown"}]}
{"id":"voice-code-security-au2.17","content_hash":"156b5bfd4d7fc61dd9521e8e5e448d28fd1f16b58d6c43258321707c7cc90eeb","title":"Update STANDARDS.md with authentication protocol","description":"## Design Reference\n@docs/api-key-authentication.md#appendix-a\n\n## Context\nDocumentation must reflect the new authentication fields in the WebSocket protocol. STANDARDS.md is the source of truth for protocol specification.\n\n## Requirements\n- [ ] Add api_key field to connect message documentation\n- [ ] Add auth_error message type documentation\n- [ ] Add auth_version field to hello message documentation\n- [ ] Update message examples to show auth fields\n- [ ] Document Authorization header for HTTP endpoints\n\n## Technical Approach\n- Files to modify: STANDARDS.md\n- Add api_key to Client -\u003e Backend connect message\n- Add auth_error to Backend -\u003e Client message types\n- Add auth_version to hello message fields\n- Add HTTP Authorization header section\n\n## Verification\n- [ ] All new fields documented with examples\n- [ ] Examples match actual implementation\n- [ ] Protocol version noted\n\n## Parallelization\nCan be worked alongside: Any implementation task\n\n## Acceptance Criteria\n- Protocol documentation complete and accurate","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T14:46:25.786254-06:00","updated_at":"2026-01-04T06:41:06.281736-06:00","closed_at":"2026-01-04T06:41:06.281736-06:00","source_repo":"."}
{"id":"voice-code-security-au2.18","content_hash":"c000d8bf5da99199a993da0d32b39e66feb4a2394a5092901f1d4d559a738b53","title":"End-to-end integration tests for authentication","description":"## Design Reference\n@docs/api-key-authentication.md#5-testing-strategy\n\n## Context\nFinal validation that all authentication components work together. Tests the complete flow from key generation through authenticated communication.\n\n## Requirements\n- [ ] Test: Generate key -\u003e display QR -\u003e scan -\u003e connect -\u003e authenticated\n- [ ] Test: Invalid key rejected at WebSocket connect\n- [ ] Test: Missing key rejected at WebSocket connect\n- [ ] Test: HTTP upload with valid Bearer token succeeds\n- [ ] Test: HTTP upload with invalid Bearer token returns 401\n- [ ] Test: Reconnection maintains authentication\n\n## Technical Approach\n- Backend integration tests in test/voice_code/integration_test.clj\n- iOS UI tests for full flow (if UI testing configured)\n- May require test fixtures for key generation\n- Use dynamic binding for test key file path\n\n## Verification\n- [ ] All integration tests pass\n- [ ] Tests run in CI pipeline\n- [ ] No flaky tests\n\n## Parallelization\nMust wait for: WebSocket auth, HTTP auth, VoiceCodeClient updates\n\n## Acceptance Criteria\n- All acceptance criteria validated end-to-end","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-02T14:46:55.949845-06:00","updated_at":"2026-01-03T18:44:50.214046-06:00","closed_at":"2026-01-03T18:44:50.214046-06:00","source_repo":".","dependencies":[{"issue_id":"voice-code-security-au2.18","depends_on_id":"voice-code-security-au2.8","type":"blocks","created_at":"2026-01-02T14:46:55.950486-06:00","created_by":"travisbrown"},{"issue_id":"voice-code-security-au2.18","depends_on_id":"voice-code-security-au2.9","type":"blocks","created_at":"2026-01-02T14:46:55.950857-06:00","created_by":"travisbrown"},{"issue_id":"voice-code-security-au2.18","depends_on_id":"voice-code-security-au2.11","type":"blocks","created_at":"2026-01-02T14:46:55.951141-06:00","created_by":"travisbrown"}]}
{"id":"voice-code-security-au2.4","content_hash":"ff289f698d52145298cff977c04edfb39846aace0fb80abd8a5c6c34226a7f19","title":"Implement auth namespace with key generation and validation","description":"## Design Reference\n@docs/api-key-authentication.md#3-detailed-design\n\n## Context\nFoundation task for API key authentication. The auth namespace provides all cryptographic operations needed by both WebSocket and HTTP authentication. This must be completed before server integration.\n\n## Requirements\n- [ ] Create backend/src/voice_code/auth.clj namespace\n- [ ] Implement generate-key using SecureRandom for 128-bit entropy\n- [ ] Implement valid-key-format? to validate 43-char key structure\n- [ ] Implement constant-time-equals? to prevent timing attacks\n- [ ] Implement save-key! with chmod 600 file permissions\n- [ ] Implement load-key with nil return for missing file\n- [ ] Implement authenticate combining load and compare\n- [ ] Use dynamic var *key-file-path* for test isolation\n\n## Technical Approach\n- Files to create: backend/src/voice_code/auth.clj\n- Key format: 11-char prefix + 32 lowercase hex chars = 43 chars total\n- Key file location: ~/.voice-code/api-key\n- Use java.security.SecureRandom for entropy\n- Use byte-level XOR accumulation for constant-time comparison\n\n## Verification\n- [ ] Unit test: generate-key produces valid 43-char keys\n- [ ] Unit test: valid-key-format? accepts valid, rejects invalid formats\n- [ ] Unit test: constant-time-equals? returns correct results\n- [ ] Unit test: save-key! creates file with 600 permissions\n- [ ] Unit test: load-key returns nil for missing file\n- [ ] Unit test: authenticate validates correctly\n\n## Parallelization\nCan be worked alongside: Add ZXing dependency, Create KeychainManager\n\n## Acceptance Criteria\n- AC1: Backend generates cryptographically secure 43-char API keys\n- AC5: Invalid keys rejected with timing-attack resistant comparison","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-02T14:41:08.344469-06:00","updated_at":"2026-01-02T18:29:40.415679-06:00","closed_at":"2026-01-02T18:29:40.415679-06:00","source_repo":"."}
{"id":"voice-code-security-au2.5","content_hash":"51a0719993dea0ee9938aab732692ef3e73f9d7051dfc25f30b7b3aeeb83a15d","title":"Add ZXing dependency to deps.edn","description":"## Design Reference\n@docs/api-key-authentication.md#32-qr-code-display\n\n## Context\nZXing library is required for QR code matrix generation. This is a simple dependency addition that unblocks the QR namespace implementation.\n\n## Requirements\n- [ ] Add com.google.zxing/core to deps.edn\n- [ ] Add com.google.zxing/javase to deps.edn\n- [ ] Verify dependency resolves correctly\n\n## Technical Approach\n- Files to modify: backend/deps.edn\n- Dependencies to add:\n  - com.google.zxing/core {:mvn/version \"3.5.2\"}\n  - com.google.zxing/javase {:mvn/version \"3.5.2\"}\n\n## Verification\n- [ ] Run clj -Stree to verify dependencies resolve\n- [ ] REPL can require com.google.zxing.qrcode.QRCodeWriter\n\n## Parallelization\nCan be worked alongside: Implement auth namespace, Create KeychainManager\n\n## Acceptance Criteria\n- AC2: Supports QR code generation (dependency prerequisite)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-02T14:41:34.511416-06:00","updated_at":"2026-01-02T18:35:17.675054-06:00","closed_at":"2026-01-02T18:35:17.675054-06:00","source_repo":"."}
{"id":"voice-code-security-au2.6","content_hash":"ecf1f33e3d0378e1406eda6b19a9cba747975db898e6d61671b2119863b25120","title":"Implement QR code namespace for terminal display","description":"## Design Reference\n@docs/api-key-authentication.md#32-qr-code-display\n\n## Context\nQR code display enables easy key transfer from backend to iOS device. Uses ZXing for matrix generation and Unicode block characters for terminal rendering.\n\n## Requirements\n- [ ] Create backend/src/voice_code/qr.clj namespace\n- [ ] Implement generate-qr-matrix using ZXing QRCodeWriter\n- [ ] Implement render-qr-terminal with Unicode block characters\n- [ ] Implement display-setup-qr! with instructions text\n- [ ] Handle error correction level L for QR generation\n\n## Technical Approach\n- Files to create: backend/src/voice_code/qr.clj\n- Dependencies: Requires ZXing (voice-code-security-au2.5)\n- Unicode chars: FULL BLOCK, LOWER HALF, UPPER HALF, SPACE\n- QR size: Let ZXing auto-size based on content\n- Terminal width: Assume 80+ columns\n\n## Verification\n- [ ] Unit test: generate-qr-matrix returns valid matrix\n- [ ] Unit test: render-qr-terminal produces string output\n- [ ] Manual: QR code scannable by iOS camera app\n- [ ] Manual: Instructions clearly visible above QR\n\n## Parallelization\nCan be worked alongside: iOS KeychainManager tasks (after ZXing dep added)\n\n## Acceptance Criteria\n- AC2: Backend displays API key as QR code in terminal","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-02T14:41:59.390916-06:00","updated_at":"2026-01-02T18:48:08.854493-06:00","closed_at":"2026-01-02T18:48:08.854493-06:00","source_repo":".","dependencies":[{"issue_id":"voice-code-security-au2.6","depends_on_id":"voice-code-security-au2.5","type":"blocks","created_at":"2026-01-02T14:41:59.391429-06:00","created_by":"travisbrown"}]}
{"id":"voice-code-security-au2.7","content_hash":"01859be7e4a1201474cc033627c2cb4dc16beedbfc379066e419840258384f13","title":"Add Makefile targets for key generation and QR display","description":"## Design Reference\n@docs/api-key-authentication.md#36-makefile-targets\n\n## Context\nMakefile targets provide user-friendly commands for key management. These are the primary interface for backend operators to generate and display API keys.\n\n## Requirements\n- [ ] Add generate-key target to backend/Makefile\n- [ ] Add show-qr target to backend/Makefile\n- [ ] Ensure targets work from project root\n\n## Technical Approach\n- Files to modify: backend/Makefile\n- generate-key: clj -X:run :command :generate-key\n- show-qr: clj -X:run :command :show-qr\n- May need to add :run alias to deps.edn\n\n## Verification\n- [ ] make generate-key creates ~/.voice-code/api-key\n- [ ] make show-qr displays scannable QR code\n- [ ] Targets fail gracefully if key missing (show-qr)\n\n## Parallelization\nMust wait for: auth namespace, QR namespace\n\n## Acceptance Criteria\n- AC1: Key generation accessible via make target\n- AC2: QR display accessible via make target","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T14:42:42.949807-06:00","updated_at":"2026-01-03T18:51:12.109345-06:00","closed_at":"2026-01-03T18:51:12.109345-06:00","source_repo":".","dependencies":[{"issue_id":"voice-code-security-au2.7","depends_on_id":"voice-code-security-au2.4","type":"blocks","created_at":"2026-01-02T14:42:42.950373-06:00","created_by":"travisbrown"},{"issue_id":"voice-code-security-au2.7","depends_on_id":"voice-code-security-au2.6","type":"blocks","created_at":"2026-01-02T14:42:42.950682-06:00","created_by":"travisbrown"}]}
{"id":"voice-code-security-au2.8","content_hash":"9f62684bd4f63426395b8c681f3276b2c28cf59e8dc08531b6bb74ec63347a12","title":"Integrate authentication into WebSocket server","description":"## Design Reference\n@docs/api-key-authentication.md#33-session-based-authentication\n\n## Context\nCore server integration that validates API keys on WebSocket connect and tracks authenticated channels. All subsequent messages are allowed only for authenticated channels.\n\n## Requirements\n- [ ] Add authenticated-channels atom to server namespace\n- [ ] Update hello message to include auth_version: 1\n- [ ] Modify connect handler to extract and validate api_key\n- [ ] Implement auth_error message type\n- [ ] Add channel to authenticated set on successful auth\n- [ ] Remove channel from set on disconnect\n- [ ] Block all messages except connect for unauthenticated channels\n\n## Technical Approach\n- Files to modify: backend/src/voice_code/server.clj\n- New atom: (defonce authenticated-channels (atom #{}))\n- Hello message: Add :auth-version 1 to response\n- Connect handler: Extract :api-key, call auth/authenticate\n- Error response: {:type \"auth_error\" :message \"Authentication failed\"}\n- Use generic error message (no detail about why auth failed)\n\n## Verification\n- [ ] Unit test: hello includes auth_version\n- [ ] Unit test: valid api_key authenticates channel\n- [ ] Unit test: invalid api_key returns auth_error\n- [ ] Unit test: missing api_key returns auth_error\n- [ ] Unit test: unauthenticated channel blocked from prompt\n- [ ] Integration test: full connect flow with auth\n\n## Parallelization\nMust wait for: auth namespace\n\n## Acceptance Criteria\n- AC4: WebSocket validates api_key in connect message\n- AC5: Invalid/missing keys rejected with auth_error\n- AC6: Authentication persists for session lifetime","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-02T14:43:01.72142-06:00","updated_at":"2026-01-03T08:13:20.567533-06:00","closed_at":"2026-01-03T08:13:20.567533-06:00","source_repo":".","dependencies":[{"issue_id":"voice-code-security-au2.8","depends_on_id":"voice-code-security-au2.4","type":"blocks","created_at":"2026-01-02T14:43:01.721997-06:00","created_by":"travisbrown"}]}
{"id":"voice-code-security-au2.9","content_hash":"a566de2f8640a4592fc48720b24b6545bbdca8f01be899880e1ee2f3410fc46c","title":"Add Bearer token authentication to HTTP upload endpoint","description":"## Design Reference\n@docs/api-key-authentication.md#34-http-bearer-authentication\n\n## Context\nHTTP endpoints (file upload) need Bearer token authentication for Share Extension and other HTTP clients. Uses same API key as WebSocket auth.\n\n## Requirements\n- [ ] Extract Authorization header from HTTP requests\n- [ ] Parse Bearer token from header value\n- [ ] Validate token using auth/authenticate\n- [ ] Return 401 Unauthorized for invalid/missing token\n- [ ] Return 401 with generic error message body\n\n## Technical Approach\n- Files to modify: backend/src/voice_code/server.clj (HTTP handler)\n- Header format: Authorization: Bearer \u003capi-key\u003e\n- Parse: (when-let [auth (get-in request [:headers \"authorization\"])]\n           (second (re-matches #\"Bearer (.+)\" auth)))\n- Response: {:status 401 :body \"Unauthorized\"}\n\n## Verification\n- [ ] Unit test: valid Bearer token allows request\n- [ ] Unit test: invalid Bearer token returns 401\n- [ ] Unit test: missing Authorization header returns 401\n- [ ] Unit test: malformed Authorization header returns 401\n- [ ] Integration test: file upload with Bearer token\n\n## Parallelization\nCan be worked alongside: WebSocket auth integration\n\n## Acceptance Criteria\n- AC7: HTTP endpoints validate Bearer token","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-02T14:43:12.88886-06:00","updated_at":"2026-01-03T08:29:23.677042-06:00","closed_at":"2026-01-03T08:29:23.677042-06:00","source_repo":".","dependencies":[{"issue_id":"voice-code-security-au2.9","depends_on_id":"voice-code-security-au2.4","type":"blocks","created_at":"2026-01-02T14:43:12.889424-06:00","created_by":"travisbrown"}]}
{"id":"voice-code-security-bvy","content_hash":"17248a88e7af8037bcb6766da96a65a7ccfe3c981f21d6fedc218963f25bc61c","title":"API Key Authentication Security Hardening","description":"## Design Document\n@docs/api-key-authentication.md\n\n## Overview\nSecurity improvements identified during code review of the API key authentication feature. These are enhancements to the already-implemented authentication system, addressing minor security hygiene issues.\n\n## Context\nThe main API key authentication feature (voice-code-security-au2) is complete. This epic covers follow-up improvements identified during security review.\n\n## Acceptance Criteria\n- [ ] AC1: Clipboard-copied API keys auto-expire after 60 seconds\n- [ ] AC2: Bearer token authentication accepts case-insensitive scheme (per RFC 6750)\n- [ ] AC3: iOS client fails gracefully when server requires incompatible auth_version\n- [ ] AC4: Terminal QR display offers option to clear screen after scanning\n\n## Security Review Reference\nThese improvements address medium and low priority findings from the security review conducted on the feature branch.","status":"open","priority":2,"issue_type":"epic","created_at":"2026-01-04T11:11:25.672016-06:00","updated_at":"2026-01-04T11:11:25.672016-06:00","source_repo":"."}
{"id":"voice-code-security-hrt","content_hash":"eadd9aa3970b63ab266d7d9adc44bd0d53ccbd5a6cdae19fda05793d70d199fc","title":"Add terminal clear option after QR display","description":"## Problem\nAPI key is displayed in plaintext in terminal and persists in scrollback, tmux buffers, and screen recordings.\n\n## Solution\nAdd optional auto-clear or prompt after QR display:\n```clojure\n(defn display-setup-qr! []\n  ;; ... existing QR display ...\n  (println)\n  (println \"Press Enter to clear screen...\")\n  (read-line)\n  (print \"\\033[2J\\033[H\") ;; ANSI clear screen\n  (flush))\n```\n\nOr add a --no-clear flag for non-interactive use.\n\n## Files\n- backend/src/voice_code/qr.clj\n- Makefile (update show-key-qr target)\n\n## Acceptance Criteria\n- [ ] User can clear screen after scanning\n- [ ] Non-interactive mode available (--no-clear)\n- [ ] Works in standard terminals (ANSI escape support)","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-04T11:09:36.30055-06:00","updated_at":"2026-01-04T11:09:36.30055-06:00","source_repo":".","dependencies":[{"issue_id":"voice-code-security-hrt","depends_on_id":"voice-code-security-bvy","type":"parent-child","created_at":"2026-01-04T11:11:35.992612-06:00","created_by":"travisbrown"}]}
{"id":"voice-code-security-jlf","content_hash":"8c7bded325a7a5684c6da6be27b59113247df45b83064a83f8d1af335b3046b8","title":"Add clipboard expiration for API key copy","description":"## Problem\nWhen users copy the API key to clipboard (APIKeyManagementView.swift:98), it persists indefinitely and is accessible to all apps.\n\n## Solution\nUse `UIPasteboard.general.setItems` with expiration:\n```swift\nUIPasteboard.general.setItems([[\"public.utf8-plain-text\": key]], options: [.expirationDate: Date().addingTimeInterval(60)])\n```\n\n## Files\n- ios/VoiceCode/Views/APIKeyManagementView.swift\n\n## Acceptance Criteria\n- [ ] Clipboard expires after 60 seconds\n- [ ] User sees brief toast/feedback that key was copied with expiration notice","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-04T11:09:00.571333-06:00","updated_at":"2026-01-04T11:09:00.571333-06:00","source_repo":".","dependencies":[{"issue_id":"voice-code-security-jlf","depends_on_id":"voice-code-security-bvy","type":"parent-child","created_at":"2026-01-04T11:11:34.577475-06:00","created_by":"travisbrown"}]}
