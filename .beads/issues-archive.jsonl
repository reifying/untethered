{"id":"voice-code-session-74t","content_hash":"7c10f3e1ef0a4424c54179def012609c049b5d82d085d9298d26eba516ef232c","title":"Workstream Abstraction","description":"## Design Document\n@docs/design/workstream-abstraction.md\n\n## Overview\nIntroduce a Workstream abstraction that decouples front-end session identity from Claude Code session identity. This enables context window clearing without creating new UI entries, simplifies queue management (queue manages workstreams, not Claude sessions), and hides Claude sessions as an implementation detail.\n\n## Acceptance Criteria\n1. User sees workstreams in session list, not Claude sessions\n2. Clearing context keeps user in same workstream\n3. Queue position preserved after clear\n4. Workstream name persists through clears\n5. Migration creates workstream wrappers for existing sessions\n6. Recipes can request fresh context without UI disruption\n7. Messages display from active Claude session only\n8. Backward compatibility: legacy session_id prompts still work","status":"open","priority":2,"issue_type":"epic","created_at":"2025-12-28T22:17:00.895383-06:00","updated_at":"2025-12-28T22:17:00.895383-06:00","source_repo":"."}
{"id":"voice-code-session-74t.1","content_hash":"b4ed90af59e28e1c3ec218748beeb48bd2bed7507b5ddf0729260a7be5d2f614","title":"Implement workstream state management module","description":"## Design Reference\n@docs/design/workstream-abstraction.md#backend-workstream-state-management\n\n## Context\nThe workstream abstraction requires a new Clojure namespace to manage workstream state. This is the foundation for all backend workstream functionality - message handlers and migration logic depend on this module.\n\n## Requirements\n- [ ] Create `voice-code.workstream` namespace\n- [ ] Implement `workstream-index` atom for in-memory state\n- [ ] Implement persistence to `~/.voice-code/workstreams.edn`\n- [ ] Implement CRUD operations: `create-workstream!`, `get-workstream`, `get-all-workstreams`, `update-workstream!`, `delete-workstream!`\n- [ ] Implement session linking: `link-claude-session!`, `unlink-claude-session!`\n- [ ] Implement `load-workstream-index!` for startup loading\n- [ ] Add `format-timestamp` utility function\n\n## Technical Approach\n- Files to create: `backend/src/voice_code/workstream.clj`\n- Data structure per workstream:\n  ```clojure\n  {:id \"uuid\"\n   :name \"string\"\n   :working-directory \"path\"\n   :active-claude-session-id \"uuid or nil\"\n   :queue-priority :normal\n   :priority-order 0.0\n   :created-at timestamp-ms\n   :last-modified timestamp-ms}\n  ```\n- Use `swap!` for atomic updates\n- Persist after every mutation\n\n## Verification\n- [ ] Unit tests for `create-workstream!` with default and custom names\n- [ ] Unit tests for `link-claude-session!` and `unlink-claude-session!`\n- [ ] Unit tests for `unlink-claude-session!` returning previous session ID\n- [ ] Unit tests for persistence (save/load round-trip)\n- [ ] Manual: Verify `~/.voice-code/workstreams.edn` is created and readable\n\n## Acceptance Criteria\n- Workstream state can be created, read, updated, deleted\n- Claude sessions can be linked/unlinked from workstreams\n- State persists across backend restarts\n\n## Parallelization\nCan be worked alongside: iOS CoreData schema task","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-28T22:17:53.125873-06:00","updated_at":"2025-12-28T22:17:53.125873-06:00","source_repo":"."}
