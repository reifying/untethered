{"id":"voice-code-desktop3-yfz.10","content_hash":"8e81c0d74b83555d4881b70262769da66e491016487fbb99f31dbad70fffbb9f","title":"Build macOS target and fix compilation errors","description":"## Design Reference\n@docs/design/macos-desktop-app.md (Section: Verification)\n\n## Context\nAfter all platform conditionals are in place, the macOS target should compile. This task is for building and fixing any remaining compilation errors.\n\n## Requirements\n1. Build VoiceCodeMac target\n2. Fix any compilation errors\n3. Address critical warnings\n4. Ensure app launches\n\n## Technical Approach\n\n### Process\n1. Run `make build-mac` (or equivalent Makefile target)\n2. Collect all error messages\n3. Fix errors one by one, updating relevant tasks if needed\n4. Iterate until build succeeds\n\n### Common Issues to Expect\n- Missing platform conditionals\n- Unavailable APIs on macOS\n- Import statement issues\n- Type mismatches between platforms\n\n### Dependencies\n- Depends on ALL previous tasks (yfz.2 through yfz.9)\n- This is the integration verification step\n\n## Verification\n1. `make build-mac` succeeds\n2. No compilation errors\n3. App binary is produced\n4. App launches and shows main window\n\n## Acceptance Criteria\n- [ ] macOS target builds successfully\n- [ ] No compilation errors\n- [ ] App launches on macOS\n- [ ] Main window displays","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-02T18:40:32.099652-06:00","updated_at":"2026-01-02T18:42:22.856221-06:00","source_repo":".","dependencies":[{"issue_id":"voice-code-desktop3-yfz.10","depends_on_id":"voice-code-desktop3-yfz.3","type":"blocks","created_at":"2026-01-02T18:43:13.779668-06:00","created_by":"travisbrown"},{"issue_id":"voice-code-desktop3-yfz.10","depends_on_id":"voice-code-desktop3-yfz.4","type":"blocks","created_at":"2026-01-02T18:43:15.041447-06:00","created_by":"travisbrown"},{"issue_id":"voice-code-desktop3-yfz.10","depends_on_id":"voice-code-desktop3-yfz.5","type":"blocks","created_at":"2026-01-02T18:43:16.225754-06:00","created_by":"travisbrown"},{"issue_id":"voice-code-desktop3-yfz.10","depends_on_id":"voice-code-desktop3-yfz.6","type":"blocks","created_at":"2026-01-02T18:43:17.812588-06:00","created_by":"travisbrown"},{"issue_id":"voice-code-desktop3-yfz.10","depends_on_id":"voice-code-desktop3-yfz.7","type":"blocks","created_at":"2026-01-02T18:43:19.195828-06:00","created_by":"travisbrown"},{"issue_id":"voice-code-desktop3-yfz.10","depends_on_id":"voice-code-desktop3-yfz.8","type":"blocks","created_at":"2026-01-02T18:43:20.774003-06:00","created_by":"travisbrown"},{"issue_id":"voice-code-desktop3-yfz.10","depends_on_id":"voice-code-desktop3-yfz.9","type":"blocks","created_at":"2026-01-02T18:43:22.568653-06:00","created_by":"travisbrown"},{"issue_id":"voice-code-desktop3-yfz.10","depends_on_id":"voice-code-desktop3-yfz.13","type":"blocks","created_at":"2026-01-04T11:29:45.951328-06:00","created_by":"travisbrown"}]}
{"id":"voice-code-desktop3-yfz.10","content_hash":"8e81c0d74b83555d4881b70262769da66e491016487fbb99f31dbad70fffbb9f","title":"Build macOS target and fix compilation errors","description":"## Design Reference\n@docs/design/macos-desktop-app.md (Section: Verification)\n\n## Context\nAfter all platform conditionals are in place, the macOS target should compile. This task is for building and fixing any remaining compilation errors.\n\n## Requirements\n1. Build VoiceCodeMac target\n2. Fix any compilation errors\n3. Address critical warnings\n4. Ensure app launches\n\n## Technical Approach\n\n### Process\n1. Run `make build-mac` (or equivalent Makefile target)\n2. Collect all error messages\n3. Fix errors one by one, updating relevant tasks if needed\n4. Iterate until build succeeds\n\n### Common Issues to Expect\n- Missing platform conditionals\n- Unavailable APIs on macOS\n- Import statement issues\n- Type mismatches between platforms\n\n### Dependencies\n- Depends on ALL previous tasks (yfz.2 through yfz.9)\n- This is the integration verification step\n\n## Verification\n1. `make build-mac` succeeds\n2. No compilation errors\n3. App binary is produced\n4. App launches and shows main window\n\n## Acceptance Criteria\n- [ ] macOS target builds successfully\n- [ ] No compilation errors\n- [ ] App launches on macOS\n- [ ] Main window displays","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-02T18:40:32.099652-06:00","updated_at":"2026-01-02T18:42:22.856221-06:00","source_repo":".","dependencies":[{"issue_id":"voice-code-desktop3-yfz.10","depends_on_id":"voice-code-desktop3-yfz.3","type":"blocks","created_at":"2026-01-02T18:43:13.779668-06:00","created_by":"travisbrown"},{"issue_id":"voice-code-desktop3-yfz.10","depends_on_id":"voice-code-desktop3-yfz.4","type":"blocks","created_at":"2026-01-02T18:43:15.041447-06:00","created_by":"travisbrown"},{"issue_id":"voice-code-desktop3-yfz.10","depends_on_id":"voice-code-desktop3-yfz.5","type":"blocks","created_at":"2026-01-02T18:43:16.225754-06:00","created_by":"travisbrown"},{"issue_id":"voice-code-desktop3-yfz.10","depends_on_id":"voice-code-desktop3-yfz.6","type":"blocks","created_at":"2026-01-02T18:43:17.812588-06:00","created_by":"travisbrown"},{"issue_id":"voice-code-desktop3-yfz.10","depends_on_id":"voice-code-desktop3-yfz.7","type":"blocks","created_at":"2026-01-02T18:43:19.195828-06:00","created_by":"travisbrown"},{"issue_id":"voice-code-desktop3-yfz.10","depends_on_id":"voice-code-desktop3-yfz.8","type":"blocks","created_at":"2026-01-02T18:43:20.774003-06:00","created_by":"travisbrown"},{"issue_id":"voice-code-desktop3-yfz.10","depends_on_id":"voice-code-desktop3-yfz.9","type":"blocks","created_at":"2026-01-02T18:43:22.568653-06:00","created_by":"travisbrown"}]}
{"id":"voice-code-desktop3-yfz.11","content_hash":"00fbdf4f7a8553c18855e42a219130400c47825e519706883e77ba31a5492ec1","title":"Run VoiceCodeMacTests","description":"## Design Reference\n@docs/design/macos-desktop-app.md (Section: Verification)\n\n## Context\nRun automated tests against the macOS target to verify functionality. Tests should pass with the platform conditionals in place.\n\n## Requirements\n1. Run VoiceCodeMacTests target\n2. Fix any failing tests\n3. Ensure test coverage matches iOS\n\n## Technical Approach\n\n### Process\n1. Run `make test-mac` (or equivalent Makefile target)\n2. Review test results\n3. Fix failing tests - may need platform conditionals in test code\n4. Ensure excluded iOS-only tests are not run\n\n### Excluded Tests (iOS-only, per design document)\n- `DeviceAudioSessionManagerTests.swift` — tests AVAudioSession (iOS-only API)\n- `VoiceOutputManagerTests.swift` — tests audio session configuration\n- `CopyFeaturesTests.swift` — tests UIPasteboard clipboard operations\n- `SessionInfoViewTests.swift` — tests UIPasteboard clipboard operations\n- `QRScannerViewTests.swift` — tests QRScannerView (iOS-only, excluded from macOS target)\n\n### Dependencies\n- Depends on: voice-code-desktop3-yfz.10 (Build must succeed first)\n\n## Verification\n1. Test suite runs to completion\n2. All tests pass\n3. No unexpected test failures\n\n## Acceptance Criteria\n- [ ] VoiceCodeMacTests target runs\n- [ ] All tests pass\n- [ ] iOS-only tests properly excluded (5 files listed above)","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-02T18:40:33.272009-06:00","updated_at":"2026-01-04T11:39:49.456709-06:00","source_repo":".","dependencies":[{"issue_id":"voice-code-desktop3-yfz.11","depends_on_id":"voice-code-desktop3-yfz.10","type":"blocks","created_at":"2026-01-02T18:43:30.231216-06:00","created_by":"travisbrown"}]}
{"id":"voice-code-desktop3-yfz.11","content_hash":"afc85faf4eefd12a933eeae38d8003d8e5934958d5dd454d7856bf7487624017","title":"Run VoiceCodeMacTests","description":"## Design Reference\n@docs/design/macos-desktop-app.md (Section: Verification, lines 657-664)\n\n## Context\nRun automated tests against the macOS target to verify functionality. Tests should pass with the platform conditionals in place.\n\n## Requirements\n1. Run VoiceCodeMacTests target\n2. Fix any failing tests\n3. Ensure test coverage matches iOS\n\n## Technical Approach\n\n### Process\n1. Run `make test-mac` (or equivalent Makefile target)\n2. Review test results\n3. Fix failing tests - may need platform conditionals in test code\n4. Ensure excluded iOS-only tests are not run\n\n### Excluded Tests (iOS-only, per design document)\n- `DeviceAudioSessionManagerTests.swift` — tests AVAudioSession (iOS-only API)\n- `VoiceOutputManagerTests.swift` — tests audio session configuration\n- `CopyFeaturesTests.swift` — tests UIPasteboard clipboard operations\n- `SessionInfoViewTests.swift` — tests UIPasteboard clipboard operations\n\n### Dependencies\n- Depends on: voice-code-desktop3-yfz.10 (Build must succeed first)\n\n## Verification\n1. Test suite runs to completion\n2. All tests pass\n3. No unexpected test failures\n\n## Acceptance Criteria\n- [ ] VoiceCodeMacTests target runs\n- [ ] All tests pass\n- [ ] iOS-only tests properly excluded (4 files listed above)","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-02T18:40:33.272009-06:00","updated_at":"2026-01-02T18:49:31.654047-06:00","source_repo":".","dependencies":[{"issue_id":"voice-code-desktop3-yfz.11","depends_on_id":"voice-code-desktop3-yfz.10","type":"blocks","created_at":"2026-01-02T18:43:30.231216-06:00","created_by":"travisbrown"}]}
{"id":"voice-code-desktop3-yfz.12","content_hash":"2a6f686b92fdb2f622ee1a2391c007dbdcdb5749ba9cd28adc31f73edfaed5ef","title":"Manual feature testing","description":"## Design Reference\n@docs/design/macos-desktop-app.md (Section: Acceptance Criteria)\n\n## Context\nFinal verification that all iOS features work correctly on macOS. Manual testing ensures parity beyond what automated tests cover.\n\n## Requirements\nTest all features from the acceptance criteria:\n1. WebSocket connection to backend\n2. Create/switch/delete sessions\n3. Voice input recording\n4. Send prompts, receive responses\n5. Copy message to clipboard\n6. Execute Makefile commands\n7. View command history\n8. View command output\n9. API key authentication (manual entry)\n\n## Technical Approach\n\n### Test Script\n1. Launch macOS app (without API key configured)\n2. Verify authentication required screen appears\n3. Enter API key manually in Settings\n4. Verify backend connection (status indicator)\n5. Create new session\n6. Record voice input\n7. Send text prompt\n8. Receive response\n9. Copy response to clipboard\n10. Open Commands tab\n11. Execute a command\n12. View command history\n13. Check command output\n14. Switch sessions\n15. Delete a session\n16. Delete API key and verify disconnect\n\n### Known Limitations (Expected)\n- Resources feature may not work (no Share Extension on macOS in MVP)\n- Haptic feedback not present (correct behavior)\n- QR code scanning not available (iOS-only, manual entry works)\n\n### Dependencies\n- Depends on: voice-code-desktop3-yfz.11 (Tests must pass first)\n\n## Verification\nAll acceptance criteria from the epic are manually verified.\n\n## Acceptance Criteria\n- [ ] Authentication required view shows when no API key\n- [ ] API key can be entered manually in Settings\n- [ ] App connects to WebSocket backend after authentication\n- [ ] Sessions can be created, switched, deleted\n- [ ] Voice input works\n- [ ] Prompts sent successfully\n- [ ] Responses received and displayed\n- [ ] Clipboard copy works\n- [ ] Commands execute\n- [ ] Command history displays\n- [ ] Command output viewable\n- [ ] Resources displays (content may be empty without Share Extension)\n- [ ] API key can be deleted from Settings","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-02T18:40:34.424918-06:00","updated_at":"2026-01-04T11:49:47.058102-06:00","source_repo":".","dependencies":[{"issue_id":"voice-code-desktop3-yfz.12","depends_on_id":"voice-code-desktop3-yfz.11","type":"blocks","created_at":"2026-01-02T18:43:31.847005-06:00","created_by":"travisbrown"}]}
{"id":"voice-code-desktop3-yfz.12","content_hash":"e006f81e12fd374920b943d0157ab354c10a0a2d6babd1630ec6f7031f9e675d","title":"Manual feature testing","description":"## Design Reference\n@docs/design/macos-desktop-app.md (Section: Acceptance Criteria)\n\n## Context\nFinal verification that all iOS features work correctly on macOS. Manual testing ensures parity beyond what automated tests cover.\n\n## Requirements\nTest all features from the acceptance criteria:\n1. WebSocket connection to backend\n2. Create/switch/delete sessions\n3. Voice input recording\n4. Send prompts, receive responses\n5. Copy message to clipboard\n6. Execute Makefile commands\n7. View command history\n8. View command output\n\n## Technical Approach\n\n### Test Script\n1. Launch macOS app\n2. Verify backend connection (status indicator)\n3. Create new session\n4. Record voice input\n5. Send text prompt\n6. Receive response\n7. Copy response to clipboard\n8. Open Commands tab\n9. Execute a command\n10. View command history\n11. Check command output\n12. Switch sessions\n13. Delete a session\n\n### Known Limitations (Expected)\n- Resources feature may not work (no Share Extension on macOS in MVP)\n- Haptic feedback not present (correct behavior)\n\n### Dependencies\n- Depends on: voice-code-desktop3-yfz.11 (Tests must pass first)\n\n## Verification\nAll acceptance criteria from the epic are manually verified.\n\n## Acceptance Criteria\n- [ ] App connects to WebSocket backend\n- [ ] Sessions can be created, switched, deleted\n- [ ] Voice input works\n- [ ] Prompts sent successfully\n- [ ] Responses received and displayed\n- [ ] Clipboard copy works\n- [ ] Commands execute\n- [ ] Command history displays\n- [ ] Command output viewable\n- [ ] Resources displays (content may be empty without Share Extension)","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-02T18:40:34.424918-06:00","updated_at":"2026-01-02T18:42:25.980915-06:00","source_repo":".","dependencies":[{"issue_id":"voice-code-desktop3-yfz.12","depends_on_id":"voice-code-desktop3-yfz.11","type":"blocks","created_at":"2026-01-02T18:43:31.847005-06:00","created_by":"travisbrown"}]}
{"id":"voice-code-desktop3-yfz.13","content_hash":"8e61285262c7ceec067823f1ce551c07c2fab3523b139479d94d02af136e17bc","title":"APIKeySection.swift platform conditionals for QR scanner","description":"## Design Reference\n@docs/design/macos-desktop-app.md\n\n## Context\nThe security feature added `APIKeySection.swift` which uses `QRScannerView` for camera-based QR code scanning. Since `QRScannerView.swift` is excluded from the macOS target (uses UIViewController and AVCaptureSession), `APIKeySection.swift` needs platform conditionals to hide QR scanning UI on macOS.\n\n## Requirements\n1. Add #if os(iOS) conditionals around QRScannerView usage\n2. Hide \"Scan QR Code\" button on macOS\n3. Hide \"Update Key\" button (which opens scanner) on macOS\n4. Manual key entry remains the only option on macOS\n\n## Technical Approach\n\n### Files to Modify\n- `ios/VoiceCode/Views/APIKeySection.swift`\n\n### Changes\n```swift\n// Hide scanner sheet on macOS\n#if os(iOS)\n.sheet(isPresented: $showingScanner) {\n    QRScannerView(...)\n}\n#endif\n\n// In notConfiguredKeyView, hide scan button on macOS\n#if os(iOS)\nButton(action: { showingScanner = true }) {\n    HStack {\n        Text(\"Scan QR Code\")\n        ...\n    }\n}\n#endif\n\n// In configuredKeyView, hide update button on macOS\n#if os(iOS)\nButton(action: { showingScanner = true }) {\n    HStack {\n        Text(\"Update Key\")\n        ...\n    }\n}\n#endif\n```\n\n### Dependencies\n- Depends on: voice-code-desktop3-yfz.2 (QRScannerView must be excluded first)\n- Can run in parallel with: yfz.3-9\n\n## Verification\n1. macOS target compiles without QRScannerView references\n2. iOS target still shows QR scanning options\n3. macOS shows only manual key entry\n4. Key management (save/delete) works on both platforms\n\n## Acceptance Criteria\n- [ ] No QRScannerView usage without #if os(iOS) guard\n- [ ] macOS shows manual entry only (no scan buttons)\n- [ ] iOS retains full QR scanning functionality\n- [ ] Both platforms compile","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-04T11:29:20.060435-06:00","updated_at":"2026-01-04T11:29:37.369789-06:00","source_repo":".","dependencies":[{"issue_id":"voice-code-desktop3-yfz.13","depends_on_id":"voice-code-desktop3-yfz.2","type":"blocks","created_at":"2026-01-04T11:29:44.472894-06:00","created_by":"travisbrown"}]}
{"id":"voice-code-desktop3-yfz.2","content_hash":"3ab978c0d1d61945d3e46859c01d215944db5ad928667c1e6663d4c71d9d82cf","title":"Project Infrastructure: VoiceCodeMac target setup","description":"## Design Reference\n@docs/design/macos-desktop-app.md\n\n## Context\nThis is the foundation task that establishes the macOS target in the Xcode project. All other tasks depend on this being completed first. Without this infrastructure, there is no macOS build to modify or test.\n\n## Requirements\n1. Create VoiceCodeMac directory structure\n2. Create macOS-specific Info.plist with required keys\n3. Create macOS entitlements file with App Sandbox and network permissions\n4. Update project.yml with VoiceCodeMac target configuration\n5. Generate Xcode project and verify it opens without errors\n\n## Technical Approach\n\n### New Files\n- `ios/VoiceCodeMac/Info.plist` - macOS app metadata (bundle ID, version, SwiftUI lifecycle)\n- `ios/VoiceCodeMac/VoiceCodeMac.entitlements` - App Sandbox, network client, audio input\n\n### Files to Modify\n- `ios/project.yml` - Add VoiceCodeMac target with:\n  - Platform: macOS\n  - Deployment target: 15.0 (per design document line 388)\n  - Sources pointing to shared VoiceCode/ and VoiceCodeMac/\n  - Excludes for iOS-only files:\n    - `Managers/DeviceAudioSessionManager.swift` (AVAudioSession)\n    - `Views/QRScannerView.swift` (UIViewController, AVCaptureSession camera)\n  - Test target VoiceCodeMacTests excluding iOS-only tests:\n    - `DeviceAudioSessionManagerTests.swift`\n    - `VoiceOutputManagerTests.swift`\n    - `CopyFeaturesTests.swift`\n    - `SessionInfoViewTests.swift`\n    - `QRScannerViewTests.swift`\n\n### Dependencies\nNone - this is the foundation task.\n\n## Verification\n1. Run `make generate` successfully\n2. Open VoiceCode.xcodeproj in Xcode\n3. Select VoiceCodeMac scheme\n4. Build succeeds (may have warnings, but no errors blocking compilation)\n5. App launches and shows main window\n\n## Acceptance Criteria\n- [ ] VoiceCodeMac/ directory exists with Info.plist and entitlements\n- [ ] project.yml includes VoiceCodeMac and VoiceCodeMacTests targets\n- [ ] project.yml excludes DeviceAudioSessionManager.swift and QRScannerView.swift from macOS\n- [ ] VoiceCodeMacTests excludes 5 iOS-only test files\n- [ ] macOS deployment target is 15.0\n- [ ] `make generate` completes without errors\n- [ ] Xcode opens project and shows both iOS and macOS schemes\n- [ ] macOS target builds (compilation succeeds)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T18:38:57.171976-06:00","updated_at":"2026-01-04T12:17:43.313871-06:00","closed_at":"2026-01-04T12:17:43.313871-06:00","source_repo":"."}
{"id":"voice-code-desktop3-yfz.2","content_hash":"3ab978c0d1d61945d3e46859c01d215944db5ad928667c1e6663d4c71d9d82cf","title":"Project Infrastructure: VoiceCodeMac target setup","description":"## Design Reference\n@docs/design/macos-desktop-app.md\n\n## Context\nThis is the foundation task that establishes the macOS target in the Xcode project. All other tasks depend on this being completed first. Without this infrastructure, there is no macOS build to modify or test.\n\n## Requirements\n1. Create VoiceCodeMac directory structure\n2. Create macOS-specific Info.plist with required keys\n3. Create macOS entitlements file with App Sandbox and network permissions\n4. Update project.yml with VoiceCodeMac target configuration\n5. Generate Xcode project and verify it opens without errors\n\n## Technical Approach\n\n### New Files\n- `ios/VoiceCodeMac/Info.plist` - macOS app metadata (bundle ID, version, SwiftUI lifecycle)\n- `ios/VoiceCodeMac/VoiceCodeMac.entitlements` - App Sandbox, network client, audio input\n\n### Files to Modify\n- `ios/project.yml` - Add VoiceCodeMac target with:\n  - Platform: macOS\n  - Deployment target: 15.0 (per design document line 388)\n  - Sources pointing to shared VoiceCode/ and VoiceCodeMac/\n  - Excludes for iOS-only files:\n    - `Managers/DeviceAudioSessionManager.swift` (AVAudioSession)\n    - `Views/QRScannerView.swift` (UIViewController, AVCaptureSession camera)\n  - Test target VoiceCodeMacTests excluding iOS-only tests:\n    - `DeviceAudioSessionManagerTests.swift`\n    - `VoiceOutputManagerTests.swift`\n    - `CopyFeaturesTests.swift`\n    - `SessionInfoViewTests.swift`\n    - `QRScannerViewTests.swift`\n\n### Dependencies\nNone - this is the foundation task.\n\n## Verification\n1. Run `make generate` successfully\n2. Open VoiceCode.xcodeproj in Xcode\n3. Select VoiceCodeMac scheme\n4. Build succeeds (may have warnings, but no errors blocking compilation)\n5. App launches and shows main window\n\n## Acceptance Criteria\n- [ ] VoiceCodeMac/ directory exists with Info.plist and entitlements\n- [ ] project.yml includes VoiceCodeMac and VoiceCodeMacTests targets\n- [ ] project.yml excludes DeviceAudioSessionManager.swift and QRScannerView.swift from macOS\n- [ ] VoiceCodeMacTests excludes 5 iOS-only test files\n- [ ] macOS deployment target is 15.0\n- [ ] `make generate` completes without errors\n- [ ] Xcode opens project and shows both iOS and macOS schemes\n- [ ] macOS target builds (compilation succeeds)","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-02T18:38:57.171976-06:00","updated_at":"2026-01-04T11:40:16.575918-06:00","source_repo":"."}
{"id":"voice-code-desktop3-yfz.2","content_hash":"f5991f1f1b91d8a4fd27f86067aa31db5c3402d7ff1ea57a3260ee910e1a007b","title":"Project Infrastructure: VoiceCodeMac target setup","description":"## Design Reference\n@docs/design/macos-desktop-app.md\n\n## Context\nThis is the foundation task that establishes the macOS target in the Xcode project. All other tasks depend on this being completed first. Without this infrastructure, there is no macOS build to modify or test.\n\n## Requirements\n1. Create VoiceCodeMac directory structure\n2. Create macOS-specific Info.plist with required keys\n3. Create macOS entitlements file with App Sandbox and network permissions\n4. Update project.yml with VoiceCodeMac target configuration\n5. Generate Xcode project and verify it opens without errors\n\n## Technical Approach\n\n### New Files\n- `ios/VoiceCodeMac/Info.plist` - macOS app metadata (bundle ID, version, SwiftUI lifecycle)\n- `ios/VoiceCodeMac/VoiceCodeMac.entitlements` - App Sandbox, network client, audio input\n\n### Files to Modify\n- `ios/project.yml` - Add VoiceCodeMac target with:\n  - Platform: macOS\n  - Deployment target: 15.0 (per design document line 388)\n  - Sources pointing to shared VoiceCode/ and VoiceCodeMac/\n  - Excludes for iOS-only files (DeviceAudioSessionManager.swift)\n  - Test target VoiceCodeMacTests excluding iOS-only tests\n\n### Dependencies\nNone - this is the foundation task.\n\n## Verification\n1. Run `make generate` successfully\n2. Open VoiceCode.xcodeproj in Xcode\n3. Select VoiceCodeMac scheme\n4. Build succeeds (may have warnings, but no errors blocking compilation)\n5. App launches and shows main window\n\n## Acceptance Criteria\n- [ ] VoiceCodeMac/ directory exists with Info.plist and entitlements\n- [ ] project.yml includes VoiceCodeMac and VoiceCodeMacTests targets\n- [ ] macOS deployment target is 15.0\n- [ ] `make generate` completes without errors\n- [ ] Xcode opens project and shows both iOS and macOS schemes\n- [ ] macOS target builds (compilation succeeds)","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-02T18:38:57.171976-06:00","updated_at":"2026-01-02T18:47:42.092492-06:00","source_repo":"."}
{"id":"voice-code-desktop3-yfz.3","content_hash":"60d344e24a56eeccc432475e450460b9b8a6527a15e2b755494abf717a9ffbeb","title":"Create ClipboardUtility.swift","description":"## Design Reference\n@docs/design/macos-desktop-app.md (Section: ClipboardUtility.swift, lines 317-352)\n\n## Context\nCentralizes clipboard and haptic feedback operations to avoid duplicating platform conditionals across 7 view files. This utility provides a single location for platform-specific code.\n\n## Requirements\n1. Create ClipboardUtility.swift with cross-platform clipboard copy function\n2. Include haptic feedback wrapper (iOS-only, no-op on macOS)\n3. Use proper platform conditionals (#if os(iOS) / #elseif os(macOS))\n\n## Technical Approach\n\n### New Files\n- `ios/VoiceCode/Utils/ClipboardUtility.swift`\n\n### Implementation (per design document)\n```swift\nimport Foundation\n#if os(iOS)\nimport UIKit\n#elseif os(macOS)\nimport AppKit\n#endif\n\nenum ClipboardUtility {\n    /// Copy text to system clipboard with optional haptic feedback (iOS only)\n    static func copy(_ text: String) {\n        #if os(iOS)\n        UIPasteboard.general.string = text\n        #elseif os(macOS)\n        NSPasteboard.general.clearContents()\n        NSPasteboard.general.setString(text, forType: .string)\n        #endif\n    }\n\n    /// Trigger success haptic feedback (iOS only, no-op on macOS)\n    static func triggerSuccessHaptic() {\n        #if os(iOS)\n        let generator = UINotificationFeedbackGenerator()\n        generator.notificationOccurred(.success)\n        #endif\n        // macOS: No haptic feedback available\n    }\n}\n```\n\n### Dependencies\n- Depends on: voice-code-desktop3-yfz.2 (Project Infrastructure)\n- Can run in parallel with: yfz.4, yfz.5, yfz.6, yfz.7 (manager conditionals)\n\n## Verification\n1. File compiles for both iOS and macOS targets\n2. No compiler errors or warnings about platform availability\n\n## Acceptance Criteria\n- [ ] ClipboardUtility.swift exists in ios/VoiceCode/Utils/\n- [ ] Has copy() and triggerSuccessHaptic() methods\n- [ ] Compiles for iOS target\n- [ ] Compiles for macOS target\n- [ ] Platform conditionals are correct","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T18:40:12.197311-06:00","updated_at":"2026-01-04T13:07:00.486634-06:00","closed_at":"2026-01-04T13:07:00.486634-06:00","source_repo":".","dependencies":[{"issue_id":"voice-code-desktop3-yfz.3","depends_on_id":"voice-code-desktop3-yfz.2","type":"blocks","created_at":"2026-01-02T18:42:50.388708-06:00","created_by":"travisbrown"}]}
{"id":"voice-code-desktop3-yfz.3","content_hash":"60d344e24a56eeccc432475e450460b9b8a6527a15e2b755494abf717a9ffbeb","title":"Create ClipboardUtility.swift","description":"## Design Reference\n@docs/design/macos-desktop-app.md (Section: ClipboardUtility.swift, lines 317-352)\n\n## Context\nCentralizes clipboard and haptic feedback operations to avoid duplicating platform conditionals across 7 view files. This utility provides a single location for platform-specific code.\n\n## Requirements\n1. Create ClipboardUtility.swift with cross-platform clipboard copy function\n2. Include haptic feedback wrapper (iOS-only, no-op on macOS)\n3. Use proper platform conditionals (#if os(iOS) / #elseif os(macOS))\n\n## Technical Approach\n\n### New Files\n- `ios/VoiceCode/Utils/ClipboardUtility.swift`\n\n### Implementation (per design document)\n```swift\nimport Foundation\n#if os(iOS)\nimport UIKit\n#elseif os(macOS)\nimport AppKit\n#endif\n\nenum ClipboardUtility {\n    /// Copy text to system clipboard with optional haptic feedback (iOS only)\n    static func copy(_ text: String) {\n        #if os(iOS)\n        UIPasteboard.general.string = text\n        #elseif os(macOS)\n        NSPasteboard.general.clearContents()\n        NSPasteboard.general.setString(text, forType: .string)\n        #endif\n    }\n\n    /// Trigger success haptic feedback (iOS only, no-op on macOS)\n    static func triggerSuccessHaptic() {\n        #if os(iOS)\n        let generator = UINotificationFeedbackGenerator()\n        generator.notificationOccurred(.success)\n        #endif\n        // macOS: No haptic feedback available\n    }\n}\n```\n\n### Dependencies\n- Depends on: voice-code-desktop3-yfz.2 (Project Infrastructure)\n- Can run in parallel with: yfz.4, yfz.5, yfz.6, yfz.7 (manager conditionals)\n\n## Verification\n1. File compiles for both iOS and macOS targets\n2. No compiler errors or warnings about platform availability\n\n## Acceptance Criteria\n- [ ] ClipboardUtility.swift exists in ios/VoiceCode/Utils/\n- [ ] Has copy() and triggerSuccessHaptic() methods\n- [ ] Compiles for iOS target\n- [ ] Compiles for macOS target\n- [ ] Platform conditionals are correct","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-02T18:40:12.197311-06:00","updated_at":"2026-01-02T18:47:21.490231-06:00","source_repo":".","dependencies":[{"issue_id":"voice-code-desktop3-yfz.3","depends_on_id":"voice-code-desktop3-yfz.2","type":"blocks","created_at":"2026-01-02T18:42:50.388708-06:00","created_by":"travisbrown"}]}
{"id":"voice-code-desktop3-yfz.4","content_hash":"c16c0eb0b9ca4a5d1a98f1ac5f7879b2d961171c4828fa34f96ccfccb7985b81","title":"VoiceCodeClient.swift platform conditionals","description":"## Design Reference\n@docs/design/macos-desktop-app.md (Section: VoiceCodeClient.swift)\n\n## Context\nVoiceCodeClient uses UIApplication lifecycle notifications for WebSocket reconnection. macOS uses NSApplication equivalents.\n\n## Requirements\n1. Add platform conditionals for lifecycle notification observers\n2. Use willEnterForegroundNotification (iOS) vs willBecomeActiveNotification (macOS)\n3. Use didEnterBackgroundNotification (iOS) vs willResignActiveNotification (macOS)\n\n## Technical Approach\n\n### Files to Modify\n- `ios/VoiceCode/Managers/VoiceCodeClient.swift`\n\n### Changes\nReplace UIApplication notification observers with platform-conditional versions:\n\n```swift\n#if os(iOS)\nNotificationCenter.default.addObserver(\n    self,\n    selector: #selector(appWillEnterForeground),\n    name: UIApplication.willEnterForegroundNotification,\n    object: nil\n)\n#elseif os(macOS)\nNotificationCenter.default.addObserver(\n    self,\n    selector: #selector(appWillEnterForeground),\n    name: NSApplication.willBecomeActiveNotification,\n    object: nil\n)\n#endif\n```\n\n### Dependencies\n- Depends on: voice-code-desktop3-yfz.2 (Project Infrastructure)\n- Can run in parallel with: yfz.3, yfz.5, yfz.6, yfz.7\n\n## Verification\n1. macOS target compiles without UIApplication errors\n2. iOS target still compiles correctly\n3. WebSocket reconnects properly on both platforms\n\n## Acceptance Criteria\n- [ ] No UIApplication references without #if os(iOS) guard\n- [ ] macOS uses NSApplication equivalents\n- [ ] Compiles for both platforms","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T18:40:13.439069-06:00","updated_at":"2026-01-04T14:10:42.403422-06:00","closed_at":"2026-01-04T14:10:42.403422-06:00","source_repo":".","dependencies":[{"issue_id":"voice-code-desktop3-yfz.4","depends_on_id":"voice-code-desktop3-yfz.2","type":"blocks","created_at":"2026-01-02T18:42:52.152727-06:00","created_by":"travisbrown"}]}
{"id":"voice-code-desktop3-yfz.4","content_hash":"c16c0eb0b9ca4a5d1a98f1ac5f7879b2d961171c4828fa34f96ccfccb7985b81","title":"VoiceCodeClient.swift platform conditionals","description":"## Design Reference\n@docs/design/macos-desktop-app.md (Section: VoiceCodeClient.swift)\n\n## Context\nVoiceCodeClient uses UIApplication lifecycle notifications for WebSocket reconnection. macOS uses NSApplication equivalents.\n\n## Requirements\n1. Add platform conditionals for lifecycle notification observers\n2. Use willEnterForegroundNotification (iOS) vs willBecomeActiveNotification (macOS)\n3. Use didEnterBackgroundNotification (iOS) vs willResignActiveNotification (macOS)\n\n## Technical Approach\n\n### Files to Modify\n- `ios/VoiceCode/Managers/VoiceCodeClient.swift`\n\n### Changes\nReplace UIApplication notification observers with platform-conditional versions:\n\n```swift\n#if os(iOS)\nNotificationCenter.default.addObserver(\n    self,\n    selector: #selector(appWillEnterForeground),\n    name: UIApplication.willEnterForegroundNotification,\n    object: nil\n)\n#elseif os(macOS)\nNotificationCenter.default.addObserver(\n    self,\n    selector: #selector(appWillEnterForeground),\n    name: NSApplication.willBecomeActiveNotification,\n    object: nil\n)\n#endif\n```\n\n### Dependencies\n- Depends on: voice-code-desktop3-yfz.2 (Project Infrastructure)\n- Can run in parallel with: yfz.3, yfz.5, yfz.6, yfz.7\n\n## Verification\n1. macOS target compiles without UIApplication errors\n2. iOS target still compiles correctly\n3. WebSocket reconnects properly on both platforms\n\n## Acceptance Criteria\n- [ ] No UIApplication references without #if os(iOS) guard\n- [ ] macOS uses NSApplication equivalents\n- [ ] Compiles for both platforms","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-02T18:40:13.439069-06:00","updated_at":"2026-01-02T18:41:27.153743-06:00","source_repo":".","dependencies":[{"issue_id":"voice-code-desktop3-yfz.4","depends_on_id":"voice-code-desktop3-yfz.2","type":"blocks","created_at":"2026-01-02T18:42:52.152727-06:00","created_by":"travisbrown"}]}
{"id":"voice-code-desktop3-yfz.5","content_hash":"6c056948df49e63935879a52ab4124e097dc69c4a22a9c9aba37b04af4ffa796","title":"VoiceInputManager.swift platform conditionals","description":"## Design Reference\n@docs/design/macos-desktop-app.md (Section: VoiceInputManager.swift)\n\n## Context\nVoiceInputManager uses AVAudioSession for iOS audio configuration. macOS does not have AVAudioSession - it uses AVAudioEngine directly without session management.\n\n## Requirements\n1. Guard all AVAudioSession calls with #if os(iOS)\n2. macOS audio input works without session configuration\n3. Preserve iOS behavior exactly\n\n## Technical Approach\n\n### Files to Modify\n- `ios/VoiceCode/Managers/VoiceInputManager.swift`\n\n### Changes\nWrap AVAudioSession configuration in platform conditionals:\n\n```swift\nprivate func configureAudioSession() throws {\n    #if os(iOS)\n    let session = AVAudioSession.sharedInstance()\n    try session.setCategory(.playAndRecord, mode: .default, options: [.defaultToSpeaker, .allowBluetooth])\n    try session.setActive(true)\n    #endif\n    // macOS: No session configuration needed\n}\n```\n\n### Dependencies\n- Depends on: voice-code-desktop3-yfz.2 (Project Infrastructure)\n- Can run in parallel with: yfz.3, yfz.4, yfz.6, yfz.7\n\n## Verification\n1. macOS target compiles without AVAudioSession errors\n2. Voice input works on macOS using AVAudioEngine\n3. iOS behavior unchanged\n\n## Acceptance Criteria\n- [ ] No AVAudioSession references without #if os(iOS) guard\n- [ ] macOS compiles successfully\n- [ ] Voice recording starts without errors on macOS","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T18:40:15.067729-06:00","updated_at":"2026-01-04T15:27:15.657037-06:00","closed_at":"2026-01-04T15:27:15.657037-06:00","source_repo":".","dependencies":[{"issue_id":"voice-code-desktop3-yfz.5","depends_on_id":"voice-code-desktop3-yfz.2","type":"blocks","created_at":"2026-01-02T18:42:53.469317-06:00","created_by":"travisbrown"}]}
{"id":"voice-code-desktop3-yfz.5","content_hash":"6c056948df49e63935879a52ab4124e097dc69c4a22a9c9aba37b04af4ffa796","title":"VoiceInputManager.swift platform conditionals","description":"## Design Reference\n@docs/design/macos-desktop-app.md (Section: VoiceInputManager.swift)\n\n## Context\nVoiceInputManager uses AVAudioSession for iOS audio configuration. macOS does not have AVAudioSession - it uses AVAudioEngine directly without session management.\n\n## Requirements\n1. Guard all AVAudioSession calls with #if os(iOS)\n2. macOS audio input works without session configuration\n3. Preserve iOS behavior exactly\n\n## Technical Approach\n\n### Files to Modify\n- `ios/VoiceCode/Managers/VoiceInputManager.swift`\n\n### Changes\nWrap AVAudioSession configuration in platform conditionals:\n\n```swift\nprivate func configureAudioSession() throws {\n    #if os(iOS)\n    let session = AVAudioSession.sharedInstance()\n    try session.setCategory(.playAndRecord, mode: .default, options: [.defaultToSpeaker, .allowBluetooth])\n    try session.setActive(true)\n    #endif\n    // macOS: No session configuration needed\n}\n```\n\n### Dependencies\n- Depends on: voice-code-desktop3-yfz.2 (Project Infrastructure)\n- Can run in parallel with: yfz.3, yfz.4, yfz.6, yfz.7\n\n## Verification\n1. macOS target compiles without AVAudioSession errors\n2. Voice input works on macOS using AVAudioEngine\n3. iOS behavior unchanged\n\n## Acceptance Criteria\n- [ ] No AVAudioSession references without #if os(iOS) guard\n- [ ] macOS compiles successfully\n- [ ] Voice recording starts without errors on macOS","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-02T18:40:15.067729-06:00","updated_at":"2026-01-02T18:41:28.54364-06:00","source_repo":".","dependencies":[{"issue_id":"voice-code-desktop3-yfz.5","depends_on_id":"voice-code-desktop3-yfz.2","type":"blocks","created_at":"2026-01-02T18:42:53.469317-06:00","created_by":"travisbrown"}]}
{"id":"voice-code-desktop3-yfz.6","content_hash":"02fa78d1528ae96739b872c3220b44e72f1ed1d20d409cd420a295665213fcbc","title":"VoiceOutputManager.swift platform conditionals","description":"## Design Reference\n@docs/design/macos-desktop-app.md (Section: VoiceOutputManager.swift)\n\n## Context\nVoiceOutputManager has AVAudioSession guards for audio playback. The interruptionHandler property and session configuration need platform conditionals.\n\n## Requirements\n1. Guard AVAudioSession usage with #if os(iOS)\n2. Remove or conditionally compile interruptionHandler property\n3. Ensure audio playback works on macOS\n\n## Technical Approach\n\n### Files to Modify\n- `ios/VoiceCode/Managers/VoiceOutputManager.swift`\n\n### Changes\n```swift\n#if os(iOS)\nprivate var interruptionHandler: Any?\n#endif\n\nprivate func setupAudioSession() {\n    #if os(iOS)\n    let session = AVAudioSession.sharedInstance()\n    try? session.setCategory(.playback, mode: .default)\n    try? session.setActive(true)\n    #endif\n}\n```\n\n### Dependencies\n- Depends on: voice-code-desktop3-yfz.2 (Project Infrastructure)\n- Can run in parallel with: yfz.3, yfz.4, yfz.5, yfz.7\n\n## Verification\n1. macOS target compiles without AVAudioSession errors\n2. Audio playback works on macOS\n3. iOS behavior unchanged\n\n## Acceptance Criteria\n- [ ] No AVAudioSession references without #if os(iOS) guard\n- [ ] interruptionHandler conditionally compiled\n- [ ] Text-to-speech works on macOS","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T18:40:16.420632-06:00","updated_at":"2026-01-04T15:42:59.919913-06:00","closed_at":"2026-01-04T15:42:59.919913-06:00","source_repo":".","dependencies":[{"issue_id":"voice-code-desktop3-yfz.6","depends_on_id":"voice-code-desktop3-yfz.2","type":"blocks","created_at":"2026-01-02T18:42:54.821709-06:00","created_by":"travisbrown"}]}
{"id":"voice-code-desktop3-yfz.6","content_hash":"02fa78d1528ae96739b872c3220b44e72f1ed1d20d409cd420a295665213fcbc","title":"VoiceOutputManager.swift platform conditionals","description":"## Design Reference\n@docs/design/macos-desktop-app.md (Section: VoiceOutputManager.swift)\n\n## Context\nVoiceOutputManager has AVAudioSession guards for audio playback. The interruptionHandler property and session configuration need platform conditionals.\n\n## Requirements\n1. Guard AVAudioSession usage with #if os(iOS)\n2. Remove or conditionally compile interruptionHandler property\n3. Ensure audio playback works on macOS\n\n## Technical Approach\n\n### Files to Modify\n- `ios/VoiceCode/Managers/VoiceOutputManager.swift`\n\n### Changes\n```swift\n#if os(iOS)\nprivate var interruptionHandler: Any?\n#endif\n\nprivate func setupAudioSession() {\n    #if os(iOS)\n    let session = AVAudioSession.sharedInstance()\n    try? session.setCategory(.playback, mode: .default)\n    try? session.setActive(true)\n    #endif\n}\n```\n\n### Dependencies\n- Depends on: voice-code-desktop3-yfz.2 (Project Infrastructure)\n- Can run in parallel with: yfz.3, yfz.4, yfz.5, yfz.7\n\n## Verification\n1. macOS target compiles without AVAudioSession errors\n2. Audio playback works on macOS\n3. iOS behavior unchanged\n\n## Acceptance Criteria\n- [ ] No AVAudioSession references without #if os(iOS) guard\n- [ ] interruptionHandler conditionally compiled\n- [ ] Text-to-speech works on macOS","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-02T18:40:16.420632-06:00","updated_at":"2026-01-02T18:41:30.060768-06:00","source_repo":".","dependencies":[{"issue_id":"voice-code-desktop3-yfz.6","depends_on_id":"voice-code-desktop3-yfz.2","type":"blocks","created_at":"2026-01-02T18:42:54.821709-06:00","created_by":"travisbrown"}]}
{"id":"voice-code-desktop3-yfz.7","content_hash":"140e0a9d7182e09f57a7da5b60c2e2f5b09c18b2275d1ba7ea4d29c7ea5703bd","title":"VoiceCodeApp.swift platform conditionals","description":"## Design Reference\n@docs/design/macos-desktop-app.md (Section: VoiceCodeApp.swift)\n\n## Context\nVoiceCodeApp uses UIApplication lifecycle hooks for app state management. macOS uses NSApplication equivalents with different lifecycle methods.\n\n## Requirements\n1. Add platform conditionals for scenePhase handling\n2. Replace UIApplication-specific code with NSApplication equivalents\n3. Maintain same behavior on both platforms\n\n## Technical Approach\n\n### Files to Modify\n- `ios/VoiceCode/VoiceCodeApp.swift`\n\n### Changes\n```swift\n.onChange(of: scenePhase) { newPhase in\n    switch newPhase {\n    case .active:\n        voiceCodeClient.connect()\n    case .background:\n        #if os(iOS)\n        voiceCodeClient.disconnect()\n        #endif\n        // macOS: Keep connection alive\n    case .inactive:\n        break\n    @unknown default:\n        break\n    }\n}\n```\n\n### Dependencies\n- Depends on: voice-code-desktop3-yfz.2 (Project Infrastructure)\n- Can run in parallel with: yfz.3, yfz.4, yfz.5, yfz.6\n\n## Verification\n1. App launches correctly on macOS\n2. WebSocket connects on app activation\n3. iOS behavior unchanged\n\n## Acceptance Criteria\n- [ ] No UIApplication references without guards\n- [ ] App launches on macOS\n- [ ] Lifecycle behavior appropriate for each platform","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T18:40:17.818622-06:00","updated_at":"2026-01-04T15:52:27.870621-06:00","closed_at":"2026-01-04T15:52:27.870621-06:00","source_repo":".","dependencies":[{"issue_id":"voice-code-desktop3-yfz.7","depends_on_id":"voice-code-desktop3-yfz.2","type":"blocks","created_at":"2026-01-02T18:42:56.211539-06:00","created_by":"travisbrown"}]}
{"id":"voice-code-desktop3-yfz.7","content_hash":"140e0a9d7182e09f57a7da5b60c2e2f5b09c18b2275d1ba7ea4d29c7ea5703bd","title":"VoiceCodeApp.swift platform conditionals","description":"## Design Reference\n@docs/design/macos-desktop-app.md (Section: VoiceCodeApp.swift)\n\n## Context\nVoiceCodeApp uses UIApplication lifecycle hooks for app state management. macOS uses NSApplication equivalents with different lifecycle methods.\n\n## Requirements\n1. Add platform conditionals for scenePhase handling\n2. Replace UIApplication-specific code with NSApplication equivalents\n3. Maintain same behavior on both platforms\n\n## Technical Approach\n\n### Files to Modify\n- `ios/VoiceCode/VoiceCodeApp.swift`\n\n### Changes\n```swift\n.onChange(of: scenePhase) { newPhase in\n    switch newPhase {\n    case .active:\n        voiceCodeClient.connect()\n    case .background:\n        #if os(iOS)\n        voiceCodeClient.disconnect()\n        #endif\n        // macOS: Keep connection alive\n    case .inactive:\n        break\n    @unknown default:\n        break\n    }\n}\n```\n\n### Dependencies\n- Depends on: voice-code-desktop3-yfz.2 (Project Infrastructure)\n- Can run in parallel with: yfz.3, yfz.4, yfz.5, yfz.6\n\n## Verification\n1. App launches correctly on macOS\n2. WebSocket connects on app activation\n3. iOS behavior unchanged\n\n## Acceptance Criteria\n- [ ] No UIApplication references without guards\n- [ ] App launches on macOS\n- [ ] Lifecycle behavior appropriate for each platform","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-02T18:40:17.818622-06:00","updated_at":"2026-01-02T18:41:31.34906-06:00","source_repo":".","dependencies":[{"issue_id":"voice-code-desktop3-yfz.7","depends_on_id":"voice-code-desktop3-yfz.2","type":"blocks","created_at":"2026-01-02T18:42:56.211539-06:00","created_by":"travisbrown"}]}
{"id":"voice-code-desktop3-yfz.8","content_hash":"4b1e9a49b069b44598e3e0759640ae9ba1b11116bf7746aadc85ddb51ab77a20","title":"Update view files to use ClipboardUtility","description":"## Design Reference\n@docs/design/macos-desktop-app.md (Section: View Files with Clipboard, lines 64-74)\n\n## Context\n7 view files contain UIPasteboard.general.string and UINotificationFeedbackGenerator calls. These need to use ClipboardUtility instead.\n\n## Requirements\n1. Replace all UIPasteboard.general.string calls with ClipboardUtility.copy()\n2. Replace UINotificationFeedbackGenerator calls with ClipboardUtility.triggerSuccessHaptic()\n3. Remove direct UIKit imports where no longer needed\n\n## Technical Approach\n\n### Files to Modify (7 files per design document)\n1. `ios/VoiceCode/Views/DirectoryListView.swift`\n2. `ios/VoiceCode/Views/SessionsForDirectoryView.swift`\n3. `ios/VoiceCode/Views/SessionLookupView.swift`\n4. `ios/VoiceCode/Views/SessionInfoView.swift`\n5. `ios/VoiceCode/Views/ConversationView.swift`\n6. `ios/VoiceCode/Views/DebugLogsView.swift`\n7. `ios/VoiceCode/Views/CommandOutputDetailView.swift`\n\n### Changes Pattern\nBefore:\n```swift\nUIPasteboard.general.string = text\nlet generator = UINotificationFeedbackGenerator()\ngenerator.notificationOccurred(.success)\n```\n\nAfter:\n```swift\nClipboardUtility.copy(text)\nClipboardUtility.triggerSuccessHaptic()\n```\n\n### Dependencies\n- Depends on: voice-code-desktop3-yfz.3 (ClipboardUtility.swift must exist first)\n\n## Verification\n1. All 7 files compile for both platforms\n2. No UIPasteboard or UINotificationFeedbackGenerator references remain\n3. Copy functionality works in iOS Simulator\n4. Copy functionality works in macOS app\n\n## Acceptance Criteria\n- [ ] All 7 files updated to use ClipboardUtility\n- [ ] No direct UIPasteboard usage in these files\n- [ ] No direct UINotificationFeedbackGenerator usage in these files\n- [ ] Both platforms compile","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T18:40:28.962719-06:00","updated_at":"2026-01-04T17:22:41.733413-06:00","closed_at":"2026-01-04T17:22:41.733413-06:00","source_repo":".","dependencies":[{"issue_id":"voice-code-desktop3-yfz.8","depends_on_id":"voice-code-desktop3-yfz.3","type":"blocks","created_at":"2026-01-02T18:43:12.411579-06:00","created_by":"travisbrown"}]}
{"id":"voice-code-desktop3-yfz.8","content_hash":"4b1e9a49b069b44598e3e0759640ae9ba1b11116bf7746aadc85ddb51ab77a20","title":"Update view files to use ClipboardUtility","description":"## Design Reference\n@docs/design/macos-desktop-app.md (Section: View Files with Clipboard, lines 64-74)\n\n## Context\n7 view files contain UIPasteboard.general.string and UINotificationFeedbackGenerator calls. These need to use ClipboardUtility instead.\n\n## Requirements\n1. Replace all UIPasteboard.general.string calls with ClipboardUtility.copy()\n2. Replace UINotificationFeedbackGenerator calls with ClipboardUtility.triggerSuccessHaptic()\n3. Remove direct UIKit imports where no longer needed\n\n## Technical Approach\n\n### Files to Modify (7 files per design document)\n1. `ios/VoiceCode/Views/DirectoryListView.swift`\n2. `ios/VoiceCode/Views/SessionsForDirectoryView.swift`\n3. `ios/VoiceCode/Views/SessionLookupView.swift`\n4. `ios/VoiceCode/Views/SessionInfoView.swift`\n5. `ios/VoiceCode/Views/ConversationView.swift`\n6. `ios/VoiceCode/Views/DebugLogsView.swift`\n7. `ios/VoiceCode/Views/CommandOutputDetailView.swift`\n\n### Changes Pattern\nBefore:\n```swift\nUIPasteboard.general.string = text\nlet generator = UINotificationFeedbackGenerator()\ngenerator.notificationOccurred(.success)\n```\n\nAfter:\n```swift\nClipboardUtility.copy(text)\nClipboardUtility.triggerSuccessHaptic()\n```\n\n### Dependencies\n- Depends on: voice-code-desktop3-yfz.3 (ClipboardUtility.swift must exist first)\n\n## Verification\n1. All 7 files compile for both platforms\n2. No UIPasteboard or UINotificationFeedbackGenerator references remain\n3. Copy functionality works in iOS Simulator\n4. Copy functionality works in macOS app\n\n## Acceptance Criteria\n- [ ] All 7 files updated to use ClipboardUtility\n- [ ] No direct UIPasteboard usage in these files\n- [ ] No direct UINotificationFeedbackGenerator usage in these files\n- [ ] Both platforms compile","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-02T18:40:28.962719-06:00","updated_at":"2026-01-02T18:47:02.342643-06:00","source_repo":".","dependencies":[{"issue_id":"voice-code-desktop3-yfz.8","depends_on_id":"voice-code-desktop3-yfz.3","type":"blocks","created_at":"2026-01-02T18:43:12.411579-06:00","created_by":"travisbrown"}]}
{"id":"voice-code-desktop3-yfz.9","content_hash":"eb00bb6d153f963554f043925d2a9a4e406368c4ff5dfc10a9746a801047b3c5","title":"Create macOS app icons","description":"## Design Reference\n@docs/design/macos-desktop-app.md (Section: Assets)\n\n## Context\nmacOS apps require an AppIcon in the asset catalog. Can reuse iOS icon assets scaled appropriately, or create placeholder icons.\n\n## Requirements\n1. Add macOS AppIcon to Assets.xcassets\n2. Support required sizes: 16, 32, 128, 256, 512 (1x and 2x)\n3. Icon should be recognizable as Voice Code app\n\n## Technical Approach\n\n### Files to Modify\n- `ios/VoiceCode/Assets.xcassets/AppIcon.appiconset/Contents.json`\n- Add macOS icon images to the appiconset\n\n### Options\n1. **Scale existing iOS icons** - Use image tools to generate macOS sizes\n2. **Use placeholder** - Simple colored square with \"VC\" text\n3. **Request from user** - Ask for proper macOS icon assets\n\n### Dependencies\n- Depends on: voice-code-desktop3-yfz.2 (Project Infrastructure)\n- Can run in parallel with any code changes\n\n## Verification\n1. Xcode shows AppIcon for macOS target\n2. App builds without missing icon warnings\n3. App icon displays in Dock\n\n## Acceptance Criteria\n- [ ] AppIcon includes macOS icon entries\n- [ ] No missing icon warnings during build\n- [ ] Icon visible in macOS Dock when app runs","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-02T18:40:30.796061-06:00","updated_at":"2026-01-02T18:42:21.57113-06:00","source_repo":".","dependencies":[{"issue_id":"voice-code-desktop3-yfz.9","depends_on_id":"voice-code-desktop3-yfz.2","type":"blocks","created_at":"2026-01-02T18:42:57.37626-06:00","created_by":"travisbrown"}]}
{"id":"voice-code-desktop3-yfz","content_hash":"9ea2e457101fdeb97f71340188378d744c5fd6d094de09d62a5d6e274038bb1f","title":"macOS Desktop App MVP","description":"## Design Document\n@docs/design/macos-desktop-app.md\n\n## Overview\nCreate a macOS native app with full feature parity to the iOS voice-code app, maximizing code sharing (95%+) through a single Xcode project with iOS and macOS targets.\n\nKey deliverables:\n- VoiceCodeMac target in project.yml with macOS-specific configuration\n- Platform conditionals in 4 manager files (VoiceCodeClient, VoiceInputManager, VoiceOutputManager, VoiceCodeApp)\n- New ClipboardUtility.swift for cross-platform clipboard/haptic operations\n- Updates to 7 view files to use ClipboardUtility\n- macOS app icons\n- VoiceCodeMacTests target (excludes 4 iOS-only test files)\n\n## Acceptance Criteria\n1. macOS app builds successfully with xcodegen generate and xcodebuild -scheme VoiceCodeMac\n2. App launches and connects to backend server\n3. Session list displays correctly\n4. Conversations display and allow text input\n5. Voice input captures and transcribes speech\n6. Voice output speaks assistant responses\n7. Command menu shows Makefile targets and executes commands\n8. Recipes display and execute\n9. Resources view shows uploaded files\n10. Settings persist across launches\n11. All existing iOS unit tests pass\n12. All unit tests pass on macOS target","status":"open","priority":2,"issue_type":"epic","created_at":"2026-01-02T18:37:26.398618-06:00","updated_at":"2026-01-02T18:37:26.398618-06:00","source_repo":"."}
{"id":"voice-code-desktop3-yfz","content_hash":"f074141f80a80fddd295fe0b9a5caf9dc0975b400a2d07a4c1298c5180bea0f4","title":"macOS Desktop App MVP","description":"## Design Document\n@docs/design/macos-desktop-app.md\n\n## Overview\nCreate a macOS native app with full feature parity to the iOS voice-code app, maximizing code sharing (95%+) through a single Xcode project with iOS and macOS targets.\n\nKey deliverables:\n- VoiceCodeMac target in project.yml with macOS-specific configuration\n- iOS-only file exclusions: DeviceAudioSessionManager.swift, QRScannerView.swift\n- Platform conditionals in 5 files: VoiceCodeClient, VoiceInputManager, VoiceOutputManager, VoiceCodeApp, APIKeySection\n- New ClipboardUtility.swift for cross-platform clipboard/haptic operations\n- Updates to 7 view files to use ClipboardUtility\n- macOS app icons\n- VoiceCodeMacTests target (excludes 5 iOS-only test files)\n\n## Acceptance Criteria\n1. macOS app builds successfully with xcodegen generate and xcodebuild -scheme VoiceCodeMac\n2. App launches and connects to backend server\n3. Session list displays correctly\n4. Conversations display and allow text input\n5. Voice input captures and transcribes speech\n6. Voice output speaks assistant responses\n7. Command menu shows Makefile targets and executes commands\n8. Recipes display and execute\n9. Resources view shows uploaded files\n10. Settings persist across launches (including API key via Keychain)\n11. All existing iOS unit tests pass\n12. All unit tests pass on macOS target\n13. API key authentication works (manual entry only on macOS, QR+manual on iOS)","status":"open","priority":2,"issue_type":"epic","created_at":"2026-01-02T18:37:26.398618-06:00","updated_at":"2026-01-04T11:49:00.055875-06:00","source_repo":"."}
{"id":"voice-code-security-au2.10","content_hash":"ba16eeb9620e59e86a5f1b0cd29e94fe2fa4105c30b0d8a167986ccd4ea1c70e","title":"Create KeychainManager for secure API key storage","description":"## Design Reference\n@docs/api-key-authentication.md#35-ios-keychain-storage\n\n## Context\nFoundation iOS task for secure credential storage. KeychainManager provides Keychain access with Share Extension sharing via access group. Must be completed before VoiceCodeClient updates.\n\n## Requirements\n- [ ] Create KeychainManager.swift class\n- [ ] Implement saveAPIKey(_ key: String) throws\n- [ ] Implement retrieveAPIKey() -\u003e String?\n- [ ] Implement deleteAPIKey() throws\n- [ ] Implement hasAPIKey() -\u003e Bool\n- [ ] Implement isValidAPIKeyFormat(_ key: String) -\u003e Bool\n- [ ] Configure kSecAttrAccessGroup for Share Extension sharing\n- [ ] Use kSecAttrAccessibleAfterFirstUnlock for availability\n\n## Technical Approach\n- Files to create: VoiceCode/KeychainManager.swift\n- Service name: \"com.example.voicecode.api-key\"\n- Access group: Configure in entitlements for app + extension\n- Key validation: 43 chars, prefix check, hex validation\n- Error handling: Custom KeychainError enum\n\n## Verification\n- [ ] Unit test: saveAPIKey stores key\n- [ ] Unit test: retrieveAPIKey returns stored key\n- [ ] Unit test: deleteAPIKey removes key\n- [ ] Unit test: hasAPIKey returns correct state\n- [ ] Unit test: isValidAPIKeyFormat validates correctly\n- [ ] Integration test: Share Extension can access stored key\n\n## Parallelization\nCan be worked alongside: Backend auth namespace, ZXing dependency\n\n## Acceptance Criteria\n- AC3: iOS stores key securely in Keychain\n- AC8: Share Extension can access key (via access group)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-02T14:43:43.925327-06:00","updated_at":"2026-01-03T08:52:55.990561-06:00","closed_at":"2026-01-03T08:52:55.990561-06:00","source_repo":"."}
{"id":"voice-code-security-au2.11","content_hash":"823ffdbe8fd173f5059c6d060026553f249b783262abf54e44480c3cd386a195","title":"Update VoiceCodeClient to include API key in connect","description":"## Design Reference\n@docs/api-key-authentication.md#35-ios-keychain-storage\n\n## Context\nVoiceCodeClient must send API key in connect message and handle auth responses. This integrates KeychainManager with WebSocket communication.\n\n## Requirements\n- [ ] Add apiKey property to VoiceCodeClient\n- [ ] Load API key from KeychainManager on init\n- [ ] Include api_key field in connect message JSON\n- [ ] Handle auth_error message type\n- [ ] Handle auth_version in hello message\n- [ ] Implement exponential backoff for reconnection\n- [ ] Notify delegate/observers on auth failure\n\n## Technical Approach\n- Files to modify: VoiceCode/VoiceCodeClient.swift\n- Connect message: Add \"api_key\": apiKey to JSON\n- Auth error handling: Parse type: \"auth_error\", notify UI\n- Backoff: 1s initial, 30s max, 2x multiplier, +/-25% jitter\n- Store auth_version from hello for future compatibility\n\n## Verification\n- [ ] Unit test: connect message includes api_key\n- [ ] Unit test: auth_error triggers failure callback\n- [ ] Unit test: hello auth_version is parsed\n- [ ] Unit test: exponential backoff timing correct\n- [ ] Integration test: successful auth flow\n- [ ] Integration test: failed auth flow\n\n## Parallelization\nMust wait for: KeychainManager\n\n## Acceptance Criteria\n- AC4: WebSocket connect includes api_key\n- AC5: Auth errors handled gracefully","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-02T14:44:20.808204-06:00","updated_at":"2026-01-03T09:12:44.901757-06:00","closed_at":"2026-01-03T09:12:44.901757-06:00","source_repo":".","dependencies":[{"issue_id":"voice-code-security-au2.11","depends_on_id":"voice-code-security-au2.10","type":"blocks","created_at":"2026-01-02T14:44:20.808727-06:00","created_by":"travisbrown"}]}
{"id":"voice-code-security-au2.12","content_hash":"13dfc14b327f8f1ae20ca3d7c2e380528e9ce4a304ae3bf2a545cd2ba9d6d0e5","title":"Implement QRScannerView for API key scanning","description":"## Design Reference\n@docs/api-key-authentication.md#35-ios-keychain-storage\n\n## Context\nQR scanner enables easy API key transfer from terminal to iOS device. Uses AVFoundation for camera access and validates scanned keys before storage.\n\n## Requirements\n- [ ] Create QRScannerView.swift using AVCaptureSession\n- [ ] Request camera permission with appropriate messaging\n- [ ] Detect QR codes containing API key format\n- [ ] Validate scanned key with isValidAPIKeyFormat\n- [ ] Save valid key via KeychainManager\n- [ ] Provide success/failure feedback to user\n- [ ] Handle camera permission denied state\n\n## Technical Approach\n- Files to create: VoiceCode/Views/QRScannerView.swift\n- Use AVCaptureMetadataOutput for QR detection\n- Filter for .qr metadata object type\n- Validate key format before accepting\n- Dismiss on successful scan or user cancel\n- Show alert for invalid QR codes\n\n## Verification\n- [ ] Unit test: valid QR code accepted\n- [ ] Unit test: invalid QR code rejected with message\n- [ ] Manual test: scan QR from terminal\n- [ ] Manual test: camera permission flow\n- [ ] Manual test: permission denied state\n\n## Parallelization\nCan be worked alongside: AuthenticationRequiredView, APIKeySection\n\n## Acceptance Criteria\n- AC3: iOS scans QR code and stores key\n- AC10: Clear feedback on scan success/failure","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-02T14:44:43.745162-06:00","updated_at":"2026-01-03T09:55:31.55938-06:00","closed_at":"2026-01-03T09:55:31.55938-06:00","source_repo":".","dependencies":[{"issue_id":"voice-code-security-au2.12","depends_on_id":"voice-code-security-au2.10","type":"blocks","created_at":"2026-01-02T14:44:43.745664-06:00","created_by":"travisbrown"}]}
{"id":"voice-code-security-au2.13","content_hash":"a814d5533b2118772006ffc5b1dfcfab081d2a0ad3909e16426a5e8b5d8bd8cc","title":"Create AuthenticationRequiredView for unauthenticated state","description":"## Design Reference\n@docs/api-key-authentication.md#35-ios-keychain-storage\n\n## Context\nShown when app launches without API key or when authentication fails. Provides clear instructions and entry point to QR scanning.\n\n## Requirements\n- [ ] Create AuthenticationRequiredView.swift\n- [ ] Display clear message explaining auth requirement\n- [ ] Show \"Scan QR Code\" button to launch scanner\n- [ ] Show \"Enter Manually\" button for manual entry\n- [ ] Display after auth_error from backend\n- [ ] Integrate with app navigation flow\n\n## Technical Approach\n- Files to create: VoiceCode/Views/AuthenticationRequiredView.swift\n- SwiftUI view with centered content\n- Lock icon or similar visual indicator\n- Instructions text explaining the setup process\n- Two CTAs: Scan QR (primary), Enter Manually (secondary)\n- Navigation to QRScannerView or manual entry\n\n## Verification\n- [ ] Unit test: view renders correctly\n- [ ] Manual test: appears when no API key\n- [ ] Manual test: appears after auth_error\n- [ ] Manual test: navigation to scanner works\n- [ ] Manual test: navigation to manual entry works\n\n## Parallelization\nCan be worked alongside: QRScannerView, APIKeySection\n\n## Acceptance Criteria\n- AC10: Clear error UX when key is missing","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-02T14:44:56.651629-06:00","updated_at":"2026-01-03T10:17:56.349047-06:00","closed_at":"2026-01-03T10:17:56.349047-06:00","source_repo":".","dependencies":[{"issue_id":"voice-code-security-au2.13","depends_on_id":"voice-code-security-au2.10","type":"blocks","created_at":"2026-01-02T14:44:56.652186-06:00","created_by":"travisbrown"}]}
{"id":"voice-code-security-au2.14","content_hash":"f373d0445e3e76258f84e5561b2f22fcd69eceab5e6d5ed163d8513efe1d918c","title":"Create APIKeySection for Settings view","description":"## Design Reference\n@docs/api-key-authentication.md#35-ios-keychain-storage\n\n## Context\nSettings section showing API key status and providing key management actions. Part of the app's settings/preferences screen.\n\n## Requirements\n- [ ] Create APIKeySection.swift view component\n- [ ] Show connection status (authenticated/not)\n- [ ] Show masked key preview (first/last 4 chars)\n- [ ] Provide \"Update Key\" action\n- [ ] Provide \"Delete Key\" action with confirmation\n- [ ] Integrate into existing Settings view\n\n## Technical Approach\n- Files to create: VoiceCode/Views/APIKeySection.swift\n- Files to modify: Settings view to include section\n- Key masking: \"voic...89ab\" format\n- Delete confirmation: Alert with destructive action\n- Update: Navigate to QRScannerView or manual entry\n\n## Verification\n- [ ] Unit test: masked key format correct\n- [ ] Unit test: status displays correctly\n- [ ] Manual test: delete with confirmation\n- [ ] Manual test: update flow works\n\n## Parallelization\nCan be worked alongside: QRScannerView, AuthenticationRequiredView\n\n## Acceptance Criteria\n- AC9: iOS provides key management UI","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T14:45:21.051522-06:00","updated_at":"2026-01-03T20:18:55.151728-06:00","closed_at":"2026-01-03T20:18:55.151728-06:00","source_repo":".","dependencies":[{"issue_id":"voice-code-security-au2.14","depends_on_id":"voice-code-security-au2.10","type":"blocks","created_at":"2026-01-02T14:45:21.052145-06:00","created_by":"travisbrown"}]}
{"id":"voice-code-security-au2.15","content_hash":"ad6f2963ab9b9aea42258bada8f4f4c0727f85ce25f319c140ea2ff730a76bec","title":"Create APIKeyManagementView for manual key entry","description":"## Design Reference\n@docs/api-key-authentication.md#35-ios-keychain-storage\n\n## Context\nFull-screen view for manual API key entry and management. Provides alternative to QR scanning and detailed key information.\n\n## Requirements\n- [ ] Create APIKeyManagementView.swift\n- [ ] Text field for manual key entry\n- [ ] Real-time key format validation\n- [ ] Save button (enabled only for valid keys)\n- [ ] Current key display (masked)\n- [ ] Delete key option\n- [ ] Link to QR scanner as alternative\n\n## Technical Approach\n- Files to create: VoiceCode/Views/APIKeyManagementView.swift\n- TextField with secure entry option\n- Validate on each character change\n- Show validation status (checkmark/x)\n- Format hint showing expected key format\n- Integrate with KeychainManager\n\n## Verification\n- [ ] Unit test: validation feedback works\n- [ ] Unit test: save only enabled for valid keys\n- [ ] Manual test: manual entry flow\n- [ ] Manual test: navigation to QR scanner\n\n## Parallelization\nMust wait for: KeychainManager, QRScannerView\n\n## Acceptance Criteria\n- AC9: iOS provides key management UI","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T14:45:36.252061-06:00","updated_at":"2026-01-03T22:38:03.410097-06:00","closed_at":"2026-01-03T22:38:03.410097-06:00","source_repo":".","dependencies":[{"issue_id":"voice-code-security-au2.15","depends_on_id":"voice-code-security-au2.10","type":"blocks","created_at":"2026-01-02T14:45:36.252628-06:00","created_by":"travisbrown"},{"issue_id":"voice-code-security-au2.15","depends_on_id":"voice-code-security-au2.12","type":"blocks","created_at":"2026-01-02T14:45:36.252938-06:00","created_by":"travisbrown"}]}
{"id":"voice-code-security-au2.16","content_hash":"90ed78cd8c272866cefd4bc9889b12d049e9b819d95a7c7cba2a4c2f70e9b740","title":"Update Share Extension to include Bearer token","description":"## Design Reference\n@docs/api-key-authentication.md#34-http-bearer-authentication\n\n## Context\nShare Extension makes HTTP requests to upload files. Must include Bearer token and handle 401 responses appropriately.\n\n## Requirements\n- [ ] Access API key from Keychain via shared access group\n- [ ] Add Authorization: Bearer header to HTTP requests\n- [ ] Handle 401 Unauthorized response\n- [ ] Show appropriate error message for auth failure\n- [ ] Handle missing API key state gracefully\n\n## Technical Approach\n- Files to modify: ShareExtension/ShareViewController.swift\n- Use KeychainManager with shared access group\n- Header: request.setValue(\"Bearer \\(apiKey)\", forHTTPHeaderField: \"Authorization\")\n- On 401: Show \"Authentication required\" error\n- On missing key: Show \"Please set up API key in main app\"\n\n## Verification\n- [ ] Unit test: Authorization header included\n- [ ] Unit test: 401 response handled\n- [ ] Integration test: successful upload with auth\n- [ ] Manual test: share from other app with valid key\n- [ ] Manual test: share error when no key configured\n\n## Parallelization\nMust wait for: KeychainManager, HTTP Bearer auth\n\n## Acceptance Criteria\n- AC8: Share Extension includes API key in HTTP requests","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-02T14:45:55.639813-06:00","updated_at":"2026-01-03T10:35:50.295196-06:00","closed_at":"2026-01-03T10:35:50.295196-06:00","source_repo":".","dependencies":[{"issue_id":"voice-code-security-au2.16","depends_on_id":"voice-code-security-au2.10","type":"blocks","created_at":"2026-01-02T14:45:55.640333-06:00","created_by":"travisbrown"},{"issue_id":"voice-code-security-au2.16","depends_on_id":"voice-code-security-au2.9","type":"blocks","created_at":"2026-01-02T14:45:55.640651-06:00","created_by":"travisbrown"}]}
{"id":"voice-code-security-au2.17","content_hash":"156b5bfd4d7fc61dd9521e8e5e448d28fd1f16b58d6c43258321707c7cc90eeb","title":"Update STANDARDS.md with authentication protocol","description":"## Design Reference\n@docs/api-key-authentication.md#appendix-a\n\n## Context\nDocumentation must reflect the new authentication fields in the WebSocket protocol. STANDARDS.md is the source of truth for protocol specification.\n\n## Requirements\n- [ ] Add api_key field to connect message documentation\n- [ ] Add auth_error message type documentation\n- [ ] Add auth_version field to hello message documentation\n- [ ] Update message examples to show auth fields\n- [ ] Document Authorization header for HTTP endpoints\n\n## Technical Approach\n- Files to modify: STANDARDS.md\n- Add api_key to Client -\u003e Backend connect message\n- Add auth_error to Backend -\u003e Client message types\n- Add auth_version to hello message fields\n- Add HTTP Authorization header section\n\n## Verification\n- [ ] All new fields documented with examples\n- [ ] Examples match actual implementation\n- [ ] Protocol version noted\n\n## Parallelization\nCan be worked alongside: Any implementation task\n\n## Acceptance Criteria\n- Protocol documentation complete and accurate","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-02T14:46:25.786254-06:00","updated_at":"2026-01-02T14:46:25.786254-06:00","source_repo":"."}
{"id":"voice-code-security-au2.18","content_hash":"c000d8bf5da99199a993da0d32b39e66feb4a2394a5092901f1d4d559a738b53","title":"End-to-end integration tests for authentication","description":"## Design Reference\n@docs/api-key-authentication.md#5-testing-strategy\n\n## Context\nFinal validation that all authentication components work together. Tests the complete flow from key generation through authenticated communication.\n\n## Requirements\n- [ ] Test: Generate key -\u003e display QR -\u003e scan -\u003e connect -\u003e authenticated\n- [ ] Test: Invalid key rejected at WebSocket connect\n- [ ] Test: Missing key rejected at WebSocket connect\n- [ ] Test: HTTP upload with valid Bearer token succeeds\n- [ ] Test: HTTP upload with invalid Bearer token returns 401\n- [ ] Test: Reconnection maintains authentication\n\n## Technical Approach\n- Backend integration tests in test/voice_code/integration_test.clj\n- iOS UI tests for full flow (if UI testing configured)\n- May require test fixtures for key generation\n- Use dynamic binding for test key file path\n\n## Verification\n- [ ] All integration tests pass\n- [ ] Tests run in CI pipeline\n- [ ] No flaky tests\n\n## Parallelization\nMust wait for: WebSocket auth, HTTP auth, VoiceCodeClient updates\n\n## Acceptance Criteria\n- All acceptance criteria validated end-to-end","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-02T14:46:55.949845-06:00","updated_at":"2026-01-03T18:44:50.214046-06:00","closed_at":"2026-01-03T18:44:50.214046-06:00","source_repo":".","dependencies":[{"issue_id":"voice-code-security-au2.18","depends_on_id":"voice-code-security-au2.8","type":"blocks","created_at":"2026-01-02T14:46:55.950486-06:00","created_by":"travisbrown"},{"issue_id":"voice-code-security-au2.18","depends_on_id":"voice-code-security-au2.9","type":"blocks","created_at":"2026-01-02T14:46:55.950857-06:00","created_by":"travisbrown"},{"issue_id":"voice-code-security-au2.18","depends_on_id":"voice-code-security-au2.11","type":"blocks","created_at":"2026-01-02T14:46:55.951141-06:00","created_by":"travisbrown"}]}
{"id":"voice-code-security-au2.4","content_hash":"ff289f698d52145298cff977c04edfb39846aace0fb80abd8a5c6c34226a7f19","title":"Implement auth namespace with key generation and validation","description":"## Design Reference\n@docs/api-key-authentication.md#3-detailed-design\n\n## Context\nFoundation task for API key authentication. The auth namespace provides all cryptographic operations needed by both WebSocket and HTTP authentication. This must be completed before server integration.\n\n## Requirements\n- [ ] Create backend/src/voice_code/auth.clj namespace\n- [ ] Implement generate-key using SecureRandom for 128-bit entropy\n- [ ] Implement valid-key-format? to validate 43-char key structure\n- [ ] Implement constant-time-equals? to prevent timing attacks\n- [ ] Implement save-key! with chmod 600 file permissions\n- [ ] Implement load-key with nil return for missing file\n- [ ] Implement authenticate combining load and compare\n- [ ] Use dynamic var *key-file-path* for test isolation\n\n## Technical Approach\n- Files to create: backend/src/voice_code/auth.clj\n- Key format: 11-char prefix + 32 lowercase hex chars = 43 chars total\n- Key file location: ~/.voice-code/api-key\n- Use java.security.SecureRandom for entropy\n- Use byte-level XOR accumulation for constant-time comparison\n\n## Verification\n- [ ] Unit test: generate-key produces valid 43-char keys\n- [ ] Unit test: valid-key-format? accepts valid, rejects invalid formats\n- [ ] Unit test: constant-time-equals? returns correct results\n- [ ] Unit test: save-key! creates file with 600 permissions\n- [ ] Unit test: load-key returns nil for missing file\n- [ ] Unit test: authenticate validates correctly\n\n## Parallelization\nCan be worked alongside: Add ZXing dependency, Create KeychainManager\n\n## Acceptance Criteria\n- AC1: Backend generates cryptographically secure 43-char API keys\n- AC5: Invalid keys rejected with timing-attack resistant comparison","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-02T14:41:08.344469-06:00","updated_at":"2026-01-02T18:29:40.415679-06:00","closed_at":"2026-01-02T18:29:40.415679-06:00","source_repo":"."}
{"id":"voice-code-security-au2.5","content_hash":"51a0719993dea0ee9938aab732692ef3e73f9d7051dfc25f30b7b3aeeb83a15d","title":"Add ZXing dependency to deps.edn","description":"## Design Reference\n@docs/api-key-authentication.md#32-qr-code-display\n\n## Context\nZXing library is required for QR code matrix generation. This is a simple dependency addition that unblocks the QR namespace implementation.\n\n## Requirements\n- [ ] Add com.google.zxing/core to deps.edn\n- [ ] Add com.google.zxing/javase to deps.edn\n- [ ] Verify dependency resolves correctly\n\n## Technical Approach\n- Files to modify: backend/deps.edn\n- Dependencies to add:\n  - com.google.zxing/core {:mvn/version \"3.5.2\"}\n  - com.google.zxing/javase {:mvn/version \"3.5.2\"}\n\n## Verification\n- [ ] Run clj -Stree to verify dependencies resolve\n- [ ] REPL can require com.google.zxing.qrcode.QRCodeWriter\n\n## Parallelization\nCan be worked alongside: Implement auth namespace, Create KeychainManager\n\n## Acceptance Criteria\n- AC2: Supports QR code generation (dependency prerequisite)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-02T14:41:34.511416-06:00","updated_at":"2026-01-02T18:35:17.675054-06:00","closed_at":"2026-01-02T18:35:17.675054-06:00","source_repo":"."}
{"id":"voice-code-security-au2.6","content_hash":"ecf1f33e3d0378e1406eda6b19a9cba747975db898e6d61671b2119863b25120","title":"Implement QR code namespace for terminal display","description":"## Design Reference\n@docs/api-key-authentication.md#32-qr-code-display\n\n## Context\nQR code display enables easy key transfer from backend to iOS device. Uses ZXing for matrix generation and Unicode block characters for terminal rendering.\n\n## Requirements\n- [ ] Create backend/src/voice_code/qr.clj namespace\n- [ ] Implement generate-qr-matrix using ZXing QRCodeWriter\n- [ ] Implement render-qr-terminal with Unicode block characters\n- [ ] Implement display-setup-qr! with instructions text\n- [ ] Handle error correction level L for QR generation\n\n## Technical Approach\n- Files to create: backend/src/voice_code/qr.clj\n- Dependencies: Requires ZXing (voice-code-security-au2.5)\n- Unicode chars: FULL BLOCK, LOWER HALF, UPPER HALF, SPACE\n- QR size: Let ZXing auto-size based on content\n- Terminal width: Assume 80+ columns\n\n## Verification\n- [ ] Unit test: generate-qr-matrix returns valid matrix\n- [ ] Unit test: render-qr-terminal produces string output\n- [ ] Manual: QR code scannable by iOS camera app\n- [ ] Manual: Instructions clearly visible above QR\n\n## Parallelization\nCan be worked alongside: iOS KeychainManager tasks (after ZXing dep added)\n\n## Acceptance Criteria\n- AC2: Backend displays API key as QR code in terminal","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-02T14:41:59.390916-06:00","updated_at":"2026-01-02T18:48:08.854493-06:00","closed_at":"2026-01-02T18:48:08.854493-06:00","source_repo":".","dependencies":[{"issue_id":"voice-code-security-au2.6","depends_on_id":"voice-code-security-au2.5","type":"blocks","created_at":"2026-01-02T14:41:59.391429-06:00","created_by":"travisbrown"}]}
{"id":"voice-code-security-au2.7","content_hash":"01859be7e4a1201474cc033627c2cb4dc16beedbfc379066e419840258384f13","title":"Add Makefile targets for key generation and QR display","description":"## Design Reference\n@docs/api-key-authentication.md#36-makefile-targets\n\n## Context\nMakefile targets provide user-friendly commands for key management. These are the primary interface for backend operators to generate and display API keys.\n\n## Requirements\n- [ ] Add generate-key target to backend/Makefile\n- [ ] Add show-qr target to backend/Makefile\n- [ ] Ensure targets work from project root\n\n## Technical Approach\n- Files to modify: backend/Makefile\n- generate-key: clj -X:run :command :generate-key\n- show-qr: clj -X:run :command :show-qr\n- May need to add :run alias to deps.edn\n\n## Verification\n- [ ] make generate-key creates ~/.voice-code/api-key\n- [ ] make show-qr displays scannable QR code\n- [ ] Targets fail gracefully if key missing (show-qr)\n\n## Parallelization\nMust wait for: auth namespace, QR namespace\n\n## Acceptance Criteria\n- AC1: Key generation accessible via make target\n- AC2: QR display accessible via make target","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T14:42:42.949807-06:00","updated_at":"2026-01-03T18:51:12.109345-06:00","closed_at":"2026-01-03T18:51:12.109345-06:00","source_repo":".","dependencies":[{"issue_id":"voice-code-security-au2.7","depends_on_id":"voice-code-security-au2.4","type":"blocks","created_at":"2026-01-02T14:42:42.950373-06:00","created_by":"travisbrown"},{"issue_id":"voice-code-security-au2.7","depends_on_id":"voice-code-security-au2.6","type":"blocks","created_at":"2026-01-02T14:42:42.950682-06:00","created_by":"travisbrown"}]}
{"id":"voice-code-security-au2.8","content_hash":"9f62684bd4f63426395b8c681f3276b2c28cf59e8dc08531b6bb74ec63347a12","title":"Integrate authentication into WebSocket server","description":"## Design Reference\n@docs/api-key-authentication.md#33-session-based-authentication\n\n## Context\nCore server integration that validates API keys on WebSocket connect and tracks authenticated channels. All subsequent messages are allowed only for authenticated channels.\n\n## Requirements\n- [ ] Add authenticated-channels atom to server namespace\n- [ ] Update hello message to include auth_version: 1\n- [ ] Modify connect handler to extract and validate api_key\n- [ ] Implement auth_error message type\n- [ ] Add channel to authenticated set on successful auth\n- [ ] Remove channel from set on disconnect\n- [ ] Block all messages except connect for unauthenticated channels\n\n## Technical Approach\n- Files to modify: backend/src/voice_code/server.clj\n- New atom: (defonce authenticated-channels (atom #{}))\n- Hello message: Add :auth-version 1 to response\n- Connect handler: Extract :api-key, call auth/authenticate\n- Error response: {:type \"auth_error\" :message \"Authentication failed\"}\n- Use generic error message (no detail about why auth failed)\n\n## Verification\n- [ ] Unit test: hello includes auth_version\n- [ ] Unit test: valid api_key authenticates channel\n- [ ] Unit test: invalid api_key returns auth_error\n- [ ] Unit test: missing api_key returns auth_error\n- [ ] Unit test: unauthenticated channel blocked from prompt\n- [ ] Integration test: full connect flow with auth\n\n## Parallelization\nMust wait for: auth namespace\n\n## Acceptance Criteria\n- AC4: WebSocket validates api_key in connect message\n- AC5: Invalid/missing keys rejected with auth_error\n- AC6: Authentication persists for session lifetime","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-02T14:43:01.72142-06:00","updated_at":"2026-01-03T08:13:20.567533-06:00","closed_at":"2026-01-03T08:13:20.567533-06:00","source_repo":".","dependencies":[{"issue_id":"voice-code-security-au2.8","depends_on_id":"voice-code-security-au2.4","type":"blocks","created_at":"2026-01-02T14:43:01.721997-06:00","created_by":"travisbrown"}]}
{"id":"voice-code-security-au2.9","content_hash":"a566de2f8640a4592fc48720b24b6545bbdca8f01be899880e1ee2f3410fc46c","title":"Add Bearer token authentication to HTTP upload endpoint","description":"## Design Reference\n@docs/api-key-authentication.md#34-http-bearer-authentication\n\n## Context\nHTTP endpoints (file upload) need Bearer token authentication for Share Extension and other HTTP clients. Uses same API key as WebSocket auth.\n\n## Requirements\n- [ ] Extract Authorization header from HTTP requests\n- [ ] Parse Bearer token from header value\n- [ ] Validate token using auth/authenticate\n- [ ] Return 401 Unauthorized for invalid/missing token\n- [ ] Return 401 with generic error message body\n\n## Technical Approach\n- Files to modify: backend/src/voice_code/server.clj (HTTP handler)\n- Header format: Authorization: Bearer \u003capi-key\u003e\n- Parse: (when-let [auth (get-in request [:headers \"authorization\"])]\n           (second (re-matches #\"Bearer (.+)\" auth)))\n- Response: {:status 401 :body \"Unauthorized\"}\n\n## Verification\n- [ ] Unit test: valid Bearer token allows request\n- [ ] Unit test: invalid Bearer token returns 401\n- [ ] Unit test: missing Authorization header returns 401\n- [ ] Unit test: malformed Authorization header returns 401\n- [ ] Integration test: file upload with Bearer token\n\n## Parallelization\nCan be worked alongside: WebSocket auth integration\n\n## Acceptance Criteria\n- AC7: HTTP endpoints validate Bearer token","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-02T14:43:12.88886-06:00","updated_at":"2026-01-03T08:29:23.677042-06:00","closed_at":"2026-01-03T08:29:23.677042-06:00","source_repo":".","dependencies":[{"issue_id":"voice-code-security-au2.9","depends_on_id":"voice-code-security-au2.4","type":"blocks","created_at":"2026-01-02T14:43:12.889424-06:00","created_by":"travisbrown"}]}
{"id":"voice-code-security-au2","content_hash":"cba02aa6b675f167b93ab260196abf1674fd8f7710255eca74c37147ce0e5ce6","title":"API Key Authentication","description":"## Design Document\n@docs/api-key-authentication.md\n\n## Overview\nImplement Pre-Shared Key (PSK) authentication between iOS app and Clojure backend. Users generate a 43-character API key on the backend, scan it via QR code on iOS, and all subsequent WebSocket and HTTP connections are authenticated.\n\n## Acceptance Criteria\n1. Backend generates cryptographically secure 43-char API keys (voice-code- prefix + 32 hex chars)\n2. Backend displays API key as QR code in terminal with Unicode block characters\n3. iOS app scans QR code and stores key securely in Keychain with Share Extension access\n4. WebSocket connections include api_key in connect message; backend validates and marks channel authenticated\n5. Invalid/missing API keys are rejected with generic auth_error message (timing-attack resistant)\n6. Authentication persists for WebSocket session lifetime (no per-message auth)\n7. HTTP endpoints validate Bearer token in Authorization header\n8. Share Extension includes API key in HTTP requests\n9. iOS provides UI for key management (scan, view, delete)\n10. Clear error UX when authentication fails or key is missing","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-02T14:39:10.514025-06:00","updated_at":"2026-01-02T17:34:17.197409-06:00","closed_at":"2026-01-02T17:34:17.197409-06:00","source_repo":"."}
{"id":"voice-code-exit-recipe-3u9","content_hash":"7fff9620c45e6308389d5ad72cbe5f6dca8954192c73ad79f9e778b5ef6865ef","title":"Recipe State Synchronization for iOS Client Resilience","description":"## Design Document\n@specs/200-architecture/200-backend/200-015-recipe-state-sync-design.md\n\n## Overview\nEnsure recipe state is always eventually consistent between backend and iOS client. This addresses the issue where recipes can appear \"stuck\" in the UI when the `recipe_exited` message is missed due to network issues or WebSocket reconnection.\n\n## Solution\nThree complementary fixes:\n1. **Safety Net**: `turn_complete` clears any active recipe state as fallback\n2. **State Sync**: New `active_recipes_sync` message sent on connect/reconnect\n3. **Enhanced Logging**: Better observability for diagnosing issues\n\n## Acceptance Criteria\n1. When `turn_complete` is received for a session with an active recipe, the recipe is cleared from `activeRecipes`\n2. When iOS connects/reconnects, it receives `active_recipes_sync` with current server state\n3. iOS `activeRecipes` is replaced with server state on receiving `active_recipes_sync`\n4. Empty `active_recipes_sync` clears any stale local recipe state\n5. Backend logs include session-id when sending `recipe_exited`\n6. Backend logs warning when `recipe_exited` cannot be sent (channel disconnected)\n7. All existing recipe tests continue to pass","status":"open","priority":2,"issue_type":"epic","created_at":"2025-12-29T15:22:52.398099-06:00","updated_at":"2025-12-29T15:22:52.398099-06:00","source_repo":"."}
{"id":"voice-code-exit-recipe-3u9.1","content_hash":"d0f39de01b8d985b078d041d1e008e4e758d08b3b46ba223bf1b0bdd60532836","title":"Modify send-to-client! to return success/failure boolean","description":"## Design Reference\n@specs/200-architecture/200-backend/200-015-recipe-state-sync-design.md#fix-3-enhanced-logging-for-recipe-exit\n\n## Context\nThe current `send-to-client!` function does not indicate whether the message was successfully sent. This makes it impossible to detect and log when critical messages like `recipe_exited` fail to reach the client due to disconnection.\n\n## Requirements\n- [ ] Modify `send-to-client!` to return `true` when message is sent successfully\n- [ ] Return `false` when channel is not in `connected-clients`\n- [ ] Return `false` when `http/send!` throws an exception\n- [ ] Preserve existing logging behavior\n- [ ] Add session-id to log context when available\n\n## Technical Approach\nWrap the send operation in try/catch and return boolean result:\n- Files to modify: `backend/src/voice_code/server.clj`\n- Function: `send-to-client!` (line ~130)\n- Dependencies: None (foundation task)\n\n```clojure\n(defn send-to-client!\n  [channel message-data]\n  (if (contains? @connected-clients channel)\n    (do\n      (log/info \"Sending message to client\" {:type (:type message-data)\n                                              :session-id (:session-id message-data)})\n      (try\n        (http/send! channel (generate-json message-data))\n        true\n        (catch Exception e\n          (log/warn e \"Failed to send to client\" {:type (:type message-data)})\n          false)))\n    (do\n      (log/warn \"Channel not in connected-clients\" {:type (:type message-data)})\n      false)))\n```\n\n## Verification\n- [ ] Unit test: `send-to-client!` returns false for disconnected channel\n- [ ] Manual verification: Check logs show session-id in recipe_exited messages\n\n## Acceptance Criteria\n- Backend logs include session-id when sending `recipe_exited`\n- Backend logs warning when `recipe_exited` cannot be sent (channel disconnected)\n\n## Parallelization\nCan be worked alongside: Task 4 (iOS active_recipes_sync handler), Task 5 (iOS turn_complete safety net)","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-29T15:23:38.347838-06:00","updated_at":"2025-12-29T15:23:38.347838-06:00","source_repo":"."}
{"id":"voice-code-exit-recipe-3u9.2","content_hash":"313e51ddcf0750f4063e938ca620f2b637fc172af226a8eecc42f76586530579","title":"Add get-active-recipes-for-client helper function","description":"## Design Reference\n@specs/200-architecture/200-backend/200-015-recipe-state-sync-design.md#fix-2-recipe-state-sync-on-reconnection\n\n## Context\nTo sync recipe state on client reconnection, we need a helper function that formats the `session-orchestration-state` atom into a client-friendly map structure for the `active_recipes_sync` message.\n\n## Requirements\n- [ ] Create `get-active-recipes-for-client` function\n- [ ] Return empty map `{}` when no recipes are active\n- [ ] Return map of session-id to recipe info for each active recipe\n- [ ] Include: recipe-id, recipe-label, current-step, step-count\n\n## Technical Approach\nIterate over `session-orchestration-state` atom and format each entry:\n- Files to modify: `backend/src/voice_code/server.clj`\n- Add near other orchestration helper functions (~line 189)\n- Dependencies: None (uses existing atoms and recipe registry)\n\n```clojure\n(defn get-active-recipes-for-client\n  \"Get all active recipes as a map of session-id -\u003e recipe info for client sync\"\n  []\n  (into {}\n    (map (fn [[session-id state]]\n           (let [recipe (recipes/get-recipe (:recipe-id state))]\n             [session-id {:recipe-id (name (:recipe-id state))\n                          :recipe-label (:label recipe)\n                          :current-step (name (:current-step state))\n                          :step-count (:step-count state)}]))\n         @session-orchestration-state)))\n```\n\n## Verification\n- [ ] Unit test: Returns empty map when no active recipes\n- [ ] Unit test: Returns formatted recipe data with all required fields\n- [ ] Unit test: Uses `start-recipe-for-session` to set up state properly\n\n## Acceptance Criteria\nEnables sending `active_recipes_sync` message with correct format\n\n## Parallelization\nCan be worked alongside: Task 1 (send-to-client!), Task 4 (iOS handler), Task 5 (iOS safety net)","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-29T15:24:07.445324-06:00","updated_at":"2025-12-29T15:24:07.445324-06:00","source_repo":"."}
{"id":"voice-code-exit-recipe-3u9.3","content_hash":"76c2f2f6ae365e2ad2993ac25772a9442cf5a175cc913db5eef5e13572dc24c8","title":"Send active_recipes_sync message on client connect","description":"## Design Reference\n@specs/200-architecture/200-backend/200-015-recipe-state-sync-design.md#fix-2-recipe-state-sync-on-reconnection\n\n## Context\nWhen iOS clients connect or reconnect, they need to sync their local recipe state with the backend. This task adds sending the `active_recipes_sync` message in the connect handler after other initialization messages.\n\n## Requirements\n- [ ] Send `active_recipes_sync` message after `available-commands` in connect handler\n- [ ] Message format: `{type: \"active_recipes_sync\", recipes: {session-id: recipe-info, ...}}`\n- [ ] Log the count of active recipes being sent\n\n## Technical Approach\nAdd to the `\"connect\"` case in `handle-message`:\n- Files to modify: `backend/src/voice_code/server.clj`\n- Location: In connect handler, after `send-to-client!` for `available-commands` (~line 713)\n- Dependencies: Task 2 (`get-active-recipes-for-client`)\n\n```clojure\n;; Send active recipes state for reconnection sync\n(let [active-recipes (get-active-recipes-for-client)]\n  (log/info \"Sending active recipes sync\" {:count (count active-recipes)})\n  (send-to-client! channel\n                   {:type :active-recipes-sync\n                    :recipes active-recipes}))\n```\n\n## Verification\n- [ ] Integration test: Connect message triggers `active_recipes_sync` response\n- [ ] Manual verification: Start recipe, reconnect client, verify sync message received\n\n## Acceptance Criteria\n- When iOS connects/reconnects, it receives `active_recipes_sync` with current server state\n\n## Parallelization\nMust wait for: Task 2 (get-active-recipes-for-client)\nCan be worked alongside: Task 4 (iOS handler), Task 5 (iOS safety net)","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-29T15:24:34.963594-06:00","updated_at":"2025-12-29T15:24:34.963594-06:00","source_repo":".","dependencies":[{"issue_id":"voice-code-exit-recipe-3u9.3","depends_on_id":"voice-code-exit-recipe-3u9.2","type":"blocks","created_at":"2025-12-29T15:24:34.964053-06:00","created_by":"daemon"}]}
{"id":"voice-code-exit-recipe-3u9.4","content_hash":"04745ea160eae2bd7f59566a54f94c5aed0c1a488af39a63bd59bedbc75bf629","title":"Add active_recipes_sync message handler in iOS client","description":"## Design Reference\n@specs/200-architecture/200-backend/200-015-recipe-state-sync-design.md#fix-2-recipe-state-sync-on-reconnection\n\n## Context\niOS needs to handle the new `active_recipes_sync` message to synchronize its local `activeRecipes` dictionary with the backend state on connect/reconnect. This ensures recipes never appear \"stuck\" after network issues.\n\n## Requirements\n- [ ] Add `active_recipes_sync` case to `handleMessage` switch\n- [ ] Parse recipes dictionary from JSON\n- [ ] Replace local `activeRecipes` with server state (not merge)\n- [ ] Handle empty recipes dict by clearing local state\n- [ ] Log sync activity for debugging\n\n## Technical Approach\nAdd new case in `handleMessage` around line 800:\n- Files to modify: `ios/VoiceCode/Managers/VoiceCodeClient.swift`\n- Location: In `handleMessage` switch statement\n\n```swift\ncase \"active_recipes_sync\":\n    if let recipesDict = json[\"recipes\"] as? [String: [String: Any]] {\n        var syncedRecipes: [String: ActiveRecipe] = [:]\n        for (sessionId, recipeJson) in recipesDict {\n            if let recipeId = recipeJson[\"recipe_id\"] as? String,\n               let recipeLabel = recipeJson[\"recipe_label\"] as? String,\n               let currentStep = recipeJson[\"current_step\"] as? String,\n               let stepCount = recipeJson[\"step_count\"] as? Int {\n                syncedRecipes[sessionId] = ActiveRecipe(\n                    recipeId: recipeId,\n                    recipeLabel: recipeLabel,\n                    currentStep: currentStep,\n                    stepCount: stepCount\n                )\n            }\n        }\n        scheduleUpdate(key: \"activeRecipes\", value: syncedRecipes)\n        if !syncedRecipes.isEmpty {\n            print(\"🔄 [VoiceCodeClient] Synced \\(syncedRecipes.count) active recipes on connect\")\n        }\n    } else {\n        let currentRecipes = getCurrentValue(for: \"activeRecipes\", current: self.activeRecipes)\n        if !currentRecipes.isEmpty {\n            scheduleUpdate(key: \"activeRecipes\", value: [:])\n            print(\"🔄 [VoiceCodeClient] Cleared stale recipe state on connect\")\n        }\n    }\n```\n\n## Verification\n- [ ] Unit test: `testActiveRecipesSyncPopulatesState` - syncs recipe data correctly\n- [ ] Unit test: `testActiveRecipesSyncClearsStaleState` - empty sync clears local state\n- [ ] Manual verification: Start recipe, disconnect, reconnect, verify UI shows correct state\n\n## Acceptance Criteria\n- iOS `activeRecipes` is replaced with server state on receiving `active_recipes_sync`\n- Empty `active_recipes_sync` clears any stale local recipe state\n\n## Parallelization\nCan be worked alongside: Task 1, Task 2, Task 5 (iOS turn_complete safety net)","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-29T15:25:06.595372-06:00","updated_at":"2025-12-29T15:25:06.595372-06:00","source_repo":"."}
{"id":"voice-code-exit-recipe-3u9.5","content_hash":"6f96fabfb74e807a2c807596629c786b75057d80722a465b824ec23b6bd0e0ea","title":"Add turn_complete safety net to clear recipe state in iOS","description":"## Design Reference\n@specs/200-architecture/200-backend/200-015-recipe-state-sync-design.md#fix-1-safety-net---turn_complete-clears-recipe-state-ios\n\n## Context\nThe `turn_complete` message is always sent after a recipe exits. By clearing any active recipe state when `turn_complete` is received, we create a safety net that handles cases where `recipe_exited` was missed due to network issues.\n\n## Requirements\n- [ ] In `turn_complete` handler, check if session has active recipe\n- [ ] If active recipe exists, clear it from `activeRecipes`\n- [ ] Log when safety net activates for debugging\n\n## Technical Approach\nEnhance existing `turn_complete` case in `handleMessage`:\n- Files to modify: `ios/VoiceCode/Managers/VoiceCodeClient.swift`\n- Location: `turn_complete` case (~line 514-536)\n- Add before the existing session unlock logic\n\n```swift\ncase \"turn_complete\":\n    if let sessionId = json[\"session_id\"] as? String {\n        print(\"✅ [VoiceCodeClient] Received turn_complete for \\(sessionId)\")\n\n        // Safety net: Clear any active recipe for this session\n        // This handles cases where recipe_exited message was missed\n        let currentRecipes = getCurrentValue(for: \"activeRecipes\", current: self.activeRecipes)\n        if currentRecipes[sessionId] != nil {\n            var updatedRecipes = currentRecipes\n            updatedRecipes.removeValue(forKey: sessionId)\n            scheduleUpdate(key: \"activeRecipes\", value: updatedRecipes)\n            print(\"🏁 [VoiceCodeClient] Cleared recipe state on turn_complete (safety net): \\(sessionId)\")\n        }\n\n        // ... existing subscription and unlock logic ...\n    }\n```\n\n## Verification\n- [ ] Unit test: `testTurnCompleteClearsRecipeState` - recipe cleared when turn_complete received\n- [ ] Manual verification: Start recipe, simulate missed recipe_exited, verify turn_complete clears state\n\n## Acceptance Criteria\n- When `turn_complete` is received for a session with an active recipe, the recipe is cleared from `activeRecipes`\n\n## Parallelization\nCan be worked alongside: Task 1, Task 2, Task 3, Task 4 (iOS active_recipes_sync handler)","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-29T15:25:33.808047-06:00","updated_at":"2025-12-29T15:25:33.808047-06:00","source_repo":"."}
{"id":"voice-code-exit-recipe-3u9.6","content_hash":"a6a1a01faece0c22b95fe42a5032cc4004b56c6a0e318e92c238043a86ed308e","title":"Write unit tests for recipe state sync implementation","description":"## Design Reference\n@specs/200-architecture/200-backend/200-015-recipe-state-sync-design.md#verification-strategy\n\n## Context\nAll implementation tasks require corresponding tests to verify correctness. This task covers writing unit tests for both backend (Clojure) and iOS (Swift) changes.\n\n## Requirements\n\n### Backend Tests (`backend/test/voice_code/orchestration_server_test.clj`)\n- [ ] `get-active-recipes-for-client-test`: Returns empty map when no active recipes\n- [ ] `get-active-recipes-for-client-test`: Returns formatted recipe data\n- [ ] `send-to-client-returns-status-test`: Returns false when channel not connected\n\n### iOS Tests (`ios/VoiceCodeTests/VoiceCodeClientRecipeTests.swift`)\n- [ ] `testTurnCompleteClearsRecipeState`: Recipe cleared on turn_complete\n- [ ] `testActiveRecipesSyncPopulatesState`: Syncs recipe data correctly\n- [ ] `testActiveRecipesSyncClearsStaleState`: Empty sync clears local state\n\n## Technical Approach\n- Files to modify/create:\n  - `backend/test/voice_code/orchestration_server_test.clj` (add tests)\n  - `ios/VoiceCodeTests/VoiceCodeClientRecipeTests.swift` (create if needed)\n- Dependencies: All implementation tasks (1-5)\n- Use existing test patterns from each codebase\n\n## Verification\n- [ ] All new tests pass\n- [ ] All existing recipe tests continue to pass\n- [ ] Test coverage for happy path and edge cases\n\n## Acceptance Criteria\n- All existing recipe tests continue to pass\n- New tests verify all acceptance criteria from epic\n\n## Parallelization\nMust wait for: Tasks 1-5 (implementation tasks)","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-29T15:26:01.024852-06:00","updated_at":"2025-12-29T15:26:01.024852-06:00","source_repo":".","dependencies":[{"issue_id":"voice-code-exit-recipe-3u9.6","depends_on_id":"voice-code-exit-recipe-3u9.1","type":"blocks","created_at":"2025-12-29T15:26:01.025449-06:00","created_by":"daemon"},{"issue_id":"voice-code-exit-recipe-3u9.6","depends_on_id":"voice-code-exit-recipe-3u9.2","type":"blocks","created_at":"2025-12-29T15:26:01.025801-06:00","created_by":"daemon"},{"issue_id":"voice-code-exit-recipe-3u9.6","depends_on_id":"voice-code-exit-recipe-3u9.3","type":"blocks","created_at":"2025-12-29T15:26:01.026061-06:00","created_by":"daemon"},{"issue_id":"voice-code-exit-recipe-3u9.6","depends_on_id":"voice-code-exit-recipe-3u9.4","type":"blocks","created_at":"2025-12-29T15:26:01.026298-06:00","created_by":"daemon"},{"issue_id":"voice-code-exit-recipe-3u9.6","depends_on_id":"voice-code-exit-recipe-3u9.5","type":"blocks","created_at":"2025-12-29T15:26:01.026514-06:00","created_by":"daemon"}]}
{"id":"voice-code-attribution-7wl","content_hash":"d513a064f6c7a6540eca5451dfb8fcbfb1389a227857f0f46fb1e3857536ab46","title":"Add unit tests for extractRole function","description":"## Design Reference\n@docs/design/message-role-attribution.md#test-examples\n\n## Context\nThe updated `extractRole()` function needs comprehensive unit tests to verify correct behavior across all message types: user messages (string and array content), tool results, tool calls, mixed content, and edge cases.\n\n## Requirements\n- [ ] Create new test file for role extraction tests\n- [ ] Test user message with string content → \"user\"\n- [ ] Test user message with text array content → \"user\"\n- [ ] Test user message with tool_result content → \"tool_result\"\n- [ ] Test assistant message with text content → \"assistant\"\n- [ ] Test assistant message with tool_use content → \"tool_call\"\n- [ ] Test mixed content (text + tool_use) → \"tool_call\"\n- [ ] Test mixed content (text + tool_result) → \"tool_result\" (priority)\n- [ ] Test missing type field → nil\n- [ ] Test empty content array → falls back to top-level type\n\n## Technical Approach\n- New file: `ios/VoiceCodeTests/SessionSyncManagerRoleTests.swift`\n- Follow existing test patterns from `SessionSyncManagerDeltaSyncTests.swift`\n- Use in-memory PersistenceController for isolation\n- Test the `extractRole(from:)` method directly\n\n## Verification\n- [ ] All 9 test cases pass\n- [ ] Tests run in under 1 second\n- [ ] No flaky tests\n\n## Acceptance Criteria\n- Comprehensive test coverage for role extraction logic\n- Tests document expected behavior for all message types\n- Tests catch regressions in role extraction\n\n## Dependencies\nRequires: \"Update extractRole logic in SessionSyncManager\" (voice-code-attribution-au2)\n\n## Parallelization\nCannot run until extractRole logic is implemented.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-06T16:43:55.2064-06:00","updated_at":"2026-01-06T16:43:55.2064-06:00","source_repo":".","dependencies":[{"issue_id":"voice-code-attribution-7wl","depends_on_id":"voice-code-attribution-ow9","type":"parent-child","created_at":"2026-01-06T16:44:01.130774-06:00","created_by":"daemon"},{"issue_id":"voice-code-attribution-7wl","depends_on_id":"voice-code-attribution-au2","type":"blocks","created_at":"2026-01-06T16:44:01.159045-06:00","created_by":"daemon"}]}
{"id":"voice-code-attribution-au2","content_hash":"18ee0bf20acc91e458df70b507a317a99299e383e1e8be963c9596a951f7391c","title":"Update extractRole logic in SessionSyncManager","description":"## Design Reference\n@docs/design/message-role-attribution.md#ios-updated-role-extraction\n\n## Context\nThe current `extractRole()` function in SessionSyncManager.swift (line 679-681) only checks the top-level `type` field from JSONL messages. This causes tool results to appear as \"User\" and tool calls to appear as \"Assistant\". The function needs to inspect the nested `message.content[0].type` to distinguish tool interactions.\n\n## Requirements\n- [ ] Update `extractRole(from:)` to check nested message.content for tool types\n- [ ] Return \"tool_result\" when content contains tool_result type\n- [ ] Return \"tool_call\" when content contains tool_use type\n- [ ] Handle string content (return top-level type)\n- [ ] Handle array content with priority: tool_result \u003e tool_use \u003e text\n- [ ] Handle empty content arrays (fall back to top-level type)\n- [ ] Return nil for messages missing type field\n\n## Technical Approach\n- File to modify: `ios/VoiceCode/Managers/SessionSyncManager.swift`\n- Replace function at lines 679-681\n- Implement priority-based scanning of content array\n- No new files needed\n\n## Verification\n- [ ] Unit tests for all 9 test cases from design document\n- [ ] Verify existing SessionSyncManager tests still pass\n- [ ] Manual verification: Connect to session with tool calls, verify new roles stored in CoreData\n\n## Acceptance Criteria\n- Tool result messages stored with role \"tool_result\"\n- Tool call messages stored with role \"tool_call\"\n- Regular user/assistant messages unchanged\n- Backward compatible with existing CoreData (string field)\n\n## Parallelization\nThis is a foundation task - must complete before UI tasks.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-06T16:43:36.407926-06:00","updated_at":"2026-01-06T16:43:36.407926-06:00","source_repo":".","dependencies":[{"issue_id":"voice-code-attribution-au2","depends_on_id":"voice-code-attribution-ow9","type":"parent-child","created_at":"2026-01-06T16:43:40.675497-06:00","created_by":"daemon"}]}
{"id":"voice-code-attribution-d4n","content_hash":"67b133181ce2304350bc9fe7968ec92c7a6bf2ef9e32b3178cf944c942a6ab71","title":"Update export functions for new role types","description":"## Design Reference\n@docs/design/message-role-attribution.md#ios-ui-display-updates\n\n## Context\nThe export functionality in ConversationView.swift and SessionInfoView.swift uses a binary role check (`message.role == \"user\" ? \"User\" : \"Assistant\"`) which needs to be updated to handle all four role types correctly.\n\n## Requirements\n- [ ] Update export role mapping in ConversationView.swift (around line 817)\n- [ ] Update export role mapping in SessionInfoView.swift (around line 308)\n- [ ] Map \"user\" → \"User\"\n- [ ] Map \"assistant\" → \"Assistant\"\n- [ ] Map \"tool_call\" → \"Tool Call\"\n- [ ] Map \"tool_result\" → \"Tool Result\"\n- [ ] Handle unknown roles with capitalized fallback\n\n## Technical Approach\n- Files to modify:\n  - `ios/VoiceCode/Views/ConversationView.swift` (line 817)\n  - `ios/VoiceCode/Views/SessionInfoView.swift` (line 308)\n- Replace ternary with switch statement for role label mapping\n- Use `message.role.capitalized` as default case\n\n## Verification\n- [ ] Build succeeds with no warnings\n- [ ] Manual verification: Export conversation containing tool calls, verify correct labels in output\n\n## Acceptance Criteria\n- Export functions include correct role labels for all message types\n- Exported text shows \"[Tool Call]\" and \"[Tool Result]\" appropriately\n\n## Dependencies\nRequires: \"Update extractRole logic in SessionSyncManager\" (voice-code-attribution-au2)\n\n## Parallelization\nCan be worked alongside: \"Update MessageRow UI for new role types\"","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-06T16:44:38.508286-06:00","updated_at":"2026-01-06T16:44:38.508286-06:00","source_repo":".","dependencies":[{"issue_id":"voice-code-attribution-d4n","depends_on_id":"voice-code-attribution-ow9","type":"parent-child","created_at":"2026-01-06T16:44:46.80904-06:00","created_by":"daemon"},{"issue_id":"voice-code-attribution-d4n","depends_on_id":"voice-code-attribution-au2","type":"blocks","created_at":"2026-01-06T16:44:46.838177-06:00","created_by":"daemon"}]}
{"id":"voice-code-attribution-ow9","content_hash":"32c69ed95fe577bfc49d242693db2a1a3bb902d6f04af931006f373f0c579c61","title":"Message Role Attribution","description":"## Design Document\n@docs/design/message-role-attribution.md\n\n## Overview\nImprove message role attribution in the iOS frontend to correctly distinguish between actual user/assistant messages and tool interactions. Currently, tool calls and tool results are incorrectly displayed as \"User\" or \"Assistant\" because the role extraction only checks the top-level JSONL type field.\n\nThis epic delivers:\n- Content-aware role extraction that detects tool_use and tool_result in nested message content\n- Distinct UI labels and styling for \"Tool Call\" and \"Tool Result\" messages\n- Updated export functions with correct role labels\n\n## Acceptance Criteria\n1. Tool result messages display as \"Tool Result\" (not \"User\")\n2. Tool call messages display as \"Tool Call\" (not \"Assistant\")\n3. Regular user prompts still display as \"User\"\n4. Regular assistant responses still display as \"Assistant\"\n5. Tool interactions have distinct visual styling (icon, color)\n6. Existing messages in CoreData are handled gracefully (backward compatible)\n7. Export functions include correct role labels\n8. All existing tests continue to pass","status":"open","priority":2,"issue_type":"epic","created_at":"2026-01-06T16:43:05.348936-06:00","updated_at":"2026-01-06T16:43:05.348936-06:00","source_repo":"."}
{"id":"voice-code-attribution-v2d","content_hash":"ab594a2e4075b1d4544786f48b10cbe8c0a3379a341355616c7530ba8b5e949f","title":"Update MessageRow UI for new role types","description":"## Design Reference\n@docs/design/message-role-attribution.md#ios-ui-display-updates\n\n## Context\nThe MessageRow struct in ConversationView.swift currently uses inline ternary expressions for role-based styling. With four role types now (user, assistant, tool_call, tool_result), we need to extract these into computed properties and update the UI to display distinct icons, colors, and labels for each role.\n\n## Requirements\n- [ ] Add `roleIcon` computed property returning SF Symbol name for each role\n- [ ] Add `roleColor` computed property returning Color for each role\n- [ ] Add `roleLabel` computed property returning display string for each role\n- [ ] Add `bubbleBackground` computed property returning background Color\n- [ ] Update MessageRow body to use these computed properties\n- [ ] Tool calls display with orange/hammer styling\n- [ ] Tool results display with purple/document styling\n\n## Technical Approach\n- File to modify: `ios/VoiceCode/Views/ConversationView.swift`\n- Update MessageRow struct (around line 1081)\n- Replace inline ternaries with switch statements in computed properties\n- Icons: user=person.circle.fill, assistant=cpu, tool_call=hammer.fill, tool_result=doc.text.fill\n- Colors: user=blue, assistant=green, tool_call=orange, tool_result=purple\n\n## Verification\n- [ ] Build succeeds with no warnings\n- [ ] Manual verification: Load session with tool calls, verify correct icons/colors\n- [ ] Verify unknown roles show default styling (gray, questionmark)\n\n## Acceptance Criteria\n- Tool result messages display as \"Tool Result\" with purple styling\n- Tool call messages display as \"Tool Call\" with orange styling\n- Regular user/assistant messages display unchanged\n- Distinct visual treatment for each role type\n\n## Dependencies\nRequires: \"Update extractRole logic in SessionSyncManager\" (voice-code-attribution-au2)\n\n## Parallelization\nCan be worked alongside: \"Update export functions for new role types\"","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-06T16:44:18.326798-06:00","updated_at":"2026-01-06T16:44:18.326798-06:00","source_repo":".","dependencies":[{"issue_id":"voice-code-attribution-v2d","depends_on_id":"voice-code-attribution-ow9","type":"parent-child","created_at":"2026-01-06T16:44:23.982008-06:00","created_by":"daemon"},{"issue_id":"voice-code-attribution-v2d","depends_on_id":"voice-code-attribution-au2","type":"blocks","created_at":"2026-01-06T16:44:24.008974-06:00","created_by":"daemon"}]}
