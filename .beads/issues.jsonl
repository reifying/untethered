{"id":"un-30z","title":"Test task for beads verification","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-11T12:50:50.503836-06:00","created_by":"travisbrown","updated_at":"2026-01-11T12:50:50.503836-06:00"}
{"id":"un-3ea","title":"Witness Patrol","description":"Per-rig worker monitor patrol loop with progressive nudging.","status":"open","priority":2,"issue_type":"molecule","created_at":"2026-01-08T22:57:37.737583-06:00","created_by":"travisbrown","updated_at":"2026-01-08T22:57:37.737583-06:00"}
{"id":"un-7mx","title":"Fix backend restart silently failing when process started from different directory","description":"## Problem\n\nThe `make backend-restart` command silently fails when a backend server is already running but was started from a different working directory (or manually). The Makefile tracks PIDs in `.backend-pid`, but if the process was started elsewhere, the PID file doesn't exist or points to a dead process.\n\n### Symptoms\n- `make backend-restart` reports 'Backend server started (PID: XXXXX)'\n- But the new process immediately exits because port 8080 is already bound\n- Old backend continues running with stale code\n- User thinks restart succeeded but changes aren't loaded\n\n### Root Cause\n- `start-server.sh` starts the backend with `nohup` in background\n- If port 8080 is already bound, the new process fails silently\n- The PID file gets updated with the new (now dead) PID\n- No error is shown to the user\n\n### Solution\n1. Check if port 8080 is already bound before starting\n2. If bound, fail with clear error message: 'Port 8080 already in use. Run make backend-stop-all first.'\n3. Alternatively, add port check to `backend-run` target in Makefile\n\n### Workaround\nUse `pkill -f 'voice-code.server'` or `make backend-stop-all` before `make backend-run`","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-11T13:14:41.946882-06:00","created_by":"travisbrown","updated_at":"2026-01-11T13:30:00.304307-06:00","closed_at":"2026-01-11T13:30:00.304307-06:00","close_reason":"Fixed in commit f1f863e - start-server.sh now detects port conflicts before starting and reads port from config.edn"}
{"id":"un-bt5","title":"Android voice input implementation (SpeechRecognizer)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T13:14:23.541591-06:00","created_by":"travisbrown","updated_at":"2026-01-16T13:17:53.904986-06:00","closed_at":"2026-01-16T13:17:53.904986-06:00","close_reason":"Implemented VoiceInputManager and VoiceOutputManager"}
{"id":"un-dv9","title":"Add input validation to resolve-command-id","description":"## Design Document\n@docs/design/resolve-command-id-validation.md\n\n## Overview\nAdd defensive input validation to the `resolve-command-id` function in commands.clj to prevent malformed shell commands from being executed. The function currently accepts any string and can produce invalid commands for edge cases like nil, empty strings, or incomplete prefixes.\n\n## Acceptance Criteria\n1. `resolve-command-id` throws `ExceptionInfo` for `nil` input\n2. `resolve-command-id` throws `ExceptionInfo` for empty/blank string input\n3. `resolve-command-id` throws `ExceptionInfo` for `\"git.\"` (no subcommand)\n4. `resolve-command-id` throws `ExceptionInfo` for `\"bd.\"` (no subcommand)\n5. `resolve-command-id` logs resolved command at debug level\n6. All existing command resolution behavior unchanged for valid inputs\n7. All new tests pass\n8. All existing tests continue to pass","status":"open","priority":2,"issue_type":"epic","created_at":"2026-01-10T14:20:50.917017-06:00","created_by":"travisbrown","updated_at":"2026-01-10T14:20:50.917017-06:00","labels":["wt:recipe-test"]}
{"id":"un-dv9.1","title":"Add validate-command-id function","description":"## Design Reference\n@docs/design/resolve-command-id-validation.md#code-changes\n\n## Context\nThis is the foundation task for command ID validation. The `validate-command-id` function must exist before `resolve-command-id` can be updated to use it.\n\n## Requirements\n- [ ] Create `validate-command-id` function in `commands.clj`\n- [ ] Return `nil` for valid command IDs\n- [ ] Return error message string for invalid command IDs\n- [ ] Handle all validation cases: nil, non-string, blank, \"git.\", \"bd.\"\n\n## Technical Approach\nAdd the new function before the existing `resolve-command-id` function.\n\nFiles to modify:\n- `backend/src/voice_code/commands.clj`\n\nNew files to create: None\n\nDependencies: None (this is the foundation task)\n\n## Verification\n- [ ] Function compiles without errors\n- [ ] REPL test: `(validate-command-id nil)` returns error string\n- [ ] REPL test: `(validate-command-id \"git.status\")` returns nil\n\n## Acceptance Criteria\n- Function exists and handles all specified validation cases\n- Returns nil for valid inputs, error string for invalid inputs","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T14:21:13.526311-06:00","created_by":"travisbrown","updated_at":"2026-01-10T14:21:13.526311-06:00","labels":["wt:recipe-test"],"dependencies":[{"issue_id":"un-dv9.1","depends_on_id":"un-dv9","type":"parent-child","created_at":"2026-01-10T14:21:13.526905-06:00","created_by":"travisbrown"}]}
{"id":"un-dv9.2","title":"Update resolve-command-id with validation and logging","description":"## Design Reference\n@docs/design/resolve-command-id-validation.md#code-changes\n\n## Context\nAfter `validate-command-id` exists, the `resolve-command-id` function must be updated to call it and add debug logging for resolved commands.\n\n## Requirements\n- [ ] Call `validate-command-id` at the start of `resolve-command-id`\n- [ ] Throw `ExceptionInfo` with structured data when validation fails\n- [ ] Add `log/debug` call after successful resolution\n- [ ] Preserve all existing resolution logic unchanged\n\n## Technical Approach\nWrap existing cond logic in a let block to capture the resolved value for logging.\n\nFiles to modify:\n- `backend/src/voice_code/commands.clj`\n\nNew files to create: None\n\nDependencies:\n- Depends on: un-dv9.1 (Add validate-command-id function)\n\n## Verification\n- [ ] REPL test: `(resolve-command-id nil)` throws ExceptionInfo\n- [ ] REPL test: `(resolve-command-id \"git.status\")` returns \"git status\"\n- [ ] Check logs show debug output when resolving commands\n\n## Acceptance Criteria\n- `resolve-command-id` throws `ExceptionInfo` for `nil` input\n- `resolve-command-id` throws `ExceptionInfo` for empty/blank string input\n- `resolve-command-id` throws `ExceptionInfo` for `\"git.\"` (no subcommand)\n- `resolve-command-id` throws `ExceptionInfo` for `\"bd.\"` (no subcommand)\n- `resolve-command-id` logs resolved command at debug level\n- All existing command resolution behavior unchanged for valid inputs","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T14:21:25.886974-06:00","created_by":"travisbrown","updated_at":"2026-01-10T14:21:25.886974-06:00","labels":["wt:recipe-test"],"dependencies":[{"issue_id":"un-dv9.2","depends_on_id":"un-dv9","type":"parent-child","created_at":"2026-01-10T14:21:25.887602-06:00","created_by":"travisbrown"},{"issue_id":"un-dv9.2","depends_on_id":"un-dv9.1","type":"blocks","created_at":"2026-01-10T14:21:43.332472-06:00","created_by":"travisbrown"}]}
{"id":"un-dv9.3","title":"Create unit tests for command ID validation","description":"## Design Reference\n@docs/design/resolve-command-id-validation.md#unit-tests\n\n## Context\nAfter the validation logic is implemented, comprehensive unit tests ensure correctness and prevent regressions.\n\n## Requirements\n- [ ] Create new test file `backend/test/voice_code/commands_test.clj`\n- [ ] Test `validate-command-id` for all cases (nil, blank, non-string, git., bd., valid)\n- [ ] Test `resolve-command-id` for valid inputs (git, bd, makefile targets)\n- [ ] Test `resolve-command-id` throws on invalid inputs\n- [ ] Verify exception data contains command-id and error\n\n## Technical Approach\nCreate test file following patterns from existing `available_commands_test.clj`.\n\nFiles to modify: None\n\nNew files to create:\n- `backend/test/voice_code/commands_test.clj`\n\nDependencies:\n- Depends on: un-dv9.1 (Add validate-command-id function)\n- Depends on: un-dv9.2 (Update resolve-command-id with validation and logging)\n\n## Verification\n- [ ] Run `make test` - all tests pass\n- [ ] Verify new test file is discovered and executed\n- [ ] Check test output shows expected number of assertions\n\n## Acceptance Criteria\n- All new tests pass\n- All existing tests continue to pass\n\n## Parallelization\nCannot be parallelized - depends on both implementation tasks completing first.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T14:21:37.465605-06:00","created_by":"travisbrown","updated_at":"2026-01-10T14:21:37.465605-06:00","labels":["wt:recipe-test"],"dependencies":[{"issue_id":"un-dv9.3","depends_on_id":"un-dv9","type":"parent-child","created_at":"2026-01-10T14:21:37.466209-06:00","created_by":"travisbrown"},{"issue_id":"un-dv9.3","depends_on_id":"un-dv9.2","type":"blocks","created_at":"2026-01-10T14:21:43.402584-06:00","created_by":"travisbrown"}]}
{"id":"un-ekz","title":"Android session list and conversation UI","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T13:14:26.425425-06:00","created_by":"travisbrown","updated_at":"2026-01-16T13:20:55.24173-06:00","closed_at":"2026-01-16T13:20:55.24173-06:00","close_reason":"Implemented SessionListScreen and ConversationScreen"}
{"id":"un-esk","title":"Android text-to-speech output","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T13:14:24.991932-06:00","created_by":"travisbrown","updated_at":"2026-01-16T13:17:53.906257-06:00","closed_at":"2026-01-16T13:17:53.906257-06:00","close_reason":"Implemented VoiceInputManager and VoiceOutputManager"}
{"id":"un-grj","title":"Worktree beads isolation via BEADS_DB environment variable","description":"## Design Document\n@docs/design/worktree-beads-env-isolation.md\n\n## Overview\nImplement transparent, automatic isolation of beads databases per git worktree using the BEADS_DB environment variable. Each worktree gets a local .beads-local/ database that is automatically created on session start, eliminating noise from unrelated issues in the main repository.\n\n## Key Components\n1. New `voice-code.env` namespace with detection, initialization, and env building functions\n2. Integration with `claude.clj` process execution\n3. Integration with `commands.clj` process spawning\n4. Worktree session creation in `server.clj`\n5. Unit and integration tests\n6. `.gitignore` update\n\n## Acceptance Criteria\n1. [ ] Worktrees are automatically detected by checking `git rev-parse --git-dir` output for `/worktrees/`\n2. [ ] Detection results are cached per-directory to avoid repeated git calls\n3. [ ] `.beads-local/local.db` is created when worktree session starts\n4. [ ] `BEADS_DB` environment variable is set for all processes spawned in worktree directories\n5. [ ] `bd` commands in worktrees see only worktree-specific issues\n6. [ ] Main repository beads database is unaffected\n7. [ ] `.beads-local/` is in `.gitignore`\n8. [ ] All existing tests continue to pass\n9. [ ] New unit tests cover detection, env building, and db initialization","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-11T10:01:58.866236-06:00","created_by":"travisbrown","updated_at":"2026-01-11T10:30:54.686552-06:00","closed_at":"2026-01-11T10:30:54.686552-06:00","close_reason":"All implementation complete. Created voice-code.env namespace, integrated with claude.clj and commands.clj, updated worktree session creation to use local beads db, added .gitignore entry. All 281 backend tests and 12 iOS tests pass."}
{"id":"un-grj.1","title":"Create voice-code.env namespace with worktree detection","description":"## Design Reference\n@docs/design/worktree-beads-env-isolation.md#api-design\n\n## Context\nThis is the foundational task that creates the new `voice-code.env` namespace. All other integration tasks depend on this namespace existing. It provides the core functions for detecting worktrees, initializing local beads databases, and computing environment variables.\n\n## Requirements\n- [ ] Create new file `backend/src/voice_code/env.clj`\n- [ ] Implement `worktree-cache` atom for memoization\n- [ ] Implement `detect-worktree` function using `git rev-parse --git-dir`\n- [ ] Implement `ensure-beads-local!` function to initialize `.beads-local/local.db`\n- [ ] Implement `env-for-directory` function to return BEADS_DB env var map\n- [ ] Use `shell/sh :env` merge pattern to preserve PATH, HOME, etc.\n\n## Technical Approach\n- Files to create: `backend/src/voice_code/env.clj`\n- Dependencies: None (foundation task)\n\nKey implementation details:\n- `detect-worktree`: Check if `git rev-parse --git-dir` output contains `/worktrees/`\n- `ensure-beads-local!`: Create `.beads-local/` dir, run `bd init --force` with BEADS_DB env var\n- `env-for-directory`: Return `{\"BEADS_DB\" path}` for worktrees with existing db, `{}` otherwise\n- Must merge with `(System/getenv)` when using `shell/sh :env` to avoid clearing PATH\n\n## Verification\n- [ ] Unit tests in `backend/test/voice_code/env_test.clj`\n- [ ] Test `detect-worktree` identifies worktrees vs main repos\n- [ ] Test `detect-worktree` caches results\n- [ ] Test `ensure-beads-local!` creates database\n- [ ] Test `ensure-beads-local!` is idempotent\n- [ ] Test `ensure-beads-local!` preserves PATH in env\n- [ ] Test `env-for-directory` returns correct map\n\n## Acceptance Criteria\n- AC1: Worktrees are automatically detected by checking `git rev-parse --git-dir` output for `/worktrees/`\n- AC2: Detection results are cached per-directory to avoid repeated git calls","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T10:02:23.943607-06:00","created_by":"travisbrown","updated_at":"2026-01-11T10:21:19.521632-06:00","closed_at":"2026-01-11T10:21:19.521632-06:00","close_reason":"Created voice-code.env namespace with detect-worktree, ensure-beads-local!, env-for-directory, and clear-cache! functions. All 9 unit tests pass.","dependencies":[{"issue_id":"un-grj.1","depends_on_id":"un-grj","type":"parent-child","created_at":"2026-01-11T10:02:23.944164-06:00","created_by":"travisbrown"}]}
{"id":"un-grj.2","title":"Add environment variable support to claude.clj process execution","description":"## Design Reference\n@docs/design/worktree-beads-env-isolation.md#integration-points\n\n## Context\nThis task integrates the env namespace with Claude CLI process execution. When Claude is invoked in a worktree directory, the BEADS_DB environment variable must be set so that any `bd` commands Claude runs use the local database.\n\n## Requirements\n- [ ] Add 6th arity to `run-process-with-file-redirection` for `env-vars` parameter\n- [ ] Update existing arities to chain to 6-arity version\n- [ ] Modify `invoke-claude` to call `env/env-for-directory` and pass result to process runner\n- [ ] Add require for `voice-code.env` namespace\n\n## Technical Approach\n- Files to modify: `backend/src/voice_code/claude.clj`\n- Dependencies: Task \"Create voice-code.env namespace\" must complete first\n\nKey changes:\n1. Add new arity: `([cli-path args working-dir timeout-ms session-id env-vars] ...)`\n2. In process-opts, add: `(seq env-vars) (assoc :env env-vars)`\n3. In `invoke-claude`: `(let [env-vars (when expanded-dir (env/env-for-directory expanded-dir)) ...]`\n\n## Verification\n- [ ] Existing claude.clj tests still pass\n- [ ] New test: Claude invocation in worktree passes BEADS_DB to process\n- [ ] Manual: Send prompt to worktree session, verify bd commands use local db\n\n## Acceptance Criteria\n- AC4: `BEADS_DB` environment variable is set for all processes spawned in worktree directories\n\n## Parallelization\nCan be worked alongside: \"Add environment variable support to commands.clj\"","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T10:02:36.59286-06:00","created_by":"travisbrown","updated_at":"2026-01-11T10:25:01.952808-06:00","closed_at":"2026-01-11T10:25:01.952808-06:00","close_reason":"Added 6th arity to run-process-with-file-redirection for env-vars, updated invoke-claude to compute env vars via env/env-for-directory. All 33 claude tests pass.","dependencies":[{"issue_id":"un-grj.2","depends_on_id":"un-grj","type":"parent-child","created_at":"2026-01-11T10:02:36.593344-06:00","created_by":"travisbrown"},{"issue_id":"un-grj.2","depends_on_id":"un-grj.1","type":"blocks","created_at":"2026-01-11T10:03:35.218145-06:00","created_by":"travisbrown"}]}
{"id":"un-grj.3","title":"Add environment variable support to commands.clj process spawning","description":"## Design Reference\n@docs/design/worktree-beads-env-isolation.md#integration-points\n\n## Context\nThis task integrates the env namespace with shell command execution. When commands are run via the iOS Commands UI in a worktree, the BEADS_DB environment variable must be set so that `bd.ready`, `bd.list`, etc. use the local database.\n\n## Requirements\n- [ ] Modify `spawn-process` to call `env/env-for-directory`\n- [ ] Use `ProcessBuilder.environment().putAll()` to add env vars\n- [ ] Add require for `voice-code.env` namespace\n\n## Technical Approach\n- Files to modify: `backend/src/voice_code/commands.clj`\n- Dependencies: Task \"Create voice-code.env namespace\" must complete first\n\nKey changes:\n```clojure\n(let [env-vars (env/env-for-directory working-directory)\n      pb (ProcessBuilder. [\"bash\" \"-c\" shell-command])\n      _ (.directory pb (java.io.File. working-directory))\n      _ (when (seq env-vars)\n          (.putAll (.environment pb) env-vars))\n      process (.start pb)]\n  ...)\n```\n\nNote: ProcessBuilder.environment() returns a mutable map that inherits from parent process, so `.putAll` adds to (not replaces) the environment.\n\n## Verification\n- [ ] Existing commands.clj tests still pass\n- [ ] Integration test: spawn-process in worktree passes BEADS_DB\n- [ ] Manual: Run `bd.ready` command in worktree via iOS, verify sees local db\n\n## Acceptance Criteria\n- AC4: `BEADS_DB` environment variable is set for all processes spawned in worktree directories\n\n## Parallelization\nCan be worked alongside: \"Add environment variable support to claude.clj\"","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T10:02:46.895502-06:00","created_by":"travisbrown","updated_at":"2026-01-11T10:25:07.010274-06:00","closed_at":"2026-01-11T10:25:07.010274-06:00","close_reason":"Added env require and modified spawn-process to call env/env-for-directory and pass vars via ProcessBuilder.environment().putAll(). All 9 available-commands tests pass.","dependencies":[{"issue_id":"un-grj.3","depends_on_id":"un-grj","type":"parent-child","created_at":"2026-01-11T10:02:46.896-06:00","created_by":"travisbrown"},{"issue_id":"un-grj.3","depends_on_id":"un-grj.1","type":"blocks","created_at":"2026-01-11T10:03:35.270376-06:00","created_by":"travisbrown"}]}
{"id":"un-grj.4","title":"Initialize beads local database in worktree session creation","description":"## Design Reference\n@docs/design/worktree-beads-env-isolation.md#integration-points\n\n## Context\nThis task ensures that when a new worktree session is created, the local beads database is initialized before any Claude prompts are sent. This is the setup step that makes the BEADS_DB environment variable useful.\n\n## Requirements\n- [ ] Call `env/ensure-beads-local!` after successful `create-worktree!`\n- [ ] Handle failure case: send error to client if beads init fails\n- [ ] Add require for `voice-code.env` namespace\n\n## Technical Approach\n- Files to modify: `backend/src/voice_code/server.clj`\n- Dependencies: Task \"Create voice-code.env namespace\" must complete first\n\nKey changes in worktree session creation flow:\n```clojure\n(let [wt-result (worktree/create-worktree! parent-directory branch-name worktree-path)]\n  (if (:success wt-result)\n    (let [beads-result (env/ensure-beads-local! worktree-path sanitized-name)]\n      (if (:success beads-result)\n        ;; Continue with Claude invocation...\n        (let [prompt (worktree/format-worktree-prompt ...)] ...)\n        ;; Beads init failed\n        (send-error! channel {:error (:error beads-result) ...})))\n    ;; Worktree creation failed\n    ...))\n```\n\n## Verification\n- [ ] Unit test: worktree creation calls ensure-beads-local!\n- [ ] Unit test: beads init failure sends error to client\n- [ ] Manual: Create worktree via iOS, verify `.beads-local/local.db` exists\n\n## Acceptance Criteria\n- AC3: `.beads-local/local.db` is created when worktree session starts\n\n## Parallelization\nCan be worked alongside: \"Add environment variable support to claude.clj\" and \"Add environment variable support to commands.clj\"","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T10:02:58.575113-06:00","created_by":"travisbrown","updated_at":"2026-01-11T10:26:50.430486-06:00","closed_at":"2026-01-11T10:26:50.430486-06:00","close_reason":"Replaced worktree/init-beads! with env/ensure-beads-local! in server.clj worktree session creation. All 66 server tests pass.","dependencies":[{"issue_id":"un-grj.4","depends_on_id":"un-grj","type":"parent-child","created_at":"2026-01-11T10:02:58.575582-06:00","created_by":"travisbrown"},{"issue_id":"un-grj.4","depends_on_id":"un-grj.1","type":"blocks","created_at":"2026-01-11T10:03:35.323568-06:00","created_by":"travisbrown"}]}
{"id":"un-grj.5","title":"Update .gitignore to exclude .beads-local/","description":"## Design Reference\n@docs/design/worktree-beads-env-isolation.md#git-ignore-configuration\n\n## Context\nThe local beads database files should never be committed to git. This task adds the `.beads-local/` directory to the repository's `.gitignore` file.\n\n## Requirements\n- [ ] Add `.beads-local/` to `.gitignore`\n- [ ] Add comment explaining purpose\n\n## Technical Approach\n- Files to modify: `.gitignore`\n- Dependencies: None (can be done independently)\n\nAdd to `.gitignore`:\n```gitignore\n# Worktree-local beads database\n.beads-local/\n```\n\n## Verification\n- [ ] Verify `.beads-local/` is ignored by git\n- [ ] Run `git check-ignore .beads-local/` in worktree\n\n## Acceptance Criteria\n- AC7: `.beads-local/` is in `.gitignore`\n\n## Parallelization\nCan be worked alongside: All other tasks (no dependencies)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T10:03:06.543677-06:00","created_by":"travisbrown","updated_at":"2026-01-11T10:25:44.333056-06:00","closed_at":"2026-01-11T10:25:44.333056-06:00","close_reason":"Added .beads-local/ to .gitignore with explanatory comment. Verified with git check-ignore.","dependencies":[{"issue_id":"un-grj.5","depends_on_id":"un-grj","type":"parent-child","created_at":"2026-01-11T10:03:06.544153-06:00","created_by":"travisbrown"}]}
{"id":"un-grj.6","title":"Write unit tests for voice-code.env namespace","description":"## Design Reference\n@docs/design/worktree-beads-env-isolation.md#unit-tests\n\n## Context\nComprehensive unit tests ensure the env namespace functions work correctly in isolation. The design document provides detailed test examples that should be implemented.\n\n## Requirements\n- [ ] Create test file `backend/test/voice_code/env_test.clj`\n- [ ] Implement test helper functions (create-temp-dir!, cleanup-temp-dir!, etc.)\n- [ ] Test `detect-worktree` - main repo detection\n- [ ] Test `detect-worktree` - worktree detection\n- [ ] Test `detect-worktree` - caching behavior\n- [ ] Test `env-for-directory` - non-worktree returns empty map\n- [ ] Test `env-for-directory` - worktree with db returns BEADS_DB\n- [ ] Test `env-for-directory` - worktree without db returns empty map\n- [ ] Test `ensure-beads-local!` - creates database when missing\n- [ ] Test `ensure-beads-local!` - idempotent when db exists\n- [ ] Test `ensure-beads-local!` - preserves PATH in env\n\n## Technical Approach\n- Files to create: `backend/test/voice_code/env_test.clj`\n- Dependencies: Task \"Create voice-code.env namespace\" must complete first\n\nTest helpers to implement:\n- `create-temp-dir!` - creates timestamped temp directory\n- `cleanup-temp-dir!` - recursively deletes directory\n- `create-test-git-repo!` - creates git repo with initial commit\n- `create-test-worktree!` - creates repo + worktree, returns map\n- `cleanup-test-worktree!` - cleans up worktree and repo\n\n## Verification\n- [ ] All tests pass: `make test` or `clojure -M:test`\n- [ ] Tests run in CI pipeline\n\n## Acceptance Criteria\n- AC9: New unit tests cover detection, env building, and db initialization","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T10:03:18.273001-06:00","created_by":"travisbrown","updated_at":"2026-01-11T10:27:17.17714-06:00","closed_at":"2026-01-11T10:27:17.17714-06:00","close_reason":"Tests already created in un-grj.1. 9 tests with 17 assertions covering detect-worktree, env-for-directory, and ensure-beads-local! all pass.","dependencies":[{"issue_id":"un-grj.6","depends_on_id":"un-grj","type":"parent-child","created_at":"2026-01-11T10:03:18.273479-06:00","created_by":"travisbrown"},{"issue_id":"un-grj.6","depends_on_id":"un-grj.1","type":"blocks","created_at":"2026-01-11T10:03:35.375922-06:00","created_by":"travisbrown"}]}
{"id":"un-grj.7","title":"Run full test suite and manual verification","description":"## Design Reference\n@docs/design/worktree-beads-env-isolation.md#manual-verification-steps\n\n## Context\nFinal verification task to ensure all components work together and no regressions were introduced. This task should be completed last after all other tasks are done.\n\n## Requirements\n- [ ] Run full test suite - all tests pass\n- [ ] Manual: Create worktree via iOS app\n- [ ] Manual: Verify `.beads-local/local.db` created in worktree\n- [ ] Manual: Send prompt to worktree session\n- [ ] Manual: Run `bd.ready` command in worktree via iOS\n- [ ] Manual: Verify main repo beads unaffected\n\n## Technical Approach\n- Dependencies: All other tasks must complete first\n\nManual verification steps from design:\n1. Create a worktree via iOS app\n   - Expected: `.beads-local/local.db` created in worktree\n   - Expected: `bd list` in worktree shows empty (or worktree-specific issues)\n\n2. Send prompt to worktree session\n   - Expected: Claude CLI runs with `BEADS_DB` set\n   - Expected: Any `bd` commands Claude runs use local database\n\n3. Run command via iOS Commands UI in worktree\n   - Expected: `bd.ready` shows worktree-specific issues only\n\n4. Verify main repo unaffected\n   - Expected: `bd list` in main repo shows all issues\n\n## Verification\n- [ ] `make test` passes with 0 failures\n- [ ] All manual verification steps pass\n\n## Acceptance Criteria\n- AC5: `bd` commands in worktrees see only worktree-specific issues\n- AC6: Main repository beads database is unaffected\n- AC8: All existing tests continue to pass","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T10:03:28.799527-06:00","created_by":"travisbrown","updated_at":"2026-01-11T10:30:44.69736-06:00","closed_at":"2026-01-11T10:30:44.69736-06:00","close_reason":"Full test suite passes: 281 backend tests, 12 iOS tests (3 skipped), 0 failures. Manual verification requires iOS device/backend runtime.","dependencies":[{"issue_id":"un-grj.7","depends_on_id":"un-grj","type":"parent-child","created_at":"2026-01-11T10:03:28.799986-06:00","created_by":"travisbrown"},{"issue_id":"un-grj.7","depends_on_id":"un-grj.2","type":"blocks","created_at":"2026-01-11T10:03:35.428068-06:00","created_by":"travisbrown"},{"issue_id":"un-grj.7","depends_on_id":"un-grj.3","type":"blocks","created_at":"2026-01-11T10:03:35.478455-06:00","created_by":"travisbrown"},{"issue_id":"un-grj.7","depends_on_id":"un-grj.4","type":"blocks","created_at":"2026-01-11T10:03:35.529133-06:00","created_by":"travisbrown"},{"issue_id":"un-grj.7","depends_on_id":"un-grj.5","type":"blocks","created_at":"2026-01-11T10:03:35.580412-06:00","created_by":"travisbrown"},{"issue_id":"un-grj.7","depends_on_id":"un-grj.6","type":"blocks","created_at":"2026-01-11T10:03:35.631258-06:00","created_by":"travisbrown"}]}
{"id":"un-ils","title":"SelectableText component for reliable text selection","description":"## Design Document\n@docs/design/selectable-text-component.md\n\n## Overview\nCreate a cross-platform SelectableText component using UITextView (iOS) and NSTextView (macOS) to enable reliable native text selection. Replaces SwiftUI Text with .textSelection(.enabled) which is unreliable inside ScrollView on both platforms.\n\n## Scope\n- New component: `SelectableText.swift` in Utils/\n- Migrate MessageDetailView (ConversationView.swift)\n- Migrate CommandOutputDetailView\n- Migrate DebugLogsView\n- CommandExecutionView excluded (different usage pattern)\n\n## Acceptance Criteria\n1. Long-press selects text on iOS in MessageDetailView\n2. Click-drag selects text on macOS in MessageDetailView\n3. Selected text can be copied via system popup (iOS) or Cmd+C (macOS)\n4. Text appearance matches current rendering (font, size, color)\n5. Monospaced text renders correctly in command output views\n6. Small font (10pt) renders correctly in DebugLogsView\n7. Parent ScrollView scrolling works correctly (no conflicts)\n8. No gray/disabled appearance on either platform\n9. Empty text does not crash\n10. Very long text renders without performance issues","status":"open","priority":2,"issue_type":"epic","created_at":"2026-01-10T13:48:06.814037-06:00","created_by":"travisbrown","updated_at":"2026-01-10T13:48:06.814037-06:00","labels":["wt:text-copy"]}
{"id":"un-ils.1","title":"Create SelectableText component","description":"## Design Reference\n@docs/design/selectable-text-component.md#component-api\n\n## Context\nThis is the foundation task for the SelectableText feature. Creates the new cross-platform component that all view migrations will depend on.\n\n## Requirements\n- [ ] Create new file `ios/VoiceCode/Utils/SelectableText.swift`\n- [ ] Implement `SelectableText` SwiftUI View wrapper with API:\n  - `text: String` (required)\n  - `isMonospaced: Bool = false`\n  - `fontSize: CGFloat? = nil`\n  - `textColor: Color? = nil`\n- [ ] Implement `SelectableTextView_iOS` using UIViewRepresentable\n- [ ] Implement `SelectableTextView_macOS` using NSViewRepresentable\n- [ ] Handle dark mode via system label colors\n\n## Technical Approach\n- iOS: Wrap UITextView with isEditable=false, isSelectable=true, isScrollEnabled=false\n- macOS: Wrap NSTextView.scrollableTextView() with isEditable=false, isSelectable=true\n- Use platform conditionals (#if os(iOS) / #if os(macOS))\n- Set text color to .label (iOS) / .labelColor (macOS) for dark mode support\n\nFiles to create:\n- `ios/VoiceCode/Utils/SelectableText.swift`\n\nDependencies: None (this is the foundation task)\n\n## Verification\n- [ ] Build succeeds on iOS simulator\n- [ ] Build succeeds on macOS\n- [ ] Component can be instantiated in SwiftUI preview\n\n## Acceptance Criteria\n- Text appearance matches current rendering (font, size, color)\n- No gray/disabled appearance on either platform\n- Empty text does not crash","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-10T13:48:21.334884-06:00","created_by":"travisbrown","updated_at":"2026-01-10T14:01:19.210744-06:00","closed_at":"2026-01-10T14:01:19.210744-06:00","close_reason":"Created SelectableText.swift with cross-platform UIViewRepresentable (iOS) and NSViewRepresentable (macOS) implementations. Supports text, isMonospaced, fontSize, and textColor parameters. Both iOS and macOS builds pass. All iOS tests pass; macOS unit tests pass (986 tests).","labels":["wt:text-copy"],"dependencies":[{"issue_id":"un-ils.1","depends_on_id":"un-ils","type":"parent-child","created_at":"2026-01-10T13:48:21.335411-06:00","created_by":"travisbrown"}]}
{"id":"un-ils.2","title":"Migrate MessageDetailView to SelectableText","description":"## Design Reference\n@docs/design/selectable-text-component.md#usage-migration\n\n## Context\nMessageDetailView displays full message content when users tap \"View Full\" on a conversation message. This is the primary use case for text selection.\n\n## Requirements\n- [ ] Replace Text(...).textSelection(.enabled) with SelectableText in MessageDetailView\n- [ ] Remove .font(.body) modifier (SelectableText uses body font by default)\n- [ ] Preserve existing .padding() modifier\n\n## Technical Approach\nLocation: `ConversationView.swift` around line 1206 in `MessageDetailView`\n\nFiles to modify:\n- `ios/VoiceCode/Views/ConversationView.swift`\n\nDependencies: un-ils.1 (Create SelectableText component)\n\n## Parallelization\nCan be worked alongside: Migrate CommandOutputDetailView, Migrate DebugLogsView\n\n## Verification\n- [ ] iOS: Long-press on message text shows selection handles\n- [ ] macOS: Click and drag selects text\n- [ ] macOS: Cmd+C copies selected text\n- [ ] ScrollView scrolling still works\n- [ ] Dark mode: text color adapts correctly\n\n## Acceptance Criteria\n1. Long-press selects text on iOS in MessageDetailView\n2. Click-drag selects text on macOS in MessageDetailView\n3. Selected text can be copied via system popup (iOS) or Cmd+C (macOS)\n7. Parent ScrollView scrolling works correctly (no conflicts)","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T13:48:33.443756-06:00","created_by":"travisbrown","updated_at":"2026-01-10T13:48:33.443756-06:00","labels":["wt:text-copy"],"dependencies":[{"issue_id":"un-ils.2","depends_on_id":"un-ils","type":"parent-child","created_at":"2026-01-10T13:48:33.444198-06:00","created_by":"travisbrown"},{"issue_id":"un-ils.2","depends_on_id":"un-ils.1","type":"blocks","created_at":"2026-01-10T13:48:57.099174-06:00","created_by":"travisbrown"}]}
{"id":"un-ils.3","title":"Migrate CommandOutputDetailView to SelectableText","description":"## Design Reference\n@docs/design/selectable-text-component.md#usage-migration\n\n## Context\nCommandOutputDetailView displays full command output. Command output is monospaced text that users often need to copy.\n\n## Requirements\n- [ ] Replace Text(...).textSelection(.enabled) with SelectableText\n- [ ] Use isMonospaced: true parameter\n- [ ] Preserve existing .padding(12), .background(), .cornerRadius(8) modifiers\n\n## Technical Approach\nLocation: `CommandOutputDetailView.swift` around line 167\n\nFiles to modify:\n- `ios/VoiceCode/Views/CommandOutputDetailView.swift`\n\nDependencies: un-ils.1 (Create SelectableText component)\n\n## Parallelization\nCan be worked alongside: Migrate MessageDetailView, Migrate DebugLogsView\n\n## Verification\n- [ ] iOS: Long-press on command output shows selection handles\n- [ ] macOS: Click and drag selects command output\n- [ ] Monospaced font renders correctly\n- [ ] Dark mode: text color adapts correctly\n\n## Acceptance Criteria\n5. Monospaced text renders correctly in command output views\n8. No gray/disabled appearance on either platform","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T13:48:42.717682-06:00","created_by":"travisbrown","updated_at":"2026-01-10T13:48:42.717682-06:00","labels":["wt:text-copy"],"dependencies":[{"issue_id":"un-ils.3","depends_on_id":"un-ils","type":"parent-child","created_at":"2026-01-10T13:48:42.718115-06:00","created_by":"travisbrown"},{"issue_id":"un-ils.3","depends_on_id":"un-ils.1","type":"blocks","created_at":"2026-01-10T13:48:57.14986-06:00","created_by":"travisbrown"}]}
{"id":"un-ils.4","title":"Migrate DebugLogsView to SelectableText","description":"## Design Reference\n@docs/design/selectable-text-component.md#usage-migration\n\n## Context\nDebugLogsView displays debug logs with a smaller 10pt monospaced font for information density.\n\n## Requirements\n- [ ] Replace Text(...).textSelection(.enabled) with SelectableText\n- [ ] Use isMonospaced: true parameter\n- [ ] Use fontSize: 10 parameter for small text\n- [ ] Preserve existing .frame() modifier\n\n## Technical Approach\nLocation: `DebugLogsView.swift` around line 43\n\nFiles to modify:\n- `ios/VoiceCode/Views/DebugLogsView.swift`\n\nDependencies: un-ils.1 (Create SelectableText component)\n\n## Parallelization\nCan be worked alongside: Migrate MessageDetailView, Migrate CommandOutputDetailView\n\n## Verification\n- [ ] iOS: Long-press on debug logs shows selection handles\n- [ ] macOS: Click and drag selects debug logs\n- [ ] 10pt monospaced font renders correctly\n- [ ] Dark mode: text color adapts correctly\n\n## Acceptance Criteria\n6. Small font (10pt) renders correctly in DebugLogsView\n9. Empty text does not crash\n10. Very long text renders without performance issues","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T13:48:51.881109-06:00","created_by":"travisbrown","updated_at":"2026-01-10T13:48:51.881109-06:00","labels":["wt:text-copy"],"dependencies":[{"issue_id":"un-ils.4","depends_on_id":"un-ils","type":"parent-child","created_at":"2026-01-10T13:48:51.881577-06:00","created_by":"travisbrown"},{"issue_id":"un-ils.4","depends_on_id":"un-ils.1","type":"blocks","created_at":"2026-01-10T13:48:57.199387-06:00","created_by":"travisbrown"}]}
{"id":"un-jk2","title":"Test task for panel-color worktree","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-10T12:50:39.518662-06:00","created_by":"travisbrown","updated_at":"2026-01-10T12:50:54.425296-06:00","closed_at":"2026-01-10T12:50:54.425296-06:00","close_reason":"test complete","labels":["wt:panel-color"]}
{"id":"un-ppv","title":"Panel background color consistency for interactive elements","description":"## Design Document\n@docs/design/panel-background-color-consistency.md\n\n## Overview\nFix button panel background colors in the Mac desktop app so they match their container backgrounds. The \"Tap to Speak\", \"Voice Mode\", and related buttons use hardcoded colors that don't blend with the systemBackground container.\n\n## Scope\nSingle file change: `ios/VoiceCode/Views/ConversationView.swift`\n- Line 233: Voice Mode Toggle background\n- Line 1348: Tap to Stop Button background  \n- Line 1368: Tap to Speak Button background\n\n## Acceptance Criteria\n1. Voice Mode toggle button background matches container in light mode\n2. Voice Mode toggle button background matches container in dark mode\n3. Tap to Speak button background matches container in light mode\n4. Tap to Speak button background matches container in dark mode\n5. Tap to Stop button (recording state) maintains red tint for semantic meaning\n6. Disabled state maintains visual distinction (grayed out)\n7. macOS build succeeds\n8. iOS build succeeds\n9. No visual regression in iOS appearance","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-10T11:58:55.472314-06:00","created_by":"travisbrown","updated_at":"2026-01-10T12:09:38.129672-06:00","closed_at":"2026-01-10T12:09:38.129672-06:00","close_reason":"All child tasks complete. Panel background colors now use system-adaptive colors."}
{"id":"un-ppv.1","title":"Update button background colors in ConversationView","description":"## Design Reference\n@docs/design/panel-background-color-consistency.md#code-changes\n\n## Context\nThe Mac desktop app has button panels with hardcoded background colors that don't match their container's systemBackground. This task implements the 3 color changes specified in the design document.\n\n## Requirements\n- [ ] Update Voice Mode toggle background (line 233)\n- [ ] Update Tap to Stop button background (line 1348)\n- [ ] Update Tap to Speak button background (line 1368)\n\n## Technical Approach\nFile to modify: `ios/VoiceCode/Views/ConversationView.swift`\n\nChanges:\n1. Line 233: `Color.blue.opacity(0.1)` → `Color.secondarySystemBackground`\n2. Line 1348: `Color.red.opacity(0.1)` → `Color.red.opacity(0.15)`\n3. Line 1368: `(isDisabled ? Color.gray : Color.blue).opacity(0.1)` → `isDisabled ? Color.secondary.opacity(0.1) : Color.secondarySystemBackground`\n\nNo new files needed. Uses existing `Color.secondarySystemBackground` from SystemColors.swift.\n\n## Verification\n- [ ] iOS build succeeds: `make build`\n- [ ] macOS build succeeds: `make build-mac`\n- [ ] Manual: Voice Mode toggle blends with input area (light mode)\n- [ ] Manual: Voice Mode toggle blends with input area (dark mode)\n- [ ] Manual: Tap to Speak button blends with input area (light mode)\n- [ ] Manual: Tap to Speak button blends with input area (dark mode)\n- [ ] Manual: Tap to Stop button shows red tint when recording\n- [ ] Manual: Disabled button appears grayed out\n- [ ] Manual: Buttons still look tappable/interactive\n\n## Acceptance Criteria\nAddresses all 9 acceptance criteria from the epic:\n1-4. Voice Mode and Tap to Speak backgrounds match container in light/dark modes\n5. Tap to Stop maintains red tint for recording state\n6. Disabled state shows visual distinction\n7-8. Both platform builds succeed\n9. No visual regression on iOS","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-10T11:59:14.29556-06:00","created_by":"travisbrown","updated_at":"2026-01-10T12:09:32.936479-06:00","closed_at":"2026-01-10T12:09:32.936479-06:00","close_reason":"Implemented all 3 background color changes. iOS and macOS builds verified.","dependencies":[{"issue_id":"un-ppv.1","depends_on_id":"un-ppv","type":"parent-child","created_at":"2026-01-10T11:59:14.296212-06:00","created_by":"travisbrown"}]}
{"id":"un-qrb.1","title":"Create SelectableText component","description":"## Design Reference\n@docs/design/selectable-text-component.md#component-api\n\n## Context\nThis is the foundation task for the SelectableText feature. Creates the new cross-platform component that all view migrations will depend on.\n\n## Requirements\n- [ ] Create new file `ios/VoiceCode/Utils/SelectableText.swift`\n- [ ] Implement `SelectableText` SwiftUI View wrapper with API:\n  - `text: String` (required)\n  - `isMonospaced: Bool = false`\n  - `fontSize: CGFloat? = nil`\n  - `textColor: Color? = nil`\n- [ ] Implement `SelectableTextView_iOS` using UIViewRepresentable\n- [ ] Implement `SelectableTextView_macOS` using NSViewRepresentable\n- [ ] Handle dark mode via system label colors\n\n## Technical Approach\n- iOS: Wrap UITextView with isEditable=false, isSelectable=true, isScrollEnabled=false\n- macOS: Wrap NSTextView.scrollableTextView() with isEditable=false, isSelectable=true\n- Use platform conditionals (#if os(iOS) / #if os(macOS))\n- Set text color to .label (iOS) / .labelColor (macOS) for dark mode support\n\nFiles to create:\n- `ios/VoiceCode/Utils/SelectableText.swift`\n\nDependencies: None (this is the foundation task)\n\n## Verification\n- [ ] Build succeeds on iOS simulator\n- [ ] Build succeeds on macOS\n- [ ] Component can be instantiated in SwiftUI preview\n\n## Acceptance Criteria\n- Text appearance matches current rendering (font, size, color)\n- No gray/disabled appearance on either platform\n- Empty text does not crash","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T10:00:05.689752-06:00","created_by":"travisbrown","updated_at":"2026-01-10T10:00:05.689752-06:00"}
{"id":"un-qrb.2","title":"Migrate MessageDetailView to SelectableText","description":"## Design Reference\n@docs/design/selectable-text-component.md#usage-migration\n\n## Context\nMessageDetailView displays full message content when users tap \"View Full\" on a conversation message. This is the primary use case for text selection - users need to copy portions of Claude's responses.\n\n## Requirements\n- [ ] Replace Text(...).textSelection(.enabled) with SelectableText in MessageDetailView\n- [ ] Remove .font(.body) modifier (SelectableText uses body font by default)\n- [ ] Preserve existing .padding() modifier\n- [ ] Verify text selection works on both platforms\n\n## Technical Approach\nLocation: `ConversationView.swift` around line 1206 in `MessageDetailView`\n\nBefore:\n```swift\nScrollView {\n    Text(message.text)\n        .font(.body)\n        .textSelection(.enabled)\n        .padding()\n}\n```\n\nAfter:\n```swift\nScrollView {\n    SelectableText(text: message.text)\n        .padding()\n}\n```\n\nFiles to modify:\n- `ios/VoiceCode/Views/ConversationView.swift`\n\nDependencies: un-qrb.1 (Create SelectableText component)\n\n## Parallelization\nCan be worked alongside: Migrate CommandOutputDetailView, Migrate DebugLogsView (after component is created)\n\n## Verification\n- [ ] iOS: Long-press on message text shows selection handles\n- [ ] iOS: Drag handles to adjust selection\n- [ ] iOS: Tap \"Copy\" in popup copies selected text\n- [ ] macOS: Click and drag selects text\n- [ ] macOS: Cmd+A selects all text\n- [ ] macOS: Cmd+C copies selected text\n- [ ] ScrollView scrolling still works (no conflicts)\n- [ ] Dark mode: text color adapts correctly\n\n## Acceptance Criteria\n1. Long-press selects text on iOS in MessageDetailView\n2. Click-drag selects text on macOS in MessageDetailView\n3. Selected text can be copied via system popup (iOS) or Cmd+C (macOS)\n7. Parent ScrollView scrolling works correctly (no conflicts)","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T10:00:18.554593-06:00","created_by":"travisbrown","updated_at":"2026-01-10T10:00:18.554593-06:00","dependencies":[{"issue_id":"un-qrb.2","depends_on_id":"un-qrb.1","type":"blocks","created_at":"2026-01-10T10:00:42.599993-06:00","created_by":"travisbrown"}]}
{"id":"un-qrb.3","title":"Migrate CommandOutputDetailView to SelectableText","description":"## Design Reference\n@docs/design/selectable-text-component.md#usage-migration\n\n## Context\nCommandOutputDetailView displays full command output when users view command execution history. Command output is monospaced text that users often need to copy.\n\n## Requirements\n- [ ] Replace Text(...).textSelection(.enabled) with SelectableText\n- [ ] Use isMonospaced: true parameter\n- [ ] Preserve existing .padding(12), .background(), .cornerRadius(8) modifiers\n\n## Technical Approach\nLocation: `CommandOutputDetailView.swift` around line 167\n\nBefore:\n```swift\nText(output.output)\n    .font(.system(.body, design: .monospaced))\n    .textSelection(.enabled)\n    .padding(12)\n    .background(Color.secondarySystemBackground)\n    .cornerRadius(8)\n```\n\nAfter:\n```swift\nSelectableText(text: output.output, isMonospaced: true)\n    .padding(12)\n    .background(Color.secondarySystemBackground)\n    .cornerRadius(8)\n```\n\nFiles to modify:\n- `ios/VoiceCode/Views/CommandOutputDetailView.swift`\n\nDependencies: un-qrb.1 (Create SelectableText component)\n\n## Parallelization\nCan be worked alongside: Migrate MessageDetailView, Migrate DebugLogsView (after component is created)\n\n## Verification\n- [ ] iOS: Long-press on command output shows selection handles\n- [ ] macOS: Click and drag selects command output\n- [ ] Monospaced font renders correctly\n- [ ] Background and corner radius preserved\n- [ ] Dark mode: text color adapts correctly\n\n## Acceptance Criteria\n5. Monospaced text renders correctly in command output views\n8. No gray/disabled appearance on either platform","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T10:00:27.100997-06:00","created_by":"travisbrown","updated_at":"2026-01-10T10:00:27.100997-06:00","dependencies":[{"issue_id":"un-qrb.3","depends_on_id":"un-qrb.1","type":"blocks","created_at":"2026-01-10T10:00:42.652084-06:00","created_by":"travisbrown"}]}
{"id":"un-qrb.4","title":"Migrate DebugLogsView to SelectableText","description":"## Design Reference\n@docs/design/selectable-text-component.md#usage-migration\n\n## Context\nDebugLogsView displays debug logs and render statistics. Uses a smaller 10pt monospaced font for information density. Users may need to copy log entries for debugging.\n\n## Requirements\n- [ ] Replace Text(...).textSelection(.enabled) with SelectableText\n- [ ] Use isMonospaced: true parameter\n- [ ] Use fontSize: 10 parameter for small text\n- [ ] Preserve existing .frame() modifier\n\n## Technical Approach\nLocation: `DebugLogsView.swift` around line 43\n\nBefore:\n```swift\nText(logs)\n    .font(.system(size: 10, design: .monospaced))\n    .textSelection(.enabled)\n    .frame(maxWidth: .infinity, alignment: .leading)\n    .padding()\n```\n\nAfter:\n```swift\nSelectableText(text: logs, isMonospaced: true, fontSize: 10)\n    .frame(maxWidth: .infinity, alignment: .leading)\n    .padding()\n```\n\nFiles to modify:\n- `ios/VoiceCode/Views/DebugLogsView.swift`\n\nDependencies: un-qrb.1 (Create SelectableText component)\n\n## Parallelization\nCan be worked alongside: Migrate MessageDetailView, Migrate CommandOutputDetailView (after component is created)\n\n## Verification\n- [ ] iOS: Long-press on debug logs shows selection handles\n- [ ] macOS: Click and drag selects debug logs\n- [ ] 10pt monospaced font renders correctly (small text)\n- [ ] Text fills available width\n- [ ] Dark mode: text color adapts correctly\n\n## Acceptance Criteria\n6. Small font (10pt) renders correctly in DebugLogsView\n9. Empty text does not crash\n10. Very long text renders without performance issues","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T10:00:36.650213-06:00","created_by":"travisbrown","updated_at":"2026-01-10T10:00:36.650213-06:00","dependencies":[{"issue_id":"un-qrb.4","depends_on_id":"un-qrb.1","type":"blocks","created_at":"2026-01-10T10:00:42.702947-06:00","created_by":"travisbrown"}]}
{"id":"un-rfm","title":"Test task for worktree test-6","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-11T12:42:41.782123-06:00","created_by":"travisbrown","updated_at":"2026-01-11T12:42:41.782123-06:00"}
{"id":"un-untethered-crew-sean","title":"Crew worker sean in untethered - human-managed persistent workspace.","description":"Crew worker sean in untethered - human-managed persistent workspace.\n\nrole_type: crew\nrig: untethered\nagent_state: idle\nhook_bead: null\nrole_bead: hq-crew-role\ncleanup_status: null\nactive_mr: null\nnotification_level: null","status":"open","priority":2,"issue_type":"agent","created_at":"2026-01-08T22:57:59.88141-06:00","created_by":"travisbrown","updated_at":"2026-01-08T23:36:10.621038-06:00"}
{"id":"un-untethered-polecat-furiosa","title":"un-untethered-polecat-furiosa","description":"un-untethered-polecat-furiosa\n\nrole_type: polecat\nrig: untethered\nagent_state: spawning\nhook_bead: un-zqu.10\nrole_bead: hq-polecat-role\ncleanup_status: null\nactive_mr: null\nnotification_level: null","status":"open","priority":2,"issue_type":"agent","created_at":"2026-01-09T00:02:50.449387-06:00","created_by":"travisbrown","updated_at":"2026-01-09T00:02:50.597932-06:00"}
{"id":"un-vgx","title":"Deacon Patrol","description":"Mayor's daemon patrol loop for handling callbacks, health checks, and cleanup.","status":"open","priority":2,"issue_type":"molecule","created_at":"2026-01-08T22:57:37.61922-06:00","created_by":"travisbrown","updated_at":"2026-01-08T22:57:37.61922-06:00"}
{"id":"un-vnr","title":"Refinery Patrol","description":"Merge queue processor patrol loop with verification gates.","status":"open","priority":2,"issue_type":"molecule","created_at":"2026-01-08T22:57:37.869572-06:00","created_by":"travisbrown","updated_at":"2026-01-08T22:57:37.869572-06:00"}
{"id":"un-zqu","title":"macOS Desktop Redesign","description":"## Design Document\n@docs/design/macos-desktop-redesign.md\n\n## Overview\nTransform the macOS app from 'iOS app on Mac' into a native desktop experience. Implements persistent sidebar navigation, push-to-talk voice input, command palette, proper Settings scene, menu bar quick access, and information density adjustments while maintaining voice-first identity.\n\n## Acceptance Criteria\n1. Sidebar persists while viewing conversation (NavigationSplitView)\n2. Push-to-talk works with Option+Space anywhere in app\n3. Command palette opens with Cmd+K and supports fuzzy search\n4. Settings opens as separate window via Cmd+,\n5. Menu bar icon shows connection status and enables quick voice capture\n6. Information density is higher than iOS (smaller spacing, more visible content)\n7. All keyboard shortcuts documented in menu items\n8. iOS functionality remains unchanged (no regressions)\n9. Session switching possible without losing conversation context\n10. Voice input works seamlessly via both click and keyboard\n\n## Implementation Phases\n- Phase 1: Navigation Foundation (NavigationSplitView, SessionSidebarView)\n- Phase 2: Settings \u0026 Keyboard (Settings scene, .commands{} shortcuts)\n- Phase 3: Push-to-Talk (PushToTalkModifier, RecordingIndicator)\n- Phase 4: Command Palette (CommandPaletteView)\n- Phase 5: Menu Bar Extra (MenuBarContentView, sendQuickPrompt)\n- Phase 6: Polish (DesktopDensity, hover states)","status":"open","priority":1,"issue_type":"epic","assignee":"/polecats/","created_at":"2026-01-08T23:38:00.904161-06:00","created_by":"travisbrown","updated_at":"2026-01-09T12:57:14.866403-06:00"}
{"id":"un-zqu.1","title":"Add sendQuickPrompt method to VoiceCodeClient","description":"## Design Reference\n@docs/design/macos-desktop-redesign.md#data-model-changes\n\n## Context\nThe menu bar quick capture needs a simplified API to send prompts without managing full session lifecycle. This method creates a temporary session, sends the prompt, and returns the response.\n\n## Requirements\n- [ ] Add sendQuickPrompt(text:directory:completion:) method\n- [ ] Create or reuse session in specified directory\n- [ ] Send prompt via existing WebSocket infrastructure\n- [ ] Return first response text via completion handler\n- [ ] Handle errors by returning nil\n- [ ] Track directory usage via AppSettings.trackDirectoryUsage\n\n## Technical Approach\n- Files to modify: ios/VoiceCode/VoiceCodeClient.swift\n- Dependencies: AppSettings.trackDirectoryUsage\n\nMethod signature:\n```swift\nfunc sendQuickPrompt(text: String, directory: String, completion: @escaping (String?) -\u003e Void)\n```\n\nImplementation approach:\n1. Find or create session with matching workingDirectory\n2. Set up one-time response handler\n3. Send prompt message\n4. On response, call completion with text\n5. On error/timeout, call completion with nil\n6. Call settings.trackDirectoryUsage(directory)\n\n## Verification\n- [ ] Unit test: completion called with response text on success\n- [ ] Unit test: completion called with nil on error\n- [ ] Integration test: prompt sent and response received\n- [ ] Manual: Menu bar Send button triggers prompt and shows response\n\n## Acceptance Criteria\n- Menu bar icon shows connection status and enables quick voice capture (API support)\n\n## Parallelization\nDepends on: AppSettings.trackDirectoryUsage\nRequired by: MenuBarExtra (for sendPrompt functionality)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-08T23:40:48.917777-06:00","created_by":"travisbrown","updated_at":"2026-01-10T14:48:00.999631-06:00","closed_at":"2026-01-10T14:48:00.999631-06:00","close_reason":"Implemented sendQuickPrompt method with completion handler, timeout handling, directory tracking, and 6 passing tests","dependencies":[{"issue_id":"un-zqu.1","depends_on_id":"un-zqu","type":"parent-child","created_at":"2026-01-08T23:40:48.919356-06:00","created_by":"travisbrown"},{"issue_id":"un-zqu.1","depends_on_id":"un-zqu.6","type":"blocks","created_at":"2026-01-08T23:41:20.016009-06:00","created_by":"travisbrown"}]}
{"id":"un-zqu.10","title":"Implement MacOSRootView with NavigationSplitView","description":"## Design Reference\n@docs/design/macos-desktop-redesign.md#1-navigation-architecture-persistent-sidebar\n\n## Context\nThis is the foundation task that changes the macOS app from NavigationStack (iOS-style drill-down) to NavigationSplitView (persistent two-column layout). All other macOS-specific UI changes depend on this architecture change.\n\n## Requirements\n- [ ] Create MacOSRootView struct with NavigationSplitView\n- [ ] Add selectedSessionId State for sidebar selection binding\n- [ ] Add sidebarVisibility State for toggle support\n- [ ] Create EmptyDetailView for when no session is selected\n- [ ] Wire ConversationView as detail pane\n- [ ] Platform-guard with #if os(macOS)\n\n## Technical Approach\n- Files to modify: ios/VoiceCode/VoiceCodeApp.swift\n- New files to create: None (MacOSRootView goes in VoiceCodeApp.swift)\n- Dependencies: None (this is the foundation)\n\nKey code structure:\n- NavigationSplitView(columnVisibility: $sidebarVisibility)\n- Sidebar: SessionSidebarView (created in separate task)\n- Detail: ConversationView(sessionId:) or EmptyDetailView\n- .navigationSplitViewStyle(.balanced)\n\n## Verification\n- [ ] App compiles for macOS target\n- [ ] Two-column layout renders on launch\n- [ ] EmptyDetailView shows when no session selected\n- [ ] iOS build unchanged (platform guards working)\n\n## Acceptance Criteria\n- Sidebar persists while viewing conversation (NavigationSplitView)\n- iOS functionality remains unchanged (no regressions)\n\n## Parallelization\nMust complete before: SessionSidebarView, Push-to-Talk, Command Palette\nCan be worked alongside: AppSettings additions (Phase 2 prep)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-08T23:40:57.600557-06:00","created_by":"travisbrown","updated_at":"2026-01-10T14:57:22.0452-06:00","closed_at":"2026-01-10T14:57:22.0452-06:00","close_reason":"Implemented MacOSRootView with NavigationSplitView, EmptyDetailView, and placeholder sidebar. 1001 tests passing.","dependencies":[{"issue_id":"un-zqu.10","depends_on_id":"un-zqu","type":"parent-child","created_at":"2026-01-08T23:40:57.602528-06:00","created_by":"travisbrown"}]}
{"id":"un-zqu.11","title":"Create DesktopDensity utilities for information density","description":"## Design Reference\n@docs/design/macos-desktop-redesign.md#6-information-density-adjustments\n\n## Context\nDesktop screens can display more information than mobile. This utility provides platform-specific constants and view modifiers for tighter spacing, smaller fonts, and higher truncation thresholds.\n\n## Requirements\n- [ ] Create DesktopDensity.swift with static constants struct\n- [ ] Define spacing constants (listRowVerticalPadding: 4, listRowHorizontalPadding: 8)\n- [ ] Define typography constants (bodyFont: 13pt, captionFont: 11pt)\n- [ ] Define truncation threshold (2000 chars vs 500 on iOS)\n- [ ] Define sizing constants (minRowHeight: 28, iconSize: 14)\n- [ ] Create .desktopDensity() view modifier for font\n- [ ] Create .desktopListRow() view modifier for padding\n- [ ] Platform-guard with #if os(macOS)\n\n## Technical Approach\n- Files to create: ios/VoiceCode/Utils/DesktopDensity.swift\n- Files to modify: Various view files to apply modifiers\n- Dependencies: None (can be done independently)\n\nView modifiers pattern:\n```swift\nextension View {\n    @ViewBuilder\n    func desktopDensity() -\u003e some View {\n        #if os(macOS)\n        self.font(DesktopDensity.bodyFont)\n        #else\n        self\n        #endif\n    }\n}\n```\n\nApply to: SessionSidebarRow, MessageView (truncation), list rows\n\n## Verification\n- [ ] Manual: macOS rows are visually denser than iOS\n- [ ] Manual: Font sizes are smaller but readable\n- [ ] Manual: Long messages truncate at 2000 chars on macOS\n- [ ] Visual comparison: Side-by-side iOS vs macOS screenshots\n\n## Acceptance Criteria\n- Information density is higher than iOS (smaller spacing, more visible content)\n\n## Parallelization\nCan be worked alongside: Any task after Phase 1\nShould be applied after: SessionSidebarView, CommandPaletteView","status":"in_progress","priority":3,"issue_type":"task","created_at":"2026-01-08T23:41:02.706802-06:00","created_by":"travisbrown","updated_at":"2026-01-09T10:22:11.383596-06:00","dependencies":[{"issue_id":"un-zqu.11","depends_on_id":"un-zqu","type":"parent-child","created_at":"2026-01-08T23:41:02.708555-06:00","created_by":"travisbrown"}]}
{"id":"un-zqu.12","title":"Write unit tests for macOS desktop components","description":"## Design Reference\n@docs/design/macos-desktop-redesign.md#verification-strategy\n\n## Context\nThe design document specifies unit tests for key components. This task implements those tests to verify correct behavior.\n\n## Requirements\n- [ ] Test SessionSidebarView.sessionsByDirectory grouping\n- [ ] Test SessionSidebarView.recentSessions limits to 10\n- [ ] Test CommandPaletteView filtering with \"new\" returns match\n- [ ] Test CommandPaletteView filtering with \"xyz\" returns empty\n- [ ] Test PushToTalkModifier key handling (down/up/ignored)\n- [ ] Test AppSettings.trackDirectoryUsage deduplication and limit\n\n## Technical Approach\n- Files to create/modify: ios/VoiceCodeTests/MacOSDesktopTests.swift\n- Dependencies: All component implementations\n\nTest cases from design:\n```swift\nfunc testTrackDirectoryUsage() {\n    let settings = AppSettings()\n    settings.trackDirectoryUsage(\"/path/a\")\n    settings.trackDirectoryUsage(\"/path/b\")\n    settings.trackDirectoryUsage(\"/path/a\")\n    XCTAssertEqual(settings.lastUsedDirectory, \"/path/a\")\n    XCTAssertEqual(settings.recentDirectories, [\"/path/a\", \"/path/b\"])\n}\n\nfunc testCommandPaletteFiltering() {\n    // Test \"new\" matches \"New session\"\n    // Test \"xyz\" returns empty\n}\n\nfunc testSessionGrouping() {\n    // 5 sessions across 3 directories -\u003e 3 groups\n}\n```\n\n## Verification\n- [ ] All tests pass on macOS target\n- [ ] Tests are platform-guarded appropriately\n- [ ] Coverage includes edge cases\n\n## Acceptance Criteria\nSupports overall quality assurance for all acceptance criteria\n\n## Parallelization\nDepends on: All implementation tasks\nShould be last task before manual testing","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-08T23:41:03.193861-06:00","created_by":"travisbrown","updated_at":"2026-01-08T23:41:03.193861-06:00","dependencies":[{"issue_id":"un-zqu.12","depends_on_id":"un-zqu","type":"parent-child","created_at":"2026-01-08T23:41:03.194433-06:00","created_by":"travisbrown"},{"issue_id":"un-zqu.12","depends_on_id":"un-zqu.3","type":"blocks","created_at":"2026-01-08T23:41:20.225472-06:00","created_by":"travisbrown"},{"issue_id":"un-zqu.12","depends_on_id":"un-zqu.9","type":"blocks","created_at":"2026-01-08T23:41:20.292458-06:00","created_by":"travisbrown"},{"issue_id":"un-zqu.12","depends_on_id":"un-zqu.8","type":"blocks","created_at":"2026-01-08T23:41:20.361208-06:00","created_by":"travisbrown"},{"issue_id":"un-zqu.12","depends_on_id":"un-zqu.6","type":"blocks","created_at":"2026-01-08T23:41:20.430762-06:00","created_by":"travisbrown"}]}
{"id":"un-zqu.13","title":"Manual testing and iOS regression verification","description":"## Design Reference\n@docs/design/macos-desktop-redesign.md#verification-strategy\n\n## Context\nFinal verification task to run through the manual testing checklist and verify iOS functionality is unchanged.\n\n## Requirements\n- [ ] Execute full manual testing checklist from design doc\n- [ ] Verify all 10 acceptance criteria are met\n- [ ] Build and test on iOS simulator - no regressions\n- [ ] Build and test on macOS - all features work\n- [ ] Document any issues found\n\n## Manual Testing Checklist\n\n| Feature | Test Case | Expected Result |\n|---------|-----------|-----------------|\n| Sidebar | Launch app | Sessions visible in sidebar |\n| Sidebar | Click session | Conversation loads in detail |\n| Sidebar | Cmd+0 | Sidebar toggles visibility |\n| Push-to-talk | Hold Option+Space | Recording starts |\n| Push-to-talk | Release Option+Space | Recording stops, transcription shows |\n| Command palette | Cmd+K | Palette opens |\n| Command palette | Type \"new\" | \"New session\" filtered to top |\n| Command palette | Press Enter | Action executes, palette closes |\n| Settings | Cmd+, | Settings window opens (not sheet) |\n| Settings | Change voice | Setting persists |\n| Menu bar | Click icon | Popover appears |\n| Menu bar | Click mic | Recording starts |\n| Menu bar | Send prompt | Response appears in popover |\n\n## iOS Regression Tests\n- [ ] iOS app launches normally\n- [ ] Navigation drill-down works\n- [ ] Voice recording works\n- [ ] Settings sheet opens\n- [ ] All existing features functional\n\n## Technical Approach\n- No code changes in this task\n- Document findings in issue comments\n- File bugs for any issues found\n\n## Verification\n- [ ] All manual tests pass\n- [ ] No iOS regressions identified\n- [ ] All acceptance criteria verified\n\n## Acceptance Criteria\nAll 10 acceptance criteria from epic verified and passing\n\n## Parallelization\nDepends on: All other tasks complete\nThis is the final task","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-08T23:41:03.249654-06:00","created_by":"travisbrown","updated_at":"2026-01-08T23:41:03.249654-06:00","dependencies":[{"issue_id":"un-zqu.13","depends_on_id":"un-zqu","type":"parent-child","created_at":"2026-01-08T23:41:03.250168-06:00","created_by":"travisbrown"},{"issue_id":"un-zqu.13","depends_on_id":"un-zqu.12","type":"blocks","created_at":"2026-01-08T23:41:20.498265-06:00","created_by":"travisbrown"}]}
{"id":"un-zqu.14","title":"Register voicecode:// URL scheme for deep linking","description":"## Design Reference\n@docs/design/macos-desktop-redesign.md#5-menu-bar-quick-access\n\n## Context\nThe menu bar uses voicecode://session/{id} URLs to open specific sessions in the main window. This requires registering the URL scheme in Info.plist and handling incoming URLs.\n\n## Requirements\n- [ ] Add CFBundleURLTypes to Info.plist with voicecode scheme\n- [ ] Implement URL handler in VoiceCodeApp\n- [ ] Parse voicecode://session/{uuid} URLs\n- [ ] Navigate to specified session in main window\n- [ ] Bring main window to front on URL open\n\n## Technical Approach\n- Files to modify: ios/VoiceCode/Info.plist, ios/VoiceCode/VoiceCodeApp.swift\n- Dependencies: MacOSRootView (for session navigation)\n\nInfo.plist addition:\n```xml\n\u003ckey\u003eCFBundleURLTypes\u003c/key\u003e\n\u003carray\u003e\n    \u003cdict\u003e\n        \u003ckey\u003eCFBundleURLSchemes\u003c/key\u003e\n        \u003carray\u003e\n            \u003cstring\u003evoicecode\u003c/string\u003e\n        \u003c/array\u003e\n    \u003c/dict\u003e\n\u003c/array\u003e\n```\n\nSwiftUI URL handling:\n```swift\n.onOpenURL { url in\n    if url.scheme == \"voicecode\", url.host == \"session\" {\n        let sessionId = url.lastPathComponent\n        // Set selectedSessionId\n    }\n}\n```\n\n## Verification\n- [ ] Manual: voicecode://session/{uuid} opens correct session\n- [ ] Manual: Main window comes to front\n- [ ] Manual: Invalid URLs are ignored gracefully\n\n## Acceptance Criteria\n- Session switching possible without losing conversation context (via URL)\n\n## Parallelization\nDepends on: MacOSRootView\nCan be worked alongside: MenuBarExtra","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-08T23:41:04.295888-06:00","created_by":"travisbrown","updated_at":"2026-01-08T23:41:04.295888-06:00","dependencies":[{"issue_id":"un-zqu.14","depends_on_id":"un-zqu","type":"parent-child","created_at":"2026-01-08T23:41:04.296342-06:00","created_by":"travisbrown"},{"issue_id":"un-zqu.14","depends_on_id":"un-zqu.10","type":"blocks","created_at":"2026-01-08T23:41:20.15625-06:00","created_by":"travisbrown"}]}
{"id":"un-zqu.2","title":"Add RecordingIndicator visual feedback for push-to-talk","description":"## Design Reference\n@docs/design/macos-desktop-redesign.md#2-push-to-talk-voice-input\n\n## Context\nWhen push-to-talk is active, users need clear visual feedback that recording is in progress. This indicator shows a pulsing red dot with instructional text.\n\n## Requirements\n- [ ] Create RecordingIndicator view component\n- [ ] Add pulsing red circle animation (opacity 1 to 0.5)\n- [ ] Show \"Recording... (release Option+Space to stop)\" text\n- [ ] Background pill with red tint\n- [ ] Trigger pulseAnimation on appear\n- [ ] Only render when voiceInput.isRecording is true\n- [ ] Platform-guard with #if os(macOS)\n\n## Technical Approach\n- Files to modify: ios/VoiceCode/Utils/PushToTalkModifier.swift (add RecordingIndicator there)\n  OR create separate file\n- Dependencies: PushToTalkModifier should exist\n\nKey implementation:\n```swift\n@State private var pulseAnimation = false\n\nCircle()\n    .opacity(pulseAnimation ? 1 : 0.5)\n    .animation(.easeInOut(duration: 0.5).repeatForever(), value: pulseAnimation)\n    .onAppear { pulseAnimation = true }\n```\n\n## Verification\n- [ ] Manual: Red pulsing dot appears when recording\n- [ ] Manual: Instructional text is readable\n- [ ] Manual: Indicator disappears when recording stops\n- [ ] Visual: Animation is smooth, not jarring\n\n## Acceptance Criteria\n- Voice input works seamlessly via both click and keyboard (visual feedback component)\n\n## Parallelization\nDepends on: PushToTalkModifier\nCan be worked alongside: CommandPaletteView, MenuBarExtra","status":"in_progress","priority":2,"issue_type":"task","created_at":"2026-01-08T23:40:50.612883-06:00","created_by":"travisbrown","updated_at":"2026-01-09T10:55:28.179722-06:00","dependencies":[{"issue_id":"un-zqu.2","depends_on_id":"un-zqu","type":"parent-child","created_at":"2026-01-08T23:40:50.613359-06:00","created_by":"travisbrown"},{"issue_id":"un-zqu.2","depends_on_id":"un-zqu.8","type":"blocks","created_at":"2026-01-08T23:41:19.798456-06:00","created_by":"travisbrown"}]}
{"id":"un-zqu.3","title":"Create SessionSidebarView with grouped sessions","description":"## Design Reference\n@docs/design/macos-desktop-redesign.md#1-navigation-architecture-persistent-sidebar\n\n## Context\nThe sidebar is the primary navigation element for the macOS redesign. It displays sessions grouped by directory, recent sessions, and quick command access. This replaces the iOS drill-down navigation pattern.\n\n## Requirements\n- [ ] Create SessionSidebarView.swift with FetchRequest for all sessions\n- [ ] Implement recentSessions computed property (prefix 10)\n- [ ] Implement sessionsByDirectory grouping\n- [ ] Add collapsible Recent section with clock icon\n- [ ] Add collapsible Projects section with folder grouping\n- [ ] Add collapsible Commands section (top 5 MRU commands)\n- [ ] Create SessionSidebarRow with session name, directory path, lock indicator, unread badge\n- [ ] Create CommandSidebarRow for command quick access\n- [ ] Add New Session toolbar button with Cmd+N shortcut\n- [ ] Platform-guard entire file with #if os(macOS)\n\n## Technical Approach\n- Files to create: ios/VoiceCode/Views/SessionSidebarView.swift\n- Dependencies: MacOSRootView must exist to host this view\n\nKey patterns:\n- Use @FetchRequest for CDBackendSession sorted by lastModified\n- Use session.displayName(context: viewContext) for names\n- Use session.backendName for lock checking against client.lockedSessions\n- Use CommandSorter.sortByMRU() for command ordering (existing pattern)\n- List(selection: $selectedSessionId) for sidebar selection\n\n## Verification\n- [ ] Unit test: sessionsByDirectory groups correctly with 5 sessions across 3 directories\n- [ ] Unit test: recentSessions limits to 10\n- [ ] Manual: Sessions appear in sidebar on app launch\n- [ ] Manual: Clicking session loads it in detail pane\n- [ ] Manual: Unread badge shows correct count\n- [ ] Manual: Lock icon appears for processing sessions\n\n## Acceptance Criteria\n- Sidebar persists while viewing conversation\n- Session switching possible without losing conversation context\n\n## Parallelization\nDepends on: MacOSRootView\nCan be worked alongside: MacSettingsView, PushToTalkModifier (after MacOSRootView done)","status":"in_progress","priority":1,"issue_type":"task","created_at":"2026-01-08T23:40:50.634264-06:00","created_by":"travisbrown","updated_at":"2026-01-09T10:41:34.410087-06:00","dependencies":[{"issue_id":"un-zqu.3","depends_on_id":"un-zqu","type":"parent-child","created_at":"2026-01-08T23:40:50.634747-06:00","created_by":"travisbrown"},{"issue_id":"un-zqu.3","depends_on_id":"un-zqu.10","type":"blocks","created_at":"2026-01-08T23:41:19.574618-06:00","created_by":"travisbrown"}]}
{"id":"un-zqu.4","title":"Implement MenuBarExtra scene for quick voice capture","description":"## Design Reference\n@docs/design/macos-desktop-redesign.md#5-menu-bar-quick-access\n\n## Context\nThe menu bar extra enables quick voice queries without opening the full app. Users can record voice, see transcription, and send prompts directly from the menu bar.\n\n## Requirements\n- [ ] Create MenuBarExtra.swift with VoiceCodeMenuBarExtra Scene\n- [ ] Create MenuBarContentView with all UI sections\n- [ ] Implement directory selector dropdown from settings.recentDirectories\n- [ ] Add voice input area with mic button and Space key support\n- [ ] Show transcription/response area when content exists\n- [ ] Display recent sessions list (top 3) via callback pattern\n- [ ] Add footer actions: Open VoiceCode, Settings, Quit\n- [ ] Show connection status in menu bar icon (green/red)\n- [ ] Use .menuBarExtraStyle(.window) for popover style\n- [ ] Platform-guard with #if os(macOS)\n\n## Technical Approach\n- Files to create: ios/VoiceCode/MenuBarExtra.swift\n- Files to modify: ios/VoiceCode/VoiceCodeApp.swift (add scene)\n- Dependencies: AppSettings additions (lastUsedDirectory, recentDirectories)\n\nKey patterns:\n- @State recentSessions with client.onRecentSessionsReceived callback\n- NSOpenPanel for directory browsing\n- NSApp.sendAction for opening Settings\n- URL scheme voicecode://session/{id} for session deep links\n\nNote: VoiceInputManager instance needs careful management - may need shared instance or dependency injection.\n\n## Verification\n- [ ] Manual: Menu bar icon appears when app runs\n- [ ] Manual: Icon color reflects connection status\n- [ ] Manual: Click opens popover\n- [ ] Manual: Directory dropdown shows recent directories\n- [ ] Manual: Clicking mic starts recording\n- [ ] Manual: Space key starts recording\n- [ ] Manual: Recent sessions list shows 3 items\n- [ ] Manual: \"Open VoiceCode\" activates main window\n\n## Acceptance Criteria\n- Menu bar icon shows connection status and enables quick voice capture\n\n## Parallelization\nDepends on: AppSettings additions\nCan be worked alongside: CommandPaletteView, DesktopDensity","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-08T23:40:50.936712-06:00","created_by":"travisbrown","updated_at":"2026-01-08T23:40:50.936712-06:00","dependencies":[{"issue_id":"un-zqu.4","depends_on_id":"un-zqu","type":"parent-child","created_at":"2026-01-08T23:40:50.937293-06:00","created_by":"travisbrown"},{"issue_id":"un-zqu.4","depends_on_id":"un-zqu.6","type":"blocks","created_at":"2026-01-08T23:41:19.943387-06:00","created_by":"travisbrown"},{"issue_id":"un-zqu.4","depends_on_id":"un-zqu.1","type":"blocks","created_at":"2026-01-08T23:41:20.085584-06:00","created_by":"travisbrown"}]}
{"id":"un-zqu.5","title":"Add Settings scene and .commands{} to VoiceCodeApp","description":"## Design Reference\n@docs/design/macos-desktop-redesign.md#4-settings-as-macos-settings-scene\n@docs/design/macos-desktop-redesign.md#7-complete-keyboard-shortcut-map\n\n## Context\nThis task wires up the macOS Settings scene and adds all keyboard shortcuts via the .commands{} modifier. It's the glue that connects MacSettingsView and enables all menu bar shortcuts.\n\n## Requirements\n- [ ] Add Settings scene with MacSettingsView and environment objects\n- [ ] Add .commands{} modifier to WindowGroup\n- [ ] Implement Edit menu additions (Stop Speaking, Mute Voice, Command Palette)\n- [ ] Implement View menu additions (Toggle Sidebar, Focus Sidebar, Focus Conversation)\n- [ ] Create Session menu (New, Refresh, Compact, Info, Previous, Next)\n- [ ] Add @State var showCommandPalette for Cmd+K trigger\n- [ ] Platform-guard all additions with #if os(macOS)\n\n## Technical Approach\n- Files to modify: ios/VoiceCode/VoiceCodeApp.swift\n- Dependencies: MacSettingsView must exist\n\nKeyboard shortcuts to implement:\n- Cmd+. (Stop Speaking), Cmd+Shift+M (Mute), Cmd+K (Command Palette)\n- Cmd+0 (Toggle Sidebar), Cmd+1 (Focus Sidebar), Cmd+2 (Focus Conversation)\n- Cmd+N (New Session), Cmd+R (Refresh), Cmd+Shift+C (Compact), Cmd+I (Info)\n- Cmd+[ (Previous Session), Cmd+] (Next Session)\n\nPlaceholder functions needed: focusSidebar(), focusConversation(), createNewSession(), selectPreviousSession(), selectNextSession()\n\n## Verification\n- [ ] Manual: Cmd+, opens Settings window\n- [ ] Manual: All shortcuts appear in menu bar with correct key bindings\n- [ ] Manual: Cmd+0 toggles sidebar visibility\n- [ ] Manual: Session menu shows all session-related commands\n\n## Acceptance Criteria\n- Settings opens as separate window via Cmd+,\n- All keyboard shortcuts documented in menu items\n\n## Parallelization\nDepends on: MacSettingsView\nCan be worked alongside: PushToTalkModifier, CommandPaletteView","status":"in_progress","priority":2,"issue_type":"task","created_at":"2026-01-08T23:40:51.300417-06:00","created_by":"travisbrown","updated_at":"2026-01-09T10:47:47.621203-06:00","dependencies":[{"issue_id":"un-zqu.5","depends_on_id":"un-zqu","type":"parent-child","created_at":"2026-01-08T23:40:51.301031-06:00","created_by":"travisbrown"},{"issue_id":"un-zqu.5","depends_on_id":"un-zqu.7","type":"blocks","created_at":"2026-01-08T23:41:19.653113-06:00","created_by":"travisbrown"}]}
{"id":"un-zqu.6","title":"Add AppSettings properties for directory tracking","description":"## Design Reference\n@docs/design/macos-desktop-redesign.md#data-model-changes\n\n## Context\nThe menu bar quick capture feature needs to track recently used directories and the last used directory. These settings enable the menu bar to default to a sensible directory without user input.\n\n## Requirements\n- [ ] Add lastUsedDirectory: String? property with UserDefaults persistence\n- [ ] Add recentDirectories: [String] property with UserDefaults persistence\n- [ ] Implement trackDirectoryUsage(_ directory: String) method\n- [ ] Initialize properties from UserDefaults in init()\n- [ ] Limit recentDirectories to 10 entries\n- [ ] Remove duplicates when tracking (most recent moves to front)\n\n## Technical Approach\n- Files to modify: ios/VoiceCode/AppSettings.swift\n- Dependencies: None (can be done early)\n\nImplementation:\n```swift\n@Published var lastUsedDirectory: String? {\n    didSet { UserDefaults.standard.set(lastUsedDirectory, forKey: \"lastUsedDirectory\") }\n}\n\n@Published var recentDirectories: [String] {\n    didSet { UserDefaults.standard.set(recentDirectories, forKey: \"recentDirectories\") }\n}\n\nfunc trackDirectoryUsage(_ directory: String) {\n    lastUsedDirectory = directory\n    recentDirectories = ([directory] + recentDirectories.filter { $0 != directory }).prefix(10).map { $0 }\n}\n```\n\n## Verification\n- [ ] Unit test: trackDirectoryUsage deduplicates and limits to 10\n- [ ] Unit test: lastUsedDirectory persists across app restarts\n- [ ] Unit test: tracking \"/a\", \"/b\", \"/a\" results in [\"/a\", \"/b\"]\n\n## Acceptance Criteria\nEnables acceptance criteria #5 (menu bar quick capture)\n\n## Parallelization\nCan be worked alongside: MacOSRootView, SessionSidebarView\nRequired by: MenuBarExtra","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-08T23:40:51.647168-06:00","created_by":"travisbrown","updated_at":"2026-01-10T14:38:39.023075-06:00","closed_at":"2026-01-10T14:38:39.023075-06:00","close_reason":"Implemented lastUsedDirectory, recentDirectories properties and trackDirectoryUsage() method with 9 passing tests","dependencies":[{"issue_id":"un-zqu.6","depends_on_id":"un-zqu","type":"parent-child","created_at":"2026-01-08T23:40:51.649203-06:00","created_by":"travisbrown"}]}
{"id":"un-zqu.7","title":"Create MacSettingsView with tabbed preferences","description":"## Design Reference\n@docs/design/macos-desktop-redesign.md#4-settings-as-macos-settings-scene\n\n## Context\nmacOS apps use a dedicated Settings window (Cmd+,) rather than modal sheets. This task creates the tabbed preferences UI following macOS conventions.\n\n## Requirements\n- [ ] Create MacSettingsView.swift with TabView container\n- [ ] Implement GeneralSettingsTab (recent sessions limit, queue toggles, storage location)\n- [ ] Implement ConnectionSettingsTab (server address, port, API key via KeychainManager)\n- [ ] Implement VoiceSettingsTab (voice picker, push-to-talk shortcut display)\n- [ ] Implement AdvancedSettingsTab (max message size, system prompt)\n- [ ] Add ConnectionTestResult struct and test connection button\n- [ ] Set frame size to 500x400\n- [ ] Platform-guard with #if os(macOS)\n\n## Technical Approach\n- Files to create: ios/VoiceCode/Views/MacSettingsView.swift\n- Dependencies: None for the view itself\n\nKey patterns:\n- Use @EnvironmentObject for settings, client, voiceOutput\n- API key: local @State bound to KeychainManager.shared.getAPIKey()/saveAPIKey()\n- Use .onChange(of: apiKeyInput) { _, newValue in } for macOS 14+ syntax\n- TabView with .tabItem { Label(...) } for each tab\n\n## Verification\n- [ ] Manual: Cmd+, opens Settings window (not sheet)\n- [ ] Manual: All 4 tabs render correctly\n- [ ] Manual: Changing voice persists after closing/reopening\n- [ ] Manual: API key field shows masked value from Keychain\n- [ ] Manual: Test Connection button shows result\n\n## Acceptance Criteria\n- Settings opens as separate window via Cmd+,\n\n## Parallelization\nDepends on: Settings scene in VoiceCodeApp.swift (same task or separate)\nCan be worked alongside: SessionSidebarView, PushToTalkModifier","status":"in_progress","priority":2,"issue_type":"task","created_at":"2026-01-08T23:40:51.909687-06:00","created_by":"travisbrown","updated_at":"2026-01-09T10:20:40.329418-06:00","dependencies":[{"issue_id":"un-zqu.7","depends_on_id":"un-zqu","type":"parent-child","created_at":"2026-01-08T23:40:51.910239-06:00","created_by":"travisbrown"}]}
{"id":"un-zqu.8","title":"Implement PushToTalkModifier for Option+Space voice input","description":"## Design Reference\n@docs/design/macos-desktop-redesign.md#2-push-to-talk-voice-input\n\n## Context\nDesktop users want hands-on-keyboard voice access. This modifier enables push-to-talk via Option+Space, starting recording on key down and stopping on key up.\n\n## Requirements\n- [ ] Create PushToTalkModifier.swift with ViewModifier protocol\n- [ ] Accept VoiceInputManager as @ObservedObject parameter\n- [ ] Track isHolding state to prevent repeated key events\n- [ ] Handle .down phase: start recording if not already holding\n- [ ] Handle .up phase: stop recording if was holding\n- [ ] Ignore events without Option modifier\n- [ ] Create View extension: .pushToTalk(voiceInput:)\n- [ ] Platform-guard with #if os(macOS)\n\n## Technical Approach\n- Files to create: ios/VoiceCode/Utils/PushToTalkModifier.swift\n- Files to modify: ios/VoiceCode/Views/ConversationView.swift\n- Dependencies: MacOSRootView should exist for context\n\nKey implementation:\n```swift\n.onKeyPress(\" \", phases: [.down, .up]) { press in\n    guard press.modifiers == .option else { return .ignored }\n    // Handle down/up phases\n}\n```\n\nConversationView integration:\n```swift\n#if os(macOS)\n.pushToTalk(voiceInput: voiceInputManager)\n#endif\n```\n\n## Verification\n- [ ] Unit test: Option+Space down calls startRecording(), sets isHolding true\n- [ ] Unit test: Option+Space up calls stopRecording(), sets isHolding false\n- [ ] Unit test: Space without Option returns .ignored\n- [ ] Manual: Hold Option+Space starts recording with visual feedback\n- [ ] Manual: Release stops recording and shows transcription\n\n## Acceptance Criteria\n- Push-to-talk works with Option+Space anywhere in app\n- Voice input works seamlessly via both click and keyboard\n\n## Parallelization\nDepends on: MacOSRootView (for ConversationView context)\nCan be worked alongside: MacSettingsView, CommandPaletteView","status":"in_progress","priority":2,"issue_type":"task","created_at":"2026-01-08T23:40:52.074545-06:00","created_by":"travisbrown","updated_at":"2026-01-09T10:48:54.117741-06:00","dependencies":[{"issue_id":"un-zqu.8","depends_on_id":"un-zqu","type":"parent-child","created_at":"2026-01-08T23:40:52.075073-06:00","created_by":"travisbrown"},{"issue_id":"un-zqu.8","depends_on_id":"un-zqu.10","type":"blocks","created_at":"2026-01-08T23:41:19.725884-06:00","created_by":"travisbrown"}]}
{"id":"un-zqu.9","title":"Create CommandPaletteView with fuzzy search","description":"## Design Reference\n@docs/design/macos-desktop-redesign.md#3-command-palette-cmdk\n\n## Context\nThe command palette provides Spotlight-style quick access to all app actions via Cmd+K. It supports fuzzy search filtering and keyboard navigation.\n\n## Requirements\n- [ ] Create CommandPaletteView.swift with search field and results list\n- [ ] Create CommandPaletteItem struct (id, title, shortcut, category, action)\n- [ ] Create CommandPaletteAction enum (newSession, refreshSession, etc.)\n- [ ] Create CommandPaletteRow view for individual items\n- [ ] Implement filteredCommands with localizedCaseInsensitiveContains\n- [ ] Group commands by category (Sessions, Voice, Project Commands)\n- [ ] Add keyboard navigation (up/down arrows, Enter, Escape)\n- [ ] Include project commands from client.availableCommands\n- [ ] Set frame to 500x400 with shadow and rounded corners\n- [ ] Platform-guard with #if os(macOS)\n\n## Technical Approach\n- Files to create: ios/VoiceCode/Views/CommandPaletteView.swift\n- Dependencies: Settings scene task (for Cmd+K shortcut binding)\n\nKey patterns:\n- @FocusState for search field auto-focus\n- ScrollViewReader for keyboard navigation scrolling\n- onKeyPress for arrow keys and escape\n- onAction callback closure for executing commands\n- Use CommandSorter.sortByMRU for project commands\n\nCategories and commands:\n- Sessions: New, Refresh, Compact, Info\n- Voice: Stop Speaking, Mute/Unmute\n- Project Commands: From client.availableCommands.projectCommands\n\n## Verification\n- [ ] Unit test: filtering \"new\" returns \"New session\"\n- [ ] Unit test: filtering \"xyz\" returns empty\n- [ ] Manual: Cmd+K opens palette\n- [ ] Manual: Typing filters results in real-time\n- [ ] Manual: Up/Down arrows navigate selection\n- [ ] Manual: Enter executes selected command\n- [ ] Manual: Escape closes palette\n\n## Acceptance Criteria\n- Command palette opens with Cmd+K and supports fuzzy search\n\n## Parallelization\nDepends on: Settings scene (Cmd+K shortcut)\nCan be worked alongside: MenuBarExtra, DesktopDensity","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-08T23:40:52.611576-06:00","created_by":"travisbrown","updated_at":"2026-01-08T23:40:52.611576-06:00","dependencies":[{"issue_id":"un-zqu.9","depends_on_id":"un-zqu","type":"parent-child","created_at":"2026-01-08T23:40:52.61209-06:00","created_by":"travisbrown"},{"issue_id":"un-zqu.9","depends_on_id":"un-zqu.5","type":"blocks","created_at":"2026-01-08T23:41:19.869527-06:00","created_by":"travisbrown"}]}
