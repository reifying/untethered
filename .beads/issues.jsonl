{"id":"voice-code-100","title":"Test deletion workflow","description":"Test session deletion on iOS stops replication.\n\nSteps:\n1. iOS has session subscribed\n2. User swipes to delete session\n3. iOS sends session_deleted message\n4. Verify backend stops sending updates to that iOS client\n5. Verify backend .jsonl file still exists\n6. Verify other iOS clients still receive updates\n7. Create new prompt from terminal in deleted session\n8. Verify first iOS client does NOT receive update\n9. Verify other clients DO receive update","acceptance_criteria":"Deletion stops replication for that client only, backend file remains, other clients unaffected, updates filtered correctly","status":"open","priority":0,"issue_type":"task","created_at":"2025-10-16T22:55:57.878165-05:00","updated_at":"2025-10-16T22:55:57.878165-05:00","dependencies":[{"issue_id":"voice-code-100","depends_on_id":"voice-code-117","type":"parent-child","created_at":"2025-10-17T17:45:49.936018-05:00","created_by":"travisbrown"}]}
{"id":"voice-code-101","title":"Performance testing","description":"Test performance with 1000+ sessions.\n\nTests:\n1. Index build time with 1000+ .jsonl files\n2. Measure session_list send time (should be \u003c2s)\n3. Measure per-session load time (should be \u003c200ms)\n4. Verify file watching overhead with 10 subscriptions (\u003c5% CPU)\n5. Memory usage with 1000 sessions in index (~10MB)\n6. Test pagination in iOS (20 sessions/page loads quickly)\n7. Test incremental updates (new message appears \u003c1s after terminal prompt)","acceptance_criteria":"All performance targets met, system scales to 1000+ sessions, no degradation with active watching, memory usage acceptable","status":"open","priority":0,"issue_type":"task","created_at":"2025-10-16T22:56:05.676732-05:00","updated_at":"2025-10-16T22:56:05.676732-05:00","dependencies":[{"issue_id":"voice-code-101","depends_on_id":"voice-code-117","type":"parent-child","created_at":"2025-10-17T17:45:49.955166-05:00","created_by":"travisbrown"}]}
{"id":"voice-code-102","title":"Create manual test infrastructure","description":"","design":"Create Clojure-based manual test infrastructure in manual_test/ directory:\n- manual_test/voice_code/fixtures.clj - Shared fixtures (start/stop server, etc.)\n- manual_test/voice_code/websocket_client.clj - WebSocket client helper using http-kit\n- manual_test/voice_code/test_*.clj - Individual test files\n- Makefile with targets: test-manual-startup, test-manual-protocol, etc.\n- deps.edn :manual-test alias with manual_test as extra path\n\nTests in manual_test/ can invoke Claude CLI (cost money) while regular tests in test/ are free.","status":"closed","priority":0,"issue_type":"task","assignee":"backend","created_at":"2025-10-17T09:58:03.444986-05:00","updated_at":"2025-10-17T16:52:28.05795-05:00","closed_at":"2025-10-17T16:52:28.05795-05:00"}
{"id":"voice-code-103","title":"Manual test: Backend startup and session discovery","description":"","acceptance_criteria":"Server starts successfully, session index loads from disk with correct count, filesystem watcher initializes watching all project subdirectories. File: manual_test/voice_code/test_03_startup.clj. Free to run (no Claude invocations).","notes":"✅ PASSED - All assertions passed. Tests session discovery, metadata extraction, and index persistence.","status":"closed","priority":0,"issue_type":"task","assignee":"backend","created_at":"2025-10-17T09:58:13.184067-05:00","updated_at":"2025-10-17T16:36:22.472262-05:00","closed_at":"2025-10-17T16:36:22.472262-05:00","dependencies":[{"issue_id":"voice-code-103","depends_on_id":"voice-code-102","type":"blocks","created_at":"2025-10-17T09:58:13.185082-05:00","created_by":"travisbrown"}]}
{"id":"voice-code-104","title":"Manual test: WebSocket protocol (connect, subscribe, ping)","description":"","acceptance_criteria":"Connect without session_id returns session-list message. Subscribe returns session-history. Ping returns pong. File: manual_test/voice_code/test_04_protocol.clj. Free to run.","notes":"✅ PASSED (after fixes) - Tests ping/pong, connect→session-list, subscribe→session-history. Fixed to expect session-list instead of old 'connected' message.","status":"closed","priority":0,"issue_type":"task","assignee":"backend","created_at":"2025-10-17T09:58:25.522536-05:00","updated_at":"2025-10-17T16:36:22.472499-05:00","closed_at":"2025-10-17T16:36:22.472499-05:00","dependencies":[{"issue_id":"voice-code-104","depends_on_id":"voice-code-102","type":"blocks","created_at":"2025-10-17T09:58:25.523729-05:00","created_by":"travisbrown"}]}
{"id":"voice-code-105","title":"Manual test: Filesystem watcher (new sessions and updates)","description":"","acceptance_criteria":"Watcher detects new .jsonl file creation, broadcasts session-created message within 2 seconds, metadata includes all fields. File: manual_test/voice_code/test_05_watcher_new.clj. COSTS MONEY (invokes Claude CLI).","notes":"⚠️ RUNS BUT FAILS (~$0.15 spent) - Claude CLI successfully creates sessions, but filesystem watcher doesn't detect new .jsonl files. No session_created/session_updated broadcasts received. Root cause: Watcher not adding new sessions to index in real-time.","status":"closed","priority":0,"issue_type":"task","assignee":"backend","created_at":"2025-10-17T09:58:40.906113-05:00","updated_at":"2025-10-17T16:38:32.889948-05:00","closed_at":"2025-10-17T16:38:32.889948-05:00","dependencies":[{"issue_id":"voice-code-105","depends_on_id":"voice-code-102","type":"blocks","created_at":"2025-10-17T09:58:40.907234-05:00","created_by":"travisbrown"}]}
{"id":"voice-code-106","title":"Manual test: Prompt sending with new_session_id","description":"","acceptance_criteria":"Prompt with new_session_id creates new Claude session, returns ack then response, .jsonl file created with correct session_id, session-created broadcast sent. File: manual_test/voice_code/test_06_prompt_new.clj. COSTS MONEY.","notes":"✅ PASSED (~$0.05 spent) - Creates new Claude session via WebSocket with new_session_id. Verifies .jsonl file creation and proper session ID handling.","status":"closed","priority":0,"issue_type":"task","assignee":"backend","created_at":"2025-10-17T09:58:49.366025-05:00","updated_at":"2025-10-17T16:38:32.890207-05:00","closed_at":"2025-10-17T16:38:32.890207-05:00","dependencies":[{"issue_id":"voice-code-106","depends_on_id":"voice-code-102","type":"blocks","created_at":"2025-10-17T09:58:49.367146-05:00","created_by":"travisbrown"},{"issue_id":"voice-code-106","depends_on_id":"voice-code-111","type":"blocks","created_at":"2025-10-17T11:15:01.228306-05:00","created_by":"travisbrown"}]}
{"id":"voice-code-107","title":"Manual test: Prompt sending with resume_session_id","description":"","acceptance_criteria":"Prompt with resume_session_id appends to existing session, maintains conversation context, .jsonl file appended not recreated, session-updated broadcast if subscribed. File: manual_test/voice_code/test_07_prompt_resume.clj. COSTS MONEY.","notes":"✅ PASSED (~$0.10 spent, after fixes) - Tests resume_session_id maintains context. Claude correctly remembered number 42. Fixed kebab-case field names and project folder detection. Verifies .jsonl file appended not recreated.","status":"closed","priority":0,"issue_type":"task","assignee":"backend","created_at":"2025-10-17T09:58:56.342318-05:00","updated_at":"2025-10-17T16:38:32.890329-05:00","closed_at":"2025-10-17T16:38:32.890329-05:00","dependencies":[{"issue_id":"voice-code-107","depends_on_id":"voice-code-102","type":"blocks","created_at":"2025-10-17T09:58:56.342987-05:00","created_by":"travisbrown"},{"issue_id":"voice-code-107","depends_on_id":"voice-code-111","type":"blocks","created_at":"2025-10-17T11:15:01.243041-05:00","created_by":"travisbrown"}]}
{"id":"voice-code-108","title":"Manual test: Multi-client broadcast","description":"","acceptance_criteria":"Multiple WebSocket clients receive same session-created broadcast, messages identical across clients, broadcast timing within 200ms. File: manual_test/voice_code/test_08_broadcast.clj. Free to run.","notes":"❌ FAILED - Fixture issue (session ID nil) + expects non-existent protocol messages. Needs same fixture fix as test 05 + protocol expectations rewrite.","status":"closed","priority":0,"issue_type":"task","assignee":"backend","created_at":"2025-10-17T09:59:04.004053-05:00","updated_at":"2025-10-17T16:36:22.472804-05:00","closed_at":"2025-10-17T16:36:22.472804-05:00","dependencies":[{"issue_id":"voice-code-108","depends_on_id":"voice-code-102","type":"blocks","created_at":"2025-10-17T09:59:04.005027-05:00","created_by":"travisbrown"},{"issue_id":"voice-code-108","depends_on_id":"voice-code-111","type":"blocks","created_at":"2025-10-17T11:15:01.257464-05:00","created_by":"travisbrown"}]}
{"id":"voice-code-109","title":"Manual test: Error handling","description":"","acceptance_criteria":"Invalid JSON handled gracefully, unknown message types return error, missing required fields return descriptive errors, connection stays open after errors. File: manual_test/voice_code/test_09_errors.clj. Free to run.","notes":"⚠️ PARTIAL (4/6 passing) - Tests 07a-07d pass (prompt before connect, invalid type, missing fields). Tests 07e-07f fail (non-existent resume_session_id, conflicting session IDs). Edge case error handling needs adjustment.","status":"closed","priority":0,"issue_type":"task","assignee":"backend","created_at":"2025-10-17T09:59:11.171127-05:00","updated_at":"2025-10-17T16:36:22.47291-05:00","closed_at":"2025-10-17T16:36:22.47291-05:00","dependencies":[{"issue_id":"voice-code-109","depends_on_id":"voice-code-102","type":"blocks","created_at":"2025-10-17T09:59:11.171909-05:00","created_by":"travisbrown"}]}
{"id":"voice-code-110","title":"Fix WebSocket protocol mismatch in session list response","description":"Test 02 expects 'session-list' message type after connect, but server sends different format. Need to either update server to send session-list message type per STANDARDS.md, or update STANDARDS.md and tests to match actual implementation. Test failure location: backend/manual_test/tests/02_protocol_test.clj:54-56","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-10-17T11:07:09.492876-05:00","updated_at":"2025-10-17T15:15:11.816026-05:00","closed_at":"2025-10-17T15:15:11.816026-05:00"}
{"id":"voice-code-111","title":"Fix Test 07 error: test expects 'connected' message but not receiving it","description":"Test 07 (error handling) sub-test 'test-error-both-new-and-resume-session-id' fails with 'Expected message not received: Connected'. The test expects a 'connected' confirmation after connect message, but isn't receiving it. Need to investigate if this is a test issue or server protocol issue. Location: backend/manual_test/tests/07_error_test.clj:193","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-10-17T11:07:20.215845-05:00","updated_at":"2025-10-17T17:32:16.754825-05:00","closed_at":"2025-10-17T17:32:16.754825-05:00"}
{"id":"voice-code-112","title":"Test 02 subscribe test needs sessions to validate","description":"The subscribe test in Test 02 was skipped because no sessions were available to subscribe to. Need to either: 1) Pre-populate test sessions before running the test, or 2) Make the test create its own session to subscribe to, or 3) Document that this test requires existing sessions. Location: backend/manual_test/tests/02_protocol_test.clj (subscribe test)","notes":"Root cause identified: WebSocket client cannot receive large payloads even with 20 messages. Server successfully sends session-history (logs confirm) but client times out waiting. Solutions: 1) Further reduce to 5-10 messages, 2) Implement pagination, 3) Investigate WebSocket frame size limits. Status: 4/5 protocol tests pass, only subscribe test fails.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-10-17T11:07:29.164746-05:00","updated_at":"2025-10-17T17:33:33.350163-05:00","closed_at":"2025-10-17T17:33:33.350163-05:00"}
{"id":"voice-code-113","title":"Backend optimizations for WebSocket payload size limits","description":"Changes made during manual testing: 1) Limited session-list to 50 most recent sessions (was 663), 2) Limited session-history to 20 most recent messages (was full history), 3) Added validation to reject prompts with both new_session_id and resume_session_id, 4) Changed connect response to send session-list. These prevent WebSocket frame size issues.","acceptance_criteria":"Session list limited to reasonable size, session history limited, validation prevents conflicting parameters","status":"closed","priority":2,"issue_type":"task","assignee":"backend","created_at":"2025-10-17T11:58:42.660512-05:00","updated_at":"2025-10-17T17:33:11.260537-05:00","closed_at":"2025-10-17T17:33:11.260537-05:00"}
{"id":"voice-code-114","title":"Filesystem watcher doesn't detect new Claude sessions","description":"Test 03 revealed that when Claude CLI creates new .jsonl files, the filesystem watcher doesn't detect them or broadcast session_created/session_updated messages.\n\nRoot cause: Watcher not adding new sessions to index in real-time.\n\nSteps to reproduce:\n1. Start backend server\n2. Connect WebSocket client\n3. Create new Claude session via CLI with --session-id \u003cuuid\u003e\n4. Expected: Receive session_created broadcast\n5. Actual: No broadcast received, 'Session not found' when trying to subscribe\n\nFiles involved:\n- backend/src/voice_code/replication.clj (watcher implementation)\n- backend/manual_test/tests/03_watcher_test.clj (test that fails)\n\nImpact: Terminal→iOS sync completely broken. Sessions created from terminal won't appear on iOS.","status":"closed","priority":0,"issue_type":"bug","assignee":"backend","created_at":"2025-10-17T13:17:20.881067-05:00","updated_at":"2025-10-17T15:06:23.026154-05:00","closed_at":"2025-10-17T15:06:23.026154-05:00"}
{"id":"voice-code-115","title":"Test 06 (broadcast) needs fixture and protocol fixes","description":"Test 06 fails due to:\n1. Fixture not running (session ID is nil) - same issue as test 05 had\n2. Test expects protocol messages that don't exist\n\nNeeds:\n- Apply same fixture fix as test 05 (call setup in -main)\n- Update protocol expectations to match actual server behavior\n\nFile: backend/manual_test/tests/06_broadcast_test.clj","status":"closed","priority":2,"issue_type":"bug","assignee":"backend","created_at":"2025-10-17T13:17:20.968818-05:00","updated_at":"2025-10-17T17:15:16.8605-05:00","closed_at":"2025-10-17T17:15:16.8605-05:00"}
{"id":"voice-code-116","title":"Test 07 edge cases fail (07e, 07f)","description":"Test 07 has 4/6 tests passing. Edge case tests fail:\n\n07e (non-existent resume_session_id): \n- Server may handle this differently than expected\n- Need to verify error response format\n\n07f (both new_session_id and resume_session_id):\n- Server correctly validates mutually exclusive params\n- Error message not reaching client properly\n\nFile: backend/manual_test/tests/07_error_test.clj\n\nMay need to adjust server error responses or test expectations.","status":"closed","priority":2,"issue_type":"bug","assignee":"backend","created_at":"2025-10-17T13:17:21.064121-05:00","updated_at":"2025-10-17T17:08:07.593609-05:00","closed_at":"2025-10-17T17:08:07.593609-05:00"}
{"id":"voice-code-117","title":"Session Replication Architecture","description":"Complete implementation of session replication architecture from REPLICATION_ARCHITECTURE.md.\n\nThis epic tracks the migration from iOS session UUID mapping to a unified session replication system where all Claude Code sessions (terminal and iOS) sync to iOS devices via filesystem watching and WebSocket broadcasts.\n\n## Architecture Overview\n- Backend watches ~/.claude/projects for .jsonl files\n- Maintains fast in-memory metadata index\n- Broadcasts session_created/session_updated to all iOS clients\n- iOS stores sessions in CoreData with lazy loading\n- Optimistic UI for instant feedback\n- Client-side filtering for deletion/renaming\n\n## Phases\n**Phase 1: Backend (COMPLETE)** - voice-code-74 through voice-code-86\n- Metadata index system ✓\n- Filesystem watcher ✓\n- Protocol handlers ✓\n- Session naming ✓\n- Manual tests ✓\n\n**Phase 2: iOS (IN PROGRESS)** - voice-code-87 through voice-code-96\n- CoreData schema\n- Session metadata sync\n- Lazy loading\n- Incremental updates\n- Optimistic UI\n- Prompt sending\n- Deletion/renaming\n\n**Phase 3: Testing** - voice-code-141 through voice-code-101\n- Terminal to iOS sync\n- iOS to iOS sync\n- Session forking\n- Deletion workflow\n- Performance testing\n\n## References\n- REPLICATION_ARCHITECTURE.md\n- STANDARDS.md (WebSocket protocol)","acceptance_criteria":"All replication tasks complete (74-101), backend fully tested, iOS implementation complete, end-to-end workflows validated, performance targets met","status":"open","priority":0,"issue_type":"epic","created_at":"2025-10-17T17:45:30.931052-05:00","updated_at":"2025-10-18T14:46:51.29465-05:00"}
{"id":"voice-code-118","title":"Consolidate backend Makefile into root Makefile","description":"The project has two Makefiles: root (iOS tests) and backend/ (Clojure tests). Consolidate into single root Makefile with sections for iOS and backend. Use 'cd backend \u0026\u0026' for backend targets. Maintain all existing targets from both files.","status":"open","priority":2,"issue_type":"task","created_at":"2025-10-17T19:24:34.007544-05:00","updated_at":"2025-10-17T19:24:34.007544-05:00"}
{"id":"voice-code-119","title":"Connection status not refreshed after saving server settings","description":"When configuring server settings for the first time, Test Connection works successfully, but after clicking Save, the app still shows 'disconnected'. The real connection should be refreshed/attempted after saving settings.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-10-17T22:33:31.958921-05:00","updated_at":"2025-10-18T17:23:33.678411-05:00","closed_at":"2025-10-18T17:23:33.678411-05:00"}
{"id":"voice-code-120","title":"Backend sends session_updated with 0 messages after filtering warmup","description":"The handle-file-modified function in replication.clj checks if new-messages is non-empty BEFORE filtering sidechain messages. This causes session_updated messages with empty message arrays to be sent to iOS clients when only warmup messages were added.\n\nBug location: backend/src/voice_code/replication.clj handle-file-modified function\n\nFix: Move the (when (seq new-messages)) check to AFTER (filter-sidechain-messages new-messages)","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-10-18T01:56:33.371738-05:00","updated_at":"2025-10-18T02:46:48.636877-05:00","closed_at":"2025-10-18T02:46:48.636877-05:00"}
{"id":"voice-code-121","title":"Backend re-sends all messages instead of just new ones on session creation","description":"When handle-file-created detects a new session, it doesn't initialize the file-positions atom for that session. This causes subsequent handle-file-modified calls to re-parse the entire file from the beginning, re-sending all messages instead of just new ones.\n\nEvidence: Triple reconciliation in logs (lines 86-88 of console.out) shows all messages being reconciled again after new session creation.\n\nBug location: backend/src/voice_code/replication.clj handle-file-created function\n\nFix: Initialize file-positions when creating session metadata in handle-file-created","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-10-18T01:56:33.587-05:00","updated_at":"2025-10-18T02:46:48.637472-05:00","closed_at":"2025-10-18T02:46:48.637472-05:00"}
{"id":"voice-code-122","title":"Backend includes non-UUID .jsonl files in session list","description":"The extract-session-id-from-path function in replication.clj accepts any .jsonl filename as a valid session ID without validating that it's a UUID. This causes 'Invalid or missing session_id in session data' warnings in iOS when non-UUID .jsonl files exist in Claude projects.\n\nEvidence: Line 8 of console.out shows iOS warning about invalid session_id\n\nBug location: backend/src/voice_code/replication.clj extract-session-id-from-path function\n\nFix: Add UUID validation to extract-session-id-from-path and filter out invalid sessions","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-10-18T01:56:33.802846-05:00","updated_at":"2025-10-18T02:46:48.637907-05:00","closed_at":"2025-10-18T02:46:48.637907-05:00"}
{"id":"voice-code-123","title":"iOS subscribes twice when creating new session","description":"When creating a new session from SessionsView, the app subscribes to the session in two places:\n1. SessionsView.swift:125 - when sending the prompt that creates the session\n2. ConversationView.swift:151 - when the view appears after navigation\n\nThis causes duplicate 'Client subscribing to session' log entries and duplicate optimistic message creation (though messages don't duplicate in UI).\n\nEvidence: Lines 24-27 and 48-49 in console.out show double subscription and double optimistic message creation\n\nBug locations:\n- ios/VoiceCode/Views/SessionsView.swift:125\n- ios/VoiceCode/Views/ConversationView.swift:151\n\nFix: Remove one of the subscribe calls (likely the one in SessionsView since ConversationView should handle subscription)","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-10-18T01:56:35.281828-05:00","updated_at":"2025-10-18T02:46:48.638185-05:00","closed_at":"2025-10-18T02:46:48.638185-05:00"}
{"id":"voice-code-124","title":"Existing sessions not loading - only new UI sessions populate","description":"When the app starts, existing Claude Code sessions from the filesystem are not appearing in the session list. Only newly created sessions from the iOS UI are showing up.\n\nExpected behavior: On app launch, the backend should send session_list with all existing .jsonl files from ~/.claude/projects, and iOS should display them in the SessionsView.\n\nActual behavior: Session list appears empty or only shows sessions created after the app was opened.\n\nThis blocks the ability to resume existing conversations and makes the app appear to lose history.\n\nRelated: This makes voice-code-123 (double subscription) harder to notice, since long-press to open sessions doesn't work if sessions aren't loaded.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-10-18T02:13:02.893514-05:00","updated_at":"2025-10-18T02:46:48.639015-05:00","closed_at":"2025-10-18T02:46:48.639015-05:00"}
{"id":"voice-code-125","title":"Session list interaction is not intuitive - tap vs long-press unclear","description":"The SessionsView interaction model is confusing and doesn't follow iOS conventions:\n\nCurrent behavior:\n- Tapping a session highlights it and shows a checkmark\n- Nothing material happens after the tap\n- Requires long-press to open the session (but this is broken per voice-code-124)\n- The checkbox appears to serve no clear function\n\nExpected behavior (choose one approach):\n\nOption A - Single tap opens session:\n- Tap a session → immediately navigate to ConversationView\n- Remove checkbox UI entirely\n- This matches standard iOS list behavior (Settings, Mail, Messages, etc.)\n\nOption B - Checkbox has real function:\n- Keep checkbox for multi-select (e.g., bulk delete, bulk operations)\n- Add a visible action button or toolbar when sessions are selected\n- Require explicit 'Open' button or different gesture to open a single session\n\nRecommendation: Option A is more intuitive. iOS users expect a single tap on a list item to open it. Checkboxes should only appear during explicit 'Edit' or 'Select' modes.\n\nFiles involved:\n- ios/VoiceCode/Views/SessionsView.swift\n- Session list UI implementation","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-10-18T02:13:05.243116-05:00","updated_at":"2025-10-18T02:46:48.639412-05:00","closed_at":"2025-10-18T02:46:48.639412-05:00"}
{"id":"voice-code-126","title":"Stale session index causes existing sessions not to load messages","description":"The initialize-index! function loads a cached session index from disk without validating it against the filesystem. When the cached index is stale (e.g., from a test run), iOS receives an outdated session list and cannot load messages from existing sessions.\n\nBug: Backend loaded index with 1 test session from /var/folders/temp, but filesystem had 712 real sessions.\nImpact: iOS showed sessions in list but couldn't load their messages (Session not found warnings in backend logs).\nFix: Added validate-index function that checks index count against filesystem and validates sample files exist. Index is rebuilt if validation fails.\nTest coverage: Added test-validate-index with 5 test cases covering all validation scenarios.\nTests passing: 70 tests, 371 assertions, 0 failures.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-10-18T08:50:31.691785-05:00","updated_at":"2025-10-18T08:50:36.180332-05:00","closed_at":"2025-10-18T08:50:36.180332-05:00"}
{"id":"voice-code-127","title":"Case-sensitive session lookup prevents iOS sessions from loading","description":"iOS sends uppercase UUIDs (e.g., 6F362136-EF8D-48FB-87C4-82AC582A2618) but backend files use lowercase (e.g., 6f362136-ef8d-48fb-87c4-82ac582a2618.jsonl). Session lookups in get-session-metadata, subscribe-to-session!, unsubscribe-from-session!, and is-subscribed? were case-sensitive, causing Session not found errors.\n\nRoot cause: iOS generates UUIDs via UUID().uuidString which uses uppercase hex digits. Claude CLI uses lowercase. The session-index map keys are lowercase (from filenames) but lookups did not normalize the input session-id.\n\nFix: Modified 4 functions in replication.clj to normalize session-id to lowercase using str/lower-case before lookups or set operations.\n\nTest coverage: Added test-case-insensitive-session-operations with 4 test scenarios covering all case combinations.\n\nBug locations: backend/src/voice_code/replication.clj and backend/test/voice_code/replication_test.clj\n\nTests passing: 71 tests, 388 assertions, 0 failures.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-10-18T09:06:54.459358-05:00","updated_at":"2025-10-18T09:06:59.507565-05:00","closed_at":"2025-10-18T09:06:59.507565-05:00"}
{"id":"voice-code-128","title":"Backend: Index keys are uppercase but lookups use lowercase","description":"Case-sensitivity mismatch in session index. Index is built with uppercase UUID keys from filenames, but get-session-metadata normalizes to lowercase for lookups. This causes sessions with uppercase UUIDs (from iOS) to appear missing even though they exist on disk.\n\nRoot cause: build-index! in replication.clj:175-195 uses session-id as-is from filename (uppercase), but get-session-metadata:279-282 normalizes to lowercase.\n\nFix: Normalize session-id to lowercase in build-index! before using as map key: (assoc acc (str/lower-case session-id) metadata)\n\nImpact: ~11+ sessions with uppercase UUIDs cannot be found via lookup despite being in the index.","status":"open","priority":1,"issue_type":"bug","created_at":"2025-10-18T10:44:06.534053-05:00","updated_at":"2025-10-18T10:44:06.534053-05:00"}
{"id":"voice-code-129","title":"Delete SessionManagerTests.swift (tests deleted SessionManager)","description":"SessionManagerTests.swift (208 lines, 14 tests) tests the SessionManager class that was deleted in commit 0ae654a during the architecture consolidation.\n\nSince SessionManager no longer exists (replaced by CoreData CDSession), these tests are obsolete and should be deleted.\n\nFile: ios/VoiceCodeTests/SessionManagerTests.swift\n\nContext: We consolidated the app to use CoreData exclusively, removing the old in-memory SessionManager and Session models.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-10-18T12:16:32.535702-05:00","updated_at":"2025-10-18T12:21:49.847435-05:00","closed_at":"2025-10-18T12:21:49.847435-05:00"}
{"id":"voice-code-130","title":"Clean up ModelTests.swift (remove Session tests, keep Message tests)","description":"ModelTests.swift (153 lines, 9 tests) tests both Message and Session models.\n\nKeep: Message tests - Message struct is still used as a DTO for WebSocket communication\nRemove: Session tests - Session struct was deleted in commit 0ae654a (replaced by CDSession)\n\nSession-related tests to remove:\n- testSessionCreation\n- testSessionAddMessage  \n- testSessionUpdateClaudeSessionId\n- testSessionCodable\n\nMessage tests are still valid since Message is used by VoiceCodeClient.\n\nFile: ios/VoiceCodeTests/ModelTests.swift","status":"closed","priority":1,"issue_type":"task","created_at":"2025-10-18T12:16:32.658287-05:00","updated_at":"2025-10-18T12:21:49.848087-05:00","closed_at":"2025-10-18T12:21:49.848087-05:00"}
{"id":"voice-code-131","title":"Better label non-user messages (tool results, etc.)","description":"Currently tool call results and other system messages show as 'User' role. We should distinguish these from actual user prompts so that 'User' label is reserved only for real prompts from a person. This will make the conversation view clearer about what is actually user input vs tool output or other content types.","status":"open","priority":2,"issue_type":"task","created_at":"2025-10-18T13:30:57.169958-05:00","updated_at":"2025-10-18T13:30:57.169958-05:00"}
{"id":"voice-code-132","title":"Improve long-press menu focus to highlight entire message","description":"When long-pressing on a message to get the Copy / Read Aloud menu, it would look better if the entire message container was in focus rather than just the text box. This is a nice-to-have UX improvement for better visual feedback.","status":"open","priority":3,"issue_type":"task","created_at":"2025-10-18T13:30:57.545725-05:00","updated_at":"2025-10-18T13:30:57.545725-05:00"}
{"id":"voice-code-133","title":"Group sessions by working directory on Sessions page","description":"Organize the main Sessions page to show the cwd (current working directory) as the group title for each session group. Sorting of cwd directories should remain time-based so that the directory with the most recent session appears at the top. This will help users navigate sessions by project/directory context.","notes":"Implementation complete:\n- Sessions now grouped by working directory in SessionsView\n- Groups sorted by most recent modification date\n- Sessions within each group sorted by modification date\n- Each section header shows directory path and session count\n- + button in each section header pre-populates create dialog with that directory\n- Main + button in toolbar pre-populates with most recently used directory\n- 9 comprehensive tests added and passing in SessionGroupingTests.swift\n\nRemaining: Manual testing in iOS app to verify UI behavior","status":"in_progress","priority":2,"issue_type":"task","created_at":"2025-10-18T13:30:57.905318-05:00","updated_at":"2025-10-18T14:55:16.67994-05:00"}
{"id":"voice-code-134","title":"Remove Tailscale setup from Help (or remove Help entirely)","description":"Remove the Tailscale setup information from the Help section. We don't want third-party product names like that in our product. Consider whether the entire Help section should be removed or if it should contain different content.","status":"open","priority":1,"issue_type":"task","created_at":"2025-10-18T13:30:58.257246-05:00","updated_at":"2025-10-18T13:30:58.257246-05:00"}
{"id":"voice-code-135","title":"Add config setting for default directory for new sessions","description":"Add a configuration setting in the iOS app that allows the user to optionally specify a default directory for new sessions. Currently defaults to / when one is not provided. Need to determine if this requires frontend-only changes or also backend modifications.","status":"open","priority":2,"issue_type":"task","created_at":"2025-10-18T13:30:58.577266-05:00","updated_at":"2025-10-18T13:30:58.577266-05:00"}
{"id":"voice-code-136","title":"Fix session auto-closing issue (some sessions still affected)","description":"Some sessions (not all) are still auto-closing after being opened, despite the previous fix in commit 7f40d7e that made session an @ObservedObject. Previous context: User reported session opening then immediately closing. Logs showed session opens, receives session_history with 0 messages (backend filtered sidechain messages), then onDisappear fires and session unsubscribes. Need to investigate why this still happens for some sessions after the property wrapper fix.","status":"open","priority":1,"issue_type":"bug","created_at":"2025-10-18T13:30:59.360045-05:00","updated_at":"2025-10-18T13:30:59.360045-05:00"}
{"id":"voice-code-137","title":"Fix 'Sending...' spinner to stop when backend receives message","description":"The 'Sending...' spinner currently keeps spinning until Claude Code responds to the user's message. Under our new async architecture, it should stop as soon as the backend receives the message (when we get backend acknowledgment), not wait for the full Claude response. This will provide better user feedback about message delivery status.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-10-18T13:31:00.290468-05:00","updated_at":"2025-10-18T13:31:00.290468-05:00"}
{"id":"voice-code-138","title":"Add clearable server errors list feature","description":"Create a feature to show a list of server errors that can be cleared by the user. Currently transient errors appear below the 'Tap to Speak' button. Consider options: keep current inline error display, or add a button/icon that navigates to a dedicated errors view where users can see error history and clear individual or all errors. This will provide better error visibility and management for users dealing with connection or server issues.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-10-18T13:31:47.330169-05:00","updated_at":"2025-10-18T13:31:47.330169-05:00"}
{"id":"voice-code-139","title":"Backend: Index keys are uppercase but lookups use lowercase","description":"Case-sensitivity mismatch in session index. Index is built with uppercase UUID keys from filenames, but get-session-metadata normalizes to lowercase for lookups. This causes sessions with uppercase UUIDs (from iOS) to appear missing even though they exist on disk.\n\nRoot cause: build-index! in replication.clj:175-195 uses session-id as-is from filename (uppercase), but get-session-metadata:279-282 normalizes to lowercase.\n\nFix: Normalize session-id to lowercase in build-index! before using as map key: (assoc acc (str/lower-case session-id) metadata)\n\nImpact: ~11+ sessions with uppercase UUIDs cannot be found via lookup despite being in the index.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-10-18T14:46:51.293635-05:00","updated_at":"2025-10-18T18:26:46.133435-05:00","closed_at":"2025-10-18T18:26:46.133435-05:00"}
{"id":"voice-code-140","title":"Test iOS to iOS sync","description":"End-to-end test: iOS session syncs to other iOS clients.\n\nSteps:\n1. Start backend and iOS app\n2. Create new session from iOS (send prompt with new_session_id)\n3. Backend creates .jsonl file\n4. Verify filesystem watcher detects new file\n5. Verify messages sync via session_updated\n6. Connect second iOS client\n7. Verify session appears in session_list\n8. Verify can subscribe and see full history","acceptance_criteria":"iOS sessions create backend files, sync via file watching works, other iOS clients receive sessions, full history available","status":"open","priority":0,"issue_type":"task","created_at":"2025-10-18T14:46:51.293861-05:00","updated_at":"2025-10-18T14:46:51.293861-05:00","dependencies":[{"issue_id":"voice-code-140","depends_on_id":"voice-code-117","type":"parent-child","created_at":"2025-10-18T14:46:51.300791-05:00","created_by":"import-remap"}]}
{"id":"voice-code-141","title":"Test terminal to iOS sync","description":"End-to-end test: terminal session appears on iOS.\n\nSteps:\n1. Start backend and iOS app\n2. Create new Claude session from terminal\n3. Verify iOS receives session_created message\n4. Verify session appears in iOS session list\n5. Verify auto-subscription works\n6. Send prompt from terminal\n7. Verify iOS receives session_updated\n8. Verify messages display correctly","acceptance_criteria":"Terminal sessions appear on iOS, auto-subscription works, messages sync correctly, end-to-end flow complete","status":"open","priority":0,"issue_type":"task","created_at":"2025-10-18T14:46:51.294039-05:00","updated_at":"2025-10-18T14:46:51.294039-05:00","dependencies":[{"issue_id":"voice-code-141","depends_on_id":"voice-code-117","type":"parent-child","created_at":"2025-10-18T14:46:51.300027-05:00","created_by":"import-remap"}]}
{"id":"voice-code-142","title":"Unknown message type 'session_deleted' in WebSocket handler","description":"Console shows WARNING: Unknown message type {:type session_deleted}\n\nThe WebSocket message handler is receiving messages with type 'session_deleted' but has no handler for this message type.\n\nNeeds investigation:\n1. Is this a valid message type that should be handled?\n2. Should it be added to the WebSocket protocol spec in STANDARDS.md?\n3. Or is something incorrectly sending this message type?\n\nCurrent protocol (per STANDARDS.md) defines: connect, prompt, set_directory, ping, message_ack (client→backend) and hello, connected, ack, response, error, pong, replay (backend→client).\n\n'session_deleted' is not in the spec.","status":"open","priority":1,"issue_type":"bug","created_at":"2025-10-18T14:46:51.303618-05:00","updated_at":"2025-10-18T14:46:51.303618-05:00"}
{"id":"voice-code-143","title":"Auto-speak for active session not working","description":"Auto-speak functionality is not working for the active session - responses never trigger speech output.\n\nExpected behavior: When a session has auto-speak enabled and receives a response from Claude, the response should be automatically spoken.\n\nActual behavior: Responses are received but never spoken, even when auto-speak is enabled.\n\nNeeds investigation:\n1. Is the auto-speak flag being properly stored/retrieved from session state?\n2. Is the response handler checking the auto-speak flag?\n3. Is the speech synthesis being triggered with the response text?\n4. Are there any errors in the audio/speech pipeline?\n5. Does manual 'speak' work, indicating this is specifically an auto-trigger issue?","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-10-18T14:48:27.130115-05:00","updated_at":"2025-10-18T15:55:47.852565-05:00","closed_at":"2025-10-18T15:55:47.852565-05:00"}
{"id":"voice-code-144","title":"Session messages showing 'No messages yet' despite having messages","description":"Bug: Sessions displayed '11 messages' on list page but showed 'No messages yet' when opened\n\nRoot Cause:\n- System messages have different structure: {type: 'system', content: '...'}\n- User/Assistant messages: {type: 'user/assistant', message: {content: '...'}}\n- iOS extractText() only checked for nested message.content, failing for system messages\n- This caused 'Invalid message data, missing role or text' errors (12 occurrences in console)\n\nFix Applied:\n- Updated extractText() in SessionSyncManager.swift:424-466 to handle both formats\n- First checks nested message.content (user/assistant)\n- Falls back to top-level content (system messages)\n- Added 2 new tests: testExtractTextFromSystemMessage, testExtractTextFromSystemMessageWithPlainContent\n- All 25 SessionSyncManager tests pass\n\nFiles Modified:\n- ios/VoiceCode/Managers/SessionSyncManager.swift (extractText function)\n- ios/VoiceCodeTests/SessionSyncManagerTests.swift (added 2 tests)\n\nImpact: System messages (like /status commands) now display correctly in conversation view","notes":"COMPLETE FIX: Added support for all 3 message formats (user/assistant/system/summary). All 26 tests pass. Summary messages with 'summary' field now display correctly.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-10-18T15:08:37.738898-05:00","updated_at":"2025-10-18T15:18:51.995902-05:00","closed_at":"2025-10-18T15:18:51.995904-05:00"}
{"id":"voice-code-145","title":"Hide server sessions with zero or only system messages","description":"Feature: Hide sessions that were created on the server (not in the frontend) if they have zero messages or only contain system messages.\n\nContext:\n- Some sessions appear in the list but contain no useful content\n- These sessions clutter the UI and provide no value to users\n- Only affects server-created sessions (not user-initiated sessions from FE)\n\nAcceptance Criteria:\n- Sessions created in frontend are always shown (regardless of content)\n- Server sessions with 0 messages are hidden from session list\n- Server sessions with only system messages are hidden from session list\n- Server sessions with at least one user/assistant/summary message are shown\n- Filtering happens in SessionsView after fetching from CoreData\n\nImplementation Notes:\n- Add field to CDSession to track if session was created in frontend\n- Update SessionsListView to filter out server sessions with no/system-only content\n- May need to check message types in CoreData query or computed property\n- Consider performance impact of filtering large session lists\n\nRelated:\n- voice-code-144 (message parsing fixes)\n- voice-code-133 (session grouping)","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-10-18T15:44:18.444234-05:00","updated_at":"2025-10-18T17:45:44.996521-05:00","closed_at":"2025-10-18T17:45:44.996521-05:00"}
{"id":"voice-code-146","title":"Filter summary messages from iOS display","description":"Summary messages (like 401 errors) are being synced to iOS and displayed to users. These are Claude Code internal messages that should be filtered out.\n\nRoot cause: SessionSyncManager.handleSessionUpdated processes all message types without filtering.\n\nFix: Add filtering in handleSessionUpdated to skip messages where type == 'summary'\n\nImpact: Users see confusing error messages that aren't relevant to their conversations.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-10-18T16:33:03.845951-05:00","updated_at":"2025-10-18T16:35:23.86677-05:00","closed_at":"2025-10-18T16:35:23.86677-05:00"}
{"id":"voice-code-147","title":"Filter system messages from iOS display","description":"System messages (like local command notifications) are being synced to iOS and displayed to users. These are Claude Code internal messages that should be filtered out.\n\nRoot cause: SessionSyncManager.handleSessionUpdated processes all message types without filtering.\n\nFix: Add filtering in handleSessionUpdated to skip messages where type == 'system'\n\nImpact: Users see internal system notifications that clutter their conversation view.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-10-18T16:33:04.291713-05:00","updated_at":"2025-10-18T16:35:23.867415-05:00","closed_at":"2025-10-18T16:35:23.867415-05:00"}
{"id":"voice-code-148","title":"Write tests for message type filtering","description":"Add tests to SessionSyncManagerTests to verify that summary and system messages are filtered out during sync.\n\nTest cases:\n1. Verify summary messages are not created in CoreData\n2. Verify system messages are not created in CoreData\n3. Verify user and assistant messages are still created\n4. Verify message count is correct after filtering","status":"closed","priority":1,"issue_type":"task","created_at":"2025-10-18T16:33:09.636768-05:00","updated_at":"2025-10-18T16:35:23.867857-05:00","closed_at":"2025-10-18T16:35:23.867857-05:00"}
{"id":"voice-code-149","title":"Delete existing summary/system messages from iOS CoreData","description":"After implementing message filtering, existing summary and system messages are still in the iOS CoreData database and visible to users.\n\nSolution: Add a one-time migration/cleanup that deletes all CDMessage records where role == 'summary' or role == 'system'.\n\nThis should run on app launch after the filtering code is deployed.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-10-18T16:39:40.447372-05:00","updated_at":"2025-10-18T16:55:46.861526-05:00","closed_at":"2025-10-18T16:55:46.861526-05:00"}
{"id":"voice-code-150","title":"Default to first premium voice on first launch","description":"When the app is installed and launched for the first time, automatically select the first available premium voice instead of defaulting to a basic voice.\n\nCurrent behavior: App likely defaults to first available voice regardless of quality\n\nDesired behavior:\n1. On first launch, check if any premium voices are available\n2. If premium voices exist, set the default to the first premium voice\n3. If no premium voices, fall back to first available voice\n4. Store this selection in AppSettings so it persists\n\nImplementation:\n- Add first-launch detection (using UserDefaults flag)\n- Query AVSpeechSynthesisVoice.speechVoices() for premium voices\n- Filter for premium quality voices\n- Set default voice in AppSettings\n- Mark first-launch as complete\n\nBenefits: Better out-of-box experience with higher quality voice synthesis","status":"open","priority":2,"issue_type":"feature","created_at":"2025-10-18T16:46:17.66643-05:00","updated_at":"2025-10-18T16:46:17.66643-05:00"}
{"id":"voice-code-151","title":"Refresh sessions list after server settings update","description":"When server configuration is updated in settings, the sessions list does not refresh automatically. Users must exit and restart the app to see the sessions populate.\n\nCurrent behavior:\n1. User updates server URL/port in settings\n2. User saves settings\n3. Sessions list remains empty\n4. User must force quit and restart app to see sessions\n\nExpected behavior:\n1. User updates server URL/port in settings\n2. User saves settings\n3. App automatically reconnects to new server\n4. Sessions list refreshes and populates with sessions from new server\n\nImplementation:\n- In SettingsView, after saving server settings, trigger client.reconnect()\n- SessionsListView should observe connection state changes\n- When connection is established, automatically request sessions list\n- Clear any cached sessions from previous server\n\nRelated to voice-code-119 (connection status refresh) but specifically about sessions list population.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-10-18T16:50:19.854885-05:00","updated_at":"2025-10-18T17:23:33.76711-05:00","closed_at":"2025-10-18T17:23:33.76711-05:00"}
{"id":"voice-code-152","title":"Auto-read uses wrong voice instead of configured voice","description":"Auto-read for new messages was using default system voice instead of the user's configured voice from Settings.\n\nRoot cause: SessionSyncManager.handleSessionUpdated:309 called speak(text) without passing the voiceIdentifier parameter.\n\nFix: \n- Added appSettings parameter to SessionSyncManager\n- Updated speak() call to pass settings.selectedVoiceIdentifier\n- Wired appSettings through VoiceCodeClient → SessionSyncManager\n- Added tests to verify voice configuration path\n\nFiles changed:\n- SessionSyncManager.swift: Added appSettings parameter, updated speak() call\n- VoiceCodeClient.swift: Added appSettings parameter, passed to SessionSyncManager\n- VoiceCodeApp.swift: Passed settings when creating VoiceCodeClient\n- ReadAloudTests.swift: Added tests for voice selection\n\nImpact: Auto-read now respects user's voice selection from Settings.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-10-18T17:54:18.946102-05:00","updated_at":"2025-10-18T17:54:24.337426-05:00","closed_at":"2025-10-18T17:54:24.337427-05:00"}
{"id":"voice-code-153","title":"Centralize voice selection to prevent inconsistency","description":"","notes":"Centralized voice management in VoiceOutputManager to prevent voice selection inconsistency. VoiceOutputManager now owns AppSettings and provides speak(text) for automatic voice selection and speakWithVoice(text, voiceIdentifier:) for overrides. Removed appSettings from SessionSyncManager and VoiceCodeClient. All call sites now use consistent voice.","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-10-18T18:04:05.900756-05:00","updated_at":"2025-10-18T18:04:20.73323-05:00","closed_at":"2025-10-18T18:04:20.733231-05:00"}
{"id":"voice-code-154","title":"Fix subscription loss on reconnection","description":"Implement client-side fix to restore subscriptions when iOS app reconnects to backend after network interruption. Current issue: ConversationView subscribes on onAppear, but reconnection doesn't trigger onAppear, causing message loss.\n\nSolution: Track active subscriptions in VoiceCodeClient and automatically resubscribe on reconnection.\n\nBenefits:\n- Zero backend changes (no deployment coordination)\n- Fixes root cause immediately\n- Low risk, high confidence\n- Can ship independently\n\nSee RECONNECTION_FIX_REVIEW.md for full analysis.","status":"open","priority":0,"issue_type":"epic","created_at":"2025-10-18T19:48:45.411368-05:00","updated_at":"2025-10-18T19:48:45.411368-05:00"}
{"id":"voice-code-155","title":"Track active subscriptions in VoiceCodeClient","description":"Add activeSubscriptions property to VoiceCodeClient to track which sessions are currently subscribed.\n\nImplementation:\n- Add private var activeSubscriptions = Set\u003cString\u003e()\n- Update subscribe() to insert session ID into set\n- Update unsubscribe() to remove session ID from set\n- Track subscriptions across reconnections\n\nLocation: ios/VoiceCode/Managers/VoiceCodeClient.swift\n\nCurrent code:\n- subscribe() at line 327\n- unsubscribe() at line 336","status":"closed","priority":0,"issue_type":"task","created_at":"2025-10-18T19:48:54.058524-05:00","updated_at":"2025-10-18T19:58:32.716368-05:00","closed_at":"2025-10-18T19:58:32.71637-05:00"}
{"id":"voice-code-156","title":"Implement auto-resubscribe on reconnection","description":"Restore subscriptions when client reconnects to backend after network interruption.\n\nImplementation:\n- In handleMessage() under connected case (line 187-193)\n- After reconnectionAttempts = 0\n- Iterate through activeSubscriptions set\n- Call subscribe() for each session ID\n- Log resubscription activity\n\nLocation: ios/VoiceCode/Managers/VoiceCodeClient.swift:187-193\n\nDepends on: voice-code-155 (subscription tracking)","status":"closed","priority":0,"issue_type":"task","created_at":"2025-10-18T19:49:05.213538-05:00","updated_at":"2025-10-18T19:58:37.253864-05:00","closed_at":"2025-10-18T19:58:37.253865-05:00","dependencies":[{"issue_id":"voice-code-156","depends_on_id":"voice-code-155","type":"blocks","created_at":"2025-10-18T19:49:05.215214-05:00","created_by":"travisbrown"}]}
{"id":"voice-code-157","title":"Add unit tests for subscription tracking","description":"Write unit tests to verify subscription tracking behavior.\n\nTest cases:\n1. Subscribe adds session ID to activeSubscriptions\n2. Unsubscribe removes session ID from activeSubscriptions\n3. Multiple subscribe calls are idempotent\n4. Multiple unsubscribe calls are safe\n5. activeSubscriptions persists across method calls\n\nLocation: ios/VoiceCodeTests/VoiceCodeClientTests.swift\n\nUse existing test patterns from VoiceCodeClientTests.swift","status":"closed","priority":1,"issue_type":"task","created_at":"2025-10-18T19:49:10.224077-05:00","updated_at":"2025-10-18T19:58:37.263771-05:00","closed_at":"2025-10-18T19:58:37.263772-05:00","dependencies":[{"issue_id":"voice-code-157","depends_on_id":"voice-code-155","type":"blocks","created_at":"2025-10-18T19:49:10.225518-05:00","created_by":"travisbrown"}]}
{"id":"voice-code-158","title":"Add integration test for reconnection scenario","description":"Create integration test to verify subscriptions are restored after reconnection.\n\nTest scenario:\n1. Connect client and subscribe to session A\n2. Simulate network disconnect (close WebSocket)\n3. Reconnect client (new WebSocket connection)\n4. Verify subscribe message sent for session A\n5. Verify session updates are received\n\nLocation: ios/VoiceCodeTests/IntegrationTests.swift or new file\n\nMock WebSocket connection to simulate disconnect/reconnect cycle","status":"closed","priority":1,"issue_type":"task","created_at":"2025-10-18T19:49:15.468219-05:00","updated_at":"2025-10-18T19:58:37.273387-05:00","closed_at":"2025-10-18T19:58:37.273389-05:00","dependencies":[{"issue_id":"voice-code-158","depends_on_id":"voice-code-156","type":"blocks","created_at":"2025-10-18T19:49:15.470389-05:00","created_by":"travisbrown"}]}
{"id":"voice-code-159","title":"Manual test: Verify subscription restore on network interruption","description":"Manually validate that subscriptions are restored after real network interruption.\n\nTest procedure:\n1. Launch iOS app and connect to backend\n2. Open ConversationView for session A\n3. Verify subscription sent (check logs)\n4. Enable airplane mode to force disconnect\n5. From terminal, send prompt to session A (creates new message)\n6. Disable airplane mode to reconnect\n7. Verify iOS receives connected message\n8. Verify iOS sends subscribe message for session A\n9. Verify new message appears in ConversationView\n\nSuccess criteria:\n- Message appears without manual refresh\n- No user intervention required\n- Logs show resubscription occurred\n\nLocation: Manual testing on physical device or simulator with network conditioning","status":"open","priority":0,"issue_type":"task","created_at":"2025-10-18T19:49:23.008287-05:00","updated_at":"2025-10-18T19:49:23.008287-05:00","dependencies":[{"issue_id":"voice-code-159","depends_on_id":"voice-code-156","type":"blocks","created_at":"2025-10-18T19:49:23.010743-05:00","created_by":"travisbrown"}]}
{"id":"voice-code-160","title":"Test edge case: Multiple sessions in navigation stack","description":"Validate that multiple backgrounded ConversationViews maintain subscriptions across reconnection.\n\nTest procedure:\n1. Open ConversationView for session A\n2. Navigate to session B (A is backgrounded in nav stack)\n3. Navigate to session C (A and B are backgrounded)\n4. Enable airplane mode\n5. From terminal, send prompts to sessions A, B, and C\n6. Disable airplane mode\n7. Verify all three sessions resubscribe\n8. Navigate back through stack: C -\u003e B -\u003e A\n9. Verify all messages appeared in each session\n\nSuccess criteria:\n- All three sessions show new messages\n- No messages lost during reconnection\n- Backgrounded sessions continue receiving updates\n\nEdge case validation for multi-session UI pattern","status":"open","priority":1,"issue_type":"task","created_at":"2025-10-18T19:49:30.148777-05:00","updated_at":"2025-10-18T19:49:30.148777-05:00","dependencies":[{"issue_id":"voice-code-160","depends_on_id":"voice-code-156","type":"blocks","created_at":"2025-10-18T19:49:30.150979-05:00","created_by":"travisbrown"}]}
{"id":"voice-code-161","title":"Test edge case: Reconnection during active prompt","description":"Validate behavior when network interruption occurs while prompt is being processed.\n\nTest procedure:\n1. Open ConversationView for session A\n2. Send prompt that takes \u003e5 seconds to process\n3. During processing, enable airplane mode\n4. Wait for disconnect\n5. Disable airplane mode to reconnect\n6. Verify subscription restored\n7. Verify response appears when Claude completes\n\nSuccess criteria:\n- Response arrives after reconnection\n- No duplicate prompts sent\n- UI shows correct status during reconnection\n\nTests interaction between optimistic messages, prompt processing, and reconnection","status":"open","priority":2,"issue_type":"task","created_at":"2025-10-18T19:49:36.541486-05:00","updated_at":"2025-10-18T19:49:36.541486-05:00","dependencies":[{"issue_id":"voice-code-161","depends_on_id":"voice-code-156","type":"blocks","created_at":"2025-10-18T19:49:36.543455-05:00","created_by":"travisbrown"}]}
{"id":"voice-code-162","title":"Add logging for subscription lifecycle debugging","description":"Enhance logging to make subscription lifecycle visible for debugging.\n\nAdd logging for:\n- Subscribe: session ID added to activeSubscriptions\n- Unsubscribe: session ID removed from activeSubscriptions\n- Reconnection: list of sessions being resubscribed\n- State: current activeSubscriptions count\n\nFormat:\n- Use consistent prefix: [VoiceCodeClient:Subscriptions]\n- Include session ID (first 8 chars for brevity)\n- Log at appropriate levels (debug for routine, info for reconnection)\n\nLocation: ios/VoiceCode/Managers/VoiceCodeClient.swift\n\nEnables easier troubleshooting of subscription issues in production","status":"open","priority":2,"issue_type":"task","created_at":"2025-10-18T19:49:46.044792-05:00","updated_at":"2025-10-18T19:49:46.044792-05:00","dependencies":[{"issue_id":"voice-code-162","depends_on_id":"voice-code-155","type":"blocks","created_at":"2025-10-18T19:49:46.047052-05:00","created_by":"travisbrown"}]}
{"id":"voice-code-163","title":"Update documentation with reconnection behavior","description":"Document the subscription restoration behavior in relevant files.\n\nUpdates needed:\n1. Add section to STANDARDS.md WebSocket Protocol explaining auto-resubscribe\n2. Update architecture notes about client-side subscription tracking\n3. Document expected behavior on reconnection\n\nLocation: STANDARDS.md (WebSocket Protocol section)\n\nInclude:\n- How activeSubscriptions are tracked\n- When resubscription occurs (on connected message)\n- User-visible behavior (transparent reconnection)\n\nEnsures future developers understand the reconnection mechanism","status":"open","priority":2,"issue_type":"task","created_at":"2025-10-18T19:49:55.373695-05:00","updated_at":"2025-10-18T19:49:55.373695-05:00","dependencies":[{"issue_id":"voice-code-163","depends_on_id":"voice-code-159","type":"blocks","created_at":"2025-10-18T19:49:55.374956-05:00","created_by":"travisbrown"}]}
{"id":"voice-code-164","title":"Backend: extract-working-dir only reads first line, misses cwd in warmup messages","description":"When session files start with error/summary messages before warmup, extract-working-dir reads first line which has no cwd field, falls back to placeholder working directory.\n\nRoot cause: replication.clj:90-119 extract-working-dir only reads first line with (first (line-seq rdr))\n\nExample session 5c5198ac-f97a-4e3f-9e4b-dcc61c0a3769:\n- Line 1-2: type=summary error messages (no cwd)\n- Line 3: Warmup message with cwd=/Users/travisbrown/code/mono/active/voice-code\n- Index has: working-directory=[from project: -Users-travisbrown-code-mono-active-voice-code]\n\nImpact: iOS app receives placeholder paths, commands fail with 'No such file or directory'\n\nFix: Search first N lines (e.g., 10) for cwd field instead of only first line\nAlternative: Filter out non-user/assistant messages when searching for cwd","notes":"When session files start with error/summary messages before warmup, extract-working-dir reads first line which has no cwd field, falls back to placeholder working directory.\n\nRoot cause: replication.clj:90-119 extract-working-dir only reads first line with (first (line-seq rdr))\n\nWhen cwd not found, falls back to project-name-\u003eworking-dir which derives path from parent directory name. Directory names like -Users-travisbrown-code-mono-active-voice-code use dashes instead of slashes. Function detects dash prefix and returns placeholder: [from project: -Users-travisbrown-code-mono-active-voice-code]\n\nExample session 5c5198ac-f97a-4e3f-9e4b-dcc61c0a3769:\n- Line 1-2: type=summary error messages (no cwd)\n- Line 3: Warmup message with cwd=/Users/travisbrown/code/mono/active/voice-code\n- Backend reads line 1, no cwd found, uses placeholder\n- Index stores: working-directory=[from project: -Users-travisbrown-code-mono-active-voice-code]\n- iOS receives placeholder, tries to use as actual path\n- Commands fail: Cannot run program in directory [from project: ...] No such file or directory\n\nImpact: iOS app receives invalid paths, all commands fail\n\nFix: Search first N lines (e.g., 10) for cwd field instead of only first line","status":"open","priority":0,"issue_type":"bug","created_at":"2025-10-19T15:33:11.968687-05:00","updated_at":"2025-10-19T15:45:48.554365-05:00"}
{"id":"voice-code-165","title":"iOS: Sessions not appearing after server restart despite being recent","description":"User reports that some recent sessions (from today Oct 19) don't appear in iOS app even after restarting both backend and frontend.\n\nInvestigation findings:\n- Backend has 819 total sessions, 32 from today\n- Backend filters to top 50 most recent sessions (message-count \u003e 0)\n- 50th session is from Oct 11, so all Oct 19 sessions should be included\n- Commit 9df78db added clearAllSessions() and auto-restore subscriptions\n\nPossible causes:\n1. clearAllSessions() clears CoreData but auto-restored subscriptions might restore sessions not in top 50\n2. Race condition between session_list and auto-restored subscriptions\n3. handleSessionHistory doesn't check if session exists in CoreData (line 95-100 SessionSyncManager.swift)\n4. Filter logic in handleSessionCreated (lines 57-62) might be too aggressive\n\nNeed to:\n- Verify which sessions are missing from iOS\n- Check iOS logs for warnings about 'Session not found for history'\n- Test subscription restoration with sessions outside top 50\n- Consider whether 50-session limit is appropriate or needs to be configurable","status":"open","priority":1,"issue_type":"bug","created_at":"2025-10-19T15:34:43.787874-05:00","updated_at":"2025-10-19T15:34:43.787874-05:00"}
{"id":"voice-code-166","title":"iOS: Cannot create new sessions - filtered out by messageCount \u003e 0 predicate","description":"User flow broken: Cannot create new sessions in iOS app. When user taps New Session button, enters name and working directory, and saves, the session disappears immediately and user cannot find it to send the first prompt.\n\nUSER BEHAVIOR:\n1. User opens iOS app (SessionsView shows list of sessions from backend)\n2. User taps + button to create new session\n3. User enters session name and working directory in NewSessionView\n4. User taps Save/Create\n5. Sheet dismisses but new session does NOT appear in SessionsView list\n6. User cannot find session to send initial prompt\n7. No prompt ever reaches backend, no session file created\n\nROOT CAUSE:\nSessionsView.swift line 15-17 uses fetchActiveSessions() to display sessions\nCDSession.swift line 35 has predicate: markedDeleted == NO AND messageCount \u003e 0\nWhen createNewSession() creates session (SessionsView.swift line 152-179), it sets messageCount = 0\nFetch request immediately filters out the new session because messageCount is 0\nSession exists in CoreData but is invisible in UI\n\nHISTORY:\nThis broke in commit e2d76d9 which added 3-layer zero-message filtering:\n- Layer 1: Backend don't broadcast if messageCount = 0\n- Layer 2: iOS Database filter messageCount \u003e 0 (THIS IS THE PROBLEM)\n- Layer 3: iOS Handler validate messageCount in handleSessionCreated\n\nLayer 2 was intended to hide old empty sessions from backend, but it also hides brand new locally-created sessions before user can send first message.\n\nFIX OPTIONS:\n\nOption 1: Remove messageCount \u003e 0 from fetchActiveSessions predicate\n- Simple, allows all non-deleted sessions to show\n- Old empty sessions from backend would reappear (bad UX)\n\nOption 2: Add flag to distinguish local vs backend sessions\n- Add isLocallyCreated boolean to CDSession\n- Set true when created in createNewSession()\n- Predicate: markedDeleted == NO AND (messageCount \u003e 0 OR isLocallyCreated == YES)\n- Clear flag when first message arrives from backend\n- Prevents old empty backend sessions while allowing new local ones\n\nOption 3: Don't create session until first prompt sent\n- Refactor: Hold session name/workingDir in state\n- Show temporary new session UI\n- Create CDSession only when user sends first prompt\n- More complex, changes UX flow\n\nRECOMMENDED: Option 2\nCleanest separation between locally-created sessions (which should always show) and backend sessions (which should only show if non-empty).\n\nFILES AFFECTED:\n- ios/VoiceCode/Models/CDSession.swift (add isLocallyCreated attribute)\n- ios/VoiceCode/Models/VoiceCode.xcdatamodeld (update CoreData schema)\n- ios/VoiceCode/Views/SessionsView.swift (set isLocallyCreated=true in createNewSession)\n- ios/VoiceCode/Managers/SessionSyncManager.swift (clear isLocallyCreated when syncing from backend)","status":"open","priority":0,"issue_type":"bug","created_at":"2025-10-19T16:03:13.694944-05:00","updated_at":"2025-10-19T16:03:13.694944-05:00"}
{"id":"voice-code-167","title":"Backend: Support running multiple instances on different ports","description":"Currently the backend can only run one instance because multiple instances would have file conflicts. We need to support running multiple backend instances on different ports (e.g., 8080 and 8081) for development and testing purposes.\n\nCURRENT SITUATION:\nPort configuration is in resources/config.edn at :server :port (default 8080). No command-line argument support.\n\nFILE CONFLICT ISSUES:\n\n1. Session Index File (~/.claude/.session-index.edn)\n   - SHARED between all instances\n   - Both instances read/write same file\n   - Race condition: simultaneous save-index! calls\n   - Last write wins, losing updates from other instance\n   - Each instance has separate in-memory session-index atom\n   - Updates from one instance invisible to the other\n\n2. Filesystem Watcher\n   - Both instances watch same ~/.claude/projects/ directory\n   - Both receive same filesystem events\n   - Both try to update session-index and save to disk\n   - Both broadcast session-created/updated events to their respective clients\n   - Race condition on every file event\n\n3. File Positions Atom (file-positions)\n   - In-memory only, not persisted\n   - Each instance tracks separately\n   - When file modified, both watchers see event\n   - Both parse incrementally from their last position\n   - Could cause duplicate message broadcasts to clients\n\n4. Session Data Files (~/.claude/projects/**/*.jsonl)\n   - Read-only for backend (Claude Code CLI writes them)\n   - No conflict - safe to read from multiple processes\n\nRECOMMENDED SOLUTION:\n\nMake session index file port-specific:\n- Use ~/.claude/.session-index-8080.edn for port 8080\n- Use ~/.claude/.session-index-8081.edn for port 8081\n- Each instance maintains isolated state\n- Both can watch filesystem independently\n- No coordination needed between instances\n\nIMPLEMENTATION PLAN:\n\n1. Pass port parameter through replication namespace\n   - Add port parameter to get-index-file-path function\n   - Store port in defonce or pass through function calls\n   - Update path to use port: (str home \"/.claude/.session-index-\" port \".edn\")\n\n2. Thread port from server.clj to replication.clj\n   - server/-main already has port from config\n   - Pass port to repl/initialize-index! \n   - Pass port to repl/start-watcher! (may need to store in watcher-state)\n   - Update all save-index! and load-index calls to use port\n\n3. Update function signatures:\n   - get-index-file-path [port]\n   - save-index! [index port]\n   - load-index [port]\n   - initialize-index! [port]\n\n4. Consider storing port in namespace state:\n   - Add (defonce current-port (atom nil))\n   - Set during initialize-index!\n   - Use in get-index-file-path without parameter\n\nFILES TO MODIFY:\n- backend/src/voice_code/replication.clj (get-index-file-path, save-index!, load-index, initialize-index!)\n- backend/src/voice_code/server.clj (-main function to pass port)\n\nTESTING:\n- Start two backend instances on different ports\n- Create session in one instance, verify both see filesystem event\n- Verify each instance maintains separate session index file\n- Verify no race conditions or lost updates\n- Verify clients on each port receive correct broadcasts\n\nALTERNATIVE CONSIDERED:\nDisable filesystem watcher on secondary instances - rejected because both instances should be fully functional.\n\nCONTEXT:\nThis came up during work on voice-code-164 (working directory bug). We needed to run a second backend instance for testing without interfering with the primary instance being used for active development.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-10-19T16:29:11.269418-05:00","updated_at":"2025-10-19T16:29:11.269418-05:00"}
{"id":"voice-code-170","title":"iOS: Persist draft prompts across app lifecycle","description":"Epic to preserve user's draft prompt text when backgrounding app or switching sessions. Prevents data loss and improves UX.\n\nPROBLEM:\nUsers lose their typed prompt text when:\n1. Switching to another app and returning\n2. App being backgrounded\n3. Navigating away from session detail view\n4. App crashes or is force-quit\n\nSOLUTION OVERVIEW:\nCreate a draft management system that:\n- Stores draft text per-session in UserDefaults\n- Auto-saves on every text change\n- Restores draft when viewing a session\n- Clears draft after prompt is sent\n- Prevents cross-session contamination\n\nTECHNICAL APPROACH:\n- Add DraftManager class (similar to AppSettings pattern)\n- Use dictionary [sessionID: draftText] stored in UserDefaults\n- Integrate with ConversationView to auto-save/restore\n- Handle edge cases (nil session IDs, empty drafts, cleanup)\n\nSUB-TASKS:\nSee voice-code-170 through voice-code-173","notes":"CLOSED: Original approach with parameter threading caused Swift compiler type-checking timeout. \n\nReplaced by voice-code-176 which uses @EnvironmentObject instead of parameter threading.\n\nvoice-code-171 (DraftManager class) is complete and reusable.\nvoice-code-172, 173, 174 are obsolete - replaced by new approach.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-10-19T21:15:52.429671-05:00","updated_at":"2025-10-19T22:12:47.393797-05:00","closed_at":"2025-10-19T22:12:47.393798-05:00"}
{"id":"voice-code-172","title":"iOS: Integrate DraftManager with VoiceCodeApp","description":"Add DraftManager instance to VoiceCodeApp and pass to views that need it.\n\nPARENT EPIC: voice-code-170\nDEPENDS ON: voice-code-171\n\nCHANGES:\nFile: ios/VoiceCode/VoiceCodeApp.swift\n\n1. Add @StateObject for DraftManager (around line 12):\n   @StateObject private var draftManager = DraftManager()\n\n2. Pass to RootView and down the hierarchy:\n   RootView(client: client, settings: settings, voiceOutput: voiceOutput, draftManager: draftManager, showingSettings: $showingSettings)\n\n3. Update RootView to accept and forward draftManager parameter\n\n4. Update SessionsListView to accept and forward draftManager parameter\n\n5. Pass draftManager to ConversationView when navigating (SessionsView.swift line 88-92)\n\nTESTING:\n- Verify app compiles after adding parameter threading\n- Verify DraftManager instance is shared across all views","notes":"Obsolete - parameter threading approach abandoned due to Swift compiler limitations. See voice-code-176 for new @EnvironmentObject approach.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-10-19T21:16:16.616445-05:00","updated_at":"2025-10-19T22:12:52.024979-05:00","closed_at":"2025-10-19T22:12:52.02498-05:00"}
{"id":"voice-code-173","title":"iOS: Update ConversationView to use DraftManager","description":"Modify ConversationView to save and restore draft text using DraftManager.\n\nPARENT EPIC: voice-code-170\nDEPENDS ON: voice-code-172\n\nCHANGES:\nFile: ios/VoiceCode/Views/ConversationView.swift\n\n1. Add DraftManager parameter to ConversationView init:\n   @ObservedObject var draftManager: DraftManager\n\n2. Change promptText from @State to computed property or keep @State but sync with DraftManager\n\n3. Add onAppear to restore draft:\n   .onAppear {\n       if let sessionID = session.id {\n           promptText = draftManager.getDraft(sessionID: sessionID)\n       }\n   }\n\n4. Add onChange to auto-save draft:\n   .onChange(of: promptText) { _, newValue in\n       if let sessionID = session.id {\n           draftManager.saveDraft(sessionID: sessionID, text: newValue)\n       }\n   }\n\n5. Clear draft after sending (line 134):\n   if let sessionID = session.id {\n       draftManager.clearDraft(sessionID: sessionID)\n   }\n   promptText = \"\"\n\n6. Handle edge case: session.id is nil (guard against it)\n\nTESTING:\n- Type partial prompt, background app, return - verify text restored\n- Type partial prompt, navigate away, return - verify text restored  \n- Send prompt - verify draft is cleared\n- Switch between sessions - verify each has independent draft\n- Restart app - verify drafts persist","notes":"Obsolete - parameter threading approach abandoned. See voice-code-176 for new @EnvironmentObject approach.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-10-19T21:16:25.618162-05:00","updated_at":"2025-10-19T22:12:55.965176-05:00","closed_at":"2025-10-19T22:12:55.965177-05:00"}
{"id":"voice-code-174","title":"iOS: Add draft cleanup on session deletion","description":"Clean up stored drafts when sessions are deleted to prevent storage bloat.\n\nPARENT EPIC: voice-code-170\nDEPENDS ON: voice-code-171\n\nCHANGES:\nFile: ios/VoiceCode/Managers/DraftManager.swift\n\nAdd method:\nfunc cleanupDraft(sessionID: String) {\n    drafts.removeValue(forKey: sessionID)\n}\n\nFile: ios/VoiceCode/Views/SessionsView.swift\n\nWhen deleting session (around line 104 where deleteSession is called):\n- Call draftManager.cleanupDraft(sessionID: session.id)\n- Do this before or after CoreData deletion\n\nOPTIONAL ENHANCEMENT:\nAdd periodic cleanup to remove drafts for sessions that no longer exist in CoreData:\n- Run on app launch or periodically\n- Query all session IDs from CoreData\n- Remove drafts for IDs not in CoreData\n\nTESTING:\n- Delete session with draft text\n- Verify draft is removed from UserDefaults\n- Verify storage size doesn't grow indefinitely","notes":"Obsolete - cleanup logic will be implemented in voice-code-176 using @EnvironmentObject approach.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-10-19T21:16:33.424956-05:00","updated_at":"2025-10-19T22:13:01.092755-05:00","closed_at":"2025-10-19T22:13:01.092756-05:00"}
{"id":"voice-code-176","title":"Backend: Index keys are uppercase but lookups use lowercase","description":"Case-sensitivity mismatch in session index. Index is built with uppercase UUID keys from filenames, but get-session-metadata normalizes to lowercase for lookups. This causes sessions with uppercase UUIDs (from iOS) to appear missing even though they exist on disk.\n\nRoot cause: build-index! in replication.clj:175-195 uses session-id as-is from filename (uppercase), but get-session-metadata:279-282 normalizes to lowercase.\n\nFix: Normalize session-id to lowercase in build-index! before using as map key: (assoc acc (str/lower-case session-id) metadata)\n\nImpact: ~11+ sessions with uppercase UUIDs cannot be found via lookup despite being in the index.","status":"open","priority":1,"issue_type":"bug","created_at":"2025-10-19T22:12:47.383642-05:00","updated_at":"2025-10-19T22:12:47.383642-05:00"}
{"id":"voice-code-177","title":"iOS: Draft persistence using @EnvironmentObject pattern","description":"Epic to preserve user's draft prompt text using SwiftUI @EnvironmentObject pattern instead of parameter threading.\n\nSUPERSEDES: voice-code-170 (parameter threading approach caused Swift compiler timeout)\nREUSES: voice-code-171 (DraftManager class already implemented and tested)\n\nPROBLEM:\nUsers lose typed prompt text when:\n1. Switching to another app and returning\n2. App being backgrounded\n3. Navigating away from session detail view\n4. App crashes or is force-quit\n\nSOLUTION ARCHITECTURE:\nUse SwiftUI @EnvironmentObject to inject DraftManager throughout view hierarchy without explicit parameter passing.\n\nBENEFITS:\n- No view signature changes (avoids Swift compiler type-checking timeout)\n- Idiomatic SwiftUI pattern\n- DraftManager class already complete with tests\n- Simple integration - just 2 files need changes\n\nTECHNICAL APPROACH:\n1. VoiceCodeApp creates @StateObject DraftManager\n2. Inject via .environmentObject() modifier (1 line)\n3. ConversationView accesses via @EnvironmentObject\n4. Auto-save/restore draft per session\n5. Clean up on session delete\n\nIMPLEMENTATION:\n- voice-code-177: Inject DraftManager as environment object in VoiceCodeApp\n- voice-code-178: Update ConversationView to use @EnvironmentObject\n- voice-code-179: Add draft cleanup on session deletion\n\nCONTEXT FOR NEW DEVELOPERS:\n- iOS 18.5 deployment target\n- DraftManager class: ios/VoiceCode/Managers/DraftManager.swift (complete)\n- Tests: ios/VoiceCodeTests/DraftManagerTests.swift (6 tests passing)\n- Storage: UserDefaults key sessionDrafts as [String: String]\n- Pattern reference: AppSettings uses same @Published + didSet pattern\n\nESTIMATED EFFORT: 30-45 minutes total","notes":"COMPLETED: All tasks finished successfully.\n\nImplementation used @EnvironmentObject pattern (idiomatic SwiftUI) instead of parameter threading.\n\nCompleted tasks:\n- voice-code-171: DraftManager class (REUSED from previous work)\n- voice-code-178: Inject DraftManager via @EnvironmentObject ✅\n- voice-code-179: ConversationView draft auto-save/restore ✅  \n- voice-code-180: Cleanup drafts on session deletion ✅\n\nAll builds passing. Ready for testing.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-10-19T22:13:16.557837-05:00","updated_at":"2025-10-19T22:18:37.496255-05:00","closed_at":"2025-10-19T22:18:37.496257-05:00"}
{"id":"voice-code-178","title":"iOS: Inject DraftManager via @EnvironmentObject","description":"Add DraftManager to app environment so all child views can access it without parameter passing.\n\nPARENT EPIC: voice-code-177\nDEPENDS ON: voice-code-171 (DraftManager class - COMPLETE)\n\nCONTEXT:\nDraftManager class already exists and is tested (voice-code-171).\nNeed to make it available throughout view hierarchy using SwiftUI @EnvironmentObject pattern.\n\nCHANGES NEEDED:\n\nFile: ios/VoiceCode/VoiceCodeApp.swift\n\n1. Create @StateObject after line 10:\n   @StateObject private var draftManager = DraftManager()\n\n2. Inject into environment after line 14 (inside WindowGroup):\n   RootView(settings: settings)\n       .environment(\\.managedObjectContext, persistenceController.container.viewContext)\n       .environmentObject(draftManager)  // ← ADD THIS LINE\n\nThat's it! No other changes needed for this task.\n\nTESTING:\n- App should compile and run\n- No runtime errors\n- DraftManager accessible from any child view via @EnvironmentObject\n\nREFERENCE:\nSimilar pattern used for other managers:\n- PersistenceController passed via .environment()\n- We're adding DraftManager via .environmentObject()\n\nDifference: .environment() for value types, .environmentObject() for ObservableObject","status":"closed","priority":1,"issue_type":"task","created_at":"2025-10-19T22:13:27.52631-05:00","updated_at":"2025-10-19T22:15:24.211106-05:00","closed_at":"2025-10-19T22:15:24.211108-05:00"}
{"id":"voice-code-179","title":"iOS: Use @EnvironmentObject in ConversationView for drafts","description":"Update ConversationView to access DraftManager from environment and implement auto-save/restore logic.\n\nPARENT EPIC: voice-code-177\nDEPENDS ON: voice-code-178\n\nCONTEXT:\nConversationView.swift currently has @State private var promptText.\nNeed to sync this with DraftManager to persist across app lifecycle.\n\nCHANGES NEEDED:\n\nFile: ios/VoiceCode/Views/ConversationView.swift\n\n1. Add @EnvironmentObject property (around line 14, with other properties):\n   @EnvironmentObject var draftManager: DraftManager\n\n2. Keep existing @State (line 17):\n   @State private var promptText = \"\"\n   (Keep this - UI needs @State for TextField binding)\n\n3. Add .onAppear modifier to restore draft:\n   .onAppear {\n       if let sessionID = session.id {\n           promptText = draftManager.getDraft(sessionID: sessionID)\n       }\n   }\n\n4. Add .onChange modifier to auto-save draft:\n   .onChange(of: promptText) { oldValue, newValue in\n       if let sessionID = session.id {\n           draftManager.saveDraft(sessionID: sessionID, text: newValue)\n       }\n   }\n\n5. Update sendPrompt to clear draft (around line 134):\n   // After successful send, before setting promptText = \"\"\n   if let sessionID = session.id {\n       draftManager.clearDraft(sessionID: sessionID)\n   }\n   promptText = \"\"\n\nEDGE CASES:\n- session.id might be nil: Use guard/if let to safely unwrap\n- Empty text: DraftManager.saveDraft already handles (removes entry)\n- Multiple sessions: Each has independent draft (DraftManager uses dictionary)\n\nTESTING:\n- Type partial prompt, background app, return → text should restore\n- Type partial prompt, navigate away, return → text should restore\n- Send prompt → draft should clear\n- Switch sessions → each session has own draft\n- Kill app, relaunch → drafts persist\n\nLOCATION HINTS:\n- Current @State promptText: line 17\n- ConversationTextInputView usage: around line 131-136\n- sendPrompt logic: look for where promptText is cleared","status":"closed","priority":1,"issue_type":"task","created_at":"2025-10-19T22:13:42.439437-05:00","updated_at":"2025-10-19T22:17:29.336313-05:00","closed_at":"2025-10-19T22:17:29.336314-05:00"}
{"id":"voice-code-180","title":"iOS: Clean up drafts when session deleted","description":"Remove stored draft text when user deletes a session to prevent storage bloat.\n\nPARENT EPIC: voice-code-177\nDEPENDS ON: voice-code-178\n\nCONTEXT:\nUserDefaults will accumulate draft entries for deleted sessions over time.\nNeed to clean up drafts when sessions are deleted.\n\nCHANGES NEEDED:\n\nFile: ios/VoiceCode/Views/SessionsView.swift\n\n1. Access DraftManager via @EnvironmentObject (around line 11):\n   @EnvironmentObject var draftManager: DraftManager\n\n2. In deleteSession function (around line 104):\n   Before or after viewContext.delete(session):\n   if let sessionID = session.id {\n       draftManager.cleanupDraft(sessionID: sessionID)\n   }\n\nLOCATION:\n- deleteSession function is in SessionsView.swift\n- Currently deletes from CoreData around line 104-110\n- Just add draft cleanup before viewContext.save()\n\nTESTING:\n- Create draft in session (type partial prompt)\n- Delete that session\n- Check UserDefaults: draft should be removed\n- Verify via: UserDefaults.standard.dictionary(forKey: \"sessionDrafts\")\n\nOPTIONAL ENHANCEMENT (P2):\nAdd bulk cleanup on app launch to remove orphaned drafts:\n- In DraftManager.init or separate method\n- Fetch all valid session IDs from CoreData\n- Remove drafts where sessionID not in valid set\n- Only run if draft count \u003e 100 (performance)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-10-19T22:13:53.634233-05:00","updated_at":"2025-10-19T22:18:30.318263-05:00","closed_at":"2025-10-19T22:18:30.318265-05:00"}
{"id":"voice-code-30","title":"Set up Tailscale on server and iPhone","description":"","status":"closed","priority":0,"issue_type":"task","created_at":"2025-10-13T22:17:34.247689-05:00","updated_at":"2025-10-17T17:47:56.62732-05:00","closed_at":"2025-10-17T17:47:56.62732-05:00"}
{"id":"voice-code-47","title":"Fix tilde expansion in working directory paths","description":"The Examples shows ~/code/voice-code but the server fails with 'Cannot run program in directory ~/code/mono: No such file or directory'. Java's ProcessBuilder doesn't expand tildes - need to expand ~ to actual home directory in invoke-claude before passing to shell/sh","status":"closed","priority":0,"issue_type":"task","created_at":"2025-10-14T21:17:39.392349-05:00","updated_at":"2025-10-17T17:21:36.504931-05:00","closed_at":"2025-10-17T17:21:36.504931-05:00"}
{"id":"voice-code-49","title":"Exclude code blocks from text-to-speech","description":"Code blocks should be visible in the markdown display but not read aloud. Code is important to see but terrible to hear spoken.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-10-14T21:30:59.411847-05:00","updated_at":"2025-10-18T18:35:21.505247-05:00","closed_at":"2025-10-18T18:35:21.505247-05:00"}
{"id":"voice-code-73","title":"\"Write","description":"","status":"closed","priority":0,"issue_type":"task","assignee":"backend","created_at":"2025-10-16T22:51:51.743518-05:00","updated_at":"2025-10-17T17:31:24.730402-05:00","closed_at":"2025-10-17T17:31:24.730402-05:00"}
{"id":"voice-code-74","title":"Build session metadata index system","description":"Scan .jsonl files on startup to extract metadata and build in-memory index.\n\n- Scan .claude/projects directory recursively for .jsonl files\n- Extract metadata: session-id, name, working-dir, created-at, last-modified, message-count, preview\n- Build in-memory map: session-id to metadata\n- Persist index to .claude/.session-index.edn for fast reload\n- Load from persisted index on subsequent startups","acceptance_criteria":"Can build index from 100+ .jsonl files, index persists to .edn, subsequent startups load from .edn (\u003c1 second), contains all required metadata fields","status":"closed","priority":0,"issue_type":"feature","assignee":"backend","created_at":"2025-10-16T22:52:20.331367-05:00","updated_at":"2025-10-17T09:48:50.563147-05:00","closed_at":"2025-10-17T09:48:50.563147-05:00","dependencies":[{"issue_id":"voice-code-74","depends_on_id":"voice-code-117","type":"parent-child","created_at":"2025-10-17T17:45:49.48993-05:00","created_by":"travisbrown"}]}
{"id":"voice-code-75","title":"Implement .jsonl parser","description":"Parse Claude Code .jsonl format to extract messages.\n\n- Parse .jsonl files (one JSON object per line)\n- Extract message fields: role, text, timestamp\n- Handle incremental parsing (read only new lines since last position)\n- Track last-read byte position per file for incremental reads\n- Error handling for malformed JSON lines (skip and log)\n- Return structured message list","acceptance_criteria":"Can parse full .jsonl file into message list, can parse only new lines incrementally (given last position), handles malformed JSON gracefully, returns normalized message structure","status":"closed","priority":0,"issue_type":"feature","assignee":"backend","created_at":"2025-10-16T22:52:28.433104-05:00","updated_at":"2025-10-17T09:48:50.563851-05:00","closed_at":"2025-10-17T09:48:50.563851-05:00","dependencies":[{"issue_id":"voice-code-75","depends_on_id":"voice-code-117","type":"parent-child","created_at":"2025-10-17T17:45:49.501942-05:00","created_by":"travisbrown"}]}
{"id":"voice-code-76","title":"Add filesystem watcher with debouncing","description":"Watch .claude/projects for file changes using Java NIO WatchService.\n\n- Use Java NIO WatchService to watch directory\n- Listen for: ENTRY_CREATE, ENTRY_MODIFY, ENTRY_DELETE events\n- Implement debouncing: wait 200ms of quiet before processing\n- Implement parse-retry: retry up to 3 times if parse fails (100ms between retries)\n- Update metadata index when files change\n- Handle partial writes (debouncing prevents reading mid-write)","acceptance_criteria":"Detects new .jsonl files (ENTRY_CREATE), detects modifications (ENTRY_MODIFY) with debouncing, handles partial writes without errors (debounce + retry), updates index when files change","status":"closed","priority":0,"issue_type":"feature","assignee":"backend","created_at":"2025-10-16T22:52:36.699982-05:00","updated_at":"2025-10-17T09:48:50.564111-05:00","closed_at":"2025-10-17T09:48:50.564111-05:00","dependencies":[{"issue_id":"voice-code-76","depends_on_id":"voice-code-117","type":"parent-child","created_at":"2025-10-17T17:45:49.514947-05:00","created_by":"travisbrown"}]}
{"id":"voice-code-77","title":"Implement selective file watching","description":"Track subscribed sessions and only watch their .jsonl files.\n\n- Maintain atom of subscribed session IDs\n- When iOS subscribes: add to set, start watching that specific .jsonl file\n- When iOS unsubscribes: remove from set, stop watching file\n- Always watch parent directory for new file creation (ENTRY_CREATE)\n- Only send updates for subscribed sessions\n- Limit to ~5-10 watched files per client","acceptance_criteria":"Only watches .jsonl files for subscribed sessions, always detects new session creation, unwatches when client unsubscribes, performance: \u003c5% CPU overhead with 10 subscriptions","status":"closed","priority":0,"issue_type":"feature","assignee":"backend","created_at":"2025-10-16T22:52:44.372774-05:00","updated_at":"2025-10-17T09:48:50.564354-05:00","closed_at":"2025-10-17T09:48:50.564354-05:00","dependencies":[{"issue_id":"voice-code-77","depends_on_id":"voice-code-117","type":"parent-child","created_at":"2025-10-17T17:45:49.527678-05:00","created_by":"travisbrown"}]}
{"id":"voice-code-78","title":"Add session_list message handler","description":"Send session metadata index to iOS on connection.\n\n- On WebSocket connection (after hello), send session_list message\n- Include all session metadata from index\n- Format: {type: session_list, sessions: [{session_id, name, working_directory, last_modified, message_count, preview}]}\n- Performance target: \u003c1 second to send 666 sessions\n- Use snake_case for JSON keys (per standards)","acceptance_criteria":"Sends complete session list on connection, JSON format matches protocol spec, performance: \u003c1s for 666 sessions over local network, iOS can parse and display immediately","status":"closed","priority":0,"issue_type":"feature","assignee":"backend","created_at":"2025-10-16T22:52:52.303266-05:00","updated_at":"2025-10-17T09:48:50.56454-05:00","closed_at":"2025-10-17T09:48:50.56454-05:00","dependencies":[{"issue_id":"voice-code-78","depends_on_id":"voice-code-117","type":"parent-child","created_at":"2025-10-17T17:45:49.54393-05:00","created_by":"travisbrown"}]}
{"id":"voice-code-79","title":"Add session_subscribe message handler","description":"Parse .jsonl file on-demand and send full conversation history.\n\n- Handle subscribe message from iOS: {type: subscribe, session_id: \"...\"}\n- Parse requested .jsonl file (lazy load)\n- Extract all messages from file\n- Send session_history: {type: session_history, session_id: \"...\", messages: [...]}\n- Add session to watched set (start monitoring for changes)\n- Track last-read position for incremental updates","acceptance_criteria":"Parses .jsonl on subscribe (lazy), sends full message history to iOS, adds to watched sessions set, handles missing files gracefully (error message)","status":"closed","priority":0,"issue_type":"feature","assignee":"backend","created_at":"2025-10-16T22:53:01.262046-05:00","updated_at":"2025-10-17T09:48:50.564714-05:00","closed_at":"2025-10-17T09:48:50.564714-05:00","dependencies":[{"issue_id":"voice-code-79","depends_on_id":"voice-code-117","type":"parent-child","created_at":"2025-10-17T17:45:49.557991-05:00","created_by":"travisbrown"}]}
{"id":"voice-code-80","title":"Add session_updated message handler","description":"Send incremental updates for watched sessions.\n\n- Triggered by filesystem watcher (after debouncing)\n- Parse only new messages (using last-read position)\n- Send to subscribed iOS clients: {type: session_updated, session_id: \"...\", messages: [new messages]}\n- Update last-read position after successful parse\n- Only send to iOS clients subscribed to this session","acceptance_criteria":"Sends only new messages (incremental), triggered by file modification events, updates tracked position after send, only sends to subscribed clients","status":"closed","priority":0,"issue_type":"feature","assignee":"backend","created_at":"2025-10-16T22:53:08.200542-05:00","updated_at":"2025-10-17T09:48:50.56491-05:00","closed_at":"2025-10-17T09:48:50.56491-05:00","dependencies":[{"issue_id":"voice-code-80","depends_on_id":"voice-code-117","type":"parent-child","created_at":"2025-10-17T17:45:49.580333-05:00","created_by":"travisbrown"}]}
{"id":"voice-code-81","title":"Add session_created message handler","description":"Broadcast new session creation to all iOS clients.\n\n- Triggered by filesystem watcher (ENTRY_CREATE event)\n- Extract metadata from new .jsonl file\n- Add to metadata index\n- Broadcast to all connected iOS clients: {type: session_created, session_id: \"...\", name: \"...\", ...}\n- iOS will auto-subscribe to new sessions","acceptance_criteria":"Detects new .jsonl files immediately, extracts and indexes metadata, broadcasts to all connected clients, iOS receives and can auto-subscribe","status":"closed","priority":0,"issue_type":"feature","assignee":"backend","created_at":"2025-10-16T22:53:16.509673-05:00","updated_at":"2025-10-17T09:48:50.565107-05:00","closed_at":"2025-10-17T09:48:50.565107-05:00","dependencies":[{"issue_id":"voice-code-81","depends_on_id":"voice-code-117","type":"parent-child","created_at":"2025-10-17T17:45:49.597567-05:00","created_by":"travisbrown"}]}
{"id":"voice-code-82","title":"Add session_deleted message handler","description":"Track iOS client deletions and stop replication.\n\n- Handle session_deleted from iOS: {type: session_deleted, session_id: \"...\"}\n- Track deleted sessions per iOS client (in client state map)\n- Unsubscribe from session (stop watching)\n- Ignore future updates for this session for this client\n- Do NOT delete backend .jsonl file (file remains on dev machine)","acceptance_criteria":"Unsubscribes from deleted session, stops sending updates to that iOS client, file remains on backend (not deleted), other clients still receive updates","status":"closed","priority":0,"issue_type":"feature","assignee":"backend","created_at":"2025-10-16T22:53:23.853474-05:00","updated_at":"2025-10-17T09:48:50.565295-05:00","closed_at":"2025-10-17T09:48:50.565295-05:00","dependencies":[{"issue_id":"voice-code-82","depends_on_id":"voice-code-117","type":"parent-child","created_at":"2025-10-17T17:45:49.611699-05:00","created_by":"travisbrown"}]}
{"id":"voice-code-83","title":"Update prompt handler for new/resume distinction","description":"Support new_session_id vs resume_session_id fields.\n\n- Parse new_session_id field: call claude --session-id \u003cid\u003e \"prompt\"\n- Parse resume_session_id field: call claude --resume \u003cid\u003e \"prompt\"\n- Remove direct response message (responses come via subscription)\n- iOS generates UUID for new sessions\n- Send only ack, responses come via session_updated\n\nProtocol:\n- {type: prompt, new_session_id: \"...\", text: \"...\"} → --session-id\n- {type: prompt, resume_session_id: \"...\", text: \"...\"} → --resume","acceptance_criteria":"Handles new_session_id correctly (--session-id), handles resume_session_id correctly (--resume), no direct response message, responses flow through subscription path","status":"closed","priority":0,"issue_type":"feature","assignee":"backend","created_at":"2025-10-16T22:53:33.011989-05:00","updated_at":"2025-10-17T09:48:50.56549-05:00","closed_at":"2025-10-17T09:48:50.56549-05:00","dependencies":[{"issue_id":"voice-code-83","depends_on_id":"voice-code-117","type":"parent-child","created_at":"2025-10-17T17:45:49.634188-05:00","created_by":"travisbrown"}]}
{"id":"voice-code-84","title":"Remove old session persistence logic","description":"Clean up iOS session UUID mapping and sessions.edn storage.\n\n- Remove sessions.edn file and storage logic\n- Remove channel-to-session atom mapping\n- Remove iOS session UUID → Claude session ID mapping\n- Remove register-channel! and related functions\n- Simplify to pure session replication (no session state management)\n- Update tests to reflect new architecture","acceptance_criteria":"sessions.edn storage removed, iOS session UUID mapping removed, code simplified (session replication only), all tests passing with new architecture","status":"closed","priority":0,"issue_type":"feature","assignee":"backend","created_at":"2025-10-16T22:53:40.407256-05:00","updated_at":"2025-10-17T09:48:50.565636-05:00","closed_at":"2025-10-17T09:48:50.565636-05:00","dependencies":[{"issue_id":"voice-code-84","depends_on_id":"voice-code-117","type":"parent-child","created_at":"2025-10-17T17:45:49.651891-05:00","created_by":"travisbrown"}]}
{"id":"voice-code-85","title":"Add session naming logic","description":"Generate default names for sessions.\n\n- Terminal sessions: \"Terminal: \u003cdir-name\u003e - \u003ctimestamp\u003e\"\n- iOS sessions: \"Voice: \u003cdir-name\u003e - \u003ctimestamp\u003e\"\n- Detect forks: \"\u003cparent-name\u003e (fork)\" or \"\u003cparent-name\u003e (compacted)\" if \u003c1min\n- Extract working directory from .jsonl or parent folder\n- Format timestamp: YYYY-MM-DD HH:MM\n- Include name in session metadata\n\nLogic:\n- If session created \u003c1min after parent: \"(compacted)\"\n- Otherwise: \"(fork)\"\n- Determine Terminal vs Voice by checking if iOS client initiated","acceptance_criteria":"Generates meaningful default names, detects and labels forks appropriately, includes working directory and timestamp, names appear in session_list and session_created","status":"closed","priority":0,"issue_type":"feature","assignee":"backend","created_at":"2025-10-16T22:53:49.745702-05:00","updated_at":"2025-10-17T09:48:50.565814-05:00","closed_at":"2025-10-17T09:48:50.565814-05:00","dependencies":[{"issue_id":"voice-code-85","depends_on_id":"voice-code-117","type":"parent-child","created_at":"2025-10-17T17:45:49.667367-05:00","created_by":"travisbrown"}]}
{"id":"voice-code-86","title":"Write tests for replication system","description":"Comprehensive test coverage for new replication architecture.\n\nTests:\n- Index building from 100+ .jsonl files\n- Incremental file parsing (new lines only)\n- Debouncing and parse-retry logic\n- Selective file watching (subscribe/unsubscribe)\n- Protocol messages: session_list, session_subscribe, session_history, session_updated, session_created\n- New vs resume prompt handling (--session-id vs --resume)\n- Session naming generation\n- Deletion handling","acceptance_criteria":"All tests passing, coverage for core replication logic, integration tests for file watching, protocol message tests","status":"closed","priority":0,"issue_type":"task","assignee":"backend","created_at":"2025-10-16T22:53:59.609647-05:00","updated_at":"2025-10-17T09:48:50.565967-05:00","closed_at":"2025-10-17T09:48:50.565967-05:00","dependencies":[{"issue_id":"voice-code-86","depends_on_id":"voice-code-117","type":"parent-child","created_at":"2025-10-17T17:45:49.686853-05:00","created_by":"travisbrown"}]}
{"id":"voice-code-87","title":"Design CoreData schema","description":"Design CoreData schema for session and message storage.\n\nEntities:\n- Session: id (UUID), backendName (String), localName (String?), workingDir (String), lastModified (Date), messageCount (Int), preview (String), isDeleted (Bool)\n- Message: id (UUID), sessionId (UUID), role (String), text (String), timestamp (Date), status (MessageStatus enum), serverTimestamp (Date?)\n\nRelationships:\n- Session.messages → [Message]\n- Message.session → Session\n\nEnums:\n- MessageStatus: .sending, .confirmed, .error","acceptance_criteria":"CoreData model file created, entities defined with all fields, relationships configured, compiles without errors","status":"closed","priority":0,"issue_type":"task","assignee":"ios","created_at":"2025-10-16T22:54:14.891234-05:00","updated_at":"2025-10-17T17:55:11.355372-05:00","closed_at":"2025-10-17T17:55:11.355372-05:00","dependencies":[{"issue_id":"voice-code-87","depends_on_id":"voice-code-117","type":"parent-child","created_at":"2025-10-17T17:45:49.704345-05:00","created_by":"travisbrown"}]}
{"id":"voice-code-88","title":"Implement session metadata sync","description":"Handle session_list message and store metadata in CoreData.\n\n- Receive session_list on WebSocket connection\n- Parse sessions array\n- Store in CoreData (Session entities)\n- Display in sessions list view\n- Support pagination (20 sessions per page initially)\n- Load more on scroll","acceptance_criteria":"Receives session_list, stores all sessions in CoreData, displays in UI with pagination, \"load more\" works correctly","notes":"Updated to clarify handling of session_created broadcasts. This task covers both initial session_list and ongoing session_created messages for terminal sessions.","status":"closed","priority":0,"issue_type":"feature","assignee":"ios","created_at":"2025-10-16T22:54:23.075193-05:00","updated_at":"2025-10-17T17:58:43.371981-05:00","closed_at":"2025-10-17T17:58:43.371981-05:00","dependencies":[{"issue_id":"voice-code-88","depends_on_id":"voice-code-117","type":"parent-child","created_at":"2025-10-17T17:45:49.722447-05:00","created_by":"travisbrown"}]}
{"id":"voice-code-89","title":"Implement lazy session loading","description":"Load full conversation when user opens a session.\n\n- When user taps session: send subscribe message\n- Receive session_history response\n- Parse messages array\n- Store messages in CoreData (linked to session)\n- Display in conversation view\n- Show loading indicator during fetch","acceptance_criteria":"Sends subscribe on session open, receives and stores session_history, displays messages in conversation view, loading indicator shown","status":"closed","priority":0,"issue_type":"feature","assignee":"ios","created_at":"2025-10-16T22:54:29.59329-05:00","updated_at":"2025-10-17T18:12:11.550002-05:00","closed_at":"2025-10-17T18:12:11.550002-05:00","dependencies":[{"issue_id":"voice-code-89","depends_on_id":"voice-code-117","type":"parent-child","created_at":"2025-10-17T17:45:49.741392-05:00","created_by":"travisbrown"}]}
{"id":"voice-code-90","title":"Implement incremental message updates","description":"Handle session_updated messages and update CoreData.\n\n- Receive session_updated messages from WebSocket\n- Parse new messages array\n- Append to CoreData for that session\n- Update UI in real-time (if session is open)\n- Update session preview and message count in list view","acceptance_criteria":"Receives session_updated, appends new messages to CoreData, UI updates in real-time, session list shows updated preview/count","status":"closed","priority":0,"issue_type":"feature","assignee":"ios","created_at":"2025-10-16T22:54:36.248463-05:00","updated_at":"2025-10-17T18:18:27.80231-05:00","closed_at":"2025-10-17T18:18:27.80231-05:00","dependencies":[{"issue_id":"voice-code-90","depends_on_id":"voice-code-117","type":"parent-child","created_at":"2025-10-17T17:45:49.756403-05:00","created_by":"travisbrown"}]}
{"id":"voice-code-91","title":"Implement optimistic UI for prompts","description":"Display user prompts immediately with optimistic UI pattern.\n\n- When user sends prompt: create Message with status .sending\n- Add to CoreData immediately\n- Display in conversation view (show sending indicator)\n- When session_updated arrives: reconcile by matching text\n- Update status to .confirmed, add serverTimestamp\n- Handle case where message not found (backend-originated prompt)","acceptance_criteria":"User prompts appear instantly, reconciliation works correctly, status updates from .sending to .confirmed, backend prompts handled gracefully","status":"closed","priority":0,"issue_type":"feature","assignee":"ios","created_at":"2025-10-16T22:54:43.752348-05:00","updated_at":"2025-10-17T18:24:00.025281-05:00","closed_at":"2025-10-17T18:24:00.025281-05:00","dependencies":[{"issue_id":"voice-code-91","depends_on_id":"voice-code-117","type":"parent-child","created_at":"2025-10-17T17:45:49.777476-05:00","created_by":"travisbrown"}]}
{"id":"voice-code-92","title":"Update prompt sending logic","description":"Use new_session_id vs resume_session_id fields for prompts.\n\n- Generate UUID for new sessions (before sending prompt)\n- Send subscribe(uuid) before prompt for new sessions\n- Use new_session_id field for new sessions\n- Use resume_session_id field for existing sessions\n- Remove iOS session UUID from protocol\n- Working directory from session or user selection\n\nMessage format:\n- New: {type: prompt, new_session_id: uuid, text: \"...\", working_directory: \"...\"}\n- Resume: {type: prompt, resume_session_id: uuid, text: \"...\", working_directory: \"...\"}","acceptance_criteria":"Generates UUIDs for new sessions, sends subscribe before prompt, uses correct field (new_session_id vs resume_session_id), iOS session UUID removed","notes":"This task includes auto-subscribe logic for new sessions. When creating a new session, iOS generates UUID and sends subscribe BEFORE sending the prompt, ensuring it receives all updates including the initial response.","status":"closed","priority":0,"issue_type":"feature","assignee":"ios","created_at":"2025-10-16T22:54:51.459293-05:00","updated_at":"2025-10-17T19:28:50.476732-05:00","closed_at":"2025-10-17T19:28:50.476732-05:00","dependencies":[{"issue_id":"voice-code-92","depends_on_id":"voice-code-117","type":"parent-child","created_at":"2025-10-17T17:45:49.792511-05:00","created_by":"travisbrown"}]}
{"id":"voice-code-93","title":"Implement smart speaking logic","description":"Only speak messages for active/open session.\n\n- Track currently active session ID\n- When session_updated arrives: check if message is for active session\n- If active session + assistant message: speak it\n- If background session: buffer message, update badge count\n- Show unread count in session list\n- Mark as read when user opens session","acceptance_criteria":"Only speaks messages for active session, background sessions show badge count, unread count visible in list, mark as read works","status":"closed","priority":0,"issue_type":"feature","assignee":"ios","created_at":"2025-10-16T22:54:58.774589-05:00","updated_at":"2025-10-17T19:40:49.856756-05:00","closed_at":"2025-10-17T19:40:49.856756-05:00","dependencies":[{"issue_id":"voice-code-93","depends_on_id":"voice-code-117","type":"parent-child","created_at":"2025-10-17T17:45:49.810632-05:00","created_by":"travisbrown"}]}
{"id":"voice-code-94","title":"Add long-press \"Read Aloud\" menu","description":"Add context menu to read historical messages aloud.\n\n- Long-press on any message: show context menu\n- Menu option: \"Read Aloud\"\n- Trigger TTS for that message text\n- Interrupt current playback if needed\n- Works for both user and assistant messages","acceptance_criteria":"Long-press shows context menu, \"Read Aloud\" option present, TTS plays selected message, interrupts current playback","status":"closed","priority":0,"issue_type":"feature","assignee":"ios","created_at":"2025-10-16T22:55:05.79065-05:00","updated_at":"2025-10-17T19:47:40.04061-05:00","closed_at":"2025-10-17T19:47:40.04061-05:00","dependencies":[{"issue_id":"voice-code-94","depends_on_id":"voice-code-117","type":"parent-child","created_at":"2025-10-17T17:45:49.832692-05:00","created_by":"travisbrown"}]}
{"id":"voice-code-95","title":"Implement session deletion","description":"Allow users to delete sessions locally.\n\n- Swipe to delete gesture in session list\n- Send session_deleted message to backend\n- Mark session as deleted in CoreData (isDeleted = true)\n- Hide from UI (filter out deleted sessions)\n- Send unsubscribe message\n- No backend file deletion (local only)","acceptance_criteria":"Swipe to delete works, sends session_deleted to backend, marks as deleted in CoreData, hidden from UI, unsubscribe sent","status":"closed","priority":0,"issue_type":"feature","assignee":"ios","created_at":"2025-10-16T22:55:14.723884-05:00","updated_at":"2025-10-17T19:52:30.143813-05:00","closed_at":"2025-10-17T19:52:30.143813-05:00","dependencies":[{"issue_id":"voice-code-95","depends_on_id":"voice-code-117","type":"parent-child","created_at":"2025-10-17T17:45:49.849215-05:00","created_by":"travisbrown"}]}
{"id":"voice-code-96","title":"Add session renaming","description":"Allow users to rename sessions locally.\n\n- Edit button or gesture in session detail view\n- Text field to enter custom name\n- Store in localName field (CoreData)\n- Display: localName ?? backendName\n- No backend sync (local only)\n- Update UI immediately on change","acceptance_criteria":"Can edit session name, stores in localName field, displays custom name if set, falls back to backendName, no backend sync","status":"closed","priority":0,"issue_type":"feature","assignee":"ios","created_at":"2025-10-16T22:55:21.150448-05:00","updated_at":"2025-10-17T19:55:33.263092-05:00","closed_at":"2025-10-17T19:55:33.263092-05:00","dependencies":[{"issue_id":"voice-code-96","depends_on_id":"voice-code-117","type":"parent-child","created_at":"2025-10-17T17:45:49.865005-05:00","created_by":"travisbrown"}]}
{"id":"voice-code-97","title":"Test terminal to iOS sync","description":"End-to-end test: terminal session appears on iOS.\n\nSteps:\n1. Start backend and iOS app\n2. Create new Claude session from terminal\n3. Verify iOS receives session_created message\n4. Verify session appears in iOS session list\n5. Verify auto-subscription works\n6. Send prompt from terminal\n7. Verify iOS receives session_updated\n8. Verify messages display correctly","acceptance_criteria":"Terminal sessions appear on iOS, auto-subscription works, messages sync correctly, end-to-end flow complete","status":"closed","priority":0,"issue_type":"task","created_at":"2025-10-16T22:55:34.797134-05:00","updated_at":"2025-10-18T14:23:21.42793-05:00","closed_at":"2025-10-18T14:23:21.42793-05:00"}
{"id":"voice-code-98","title":"Test iOS to iOS sync","description":"End-to-end test: iOS session syncs to other iOS clients.\n\nSteps:\n1. Start backend and iOS app\n2. Create new session from iOS (send prompt with new_session_id)\n3. Backend creates .jsonl file\n4. Verify filesystem watcher detects new file\n5. Verify messages sync via session_updated\n6. Connect second iOS client\n7. Verify session appears in session_list\n8. Verify can subscribe and see full history","acceptance_criteria":"iOS sessions create backend files, sync via file watching works, other iOS clients receive sessions, full history available","status":"closed","priority":0,"issue_type":"task","created_at":"2025-10-16T22:55:42.763758-05:00","updated_at":"2025-10-18T14:23:21.428742-05:00","closed_at":"2025-10-18T14:23:21.428742-05:00"}
{"id":"voice-code-99","title":"Test session forking","description":"Test concurrent resume creates fork that appears on iOS.\n\nSteps:\n1. Create session from terminal\n2. iOS subscribes to session\n3. From terminal: resume same session (concurrent)\n4. Claude creates fork (session-id-fork-1.jsonl)\n5. Verify filesystem watcher detects new fork file\n6. Verify iOS receives session_created for fork\n7. Verify iOS auto-subscribes to fork\n8. Verify fork name includes \"(fork)\" or \"(compacted)\"","acceptance_criteria":"Concurrent resume creates fork, fork detected by watcher, iOS receives session_created, auto-subscription works, fork naming correct","status":"open","priority":0,"issue_type":"task","created_at":"2025-10-16T22:55:51.300792-05:00","updated_at":"2025-10-16T22:55:51.300792-05:00","dependencies":[{"issue_id":"voice-code-99","depends_on_id":"voice-code-117","type":"parent-child","created_at":"2025-10-17T17:45:49.91757-05:00","created_by":"travisbrown"}]}
