{"id":"voice-code-100","title":"Test deletion workflow","description":"Test session deletion on iOS stops replication.\n\nSteps:\n1. iOS has session subscribed\n2. User swipes to delete session\n3. iOS sends session_deleted message\n4. Verify backend stops sending updates to that iOS client\n5. Verify backend .jsonl file still exists\n6. Verify other iOS clients still receive updates\n7. Create new prompt from terminal in deleted session\n8. Verify first iOS client does NOT receive update\n9. Verify other clients DO receive update","acceptance_criteria":"Deletion stops replication for that client only, backend file remains, other clients unaffected, updates filtered correctly","status":"open","priority":0,"issue_type":"task","created_at":"2025-10-16T22:55:57.878165-05:00","updated_at":"2025-10-16T22:55:57.878165-05:00"}
{"id":"voice-code-101","title":"Performance testing","description":"Test performance with 1000+ sessions.\n\nTests:\n1. Index build time with 1000+ .jsonl files\n2. Measure session_list send time (should be \u003c2s)\n3. Measure per-session load time (should be \u003c200ms)\n4. Verify file watching overhead with 10 subscriptions (\u003c5% CPU)\n5. Memory usage with 1000 sessions in index (~10MB)\n6. Test pagination in iOS (20 sessions/page loads quickly)\n7. Test incremental updates (new message appears \u003c1s after terminal prompt)","acceptance_criteria":"All performance targets met, system scales to 1000+ sessions, no degradation with active watching, memory usage acceptable","status":"open","priority":0,"issue_type":"task","created_at":"2025-10-16T22:56:05.676732-05:00","updated_at":"2025-10-16T22:56:05.676732-05:00"}
{"id":"voice-code-102","title":"Create manual test infrastructure","description":"","design":"Create Clojure-based manual test infrastructure in manual_test/ directory:\n- manual_test/voice_code/fixtures.clj - Shared fixtures (start/stop server, etc.)\n- manual_test/voice_code/websocket_client.clj - WebSocket client helper using http-kit\n- manual_test/voice_code/test_*.clj - Individual test files\n- Makefile with targets: test-manual-startup, test-manual-protocol, etc.\n- deps.edn :manual-test alias with manual_test as extra path\n\nTests in manual_test/ can invoke Claude CLI (cost money) while regular tests in test/ are free.","status":"closed","priority":0,"issue_type":"task","assignee":"backend","created_at":"2025-10-17T09:58:03.444986-05:00","updated_at":"2025-10-17T16:52:28.05795-05:00","closed_at":"2025-10-17T16:52:28.05795-05:00"}
{"id":"voice-code-103","title":"Manual test: Backend startup and session discovery","description":"","acceptance_criteria":"Server starts successfully, session index loads from disk with correct count, filesystem watcher initializes watching all project subdirectories. File: manual_test/voice_code/test_03_startup.clj. Free to run (no Claude invocations).","notes":"✅ PASSED - All assertions passed. Tests session discovery, metadata extraction, and index persistence.","status":"closed","priority":0,"issue_type":"task","assignee":"backend","created_at":"2025-10-17T09:58:13.184067-05:00","updated_at":"2025-10-17T16:36:22.472262-05:00","closed_at":"2025-10-17T16:36:22.472262-05:00","dependencies":[{"issue_id":"voice-code-103","depends_on_id":"voice-code-102","type":"blocks","created_at":"2025-10-17T09:58:13.185082-05:00","created_by":"travisbrown"}]}
{"id":"voice-code-104","title":"Manual test: WebSocket protocol (connect, subscribe, ping)","description":"","acceptance_criteria":"Connect without session_id returns session-list message. Subscribe returns session-history. Ping returns pong. File: manual_test/voice_code/test_04_protocol.clj. Free to run.","notes":"✅ PASSED (after fixes) - Tests ping/pong, connect→session-list, subscribe→session-history. Fixed to expect session-list instead of old 'connected' message.","status":"closed","priority":0,"issue_type":"task","assignee":"backend","created_at":"2025-10-17T09:58:25.522536-05:00","updated_at":"2025-10-17T16:36:22.472499-05:00","closed_at":"2025-10-17T16:36:22.472499-05:00","dependencies":[{"issue_id":"voice-code-104","depends_on_id":"voice-code-102","type":"blocks","created_at":"2025-10-17T09:58:25.523729-05:00","created_by":"travisbrown"}]}
{"id":"voice-code-105","title":"Manual test: Filesystem watcher (new sessions and updates)","description":"","acceptance_criteria":"Watcher detects new .jsonl file creation, broadcasts session-created message within 2 seconds, metadata includes all fields. File: manual_test/voice_code/test_05_watcher_new.clj. COSTS MONEY (invokes Claude CLI).","notes":"⚠️ RUNS BUT FAILS (~$0.15 spent) - Claude CLI successfully creates sessions, but filesystem watcher doesn't detect new .jsonl files. No session_created/session_updated broadcasts received. Root cause: Watcher not adding new sessions to index in real-time.","status":"closed","priority":0,"issue_type":"task","assignee":"backend","created_at":"2025-10-17T09:58:40.906113-05:00","updated_at":"2025-10-17T16:38:32.889948-05:00","closed_at":"2025-10-17T16:38:32.889948-05:00","dependencies":[{"issue_id":"voice-code-105","depends_on_id":"voice-code-102","type":"blocks","created_at":"2025-10-17T09:58:40.907234-05:00","created_by":"travisbrown"}]}
{"id":"voice-code-106","title":"Manual test: Prompt sending with new_session_id","description":"","acceptance_criteria":"Prompt with new_session_id creates new Claude session, returns ack then response, .jsonl file created with correct session_id, session-created broadcast sent. File: manual_test/voice_code/test_06_prompt_new.clj. COSTS MONEY.","notes":"✅ PASSED (~$0.05 spent) - Creates new Claude session via WebSocket with new_session_id. Verifies .jsonl file creation and proper session ID handling.","status":"closed","priority":0,"issue_type":"task","assignee":"backend","created_at":"2025-10-17T09:58:49.366025-05:00","updated_at":"2025-10-17T16:38:32.890207-05:00","closed_at":"2025-10-17T16:38:32.890207-05:00","dependencies":[{"issue_id":"voice-code-106","depends_on_id":"voice-code-102","type":"blocks","created_at":"2025-10-17T09:58:49.367146-05:00","created_by":"travisbrown"},{"issue_id":"voice-code-106","depends_on_id":"voice-code-111","type":"blocks","created_at":"2025-10-17T11:15:01.228306-05:00","created_by":"travisbrown"}]}
{"id":"voice-code-107","title":"Manual test: Prompt sending with resume_session_id","description":"","acceptance_criteria":"Prompt with resume_session_id appends to existing session, maintains conversation context, .jsonl file appended not recreated, session-updated broadcast if subscribed. File: manual_test/voice_code/test_07_prompt_resume.clj. COSTS MONEY.","notes":"✅ PASSED (~$0.10 spent, after fixes) - Tests resume_session_id maintains context. Claude correctly remembered number 42. Fixed kebab-case field names and project folder detection. Verifies .jsonl file appended not recreated.","status":"closed","priority":0,"issue_type":"task","assignee":"backend","created_at":"2025-10-17T09:58:56.342318-05:00","updated_at":"2025-10-17T16:38:32.890329-05:00","closed_at":"2025-10-17T16:38:32.890329-05:00","dependencies":[{"issue_id":"voice-code-107","depends_on_id":"voice-code-102","type":"blocks","created_at":"2025-10-17T09:58:56.342987-05:00","created_by":"travisbrown"},{"issue_id":"voice-code-107","depends_on_id":"voice-code-111","type":"blocks","created_at":"2025-10-17T11:15:01.243041-05:00","created_by":"travisbrown"}]}
{"id":"voice-code-108","title":"Manual test: Multi-client broadcast","description":"","acceptance_criteria":"Multiple WebSocket clients receive same session-created broadcast, messages identical across clients, broadcast timing within 200ms. File: manual_test/voice_code/test_08_broadcast.clj. Free to run.","notes":"❌ FAILED - Fixture issue (session ID nil) + expects non-existent protocol messages. Needs same fixture fix as test 05 + protocol expectations rewrite.","status":"closed","priority":0,"issue_type":"task","assignee":"backend","created_at":"2025-10-17T09:59:04.004053-05:00","updated_at":"2025-10-17T16:36:22.472804-05:00","closed_at":"2025-10-17T16:36:22.472804-05:00","dependencies":[{"issue_id":"voice-code-108","depends_on_id":"voice-code-102","type":"blocks","created_at":"2025-10-17T09:59:04.005027-05:00","created_by":"travisbrown"},{"issue_id":"voice-code-108","depends_on_id":"voice-code-111","type":"blocks","created_at":"2025-10-17T11:15:01.257464-05:00","created_by":"travisbrown"}]}
{"id":"voice-code-109","title":"Manual test: Error handling","description":"","acceptance_criteria":"Invalid JSON handled gracefully, unknown message types return error, missing required fields return descriptive errors, connection stays open after errors. File: manual_test/voice_code/test_09_errors.clj. Free to run.","notes":"⚠️ PARTIAL (4/6 passing) - Tests 07a-07d pass (prompt before connect, invalid type, missing fields). Tests 07e-07f fail (non-existent resume_session_id, conflicting session IDs). Edge case error handling needs adjustment.","status":"closed","priority":0,"issue_type":"task","assignee":"backend","created_at":"2025-10-17T09:59:11.171127-05:00","updated_at":"2025-10-17T16:36:22.47291-05:00","closed_at":"2025-10-17T16:36:22.47291-05:00","dependencies":[{"issue_id":"voice-code-109","depends_on_id":"voice-code-102","type":"blocks","created_at":"2025-10-17T09:59:11.171909-05:00","created_by":"travisbrown"}]}
{"id":"voice-code-110","title":"Fix WebSocket protocol mismatch in session list response","description":"Test 02 expects 'session-list' message type after connect, but server sends different format. Need to either update server to send session-list message type per STANDARDS.md, or update STANDARDS.md and tests to match actual implementation. Test failure location: backend/manual_test/tests/02_protocol_test.clj:54-56","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-10-17T11:07:09.492876-05:00","updated_at":"2025-10-17T15:15:11.816026-05:00","closed_at":"2025-10-17T15:15:11.816026-05:00"}
{"id":"voice-code-111","title":"Fix Test 07 error: test expects 'connected' message but not receiving it","description":"Test 07 (error handling) sub-test 'test-error-both-new-and-resume-session-id' fails with 'Expected message not received: Connected'. The test expects a 'connected' confirmation after connect message, but isn't receiving it. Need to investigate if this is a test issue or server protocol issue. Location: backend/manual_test/tests/07_error_test.clj:193","status":"open","priority":2,"issue_type":"bug","created_at":"2025-10-17T11:07:20.215845-05:00","updated_at":"2025-10-17T15:52:09.919586-05:00"}
{"id":"voice-code-112","title":"Test 02 subscribe test needs sessions to validate","description":"The subscribe test in Test 02 was skipped because no sessions were available to subscribe to. Need to either: 1) Pre-populate test sessions before running the test, or 2) Make the test create its own session to subscribe to, or 3) Document that this test requires existing sessions. Location: backend/manual_test/tests/02_protocol_test.clj (subscribe test)","notes":"Root cause identified: WebSocket client cannot receive large payloads even with 20 messages. Server successfully sends session-history (logs confirm) but client times out waiting. Solutions: 1) Further reduce to 5-10 messages, 2) Implement pagination, 3) Investigate WebSocket frame size limits. Status: 4/5 protocol tests pass, only subscribe test fails.","status":"open","priority":2,"issue_type":"task","created_at":"2025-10-17T11:07:29.164746-05:00","updated_at":"2025-10-17T11:58:02.224485-05:00"}
{"id":"voice-code-113","title":"Backend optimizations for WebSocket payload size limits","description":"Changes made during manual testing: 1) Limited session-list to 50 most recent sessions (was 663), 2) Limited session-history to 20 most recent messages (was full history), 3) Added validation to reject prompts with both new_session_id and resume_session_id, 4) Changed connect response to send session-list. These prevent WebSocket frame size issues.","acceptance_criteria":"Session list limited to reasonable size, session history limited, validation prevents conflicting parameters","status":"open","priority":2,"issue_type":"task","assignee":"backend","created_at":"2025-10-17T11:58:42.660512-05:00","updated_at":"2025-10-17T15:52:09.919906-05:00"}
{"id":"voice-code-114","title":"Filesystem watcher doesn't detect new Claude sessions","description":"Test 03 revealed that when Claude CLI creates new .jsonl files, the filesystem watcher doesn't detect them or broadcast session_created/session_updated messages.\n\nRoot cause: Watcher not adding new sessions to index in real-time.\n\nSteps to reproduce:\n1. Start backend server\n2. Connect WebSocket client\n3. Create new Claude session via CLI with --session-id \u003cuuid\u003e\n4. Expected: Receive session_created broadcast\n5. Actual: No broadcast received, 'Session not found' when trying to subscribe\n\nFiles involved:\n- backend/src/voice_code/replication.clj (watcher implementation)\n- backend/manual_test/tests/03_watcher_test.clj (test that fails)\n\nImpact: Terminal→iOS sync completely broken. Sessions created from terminal won't appear on iOS.","status":"closed","priority":0,"issue_type":"bug","assignee":"backend","created_at":"2025-10-17T13:17:20.881067-05:00","updated_at":"2025-10-17T15:06:23.026154-05:00","closed_at":"2025-10-17T15:06:23.026154-05:00"}
{"id":"voice-code-115","title":"Test 06 (broadcast) needs fixture and protocol fixes","description":"Test 06 fails due to:\n1. Fixture not running (session ID is nil) - same issue as test 05 had\n2. Test expects protocol messages that don't exist\n\nNeeds:\n- Apply same fixture fix as test 05 (call setup in -main)\n- Update protocol expectations to match actual server behavior\n\nFile: backend/manual_test/tests/06_broadcast_test.clj","status":"open","priority":2,"issue_type":"bug","assignee":"backend","created_at":"2025-10-17T13:17:20.968818-05:00","updated_at":"2025-10-17T13:17:20.968818-05:00"}
{"id":"voice-code-116","title":"Test 07 edge cases fail (07e, 07f)","description":"Test 07 has 4/6 tests passing. Edge case tests fail:\n\n07e (non-existent resume_session_id): \n- Server may handle this differently than expected\n- Need to verify error response format\n\n07f (both new_session_id and resume_session_id):\n- Server correctly validates mutually exclusive params\n- Error message not reaching client properly\n\nFile: backend/manual_test/tests/07_error_test.clj\n\nMay need to adjust server error responses or test expectations.","status":"closed","priority":2,"issue_type":"bug","assignee":"backend","created_at":"2025-10-17T13:17:21.064121-05:00","updated_at":"2025-10-17T17:08:07.593609-05:00","closed_at":"2025-10-17T17:08:07.593609-05:00"}
{"id":"voice-code-73","title":"\"Write","description":"","status":"open","priority":0,"issue_type":"task","assignee":"backend","created_at":"2025-10-16T22:51:51.743518-05:00","updated_at":"2025-10-16T22:51:51.743518-05:00"}
{"id":"voice-code-74","title":"Build session metadata index system","description":"Scan .jsonl files on startup to extract metadata and build in-memory index.\n\n- Scan .claude/projects directory recursively for .jsonl files\n- Extract metadata: session-id, name, working-dir, created-at, last-modified, message-count, preview\n- Build in-memory map: session-id to metadata\n- Persist index to .claude/.session-index.edn for fast reload\n- Load from persisted index on subsequent startups","acceptance_criteria":"Can build index from 100+ .jsonl files, index persists to .edn, subsequent startups load from .edn (\u003c1 second), contains all required metadata fields","status":"closed","priority":0,"issue_type":"feature","assignee":"backend","created_at":"2025-10-16T22:52:20.331367-05:00","updated_at":"2025-10-17T09:48:50.563147-05:00","closed_at":"2025-10-17T09:48:50.563147-05:00"}
{"id":"voice-code-75","title":"Implement .jsonl parser","description":"Parse Claude Code .jsonl format to extract messages.\n\n- Parse .jsonl files (one JSON object per line)\n- Extract message fields: role, text, timestamp\n- Handle incremental parsing (read only new lines since last position)\n- Track last-read byte position per file for incremental reads\n- Error handling for malformed JSON lines (skip and log)\n- Return structured message list","acceptance_criteria":"Can parse full .jsonl file into message list, can parse only new lines incrementally (given last position), handles malformed JSON gracefully, returns normalized message structure","status":"closed","priority":0,"issue_type":"feature","assignee":"backend","created_at":"2025-10-16T22:52:28.433104-05:00","updated_at":"2025-10-17T09:48:50.563851-05:00","closed_at":"2025-10-17T09:48:50.563851-05:00"}
{"id":"voice-code-76","title":"Add filesystem watcher with debouncing","description":"Watch .claude/projects for file changes using Java NIO WatchService.\n\n- Use Java NIO WatchService to watch directory\n- Listen for: ENTRY_CREATE, ENTRY_MODIFY, ENTRY_DELETE events\n- Implement debouncing: wait 200ms of quiet before processing\n- Implement parse-retry: retry up to 3 times if parse fails (100ms between retries)\n- Update metadata index when files change\n- Handle partial writes (debouncing prevents reading mid-write)","acceptance_criteria":"Detects new .jsonl files (ENTRY_CREATE), detects modifications (ENTRY_MODIFY) with debouncing, handles partial writes without errors (debounce + retry), updates index when files change","status":"closed","priority":0,"issue_type":"feature","assignee":"backend","created_at":"2025-10-16T22:52:36.699982-05:00","updated_at":"2025-10-17T09:48:50.564111-05:00","closed_at":"2025-10-17T09:48:50.564111-05:00"}
{"id":"voice-code-77","title":"Implement selective file watching","description":"Track subscribed sessions and only watch their .jsonl files.\n\n- Maintain atom of subscribed session IDs\n- When iOS subscribes: add to set, start watching that specific .jsonl file\n- When iOS unsubscribes: remove from set, stop watching file\n- Always watch parent directory for new file creation (ENTRY_CREATE)\n- Only send updates for subscribed sessions\n- Limit to ~5-10 watched files per client","acceptance_criteria":"Only watches .jsonl files for subscribed sessions, always detects new session creation, unwatches when client unsubscribes, performance: \u003c5% CPU overhead with 10 subscriptions","status":"closed","priority":0,"issue_type":"feature","assignee":"backend","created_at":"2025-10-16T22:52:44.372774-05:00","updated_at":"2025-10-17T09:48:50.564354-05:00","closed_at":"2025-10-17T09:48:50.564354-05:00"}
{"id":"voice-code-78","title":"Add session_list message handler","description":"Send session metadata index to iOS on connection.\n\n- On WebSocket connection (after hello), send session_list message\n- Include all session metadata from index\n- Format: {type: session_list, sessions: [{session_id, name, working_directory, last_modified, message_count, preview}]}\n- Performance target: \u003c1 second to send 666 sessions\n- Use snake_case for JSON keys (per standards)","acceptance_criteria":"Sends complete session list on connection, JSON format matches protocol spec, performance: \u003c1s for 666 sessions over local network, iOS can parse and display immediately","status":"closed","priority":0,"issue_type":"feature","assignee":"backend","created_at":"2025-10-16T22:52:52.303266-05:00","updated_at":"2025-10-17T09:48:50.56454-05:00","closed_at":"2025-10-17T09:48:50.56454-05:00"}
{"id":"voice-code-79","title":"Add session_subscribe message handler","description":"Parse .jsonl file on-demand and send full conversation history.\n\n- Handle subscribe message from iOS: {type: subscribe, session_id: \"...\"}\n- Parse requested .jsonl file (lazy load)\n- Extract all messages from file\n- Send session_history: {type: session_history, session_id: \"...\", messages: [...]}\n- Add session to watched set (start monitoring for changes)\n- Track last-read position for incremental updates","acceptance_criteria":"Parses .jsonl on subscribe (lazy), sends full message history to iOS, adds to watched sessions set, handles missing files gracefully (error message)","status":"closed","priority":0,"issue_type":"feature","assignee":"backend","created_at":"2025-10-16T22:53:01.262046-05:00","updated_at":"2025-10-17T09:48:50.564714-05:00","closed_at":"2025-10-17T09:48:50.564714-05:00"}
{"id":"voice-code-80","title":"Add session_updated message handler","description":"Send incremental updates for watched sessions.\n\n- Triggered by filesystem watcher (after debouncing)\n- Parse only new messages (using last-read position)\n- Send to subscribed iOS clients: {type: session_updated, session_id: \"...\", messages: [new messages]}\n- Update last-read position after successful parse\n- Only send to iOS clients subscribed to this session","acceptance_criteria":"Sends only new messages (incremental), triggered by file modification events, updates tracked position after send, only sends to subscribed clients","status":"closed","priority":0,"issue_type":"feature","assignee":"backend","created_at":"2025-10-16T22:53:08.200542-05:00","updated_at":"2025-10-17T09:48:50.56491-05:00","closed_at":"2025-10-17T09:48:50.56491-05:00"}
{"id":"voice-code-81","title":"Add session_created message handler","description":"Broadcast new session creation to all iOS clients.\n\n- Triggered by filesystem watcher (ENTRY_CREATE event)\n- Extract metadata from new .jsonl file\n- Add to metadata index\n- Broadcast to all connected iOS clients: {type: session_created, session_id: \"...\", name: \"...\", ...}\n- iOS will auto-subscribe to new sessions","acceptance_criteria":"Detects new .jsonl files immediately, extracts and indexes metadata, broadcasts to all connected clients, iOS receives and can auto-subscribe","status":"closed","priority":0,"issue_type":"feature","assignee":"backend","created_at":"2025-10-16T22:53:16.509673-05:00","updated_at":"2025-10-17T09:48:50.565107-05:00","closed_at":"2025-10-17T09:48:50.565107-05:00"}
{"id":"voice-code-82","title":"Add session_deleted message handler","description":"Track iOS client deletions and stop replication.\n\n- Handle session_deleted from iOS: {type: session_deleted, session_id: \"...\"}\n- Track deleted sessions per iOS client (in client state map)\n- Unsubscribe from session (stop watching)\n- Ignore future updates for this session for this client\n- Do NOT delete backend .jsonl file (file remains on dev machine)","acceptance_criteria":"Unsubscribes from deleted session, stops sending updates to that iOS client, file remains on backend (not deleted), other clients still receive updates","status":"closed","priority":0,"issue_type":"feature","assignee":"backend","created_at":"2025-10-16T22:53:23.853474-05:00","updated_at":"2025-10-17T09:48:50.565295-05:00","closed_at":"2025-10-17T09:48:50.565295-05:00"}
{"id":"voice-code-83","title":"Update prompt handler for new/resume distinction","description":"Support new_session_id vs resume_session_id fields.\n\n- Parse new_session_id field: call claude --session-id \u003cid\u003e \"prompt\"\n- Parse resume_session_id field: call claude --resume \u003cid\u003e \"prompt\"\n- Remove direct response message (responses come via subscription)\n- iOS generates UUID for new sessions\n- Send only ack, responses come via session_updated\n\nProtocol:\n- {type: prompt, new_session_id: \"...\", text: \"...\"} → --session-id\n- {type: prompt, resume_session_id: \"...\", text: \"...\"} → --resume","acceptance_criteria":"Handles new_session_id correctly (--session-id), handles resume_session_id correctly (--resume), no direct response message, responses flow through subscription path","status":"closed","priority":0,"issue_type":"feature","assignee":"backend","created_at":"2025-10-16T22:53:33.011989-05:00","updated_at":"2025-10-17T09:48:50.56549-05:00","closed_at":"2025-10-17T09:48:50.56549-05:00"}
{"id":"voice-code-84","title":"Remove old session persistence logic","description":"Clean up iOS session UUID mapping and sessions.edn storage.\n\n- Remove sessions.edn file and storage logic\n- Remove channel-to-session atom mapping\n- Remove iOS session UUID → Claude session ID mapping\n- Remove register-channel! and related functions\n- Simplify to pure session replication (no session state management)\n- Update tests to reflect new architecture","acceptance_criteria":"sessions.edn storage removed, iOS session UUID mapping removed, code simplified (session replication only), all tests passing with new architecture","status":"closed","priority":0,"issue_type":"feature","assignee":"backend","created_at":"2025-10-16T22:53:40.407256-05:00","updated_at":"2025-10-17T09:48:50.565636-05:00","closed_at":"2025-10-17T09:48:50.565636-05:00"}
{"id":"voice-code-85","title":"Add session naming logic","description":"Generate default names for sessions.\n\n- Terminal sessions: \"Terminal: \u003cdir-name\u003e - \u003ctimestamp\u003e\"\n- iOS sessions: \"Voice: \u003cdir-name\u003e - \u003ctimestamp\u003e\"\n- Detect forks: \"\u003cparent-name\u003e (fork)\" or \"\u003cparent-name\u003e (compacted)\" if \u003c1min\n- Extract working directory from .jsonl or parent folder\n- Format timestamp: YYYY-MM-DD HH:MM\n- Include name in session metadata\n\nLogic:\n- If session created \u003c1min after parent: \"(compacted)\"\n- Otherwise: \"(fork)\"\n- Determine Terminal vs Voice by checking if iOS client initiated","acceptance_criteria":"Generates meaningful default names, detects and labels forks appropriately, includes working directory and timestamp, names appear in session_list and session_created","status":"closed","priority":0,"issue_type":"feature","assignee":"backend","created_at":"2025-10-16T22:53:49.745702-05:00","updated_at":"2025-10-17T09:48:50.565814-05:00","closed_at":"2025-10-17T09:48:50.565814-05:00"}
{"id":"voice-code-86","title":"Write tests for replication system","description":"Comprehensive test coverage for new replication architecture.\n\nTests:\n- Index building from 100+ .jsonl files\n- Incremental file parsing (new lines only)\n- Debouncing and parse-retry logic\n- Selective file watching (subscribe/unsubscribe)\n- Protocol messages: session_list, session_subscribe, session_history, session_updated, session_created\n- New vs resume prompt handling (--session-id vs --resume)\n- Session naming generation\n- Deletion handling","acceptance_criteria":"All tests passing, coverage for core replication logic, integration tests for file watching, protocol message tests","status":"closed","priority":0,"issue_type":"task","assignee":"backend","created_at":"2025-10-16T22:53:59.609647-05:00","updated_at":"2025-10-17T09:48:50.565967-05:00","closed_at":"2025-10-17T09:48:50.565967-05:00"}
{"id":"voice-code-87","title":"Design CoreData schema","description":"Design CoreData schema for session and message storage.\n\nEntities:\n- Session: id (UUID), backendName (String), localName (String?), workingDir (String), lastModified (Date), messageCount (Int), preview (String), isDeleted (Bool)\n- Message: id (UUID), sessionId (UUID), role (String), text (String), timestamp (Date), status (MessageStatus enum), serverTimestamp (Date?)\n\nRelationships:\n- Session.messages → [Message]\n- Message.session → Session\n\nEnums:\n- MessageStatus: .sending, .confirmed, .error","acceptance_criteria":"CoreData model file created, entities defined with all fields, relationships configured, compiles without errors","status":"open","priority":0,"issue_type":"task","assignee":"ios","created_at":"2025-10-16T22:54:14.891234-05:00","updated_at":"2025-10-16T22:54:14.891234-05:00"}
{"id":"voice-code-88","title":"Implement session metadata sync","description":"Handle session_list message and store metadata in CoreData.\n\n- Receive session_list on WebSocket connection\n- Parse sessions array\n- Store in CoreData (Session entities)\n- Display in sessions list view\n- Support pagination (20 sessions per page initially)\n- Load more on scroll","acceptance_criteria":"Receives session_list, stores all sessions in CoreData, displays in UI with pagination, \"load more\" works correctly","status":"open","priority":0,"issue_type":"feature","assignee":"ios","created_at":"2025-10-16T22:54:23.075193-05:00","updated_at":"2025-10-16T22:54:23.075193-05:00"}
{"id":"voice-code-89","title":"Implement lazy session loading","description":"Load full conversation when user opens a session.\n\n- When user taps session: send subscribe message\n- Receive session_history response\n- Parse messages array\n- Store messages in CoreData (linked to session)\n- Display in conversation view\n- Show loading indicator during fetch","acceptance_criteria":"Sends subscribe on session open, receives and stores session_history, displays messages in conversation view, loading indicator shown","status":"open","priority":0,"issue_type":"feature","assignee":"ios","created_at":"2025-10-16T22:54:29.59329-05:00","updated_at":"2025-10-16T22:54:29.59329-05:00"}
{"id":"voice-code-90","title":"Implement incremental message updates","description":"Handle session_updated messages and update CoreData.\n\n- Receive session_updated messages from WebSocket\n- Parse new messages array\n- Append to CoreData for that session\n- Update UI in real-time (if session is open)\n- Update session preview and message count in list view","acceptance_criteria":"Receives session_updated, appends new messages to CoreData, UI updates in real-time, session list shows updated preview/count","status":"open","priority":0,"issue_type":"feature","assignee":"ios","created_at":"2025-10-16T22:54:36.248463-05:00","updated_at":"2025-10-16T22:54:36.248463-05:00"}
{"id":"voice-code-91","title":"Implement optimistic UI for prompts","description":"Display user prompts immediately with optimistic UI pattern.\n\n- When user sends prompt: create Message with status .sending\n- Add to CoreData immediately\n- Display in conversation view (show sending indicator)\n- When session_updated arrives: reconcile by matching text\n- Update status to .confirmed, add serverTimestamp\n- Handle case where message not found (backend-originated prompt)","acceptance_criteria":"User prompts appear instantly, reconciliation works correctly, status updates from .sending to .confirmed, backend prompts handled gracefully","status":"open","priority":0,"issue_type":"feature","assignee":"ios","created_at":"2025-10-16T22:54:43.752348-05:00","updated_at":"2025-10-16T22:54:43.752348-05:00"}
{"id":"voice-code-92","title":"Update prompt sending logic","description":"Use new_session_id vs resume_session_id fields for prompts.\n\n- Generate UUID for new sessions (before sending prompt)\n- Send subscribe(uuid) before prompt for new sessions\n- Use new_session_id field for new sessions\n- Use resume_session_id field for existing sessions\n- Remove iOS session UUID from protocol\n- Working directory from session or user selection\n\nMessage format:\n- New: {type: prompt, new_session_id: uuid, text: \"...\", working_directory: \"...\"}\n- Resume: {type: prompt, resume_session_id: uuid, text: \"...\", working_directory: \"...\"}","acceptance_criteria":"Generates UUIDs for new sessions, sends subscribe before prompt, uses correct field (new_session_id vs resume_session_id), iOS session UUID removed","status":"open","priority":0,"issue_type":"feature","assignee":"ios","created_at":"2025-10-16T22:54:51.459293-05:00","updated_at":"2025-10-16T22:54:51.459293-05:00"}
{"id":"voice-code-93","title":"Implement smart speaking logic","description":"Only speak messages for active/open session.\n\n- Track currently active session ID\n- When session_updated arrives: check if message is for active session\n- If active session + assistant message: speak it\n- If background session: buffer message, update badge count\n- Show unread count in session list\n- Mark as read when user opens session","acceptance_criteria":"Only speaks messages for active session, background sessions show badge count, unread count visible in list, mark as read works","status":"open","priority":0,"issue_type":"feature","assignee":"ios","created_at":"2025-10-16T22:54:58.774589-05:00","updated_at":"2025-10-16T22:54:58.774589-05:00"}
{"id":"voice-code-94","title":"Add long-press \"Read Aloud\" menu","description":"Add context menu to read historical messages aloud.\n\n- Long-press on any message: show context menu\n- Menu option: \"Read Aloud\"\n- Trigger TTS for that message text\n- Interrupt current playback if needed\n- Works for both user and assistant messages","acceptance_criteria":"Long-press shows context menu, \"Read Aloud\" option present, TTS plays selected message, interrupts current playback","status":"open","priority":0,"issue_type":"feature","assignee":"ios","created_at":"2025-10-16T22:55:05.79065-05:00","updated_at":"2025-10-16T22:55:05.79065-05:00"}
{"id":"voice-code-95","title":"Implement session deletion","description":"Allow users to delete sessions locally.\n\n- Swipe to delete gesture in session list\n- Send session_deleted message to backend\n- Mark session as deleted in CoreData (isDeleted = true)\n- Hide from UI (filter out deleted sessions)\n- Send unsubscribe message\n- No backend file deletion (local only)","acceptance_criteria":"Swipe to delete works, sends session_deleted to backend, marks as deleted in CoreData, hidden from UI, unsubscribe sent","status":"open","priority":0,"issue_type":"feature","assignee":"ios","created_at":"2025-10-16T22:55:14.723884-05:00","updated_at":"2025-10-16T22:55:14.723884-05:00"}
{"id":"voice-code-96","title":"Add session renaming","description":"Allow users to rename sessions locally.\n\n- Edit button or gesture in session detail view\n- Text field to enter custom name\n- Store in localName field (CoreData)\n- Display: localName ?? backendName\n- No backend sync (local only)\n- Update UI immediately on change","acceptance_criteria":"Can edit session name, stores in localName field, displays custom name if set, falls back to backendName, no backend sync","status":"open","priority":0,"issue_type":"feature","assignee":"ios","created_at":"2025-10-16T22:55:21.150448-05:00","updated_at":"2025-10-16T22:55:21.150448-05:00"}
{"id":"voice-code-97","title":"Test terminal to iOS sync","description":"End-to-end test: terminal session appears on iOS.\n\nSteps:\n1. Start backend and iOS app\n2. Create new Claude session from terminal\n3. Verify iOS receives session_created message\n4. Verify session appears in iOS session list\n5. Verify auto-subscription works\n6. Send prompt from terminal\n7. Verify iOS receives session_updated\n8. Verify messages display correctly","acceptance_criteria":"Terminal sessions appear on iOS, auto-subscription works, messages sync correctly, end-to-end flow complete","status":"open","priority":0,"issue_type":"task","created_at":"2025-10-16T22:55:34.797134-05:00","updated_at":"2025-10-16T22:55:34.797134-05:00"}
{"id":"voice-code-98","title":"Test iOS to iOS sync","description":"End-to-end test: iOS session syncs to other iOS clients.\n\nSteps:\n1. Start backend and iOS app\n2. Create new session from iOS (send prompt with new_session_id)\n3. Backend creates .jsonl file\n4. Verify filesystem watcher detects new file\n5. Verify messages sync via session_updated\n6. Connect second iOS client\n7. Verify session appears in session_list\n8. Verify can subscribe and see full history","acceptance_criteria":"iOS sessions create backend files, sync via file watching works, other iOS clients receive sessions, full history available","status":"open","priority":0,"issue_type":"task","created_at":"2025-10-16T22:55:42.763758-05:00","updated_at":"2025-10-16T22:55:42.763758-05:00"}
{"id":"voice-code-99","title":"Test session forking","description":"Test concurrent resume creates fork that appears on iOS.\n\nSteps:\n1. Create session from terminal\n2. iOS subscribes to session\n3. From terminal: resume same session (concurrent)\n4. Claude creates fork (session-id-fork-1.jsonl)\n5. Verify filesystem watcher detects new fork file\n6. Verify iOS receives session_created for fork\n7. Verify iOS auto-subscribes to fork\n8. Verify fork name includes \"(fork)\" or \"(compacted)\"","acceptance_criteria":"Concurrent resume creates fork, fork detected by watcher, iOS receives session_created, auto-subscription works, fork naming correct","status":"open","priority":0,"issue_type":"task","created_at":"2025-10-16T22:55:51.300792-05:00","updated_at":"2025-10-16T22:55:51.300792-05:00"}
